"use strict";(self.webpackChunk_datalayer_jupyter_iam=self.webpackChunk_datalayer_jupyter_iam||[]).push([[278],{21780:(e,t,r)=>{r.d(t,{Dt:()=>p,c7:()=>d,hV:()=>u,mB:()=>h});var a=r(33078),n=r(79304),s=r.n(n),i=r(53761);const l="DATALAYER_IAM_USER_KEY",o="DATALAYER_IAM_TOKEN_KEY",c="refresh_token",d=e=>{if(e){const t={handle:e.handle,firstName:e.firstName,lastName:e.lastName,email:e.email,displayName:e.displayName,joinDate:e.joinDate,roles:e.roles};window.localStorage.setItem(l,JSON.stringify(t))}else window.localStorage.removeItem(l)},h=e=>{if(e){if(localStorage.setItem(o,e),e!==i.q$)try{s()(e)}catch(e){console.error(e)}}else window.localStorage.removeItem(o)},u=()=>window.localStorage.getItem(o)||i.q$;function p(){return(0,a.getCookie)(c)}},69371:(e,t,r)=>{r.d(t,{w:()=>k});var a=r(74512),n=r(13899),s=r(2947),i=r(32126),l=r(75734),o=r(19118),c=r(19893),d=r(46722),h=r(45455),u=r(34500),p=r(44619),m=r(52746),f=r(16419),x=r(14675),j=r(86642),g=r(66029),v=r(57306),y=r(53761),Z=r(83513);function k(){const{apiRequest:e}=(0,v.h)({loginRoute:null}),{iamServerURL:t,user:r}=(0,Z.ZP)(),[h,u]=(0,g.useState)(null),[p,j]=(0,g.useState)(null),k=(0,g.useCallback)((()=>{r?e({method:"POST",url:`${t}/api/iam/v1/users`,body:{namingPattern:"*"}}).then((e=>{e.success?u(e.users.map((e=>{const t=(0,y.b0)(e);return t.id=t.uid,t}))):console.error("Failed to fetch users",e.message)})).catch((e=>{console.error("Failed to fetch users",e)})):u(null)}),[r,u]);(0,g.useEffect)((()=>{k()}),[r]);const b=(0,g.useCallback)((r=>{if(j(null),!p||!r)return;const a=[...p.roles];Promise.all([...r.filter((e=>!a.includes(e))).map((r=>e({method:"PUT",url:`${t}/api/iam/v1/user/${p.handle}/role`,body:{role:r}}))),...a.filter((e=>!r.includes(e))).map((r=>e({method:"DELETE",url:`${t}/api/iam/v1/user/${p.handle}/role/${r}`})))]).catch((e=>{console.error(`Failed to update some roles for user ${p.handle}`,e)})).finally((()=>{k()}))}),[p,k]);return(r?.roles??[]).includes(n.UserRoles.SystemAdministrator)?(0,a.jsxs)(i.Z,{children:[(0,a.jsxs)(m.i.Container,{children:[(0,a.jsx)(m.i.Title,{as:"h2",id:"manage-users",children:"Users"}),h?.length?(0,a.jsx)(f.w,{"aria-labelledby":"manager-users",data:h,columns:[{header:"Handle",field:"handle",maxWidth:"200px"},{header:"Name",field:"displayName",maxWidth:"200px"},{header:"UID",field:"uid",maxWidth:"260px"},{header:"Origin",field:"origin",maxWidth:"200px"},{header:"Roles",field:"roles",renderCell:e=>(0,a.jsxs)(i.Z,{sx:{display:"inline-flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[e.roles.map((e=>(0,a.jsx)(l.Z,{text:e}))),(0,a.jsx)(o.h,{"aria-label":"Edit the user roles",icon:s.EditIcon,size:"small",onClick:()=>{j(e)}})]})}]}):(0,a.jsx)(i.Z,{sx:{gridArea:"table"},children:h?(0,a.jsxs)(x.Z,{border:!0,children:[(0,a.jsx)(x.Z.Heading,{children:"Users"}),(0,a.jsx)(x.Z.Description,{children:(0,a.jsx)(i.Z,{sx:{textAlign:"center"},children:(0,a.jsx)(i.Z,{children:"No users register."})})})]}):(0,a.jsx)(i.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"140px"},children:(0,a.jsx)(c.Z,{})})})]}),p&&(0,a.jsx)(_,{user:p,onSubmit:b})]}):(0,a.jsx)(d.Z,{variant:"danger",children:"You are not authorized to access this resource."})}const b=Object.values(n.UserRoles).map(((e,t)=>({text:e,id:t.toString()})));function _({user:e,onSubmit:t}){const[r,n]=(0,g.useState)(e.roles.map((e=>b.find((t=>t.text===e))))),s=r.map((e=>e.id)),[l,o]=(0,g.useState)(s),c=e=>{n(r.filter((t=>t.id!==e))),o(l.filter((t=>t!==e)))};return(0,a.jsx)(j.V,{title:`Edit user ${e.handle} roles`,onClose:()=>{t(null)},footerButtons:[{buttonType:"default",onClick:()=>{t(null)},content:"Cancel"},{buttonType:"primary",onClick:()=>{t(r.map((e=>e.text)))},content:"Apply",autoFocus:!0}],children:(0,a.jsx)(i.Z,{as:"form",children:(0,a.jsxs)(h.Z,{children:[(0,a.jsx)(h.Z.Label,{id:"user-roles-input"}),(0,a.jsxs)(u.Z,{children:[(0,a.jsx)(u.Z.Input,{as:p.Z,tokens:r,onTokenRemove:c}),(0,a.jsx)(u.Z.Overlay,{children:(0,a.jsx)(u.Z.Menu,{items:b,selectedItemIds:l,onSelectedChange:e=>{if(Array.isArray(e))if(o(e.map((e=>e.id))),e.length<l.length){const t=e.map((({id:e})=>e)),r=s.filter((e=>!t.includes(e)));for(const e of r)c(e)}else n(e.map((({id:e,text:t})=>({id:e,text:t}))))},selectionVariant:"multiple","aria-labelledby":"user-roles-input"})})]})]})})})}},4833:(e,t,r)=>{r.d(t,{q:()=>h});var a=r(74512),n=r(32126),s=r(19893),i=r(46722),l=r(66029),o=r(57306),c=r(83513),d=r(89381);function h(){const{apiRequest:e}=(0,o.h)({loginRoute:null}),{iamServerURL:t,token:r}=(0,c.oR)(),[h,u]=(0,l.useState)(void 0);(0,l.useEffect)((()=>{r?e({method:"GET",url:`${t}/api/iam/v1/user`}).then((e=>{u(e?.profile??null)})):u(null)}),[r]);const p=h?{color:"",display_name:`${h.user_first_name_t||""} ${h.user_last_name_t||""}`.trim(),initials:((h.user_first_name_t||" ").charAt(0)+(h.user_last_name_t||" ").charAt(0)).toLocaleUpperCase().trim(),name:h.user_handle_s,username:h.user_handle_s,avatar_url:h.avatar_url_s,origin:h.origin_s}:null;return void 0===h?(0,a.jsx)(n.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40px"},children:(0,a.jsx)(s.Z,{})}):h?(0,a.jsxs)(n.Z,{children:[(0,a.jsx)(d.tO,{identity:p,displayToken:!1}),(0,a.jsx)(d.i6,{roles:h.roles_ss})]}):(0,a.jsx)(i.Z,{variant:"warning",children:"Unable to get the user identity"})}},89381:(e,t,r)=>{r.d(t,{i6:()=>h,jz:()=>f,p9:()=>m,tO:()=>u});var a=r(74512),n=r(2947),s=r(21809),i=r(32935),l=r(17719),o=r(75734),c=r(62005),d=r(32126);const h=e=>{const{permissions:t,roles:r}=e;return(0,a.jsxs)(a.Fragment,{children:[t&&(0,a.jsx)(s.Z,{children:(0,a.jsx)(c.Z,{as:"h3",children:"Permissions"})}),r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.Z,{children:(0,a.jsx)(c.Z,{as:"h3",children:"Roles"})}),(0,a.jsx)(d.Z,{children:(0,a.jsx)("ul",{children:r.map((e=>(0,a.jsx)("li",{children:(0,a.jsx)(c.Z,{children:e})},e)))})})]})]})},u=e=>{const{identity:t,displayToken:r=!0}=e,h=t?.color?m(t.color):void 0;return t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.Z,{children:(0,a.jsx)(c.Z,{as:"h3",children:"Identity"})}),(0,a.jsxs)(d.Z,{sx:{display:"flex"},children:[(0,a.jsx)(d.Z,{children:(0,a.jsx)(i.Z,{sx:{width:100},children:(0,a.jsx)(l.Z,{square:!0,src:t.avatar_url?`${t.avatar_url}?v=4&s=200&d=${f}`:decodeURIComponent(f),sx:{width:100,height:100}})})}),(0,a.jsx)(d.Z,{ml:3,children:(0,a.jsxs)(d.Z,{sx:{display:"grid",gridTemplateColumns:"1fr 2fr",rowGap:3,columnGap:3,maxWidth:500},children:[(0,a.jsx)(d.Z,{sx:{p:1},children:(0,a.jsx)(c.Z,{sx:{fontWeight:"bold"},children:"Name"})}),(0,a.jsx)(d.Z,{sx:{p:1},children:(0,a.jsx)(c.Z,{children:t.display_name})}),(0,a.jsx)(d.Z,{sx:{p:1},children:(0,a.jsx)(c.Z,{sx:{fontWeight:"bold"},children:"Initials"})}),(0,a.jsx)(d.Z,{sx:{p:1},children:(0,a.jsx)(c.Z,{children:t.initials})}),(0,a.jsx)(d.Z,{sx:{p:1},children:(0,a.jsx)(c.Z,{sx:{fontWeight:"bold"},children:"Username"})}),(0,a.jsx)(d.Z,{sx:{p:1},children:(0,a.jsx)(c.Z,{children:t.username})}),t.origin&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.Z,{sx:{p:1},children:(0,a.jsx)(c.Z,{sx:{fontWeight:"bold"},children:"Provider"})}),(0,a.jsx)(d.Z,{sx:{p:1},children:(0,a.jsx)(c.Z,{children:t.origin})})]})]})})]}),r&&(0,a.jsx)(d.Z,{mt:3,children:(0,a.jsx)(o.Z,{text:t.display_name,color:h,size:"large",leadingVisual:n.AlienIcon,sx:{backgroundColor:h}})})]})},p={"--jp-collaborator-color1":"#ffad8e","--jp-collaborator-color2":"#dac83d","--jp-collaborator-color3":"#72dd76","--jp-collaborator-color4":"#00e4d0","--jp-collaborator-color5":"#45d4ff","--jp-collaborator-color6":"#e2b1ff","--jp-collaborator-color7":"#ff9de6"},m=e=>p[e.replaceAll("var(","").replaceAll(")","")],f=encodeURIComponent("https://avatars.githubusercontent.com/u/70511875?s=200&v=4")},57306:(e,t,r)=>{r.d(t,{h:()=>s});var a=r(83513),n=r(20948);const s=({loginRoute:e="/"}={})=>{const{iamServerURL:t,clearAuth:r,token:s}=(0,a.oR)(),i=e?(0,n.s)():()=>{throw new Error("Unauthorized")},l=async t=>{const a=t.token??s,n={Accept:"application/json","Content-Type":"application/json"};a&&(n.Authorization=`Bearer ${a}`);const l=await fetch(t.url,{method:t.method,headers:n,body:t.body?JSON.stringify(t.body):void 0,credentials:a?"include":"omit"});if(l.status<200||l.status>=300){if(401!==l.status)throw new Error(l.status.toString());console.log("Jupyter IAM has received a 401 return code."),r(),i(e)}return await l.json()};return{apiRequest:l,me:async e=>{const r=(await l({url:`${t}/api/iam/v1/me`,method:"GET",token:e})).me;return r?{uid:r.uid,handle:r.handle,email:r.email,firstName:r.first_name,lastName:r.last_name,displayName:r.display_name,joinDate:void 0,roles:r.roles}:null}}}},20948:(e,t,r)=>{r.d(t,{s:()=>n});var a=r(83627);const n=()=>{const e=(0,a.useNavigate)();return(t,r=null,a=!0)=>{r&&r.preventDefault(),window.scrollTo(0,0),document.body.scrollTop=0,e(t)}}},90278:(e,t,r)=>{r.r(t),r.d(t,{IJupyterIAM:()=>N,default:()=>J});var a=r(13899);const n=new(r(1339).zZ)({name:"@datalayer/icons:passport-control",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72" fill="currentColor" aria-hidden="true">\n  <path fill="#92d3f5" d="M16.274 61.9s-1.8-13.9 10.2-13.9c3.2 2.1 5.9 3.6 9 3.6h-.1c3.1 0 6.3-1.6 9.5-3.7 11.6 0 9.6 13.9 9.8 14"/>\n  <path fill="#61b2e4" d="M44.844 47.285a18.274 18.274 0 01-8.87 3.514c13.1.4 13.1 7.1 13.8 11.1h5.1s1.97-14.614-10.03-14.614z"/>\n  <path fill="#92d3f5" d="M50.074 19.5c1.2.3.4 2.5-.4 3.5l-2.2 2.7h-.1a8.625 8.625 0 00-1.9-2l-.6-.4a15.38 15.38 0 001.3-1.2h-21.1a9.832 9.832 0 001.5 1.2l-.8.5a8.292 8.292 0 00-1.8 1.8l-.1-.1-2-2.4c-.8-1-1.6-3.2-.4-3.5 5.7-1.5 6-7.9 14.3-7.9s8.6 6.3 14.3 7.8zm-14.2.4c2.1 0 2.5-3.9 2.5-3.9a4.31 4.31 0 00-5-.1c-.1 0 .3 4 2.5 4z"/>\n  <path fill="#fcea2b" d="M35.874 19.9c-2.1 0-2.5-3.9-2.5-3.9a4.01 4.01 0 015 .1c0-.1-.4 3.8-2.5 3.8z"/>\n  <path fill="#61b2e4" d="M42.674 13.8s.9 8.2-2.6 8.2l5.3.3 1.7 3s3.7-1.9 3.6-5.2c.1 0-7.2-4.2-8-6.3z"/>\n  <path fill="#3f3f3f" d="M33.774 25.6a16.173 16.173 0 01-7.2-2.4c-.6-.4-1-.8-1.5-1.2h21.1a4.894 4.894 0 01-1.3 1.2 11.584 11.584 0 01-3.7 1.8 18.327 18.327 0 01-7.4.6z"/>\n  <g fill="#92d3f5">\n    <path d="M44.474 48.1l-3.7 8.8-2.6-2.7-2.5-2.6h.1c2.9-.1 5.6-1.5 8.7-3.5zM35.574 51.6l-2.6 2.7-2.6 2.6-3.6-8.9c3.1 2.1 5.8 3.5 8.8 3.6z"/>\n  </g>\n  <path fill="#fcea2b" d="M47.03 48.169L41.547 62h5.477l5.169-11.645s-2.768-2.698-5.163-2.186"/>\n  <path fill="#d0cfce" d="M11.822 39.203h10.557v14.976H11.822z"/>\n  <g>\n    <path fill="#fcea2b" d="M46.874 33.3l.1-.1c-.7 7-5.5 12.5-11.3 12.5-5.9 0-10.6-5.5-11.3-12.6a12.562 12.562 0 019.3-7.4 18.327 18.327 0 007.4-.6c3.1.3 5.8 8.2 5.8 8.2zm-5.1-3.2a2 2 0 10-2 2 2.006 2.006 0 002-2zm-8 0a2 2 0 10-2 2 2.006 2.006 0 002-2z"/>\n  </g>\n  <g fill="#f4aa41">\n    <path d="M46.974 33.2l-.1.1s-2.7-8-5.8-8.2a10.643 10.643 0 003.7-1.8l.7.5a8.625 8.625 0 011.9 2c1.2 1.7 2 4.3-.4 7.4zM24.474 33a.774.774 0 00-.1.3c-2.6-3.3-1.6-6-.3-7.7a8.641 8.641 0 011.8-1.8l.8-.6a16.173 16.173 0 007.2 2.4 12.573 12.573 0 00-9.4 7.4z"/>\n  </g>\n  <g>\n    <path fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M46.99 48.521l-5.216 12.45M51.611 50.681l-4.549 10.316"/>\n    <g fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">\n      <path d="M22.378 48.744a11.998 11.998 0 014.396-.745c3.2 2.1 5.9 3.5 8.9 3.6h.1c3 0 5.6-1.4 8.7-3.5.1 0 .1-.1.2-.1 12 0 10 13 10 13M16.774 61a16.229 16.229 0 01.603-6.819"/>\n      <path d="M26.774 47.999l3.7 8.9 2.6-2.7 2.5-2.6M38.174 54.199l-2.6-2.6M44.474 47.999v.1l-3.7 8.8-2.6-2.7"/>\n    </g>\n    <path d="M26.774 60.4h-5.8a1 1 0 110-2h5.8a.945.945 0 011 1 1.002 1.002 0 01-1 1zM35.774 40.1a6.921 6.921 0 01-3.4-.9.962.962 0 01.9-1.7 5.154 5.154 0 005.1 0 .962.962 0 11.9 1.7 7.594 7.594 0 01-3.5.9zM41.774 30.1a2 2 0 11-2-2 2.006 2.006 0 012 2zM33.774 30.1a2 2 0 11-2-2 2.006 2.006 0 012 2z"/>\n    <path d="M35.774 46.7c-6.4 0-11.7-5.9-12.3-13.8l2-.2c.5 6.7 5 11.9 10.3 11.9s9.7-5 10.3-11.7c0-.5.1-1 .1-1.5h2a9.702 9.702 0 01-.1 1.7c-.7 7.8-6 13.6-12.3 13.6z"/>\n    <path d="M24.374 34.3a.91.91 0 01-.8-.4 7.231 7.231 0 01-1.8-5.7 8.31 8.31 0 013.4-5.2l.7-.5a1 1 0 011.2 1.6l-.8.6a6.163 6.163 0 00-2.6 3.9 4.367 4.367 0 00.5 2.7 13.119 13.119 0 019.5-6.6.903.903 0 011.1.9.945.945 0 01-.9 1.1 10.854 10.854 0 00-8.7 7 .871.871 0 01-.8.6z"/>\n    <path d="M36.074 26.8c-4.7 0-9.2-1.5-11.7-4a.913.913 0 01-.2-1.1.961.961 0 01.9-.6h21.1a.961.961 0 01.9.6 1.073 1.073 0 01-.1 1.1c-2 2.4-5.7 3.9-10 4zm-7.8-3.7a17.89 17.89 0 008.6 1.7 13.836 13.836 0 006.5-1.7z"/>\n    <path d="M47.474 26.8a1.421 1.421 0 01-.6-.2.972.972 0 01-.1-1.4l2.2-2.7a4.061 4.061 0 00.8-1.9c-2.6-.7-4.1-2.3-5.6-3.8-2-2-3.9-4-8.3-4-4.5 0-6.3 1.9-8.3 4-1.5 1.5-3 3.1-5.6 3.8a3.701 3.701 0 00.8 1.9l2 2.4a.993.993 0 01-1.5 1.3l-2-2.4c-.7-.8-1.6-2.6-1.2-3.9a1.764 1.764 0 011.3-1.2 10.908 10.908 0 004.8-3.3c2.1-2.1 4.4-4.6 9.7-4.6s7.7 2.4 9.7 4.6c1.4 1.4 2.7 2.8 4.8 3.3a1.952 1.952 0 011.3 1.2c.4 1.3-.5 3.1-1.2 3.9l-2.2 2.7a1.91 1.91 0 01-.8.3z"/>\n    <path d="M46.974 34.3h-.2a.969.969 0 01-.8-.7c-1-3-3.3-7.4-4.9-7.5a.903.903 0 01-.9-1.1.955.955 0 011.1-.9c2.7.2 4.8 4.3 5.9 7a4.418 4.418 0 00.4-2.5 6.163 6.163 0 00-2.6-3.9l-.7-.6a.993.993 0 011.3-1.5l.7.5a7.947 7.947 0 013.3 5.2 7.231 7.231 0 01-1.8 5.7 1.135 1.135 0 01-.8.3zM35.874 20.9c-2.9 0-3.5-4.3-3.5-4.8a1.086 1.086 0 01.4-.9c2-1.5 5-1.2 6.3.1a1.135 1.135 0 01.3.8c-.1.5-.6 4.8-3.5 4.8zm0-2c.8 0 1.2-1.5 1.4-2.4a3.397 3.397 0 00-2.8 0c.2 1 .7 2.4 1.4 2.4zM39.774 28.1a2 2 0 11-2 2 2.006 2.006 0 012-2zM31.774 28.1a2 2 0 11-2 2 2.006 2.006 0 012-2z"/>\n    <path fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M22.379 48.744v-9.541H11.822v14.976h5.549"/>\n    <path fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.371 54.179h5.008v-5.435"/>\n  </g>\n</svg>\n'});var s=r(2677),i=r(37756),l=r(38428),o=r(72832),c=r(97930),d=r(83513),h=r(71363),u=r(57520);async function p(e="",t={}){const r=u.ServerConnection.makeSettings(),a=h.URLExt.join(r.baseUrl,"jupyter_iam",e);let n;try{n=await u.ServerConnection.makeRequest(a,t,r)}catch(e){throw new u.ServerConnection.NetworkError(e)}let s=await n.text();if(s.length>0)try{s=JSON.parse(s)}catch(e){console.log("Not a JSON response body.",n)}if(!n.ok)throw new u.ServerConnection.ResponseError(n,s.message||s);return s}var m=r(74512),f=r(33078),x=r(66029),j=r(59689),g=r(59606),v=r(32126),y=r(61726),Z=r(2947),k=r(21809),b=r(11048),_=r(62005),w=r(5917);const S={small:16,medium:32,large:64},M=x.forwardRef((function({title:e,titleId:t,size:r,colored:a,...n},s){return x.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 243.75 243.75",fill:a?"currentColor":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("currentColor")?"white":"currentColor","aria-hidden":"true",width:r?"string"==typeof r?S[r]:r:"16px",ref:s,"aria-labelledby":t},n),e?x.createElement("title",{id:t},e):null,x.createElement("g",{fill:a?"#fff":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("#fff")?"white":"currentColor",strokeWidth:2.928,transform:"translate(0 -308.268)"},x.createElement("circle",{cx:121.875,cy:430.143,r:120.411,stroke:"#000"}),x.createElement("path",{fillRule:"evenodd",stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",d:"M119.675 477.588l.253-140.166c-73.532 5.11-86.696 84.242-28.25 114.7l.61 25.34z"}),x.createElement("path",{fillRule:"evenodd",stroke:"#000",d:"M120.07 482.652H93.813c-2.945 4.667-3.575 8.04 2.748 13.127-6.62.865-6.378 8.548-2.9 10.686-4.242 1.556-5.282 8.727 6.869 7.937l1.625 5.486c.733 2.113 1.746 2.545 2.76 2.973l10.458-.086c1.992-.72 4.299-2.105 4.39-5.015z"}),x.createElement("path",{fillRule:"evenodd",stroke:"#f75c59",strokeLinecap:"round",strokeLinejoin:"round",d:"M124.291 477.462l-.469-139.95c73.532 5.11 86.696 84.458 28.25 114.916l-.61 25.34z"}),x.createElement("path",{fillRule:"evenodd",stroke:"#f75c59",d:"M125.32 482.957l-.306 32.361c1.317 11.059 11.072 8.629 10.99-.61v-31.751zM139.957 482.957l-.305 32.361c1.317 11.059 11.072 8.629 10.99-.61v-31.751z"}),x.createElement("path",{fillRule:"evenodd",stroke:"#f8d05b",d:"M112.412 477.238l-16.948-73.934c-4.23-19.168-16.974-14.783-11.444-.557 6.267 10.896 28.39 21.763 33.582 6.106-4.523-5.743-6.628-12.59 1.333-16.65"}),x.createElement("path",{fillRule:"evenodd",stroke:"#f75c59",strokeLinejoin:"round",d:"M131.627 399.814c1.778-4.471 12.628-9.482 19.487-14.062 7.117 3.213 17.741 13.145 12.804 25.555-1.265 4.901-28.05 4.544-30.224 2.137-4.481-4.606-3.115-10.024-2.067-13.63zM128.198 428.251c-.91 7.576-.577 13.909-.763 20.76 3.425.788 7.262.337 11.082-.062-2.75-6.95-5.704-13.748-10.319-20.698z"})))})),R=e=>{const{version:t}=e,[r,a]=(0,x.useState)(!1);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(k.Z,{as:"h2",children:(0,m.jsxs)(v.Z,{display:"flex",children:[(0,m.jsx)(v.Z,{mr:1,children:(0,m.jsx)(Z.PassportControlIcon,{size:32})}),(0,m.jsxs)(v.Z,{children:["Jupyter IAM",(0,m.jsx)(b.Z,{sx:{marginLeft:1},children:t})]})]})}),(0,m.jsx)(v.Z,{children:(0,m.jsx)(_.Z,{children:"Identity and Access Management for Jupyter."})}),(0,m.jsx)(v.Z,{mt:3,children:r?(0,m.jsx)(M,{size:300,onClick:e=>a(!1)}):(0,m.jsx)("img",{src:"https://assets.datalayer.tech/releases/datalayer-0.3.0-black-snake_1024.png",onClick:e=>a(!0),style:{width:"100%"}})}),(0,m.jsx)(v.Z,{children:(0,m.jsx)(w.Z,{href:"https://datalayer.tech/docs/releases/0.3.0-black-snake",target:"_blank",children:(0,m.jsx)(_.Z,{as:"h4",children:"Datalayer 0.3.0 Black Snake Release"})})}),(0,m.jsx)(v.Z,{children:(0,m.jsx)(w.Z,{href:"https://github.com/datalayer/jupyter-iam",target:"_blank",children:(0,m.jsx)(_.Z,{as:"h4",children:"Source code"})})})]})};var z=r(94834),C=r(4833),I=r(89381);const A=e=>{const{adapter:t}=e,[r,a]=(0,x.useState)();return(0,x.useEffect)((()=>{if(t){const e=t.jupyterLab.serviceManager.user;a(e)}})),(0,m.jsx)(m.Fragment,{children:r&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(I.tO,{identity:r.identity}),(0,m.jsx)(I.i6,{permissions:r.permissions})]})})},E=e=>{const{user:t}=(0,d.oR)(),{adapter:r}=e,[a,n]=(0,x.useState)(1);let s=null;switch(a){case 1:s=(0,m.jsx)(C.q,{});break;case 2:s=(0,m.jsx)(A,{adapter:r})}return(0,m.jsx)(m.Fragment,{children:(0,m.jsxs)(v.Z,{sx:{display:"flex"},children:[(0,m.jsx)(v.Z,{children:(0,m.jsxs)(z.$,{sx:{"> *":{paddingTop:"0px"}},children:[t&&(0,m.jsx)(z.$.Item,{"aria-current":1===a?"page":void 0,onClick:e=>n(1),children:"Datalayer"}),(0,m.jsx)(z.$.Item,{"aria-current":2===a?"page":void 0,onClick:e=>n(2),children:"JupyterLab"})]})}),(0,m.jsx)(v.Z,{ml:3,sx:{width:"100%"},children:s})]})})};var L=r(69371);const U=e=>{const{adapter:t}=e,{user:r}=(0,d.oR)(),[n,s]=(0,x.useState)(0),[i,l]=(0,x.useState)("");return(0,x.useEffect)((()=>{p("config").then((e=>{l(e.version)})).catch((e=>{console.error(`Error while accessing the jupyter server jupyter_iam extension.\n${e}`)}))})),(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(j.f6,{children:(0,m.jsx)(g.Z,{children:(0,m.jsxs)(v.Z,{children:[(0,m.jsx)(v.Z,{children:(0,m.jsxs)(y.J,{"aria-label":"iam",children:[(0,m.jsx)(y.J.Item,{"aria-label":"iam-home","aria-current":0===n?"page":void 0,onSelect:e=>{e.preventDefault(),s(0)},children:"Providers"}),(r?.roles??[]).includes(a.UserRoles.SystemAdministrator)&&(0,m.jsx)(y.J.Item,{"aria-label":"iam-users","aria-current":1===n?"page":void 0,onSelect:e=>{e.preventDefault(),s(1)},children:"Manage users"}),(0,m.jsx)(y.J.Item,{"aria-label":"iam-about","aria-current":2===n?"page":void 0,icon:()=>(0,m.jsx)(Z.PassportControlIcon,{colored:!0}),onSelect:e=>{e.preventDefault(),s(2)},children:"About"})]})}),(0,m.jsxs)(v.Z,{m:3,children:[0===n&&t&&(0,m.jsx)(E,{adapter:t}),1===n&&(r?.roles??[]).includes(a.UserRoles.SystemAdministrator)&&(0,m.jsx)(L.w,{}),2===n&&(0,m.jsx)(R,{version:i})]})]})})})})};class F extends i.ReactWidget{_app;constructor(e){super(),this._app=e,this.addClass("dla-Container")}render(){return(0,m.jsx)(U,{adapter:f.JupyterLabAppAdapter.create(this._app)})}}const $="@datalayer/jupyter-iam:plugin",N=new c.Token($);var T;!function(e){e.create="create-jupyter-iam-widget"}(T||(T={}));const D={id:$,autoStart:!0,requires:[i.ICommandPalette,a.IDatalayer],optional:[o.ISettingRegistry,l.ILauncher,s.ILayoutRestorer],provides:N,activate:(e,t,r,a,s,l)=>{let o=!1;const c=r=>{if(r&&!o&&!r.whiteLabel){const c=T.create;o=!0;const d=r.launcher.category;t.addItem({command:c,category:d});const h=e=>{const t=e.get("showInLauncher").composite;s&&t&&s.add({command:c,category:d,rank:4.1})};a&&a.load(D.id).then((e=>{console.log(`${D.id} settings loaded:`,e.composite),h(e),e.changed.connect(h)})).catch((e=>{console.error(`Failed to load settings for ${D.id}.`,e)}));const{commands:u}=e,p=new i.WidgetTracker({namespace:"jupyter-iam"});l&&l.restore(p,{command:c,name:()=>"jupyter-iam"}),u.addCommand(c,{caption:"Show Jupyter IAM",label:"Jupyter IAM",icon:n,execute:()=>{const t=new F(e),r=new i.MainAreaWidget({content:t});r.title.label="Jupyter IAM",r.title.icon=n,e.shell.add(r,"main"),p.add(r)}})}};return c(r.configuration.configuration),r.configuration.configurationChanged.connect(((e,t)=>{c(t)})),p("config").then((e=>{console.log(e),d.Ck.getState().setVersion(e.version)})).catch((e=>{console.error(`Error while accessing the jupyter server jupyter_iam extension.\n${e}`)})),console.log(`JupyterLab plugin ${D.id} is activated.`),{}}},J=D},53761:(e,t,r)=>{r.d(t,{q$:()=>s,aK:()=>n,b0:()=>i});const a=(e,t)=>e?t?e+" "+t:e:t??"",n=void 0,s=void 0;function i(e){return{uid:e.uid,handle:e.user_handle_s,email:e.user_email_s,firstName:e.user_first_name_t,lastName:e.user_last_name_t,displayName:a(e.user_first_name_t,e.user_last_name_t),joinDate:e.join_ts_dt?new Date(e.join_ts_dt):void 0,roles:e.roles_ss,origin:e.origin_s}}},83513:(e,t,r)=>{r.d(t,{Ck:()=>o,ZP:()=>d,oR:()=>c});var a=r(13899),n=r(4231),s=r(19992),i=r(21780),l=r(53761);const o=(0,s.M)(((e,t)=>{const r=async(r,a)=>{try{const n=await fetch(`${a}/api/iam/v1/user`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${r}`},credentials:"include"});if(n.ok){const t=await n.json(),a=(0,l.b0)(t.profile);(0,i.c7)(a),(0,i.mB)(r),e((e=>({user:a,token:r})))}else 401===n.status&&(console.info("Invalid stored token"),t().clearAuth())}catch(e){console.error("Failed to fetch user identity",e)}};return{iamServerURL:a.datalayerStore.getState().configuration?.apiServerUrl??"",setIAMServerURL:t=>{e({iamServerURL:t})},socialLogin:{},addSocialLogin:(t,r)=>{e((e=>({socialLogin:{...e.socialLogin,[t]:r}})))},user:l.aK,token:l.q$,logUser:()=>{const{iamServerURL:e,clearAuth:a}=t();if(!e)return;const n=(0,i.hV)();n?r(n,e):a()},clearAuth:()=>{(0,i.c7)(),(0,i.mB)(),e((e=>({user:l.aK,token:l.q$})))},refreshAuth:()=>{const{iamServerURL:e,token:a}=t();a?e&&r(a,e):t().clearAuth()},setAuth:e=>{const a=t();a.token!==e&&a.iamServerURL&&r(e,a.iamServerURL)},version:"",setVersion:r=>{r&&!t().version&&e((e=>({version:r})))}}}));function c(e){return(0,n.useStore)(o,e)}const d=c;a.datalayerStore.subscribe(((e,t)=>{e.configuration?.apiServerUrl&&e.configuration.apiServerUrl!==t.configuration?.apiServerUrl&&o.setState({iamServerURL:e.configuration.apiServerUrl})}))}}]);