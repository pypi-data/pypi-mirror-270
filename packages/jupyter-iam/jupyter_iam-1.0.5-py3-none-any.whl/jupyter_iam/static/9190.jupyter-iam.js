"use strict";(self.webpackChunk_datalayer_jupyter_iam=self.webpackChunk_datalayer_jupyter_iam||[]).push([[9190],{99190:(e,n,t)=>{t.d(n,{B:()=>c,H:()=>_});var s,i=t(48425),r=t(18168),a=t(46931),l=t(47963),o=t(98209),h=t(92279),d=t(56769),u=t(71204);class c{constructor(e){var n,t,s,i;this._path="",this._name="",this._type="",this._prevKernelName="",this._isDisposed=!1,this._disposed=new o.Signal(this),this._session=null,this._ready=new l.PromiseDelegate,this._initializing=!1,this._initStarted=new l.PromiseDelegate,this._initPromise=new l.PromiseDelegate,this._isReady=!1,this._isTerminating=!1,this._isRestarting=!1,this._kernelChanged=new o.Signal(this),this._preferenceChanged=new o.Signal(this),this._sessionChanged=new o.Signal(this),this._statusChanged=new o.Signal(this),this._connectionStatusChanged=new o.Signal(this),this._pendingInput=!1,this._iopubMessage=new o.Signal(this),this._unhandledMessage=new o.Signal(this),this._propertyChanged=new o.Signal(this),this._dialog=null,this._busyDisposable=null,this._pendingKernelName="",this._pendingSessionRequest="",this.sessionManager=e.sessionManager,this.specsManager=e.specsManager,this.translator=e.translator||r.Sr,this._trans=this.translator.load("jupyterlab"),this._path=null!==(n=e.path)&&void 0!==n?n:l.UUID.uuid4(),this._type=null!==(t=e.type)&&void 0!==t?t:"",this._name=null!==(s=e.name)&&void 0!==s?s:"",this._setBusy=e.setBusy,this._kernelPreference=null!==(i=e.kernelPreference)&&void 0!==i?i:{}}get session(){var e;return null!==(e=this._session)&&void 0!==e?e:null}get path(){return this._path}get type(){return this._type}get name(){return this._name}get kernelChanged(){return this._kernelChanged}get sessionChanged(){return this._sessionChanged}get statusChanged(){return this._statusChanged}get pendingInput(){return this._pendingInput}get connectionStatusChanged(){return this._connectionStatusChanged}get iopubMessage(){return this._iopubMessage}get unhandledMessage(){return this._unhandledMessage}get propertyChanged(){return this._propertyChanged}get kernelPreference(){return this._kernelPreference}set kernelPreference(e){if(!l.JSONExt.deepEqual(e,this._kernelPreference)){const n=this._kernelPreference;this._kernelPreference=e,this._preferenceChanged.emit({name:"kernelPreference",oldValue:n,newValue:l.JSONExt.deepCopy(e)})}}get kernelPreferenceChanged(){return this._preferenceChanged}get isReady(){return this._isReady}get ready(){return this._ready.promise}get isTerminating(){return this._isTerminating}get isRestarting(){return this._isRestarting}get hasNoKernel(){return this.kernelDisplayName===this.noKernelName}get kernelDisplayName(){var e,n,t,s,i,r,a;const l=null===(e=this.session)||void 0===e?void 0:e.kernel;return this._pendingKernelName===this.noKernelName?this.noKernelName:this._pendingKernelName?null!==(s=null===(t=null===(n=this.specsManager.specs)||void 0===n?void 0:n.kernelspecs[this._pendingKernelName])||void 0===t?void 0:t.display_name)&&void 0!==s?s:this._pendingKernelName:l?null!==(a=null===(r=null===(i=this.specsManager.specs)||void 0===i?void 0:i.kernelspecs[l.name])||void 0===r?void 0:r.display_name)&&void 0!==a?a:l.name:this.noKernelName}get kernelDisplayStatus(){var e,n;const t=null===(e=this.session)||void 0===e?void 0:e.kernel;return this._isTerminating?"terminating":this._isRestarting?"restarting":this._pendingKernelName===this.noKernelName?"unknown":!t&&this._pendingKernelName?"initializing":t||this.isReady||!1===this.kernelPreference.canStart||!1===this.kernelPreference.shouldStart?null!==(n="connected"===(null==t?void 0:t.connectionStatus)?null==t?void 0:t.status:null==t?void 0:t.connectionStatus)&&void 0!==n?n:"unknown":"initializing"}get prevKernelName(){return this._prevKernelName}get isDisposed(){return this._isDisposed}get disposed(){return this._disposed}get noKernelName(){return this._trans.__("No Kernel")}dispose(){this._isDisposed||(this._isDisposed=!0,this._disposed.emit(),this._session&&(this.kernelPreference.shutdownOnDispose&&this.sessionManager.shutdown(this._session.id).catch((e=>{console.error(`Kernel not shut down ${e}`)})),this._session.dispose(),this._session=null),this._dialog&&this._dialog.dispose(),this._busyDisposable&&(this._busyDisposable.dispose(),this._busyDisposable=null),o.Signal.clearData(this))}async startKernel(){const e=this.kernelPreference;if(!e.autoStartDefault&&!1===e.shouldStart)return!0;let n;if(e.id)n={id:e.id};else{const t=s.getDefaultKernel({specs:this.specsManager.specs,sessions:this.sessionManager.running(),preference:e});t&&(n={name:t})}if(n)try{return await this._changeKernel(n),!1}catch(e){}return!0}async restartKernel(){var e,n,t,s,i,r;const a=(null===(e=this.session)||void 0===e?void 0:e.kernel)||null;if(!this._isRestarting){this._isRestarting=!0,this._isReady=!1,this._statusChanged.emit("restarting");try{await(null===(t=null===(n=this.session)||void 0===n?void 0:n.kernel)||void 0===t?void 0:t.restart()),this._isReady=!0}catch(e){console.error(e)}this._isRestarting=!1,this._statusChanged.emit((null===(i=null===(s=this.session)||void 0===s?void 0:s.kernel)||void 0===i?void 0:i.status)||"unknown"),this._kernelChanged.emit({name:"kernel",oldValue:a,newValue:(null===(r=this.session)||void 0===r?void 0:r.kernel)||null})}}async changeKernel(e={}){if(this.isDisposed)throw new Error("Disposed");return await this._initStarted.promise,this._changeKernel(e)}async shutdown(){if(!this.isDisposed&&this._initializing)return await this._initStarted.promise,this._pendingSessionRequest="",this._pendingKernelName=this.noKernelName,this._shutdownSession()}async initialize(){if(this._initializing)return this._initPromise.promise;this._initializing=!0;const e=await this._initialize();return e||(this._isReady=!0,this._ready.resolve(void 0)),this._pendingSessionRequest||this._initStarted.resolve(void 0),this._initPromise.resolve(e),e}async _initialize(){const e=this.sessionManager;await e.ready,await e.refreshRunning();const n=(0,a.sE)(e.running(),(e=>e.path===this._path));if(n)try{const t=e.connectTo({model:n});this._handleNewSession(t)}catch(e){return this._handleSessionError(e),Promise.reject(e)}return await this._startIfNecessary()}async _shutdownSession(){var e;const n=this._session,t=this._isTerminating,s=this._isReady;this._isTerminating=!0,this._isReady=!1,this._statusChanged.emit("terminating");try{await(null==n?void 0:n.shutdown()),this._isTerminating=!1,null==n||n.dispose(),this._session=null;const e=(null==n?void 0:n.kernel)||null;this._statusChanged.emit("unknown"),this._kernelChanged.emit({name:"kernel",oldValue:e,newValue:null}),this._sessionChanged.emit({name:"session",oldValue:n,newValue:null})}catch(i){this._isTerminating=t,this._isReady=s;const r=null===(e=null==n?void 0:n.kernel)||void 0===e?void 0:e.status;throw void 0===r?this._statusChanged.emit("unknown"):this._statusChanged.emit(r),i}}async _startIfNecessary(){var e;const n=this.kernelPreference;return!this.isDisposed&&!(null===(e=this.session)||void 0===e?void 0:e.kernel)&&!1!==n.shouldStart&&!1!==n.canStart&&this.startKernel()}async _changeKernel(e={}){if(e.name&&(this._pendingKernelName=e.name),this._session||this._kernelChanged.emit({name:"kernel",oldValue:null,newValue:null}),this._pendingSessionRequest||this._initStarted.resolve(void 0),this._session&&!this._isTerminating)try{return await this._session.changeKernel(e),this._session.kernel}catch(e){throw this._handleSessionError(e),e}const n=i.PathExt.dirname(this._path),t=this._pendingSessionRequest=i.PathExt.join(n,l.UUID.uuid4());try{this._statusChanged.emit("starting");const n=await this.sessionManager.startNew({path:t,type:this._type,name:this._name,kernel:e});return this._pendingSessionRequest!==n.path?(await n.shutdown(),n.dispose(),null):(await n.setPath(this._path),await n.setName(this._name),this._session&&!this._isTerminating&&await this._shutdownSession(),this._handleNewSession(n))}catch(e){throw this._handleSessionError(e),e}}_handleNewSession(e){var n,t,s;if(this.isDisposed)throw Error("Disposed");return this._isReady||(this._isReady=!0,this._ready.resolve(void 0)),this._session&&this._session.dispose(),this._session=e,this._pendingKernelName="",e&&(this._prevKernelName=null!==(t=null===(n=e.kernel)||void 0===n?void 0:n.name)&&void 0!==t?t:"",e.disposed.connect(this._onSessionDisposed,this),e.propertyChanged.connect(this._onPropertyChanged,this),e.kernelChanged.connect(this._onKernelChanged,this),e.statusChanged.connect(this._onStatusChanged,this),e.connectionStatusChanged.connect(this._onConnectionStatusChanged,this),e.pendingInput.connect(this._onPendingInput,this),e.iopubMessage.connect(this._onIopubMessage,this),e.unhandledMessage.connect(this._onUnhandledMessage,this),e.path!==this._path&&this._onPropertyChanged(e,"path"),e.name!==this._name&&this._onPropertyChanged(e,"name"),e.type!==this._type&&this._onPropertyChanged(e,"type")),this._sessionChanged.emit({name:"session",oldValue:null,newValue:e}),this._kernelChanged.emit({oldValue:null,newValue:(null==e?void 0:e.kernel)||null,name:"kernel"}),this._statusChanged.emit((null===(s=null==e?void 0:e.kernel)||void 0===s?void 0:s.status)||"unknown"),(null==e?void 0:e.kernel)||null}async _handleSessionError(e){this._handleNewSession(null);let n="",t="";try{n=e.traceback,t=e.message}catch(e){}await this._displayKernelError(t,n)}async _displayKernelError(e,n){const t=d.createElement("div",null,e&&d.createElement("pre",null,e),n&&d.createElement("details",{className:"jp-mod-wide"},d.createElement("pre",null,n))),s=this._dialog=new u.Vq({title:this._trans.__("Error Starting Kernel"),body:t,buttons:[u.Vq.okButton()]});await s.launch(),this._dialog=null}_onSessionDisposed(){if(this._session){const e=this._session;this._session=null;const n=this._session;this._sessionChanged.emit({name:"session",oldValue:e,newValue:n})}}_onPropertyChanged(e,n){switch(n){case"path":this._path=e.path;break;case"name":this._name=e.name;break;case"type":this._type=e.type;break;default:throw new Error(`unrecognized property ${n}`)}this._propertyChanged.emit(n)}_onKernelChanged(e,n){this._kernelChanged.emit(n)}_onStatusChanged(e,n){var t;if("dead"===n){const n=null===(t=e.kernel)||void 0===t?void 0:t.model;if(null==n?void 0:n.reason){const e=n.traceback||"";this._displayKernelError(n.reason,e)}}this._setBusy&&("busy"===n?this._busyDisposable||(this._busyDisposable=this._setBusy()):this._busyDisposable&&(this._busyDisposable.dispose(),this._busyDisposable=null)),this._statusChanged.emit(n)}_onConnectionStatusChanged(e,n){this._connectionStatusChanged.emit(n)}_onPendingInput(e,n){this._pendingInput=n}_onIopubMessage(e,n){"shutdown_reply"===n.header.msg_type&&this.session.kernel.removeInputGuard(),this._iopubMessage.emit(n)}_onUnhandledMessage(e,n){this._unhandledMessage.emit(n)}}!function(e){e.getDefaultKernel=function(e){const{preference:n}=e,{shouldStart:t}=n;return!1===t?null:s.getDefaultKernel(e)}}(c||(c={}));class _{constructor(e={}){var n;this._translator=null!==(n=e.translator)&&void 0!==n?n:r.Sr}async selectKernel(e){if(e.isDisposed)return Promise.resolve();const n=this._translator.load("jupyterlab");let t=n.__("Cancel");e.hasNoKernel&&(t=e.kernelDisplayName);const i=[u.Vq.cancelButton({label:t}),u.Vq.okButton({label:n.__("Select"),ariaLabel:n.__("Select Kernel")})],r=e.kernelPreference.autoStartDefault,a="boolean"==typeof r,l=new u.Vq({title:n.__("Select Kernel"),body:new s.KernelSelector(e,this._translator),buttons:i,checkbox:a?{label:n.__("Always start the preferred kernel"),caption:n.__("Remember my choice and always start the preferred kernel"),checked:r}:null}),o=await l.launch();if(e.isDisposed||!o.button.accept)return;a&&null!==o.isChecked&&(e.kernelPreference={...e.kernelPreference,autoStartDefault:o.isChecked});const h=o.value;if(null===h&&!e.hasNoKernel)return e.shutdown();h&&await e.changeKernel(h)}async restart(e){var n;const t=this._translator.load("jupyterlab");if(await e.initialize(),e.isDisposed)throw new Error("session already disposed");const s=null===(n=e.session)||void 0===n?void 0:n.kernel;if(!s&&e.prevKernelName)return await e.changeKernel({name:e.prevKernelName}),!0;if(!s)throw new Error("No kernel to restart");const i=u.Vq.warnButton({label:t.__("Restart"),ariaLabel:t.__("Confirm Kernel Restart")}),r=await(0,u.vC)({title:t.__("Restart Kernel?"),body:t.__("Do you want to restart the kernel of %1? All variables will be lost.",e.name),buttons:[u.Vq.cancelButton({ariaLabel:t.__("Cancel Kernel Restart")}),i]});return!s.isDisposed&&!!r.button.accept&&(await e.restartKernel(),!0)}}!function(e){class n extends h.$L{constructor(e,n){super({node:t(e,n)})}getValue(){const e=this.node.querySelector("select");return JSON.parse(e.value)}}function t(e,n){const t=(n=n||r.Sr).load("jupyterlab"),i=document.createElement("div"),a=document.createElement("label");a.textContent=`${t.__("Select kernel for:")} "${e.name}"`,i.appendChild(a);const l=function(e){return{specs:e.specsManager.specs,sessions:e.sessionManager.running(),preference:e.kernelPreference}}(e),o=document.createElement("select");return s(o,l,n,e.hasNoKernel?null:e.kernelDisplayName),i.appendChild(o),i}function s(e,n,t,s=null){for(var i;e.firstChild;)e.removeChild(e.firstChild);const{preference:h,sessions:d,specs:u}=n,{name:c,id:_,language:p,canStart:g,shouldStart:m}=h,f=(t=t||r.Sr).load("jupyterlab");if(!u||!1===g)return e.appendChild(l(t)),e.value="null",void(e.disabled=!0);e.disabled=!1;const y=Object.create(null),v=Object.create(null);for(const e in u.kernelspecs){const n=u.kernelspecs[e];y[e]=n.display_name,v[e]=n.language}const k=[];if(c&&c in u.kernelspecs&&k.push(c),c&&k.length>0&&p)for(const e in u.kernelspecs)c!==e&&v[e]===p&&k.push(e);k.length||k.push(u.default);const w=document.createElement("optgroup");w.label=f.__("Start Preferred Kernel"),k.sort(((e,n)=>y[e].localeCompare(y[n])));for(const e of k)w.appendChild(a(e,y[e]));w.firstChild&&e.appendChild(w),e.appendChild(l(t));const C=document.createElement("optgroup");C.label=f.__("Start Other Kernel");const S=[];for(const e in u.kernelspecs)-1===k.indexOf(e)&&S.push(e);S.sort(((e,n)=>y[e].localeCompare(y[n])));for(const e of S)C.appendChild(a(e,y[e]));if(S.length&&e.appendChild(C),!1===m)e.value="null";else{let n=0;s&&(n=[...e.options].findIndex((e=>e.text===s)),n=Math.max(n,0)),e.selectedIndex=n}if(!d)return;const b=[],K=[];for(const e of d)p&&e.kernel&&v[e.kernel.name]===p&&e.kernel.id!==_?b.push(e):(null===(i=e.kernel)||void 0===i?void 0:i.id)!==_&&K.push(e);const N=document.createElement("optgroup");if(N.label=f.__("Use Kernel from Preferred Session"),e.appendChild(N),b.length){b.sort(((e,n)=>e.path.localeCompare(n.path)));for(const e of b){const n=e.kernel?y[e.kernel.name]:"";N.appendChild(o(e,n,t))}}const D=document.createElement("optgroup");if(D.label=f.__("Use Kernel from Other Session"),e.appendChild(D),K.length){K.sort(((e,n)=>e.path.localeCompare(n.path)));for(const e of K){const n=e.kernel?y[e.kernel.name]||e.kernel.name:"";D.appendChild(o(e,n,t))}}}function a(e,n){const t=document.createElement("option");return t.text=n,t.value=JSON.stringify({name:e}),t}function l(e){const n=(e=e||r.Sr).load("jupyterlab"),t=document.createElement("optgroup");t.label=n.__("Use No Kernel");const s=document.createElement("option");return s.text=n.__("No Kernel"),s.value="null",t.appendChild(s),t}function o(e,n,t){var s,a;const l=(t=t||r.Sr).load("jupyterlab"),o=document.createElement("option"),h=e.name||i.PathExt.basename(e.path);return o.text=h,o.value=JSON.stringify({id:null===(s=e.kernel)||void 0===s?void 0:s.id}),o.title=`${l.__("Path:")} ${e.path}\n${l.__("Name:")} ${h}\n${l.__("Kernel Name:")} ${n}\n${l.__("Kernel Id:")} ${null===(a=e.kernel)||void 0===a?void 0:a.id}`,o}e.KernelSelector=n,e.getDefaultKernel=function(e){var n;const{specs:t,preference:s}=e,{name:i,language:r,canStart:a,autoStartDefault:l}=s;if(!t||!1===a)return null;const o=l?t.default:null;if(!i&&!r)return o;for(const e in t.kernelspecs)if(e===i)return i;if(!r)return o;const h=[];for(const e in t.kernelspecs)r===(null===(n=t.kernelspecs[e])||void 0===n?void 0:n.language)&&h.push(e);if(1===h.length){const e=h[0];return console.warn("No exact match found for "+e+", using kernel "+e+" that matches language="+r),e}return o},e.populateKernelSelect=s}(s||(s={}))}}]);