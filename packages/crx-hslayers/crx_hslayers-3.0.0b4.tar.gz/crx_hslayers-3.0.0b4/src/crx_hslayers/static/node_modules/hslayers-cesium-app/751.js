"use strict";(self.webpackChunkhslayers_cesium_app=self.webpackChunkhslayers_cesium_app||[]).push([[751],{87751:(H,D,t)=>{t.r(D),t.d(D,{HsLegendComponent:()=>g,HsLegendLayerComponent:()=>i.h,HsLegendLayerStaticComponent:()=>L.z,HsLegendLayerStaticService:()=>y.P,HsLegendLayerVectorComponent:()=>f.i,HsLegendModule:()=>O,HsLegendService:()=>C.c});var L=t(78217),y=t(11725),f=t(72589),i=t(90565),p=t(89204),M=t(84205),E=t(33900),o=t(25849),v=t(83211),e=t(68559),C=t(18999),I=t(14608),A=t(27426),B=t(11194),W=t(91459),h=t(60316),S=t(34456),K=t(70258),c=t(77266),P=t(31968);const _=()=>({module:"LAYERS"});function m(a,u){1&a&&(e.j41(0,"span")(1,"p",12),e.EFF(2),e.nI1(3,"translateHs"),e.k0s()()),2&a&&(e.R7$(2),e.JRh(e.bMT(3,1,"LEGEND.noLegendExists")))}function T(a,u){if(1&a&&(e.j41(0,"li",13)(1,"div"),e.EFF(2),e.nI1(3,"translateHs"),e.nrm(4,"hs-legend-layer-directive",14),e.k0s()()),2&a){const n=u.$implicit,s=e.XpG(2);e.Y8G("hidden",!s.hsLegendService.legendValid(n)),e.R7$(2),e.SpI(" ",e.i5U(3,3,n.title,e.lJ4(6,_))," "),e.R7$(2),e.Y8G("layer",n)}}function r(a,u){if(1&a){const n=e.RV6();e.j41(0,"div",1),e.nrm(1,"hs-panel-header",2),e.j41(2,"div",3)(3,"p")(4,"input",4),e.nI1(5,"translateHs"),e.mxI("ngModelChange",function(d){e.eBV(n);const U=e.XpG();return e.DH7(U.titleSearch,d)||(U.titleSearch=d),e.Njj(d)}),e.bIt("input",function(){e.eBV(n);const d=e.XpG();return e.Njj(d.refreshList())}),e.k0s()(),e.DNE(6,m,4,3,"span",5),e.j41(7,"ul",6),e.DNE(8,T,5,7,"li",7),e.nI1(9,"filter"),e.k0s(),e.j41(10,"div",8)(11,"div",9)(12,"button",10),e.nI1(13,"translateHs"),e.bIt("click",function(){e.eBV(n);const d=e.XpG();return e.Njj(d.rebuildLegends())}),e.nrm(14,"i",11),e.k0s()()()()()}if(2&a){const n=e.XpG();e.Y8G("ngClass",n.panelWidthClass),e.R7$(),e.Y8G("panelTabs","LEGEND"),e.R7$(3),e.Y8G("placeholder",e.bMT(5,7,"COMMON.filter")),e.R50("ngModel",n.titleSearch),e.R7$(2),e.Y8G("ngIf",n.noLayerExists()),e.R7$(2),e.Y8G("ngForOf",e.i5U(9,9,n.filterDescriptors(),n.legendFilter)),e.R7$(4),e.Y8G("title",e.bMT(13,12,"COMMON.reload"))}}let g=(()=>{class a extends o.aH{constructor(n,s,d,U,R,G){super(),this.hsLegendService=n,this.hsMapService=s,this.hsLayerUtilsService=d,this.hsUtilsService=U,this.hsQueuesService=R,this.hsLanguageService=G,this.layerDescriptors=[],this.titleSearch="",this.name="legend",this.end=new M.B,this.legendFilter=x=>new RegExp(this.titleSearch,"i").test(x.title)}ngOnDestroy(){this.end.next(),this.end.complete()}ngOnInit(){this.hsMapService.loaded().then(n=>{n.getLayers().on("add",s=>this.layerAdded(s)),n.getLayers().on("remove",s=>{this.removeLayerFromLegends(s.element)}),this.buildLegendsForLayers(n)}),super.ngOnInit()}addLayerToLegends(n){var s=this;return(0,p.A)(function*(){const d=yield s.hsLegendService.getLayerLegendDescriptor(n);if(d){const U=n.getSource();s.hsUtilsService.instOf(U,v.Z8)&&U.colorMapChanged.pipe((0,E.Q)(s.end)).subscribe(()=>{s.layerSourcePropChanged({target:U})}),s.layerDescriptors.push(d),s.refreshList(),n.on("change:visible",R=>s.layerVisibilityChanged(R)),s.hsLayerUtilsService.isLayerWMS(n)&&n.getSource()?.on("change",R=>{s.hsUtilsService.debounce(s.layerSourcePropChanged(R),100,!1,s)})}})()}rebuildLegends(){this.layerDescriptors=[],this.buildLegendsForLayers(this.hsMapService.getMap())}filterDescriptors(){return this.layerDescriptors}noLayerExists(){return 0==this.layerDescriptors.filter(s=>s.visible).length}removeLayerFromLegends(n){for(let s=0;s<this.layerDescriptors.length;s++)if(this.layerDescriptors[s].lyr==n){this.layerDescriptors.splice(s,1),this.refreshList();break}}buildLegendsForLayers(n){n.getLayers().forEach(s=>{this.layerAdded({element:s})})}layerAdded(n){var s=this;this.hsQueuesService.ensureQueue("addLayerToLegends",3,1e4).push(function(){var U=(0,p.A)(function*(R){yield s.addLayerToLegends(n.element),R(null)});return function(R){return U.apply(this,arguments)}}())}layerVisibilityChanged(n){const s=this.findLayerDescriptor(n.target);s&&(s.visible=n.target.getVisible())}layerSourcePropChanged(n){const s=this.findLayerDescriptorBySource(n.target);s&&this.hsLegendService.getLayerLegendDescriptor(s.lyr).then(d=>{(d.subLayerLegends!=s.subLayerLegends||d.title!=s.title||this.hsLayerUtilsService.isLayerIDW(s.lyr))&&(this.layerDescriptors[this.layerDescriptors.indexOf(s)]=d,this.refreshList())})}findLayerDescriptor(n){return this.layerDescriptors.find(s=>s.lyr==n)}findLayerDescriptorBySource(n){const s=this.layerDescriptors.filter(d=>d.lyr.getSource()==n);if(s.length>0)return s[0]}refreshList(){this.layerDescriptors=Array.from(this.layerDescriptors)}static#e=this.\u0275fac=function(s){return new(s||a)(e.rXU(C.c),e.rXU(I.F),e.rXU(A.Xp),e.rXU(A.MJ),e.rXU(B.x),e.rXU(W.LJ))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["hs-legend"]],features:[e.Vt3],decls:2,vars:3,consts:[["class","card hs-main-panel",3,"ngClass",4,"ngIf"],[1,"card","hs-main-panel",3,"ngClass"],["name","legend",3,"panelTabs"],[1,"card-body"],["type","text",1,"form-control","hs-filter",3,"ngModelChange","input","placeholder","ngModel"],[4,"ngIf"],[1,"list-group"],["class","list-group-item",3,"hidden",4,"ngFor","ngForOf"],[1,"row","justify-content-center"],[1,"col","col-md-2","d-flex","justify-content-center"],["type","button",1,"btn","btn-light","btn-outline","ng-scope",3,"click","title"],[1,"icon-refresh"],[2,"text-align","center"],[1,"list-group-item",3,"hidden"],[3,"layer"]],template:function(s,d){1&s&&(e.DNE(0,r,15,14,"div",0),e.nI1(1,"async")),2&s&&e.Y8G("ngIf",e.bMT(1,1,d.isVisible$))},dependencies:[h.YU,h.Sq,h.bT,S.me,S.BC,S.vS,K.k,i.h,h.Jj,c.L,P.q],encapsulation:2})}return a})();var l=t(46443);let O=(()=>{class a{static#e=this.\u0275fac=function(s){return new(s||a)};static#t=this.\u0275mod=e.$C({type:a});static#s=this.\u0275inj=e.G2t({imports:[h.MD,S.YN,l.q1,o.Zz,o.k4]})}return a})()},78217:(H,D,t)=>{t.d(D,{z:()=>E});var L=t(88716),y=t(68559),f=t(11725),i=t(60316);function p(o,v){if(1&o&&y.nrm(0,"img",2),2&o){const e=y.XpG();y.Y8G("src",e.layerLegend.legendImage,y.B4B)}}function M(o,v){if(1&o&&y.nrm(0,"div",3),2&o){const e=y.XpG();y.Y8G("innerHtml",e.layerLegend.svgContent,y.npT)}}let E=(()=>{class o{constructor(e){this.hsLegendLayerStaticService=e,this.layerLegend={}}ngOnInit(){(0,L.pL)(this.layer.lyr)&&Object.assign(this.layerLegend,this.hsLegendLayerStaticService.fillContent(this.layer.lyr)),this.layer.lyr.on("change",e=>{(0,L.pL)(this.layer.lyr)!=this.layerLegend.lastLegendImage&&this.hsLegendLayerStaticService.fillContent(this.layer.lyr)})}static#e=this.\u0275fac=function(C){return new(C||o)(y.rXU(f.P))};static#t=this.\u0275cmp=y.VBU({type:o,selectors:[["hs-legend-layer-static"]],inputs:{layer:"layer"},decls:2,vars:2,consts:[[3,"src",4,"ngIf"],[3,"innerHtml",4,"ngIf"],[3,"src"],[3,"innerHtml"]],template:function(C,I){1&C&&y.DNE(0,p,1,1,"img",0)(1,M,1,1,"div",1),2&C&&(y.Y8G("ngIf","image"===I.layerLegend.legendType),y.R7$(),y.Y8G("ngIf","svg"===I.layerLegend.legendType))},dependencies:[i.bT],encapsulation:2})}return o})()},11725:(H,D,t)=>{t.d(D,{P:()=>i});var L=t(88716),y=t(68559),f=t(80436);let i=(()=>{class p{constructor(E){this.sanitizer=E}fillContent(E){const o={};let v=(0,L.pL)(E);return Array.isArray(v)&&(v=v[0]),v&&(o.lastLegendImage=v,v.indexOf("<svg")>-1?(o.legendType="svg",o.svgContent=this.sanitizer.bypassSecurityTrustHtml(v)):(o.legendType="image",o.legendImage=this.sanitizer.bypassSecurityTrustResourceUrl(v))),o}static#e=this.\u0275fac=function(o){return new(o||p)(y.KVO(f.up))};static#t=this.\u0275prov=y.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}return p})()},72589:(H,D,t)=>{t.d(D,{i:()=>y});var L=t(68559);let y=(()=>{class f{constructor(){}static#e=this.\u0275fac=function(M){return new(M||f)};static#t=this.\u0275cmp=L.VBU({type:f,selectors:[["hs-legend-vector-layer"]],inputs:{svg:"svg"},decls:1,vars:1,consts:[[1,"hs-vector-layer-legend",3,"innerHtml"]],template:function(M,E){1&M&&L.nrm(0,"div",0),2&M&&L.Y8G("innerHtml",E.svg,L.npT)},encapsulation:2})}return f})()},90565:(H,D,t)=>{t.d(D,{h:()=>K});var L=t(89204),y=t(84205),f=t(33900),i=t(68559),p=t(27426),M=t(18999),E=t(5991),o=t(60316),v=t(72589),e=t(78217);const C=c=>({"background-color":c});function I(c,P){if(1&c&&i.nrm(0,"hs-legend-vector-layer",3),2&c){const _=i.XpG();i.Y8G("svg",_.layer.svg)}}function A(c,P){1&c&&i.nrm(0,"img",5),2&c&&i.Y8G("src",P.$implicit,i.B4B)}function B(c,P){if(1&c&&(i.j41(0,"div"),i.DNE(1,A,1,1,"img",4),i.k0s()),2&c){const _=i.XpG();i.R7$(),i.Y8G("ngForOf",_.layer.subLayerLegends)}}function W(c,P){if(1&c&&(i.j41(0,"p")(1,"span",7),i.EFF(2,"\xa0\xa0\xa0"),i.k0s(),i.EFF(3),i.k0s()),2&c){const _=P.$implicit;i.R7$(),i.Y8G("ngStyle",i.eq3(2,C,_.color)),i.R7$(2),i.SpI("\xa0",_.name," ")}}function h(c,P){if(1&c&&(i.j41(0,"div"),i.DNE(1,W,4,4,"p",6),i.k0s()),2&c){let _;const m=i.XpG();i.R7$(),i.Y8G("ngForOf",null==(_=m.layer.lyr.getSource())?null:_.legend_categories)}}function S(c,P){if(1&c&&i.nrm(0,"hs-legend-layer-static",8),2&c){const _=i.XpG();i.Y8G("layer",_.layer)}}let K=(()=>{class c{constructor(_,m,T){var r=this;this.hsUtilsService=_,this.hsLegendService=m,this.hsStylerService=T,this.end=new y.B,this.hsStylerService.onSet.pipe((0,f.Q)(this.end)).subscribe(function(){var g=(0,L.A)(function*(l){r.layer.lyr==l&&(r.layer.svg=yield r.hsLegendService.setSvg(l))});return function(l){return g.apply(this,arguments)}}())}ngOnDestroy(){this.end.next(),this.end.complete()}static#e=this.\u0275fac=function(m){return new(m||c)(i.rXU(p.MJ),i.rXU(M.c),i.rXU(E.qm))};static#t=this.\u0275cmp=i.VBU({type:c,selectors:[["hs-legend-layer-directive"]],inputs:{layer:"layer"},decls:5,vars:4,consts:[[3,"svg",4,"ngIf"],[4,"ngIf"],[3,"layer",4,"ngIf"],[3,"svg"],["onerror"," this.parentNode.removeChild(this); ","onload","if(this.height<6) { this.parentNode.removeChild(this); }",3,"src",4,"ngFor","ngForOf"],["onerror"," this.parentNode.removeChild(this); ","onload","if(this.height<6) { this.parentNode.removeChild(this); }",3,"src"],[4,"ngFor","ngForOf"],[3,"ngStyle"],[3,"layer"]],template:function(m,T){1&m&&(i.j41(0,"div"),i.DNE(1,I,1,1,"hs-legend-vector-layer",0)(2,B,2,1,"div",1)(3,h,2,1,"div",1)(4,S,1,1,"hs-legend-layer-static",2),i.k0s()),2&m&&(i.R7$(),i.Y8G("ngIf","vector"===T.layer.type&&T.layer.autoLegend),i.R7$(),i.Y8G("ngIf","wms"===T.layer.type),i.R7$(),i.Y8G("ngIf","vector"===T.layer.type),i.R7$(),i.Y8G("ngIf","static"===T.layer.type))},dependencies:[o.Sq,o.bT,o.B3,v.i,e.z],encapsulation:2})}return c})()},18999:(H,D,t)=>{t.d(D,{c:()=>_});var L=t(89204),y=t(10445),f=t.n(y),i=t(94691),p=t(53848),M=t(84243),E=t(79499),v=t(41026),C=t(55968),I=t(23448),A=t(83211),B=t(5991),W=t(51567),h=t(88716),S=t(68559),K=t(27426),c=t(30404),P=t(80436);let _=(()=>{class m{constructor(r,g,l,O,a){var u=this;this.hsUtilsService=r,this.hsStylerService=g,this.hsLayerUtilsService=l,this.hsLayerSelectorService=O,this.sanitizer=a,this.hsLayerSelectorService.layerSelected.pipe((0,W.p)(n=>!!n)).subscribe(function(){var n=(0,L.A)(function*(s){yield u.getLayerLegendDescriptor(s.layer)});return function(s){return n.apply(this,arguments)}}())}legendValid(r){return void 0!==r&&null!=r.type&&!!(["vector","wms","static"].indexOf(r.type)>-1&&r.lyr.getVisible())}getVectorLayerLegendSvg(r){var g=this;return(0,L.A)(function*(){try{if(void 0===r||!r.getStyle())return;const l=v.SldStyleParser.default?new v.SldStyleParser.default:new v.SldStyleParser;let a,O=(0,h.WM)(r);if(O)a=(yield l.readStyle(O)).output;else{let d=r.getStyle();"function"==typeof d&&(d=d(new i.default,1)),a={name:"",rules:[{name:"",symbolizers:(new E.OlStyleParser).getSymbolizersFromOlStyle(Array.isArray(d)?d:[d])}]}}a||(O=B.lv,a=(yield l.readStyle(O)).output),g.fixOpacity(a);const u={styles:[a],size:[300,200],hideRect:!0},n=f().default?new(f().default)(u):new(f())(u),s=document.createElement("div");return yield n.render(s),s.innerHTML}catch(l){throw l}})()}fixOpacity(r){for(const g of r.rules)for(const l of g.symbolizers)"Fill"==l.kind&&l.fillOpacity&&!l.opacity&&(l.opacity=l.fillOpacity)}getLegendUrl(r,g,l){if(!this.hsLayerUtilsService.isLayerWMS(l))return"";const a=this.hsLayerUtilsService.getLayerParams(l).VERSION||"1.3.0";let u=this.hsLayerUtilsService.getURL(l);u.indexOf("proxy4ows")>-1&&(u=this.hsUtilsService.getParamsFromUrl(u).OWSURL);const n=(0,h.pL)(l);return void 0===n||Array.isArray(n)&&0==n.length?(u+=(u.indexOf("?")>0?"":"?")+"&version="+a+"&service=WMS&request=GetLegendGraphic&sld_version=1.1.0&layer="+g+"&format=image%2Fpng",(void 0===(0,h.cD)(l)||1==(0,h.cD)(l))&&(u=this.hsUtilsService.proxify(u)),u):"string"==typeof n?n:Array.isArray(n)?n[0]:void 0}setSvg(r){var g=this;return(0,L.A)(function*(){return g.sanitizer.bypassSecurityTrustHtml(yield g.getVectorLayerLegendSvg(r))})()}generateInterpolatedLayerLegend(r){return{autoLegend:!0,title:(0,h.LK)(r),lyr:r,type:"vector",visible:r.getVisible(),svg:this.hsStylerService.generateSVGGradientForColorMap(r)}}getLayerLegendDescriptor(r){var g=this;return(0,L.A)(function*(){if(!(0,h.W1)(r)){if(g.hsLayerUtilsService.isLayerWMS(r)){const l=g.hsLayerUtilsService.getLayerParams(r).LAYERS?.split(",");for(let O=0;O<l.length;O++)l[O]=g.getLegendUrl(r.getSource(),l[O],r);return{title:(0,h.LK)(r),lyr:r,type:"wms",subLayerLegends:l,visible:r.getVisible()}}return!g.hsUtilsService.instOf(r,p.A)||void 0!==(0,h.lg)(r)&&1!=(0,h.lg)(r)?g.hsUtilsService.instOf(r,M.A)&&g.hsUtilsService.instOf(r.getSource(),C.A)||g.hsUtilsService.instOf(r.getSource(),I.A)?{title:(0,h.LK)(r),lyr:r,type:"static",visible:r.getVisible()}:g.hsUtilsService.instOf(r.getSource(),A.Z8)?g.generateInterpolatedLayerLegend(r):void 0:{autoLegend:(0,h.Hn)(r)??!0,title:(0,h.LK)(r),lyr:r,type:"vector",visible:r.getVisible(),svg:yield g.setSvg(r)}}})()}static#e=this.\u0275fac=function(g){return new(g||m)(S.KVO(K.MJ),S.KVO(B.qm),S.KVO(K.Xp),S.KVO(c.lX),S.KVO(P.up))};static#t=this.\u0275prov=S.jDH({token:m,factory:m.\u0275fac,providedIn:"root"})}return m})()}}]);
//# sourceMappingURL=751.js.map