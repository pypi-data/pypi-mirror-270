"use strict";(self.webpackChunk_datalayer_jupyter_kernels=self.webpackChunk_datalayer_jupyter_kernels||[]).push([[3854],{33854:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var i=n(83243),s=n(2245),c=n(71514),a=n(45331),d=n(44532),o=n(83791),r=n(60936),l=n(39138),h=n(18168),u=n(92279);const g="jp-mod-searchable",m="jp-mod-search-active";var p;!function(e){e.search="documentsearch:start",e.searchAndReplace="documentsearch:startWithReplace",e.findNext="documentsearch:highlightNext",e.findPrevious="documentsearch:highlightPrevious",e.end="documentsearch:end",e.toggleSearchInSelection="documentsearch:toggleSearchInSelection"}(p||(p={}));const v={id:"@jupyterlab/documentsearch-extension:labShellWidgetListener",description:"Active search on valid document",requires:[i.r,a.x],autoStart:!0,activate:(e,t,n)=>{const i=e=>{e&&(n.hasProvider(e)?e.addClass(g):e.removeClass(g))};n.changed.connect((()=>i(t.activeWidget))),t.activeChanged.connect(((e,t)=>{const n=t.oldValue;n&&n.removeClass(g),i(t.newValue)}))}};class f{constructor(e){this._commandRegistry=e,this._cache=this._buildCache(),this._commandRegistry.keyBindingChanged.connect(this._rebuildCache,this)}get next(){return this._cache.next}get previous(){return this._cache.previous}get toggleSearchInSelection(){return this._cache.toggleSearchInSelection}_rebuildCache(){this._cache=this._buildCache()}_buildCache(){return{next:this._commandRegistry.keyBindings.find((e=>e.command===p.findNext)),previous:this._commandRegistry.keyBindings.find((e=>e.command===p.findPrevious)),toggleSearchInSelection:this._commandRegistry.keyBindings.find((e=>e.command===p.toggleSearchInSelection))}}dispose(){this._commandRegistry.keyBindingChanged.disconnect(this._rebuildCache,this)}}const _={id:"@jupyterlab/documentsearch-extension:plugin",description:"Provides the document search registry.",provides:a.x,requires:[h.gv],optional:[s.WW,l.O],autoStart:!0,activate:(e,t,n,i)=>{const s=t.load("jupyterlab");let a=500,l="never";const h=new d.W(t),g=new Map;if(i){const t=i.load(_.id),n=e=>{a=e.get("searchDebounceTime").composite,l=e.get("autoSearchInSelection").composite};Promise.all([t,e.restored]).then((([e])=>{n(e),e.changed.connect((e=>{n(e)}))})).catch((e=>{console.error(e.message)}))}const v=()=>{const t=e.shell.currentWidget;return!!t&&h.hasProvider(t)},S=n=>{if(!n)return;const i=n.id;let s=g.get(i);if(!s){const c=h.getProvider(n);if(!c)return;const d=new o.c(c,a),l=new f(e.commands),u=new r.a(d,t,l);g.set(i,u),[p.findNext,p.findPrevious,p.end,p.toggleSearchInSelection].forEach((t=>{e.commands.notifyCommandChanged(t)})),u.closed.connect((()=>{n.isDisposed||(n.activate(),n.removeClass(m))})),u.disposed.connect((()=>{n.isDisposed||(n.activate(),n.removeClass(m)),g.delete(i),[p.findNext,p.findPrevious,p.end,p.toggleSearchInSelection].forEach((t=>{e.commands.notifyCommandChanged(t)}))})),n.disposed.connect((()=>{u.dispose(),d.dispose(),c.dispose(),l.dispose()})),s=u}return s.isAttached||(u.$L.attach(s,n.node),n.addClass(m),n instanceof c.k&&(s.node.style.top=`${n.toolbar.node.getBoundingClientRect().height+n.contentHeader.node.getBoundingClientRect().height}px`),s.model.searchExpression&&s.model.refresh()),s};return e.commands.addCommand(p.search,{label:s.__("Find…"),isEnabled:v,execute:async t=>{const n=S(e.shell.currentWidget);if(n){const e=t.searchText;e?n.setSearchText(e):n.setSearchText(n.model.suggestedInitialQuery);const i=n.model.selectionState;let s=!1;switch(l){case"multiple-selected":s="multiple"===i;break;case"any-selected":s="multiple"===i||"single"===i}s&&await n.model.setFilter("selection",!0),n.focusSearchInput()}}}),e.commands.addCommand(p.searchAndReplace,{label:s.__("Find and Replace…"),isEnabled:v,execute:t=>{const n=S(e.shell.currentWidget);if(n){const e=t.searchText;e?n.setSearchText(e):n.setSearchText(n.model.suggestedInitialQuery);const i=t.replaceText;i&&n.setReplaceText(i),n.showReplace(),n.focusSearchInput()}}}),e.commands.addCommand(p.findNext,{label:s.__("Find Next"),isEnabled:()=>!!e.shell.currentWidget&&g.has(e.shell.currentWidget.id),execute:async()=>{var t;const n=e.shell.currentWidget;n&&await(null===(t=g.get(n.id))||void 0===t?void 0:t.model.highlightNext())}}),e.commands.addCommand(p.findPrevious,{label:s.__("Find Previous"),isEnabled:()=>!!e.shell.currentWidget&&g.has(e.shell.currentWidget.id),execute:async()=>{var t;const n=e.shell.currentWidget;n&&await(null===(t=g.get(n.id))||void 0===t?void 0:t.model.highlightPrevious())}}),e.commands.addCommand(p.end,{label:s.__("End Search"),isEnabled:()=>!!e.shell.currentWidget&&g.has(e.shell.currentWidget.id),execute:async()=>{var t;const n=e.shell.currentWidget;n&&(null===(t=g.get(n.id))||void 0===t||t.close())}}),e.commands.addCommand(p.toggleSearchInSelection,{label:s.__("Search in Selection"),isEnabled:()=>!!e.shell.currentWidget&&g.has(e.shell.currentWidget.id)&&"selection"in g.get(e.shell.currentWidget.id).model.filtersDefinition,execute:async()=>{var t;const n=e.shell.currentWidget;if(!n)return;const i=null===(t=g.get(n.id))||void 0===t?void 0:t.model;if(!i)return;const s=i.filters.selection;return i.setFilter("selection",!s)}}),n&&[p.search,p.findNext,p.findPrevious,p.end,p.toggleSearchInSelection].forEach((e=>{n.addItem({command:e,category:s.__("Main Area")})})),h}},S=[_,v]}}]);