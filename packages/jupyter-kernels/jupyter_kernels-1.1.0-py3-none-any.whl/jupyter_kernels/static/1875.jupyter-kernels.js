"use strict";(self.webpackChunk_datalayer_jupyter_kernels=self.webpackChunk_datalayer_jupyter_kernels||[]).push([[1875],{83791:(e,t,s)=>{s.d(t,{c:()=>o});var r,i=s(55616),a=s(35109),n=s(98209);class o extends i.I_{constructor(e,t){if(super(),this.searchProvider=e,this._caseSensitive=!1,this._disposed=new n.Signal(this),this._parsingError="",this._preserveCase=!1,this._initialQuery="",this._filters={},this._replaceText="",this._searchActive=!1,this._searchExpression="",this._useRegex=!1,this._wholeWords=!1,this._filters={},this.searchProvider.getFilters){const e=this.searchProvider.getFilters();for(const t in e)this._filters[t]=e[t].default}e.stateChanged.connect(this._onProviderStateChanged,this),this._searchDebouncer=new a.Debouncer((()=>{this._updateSearch().catch((e=>{console.error("Failed to update search on document.",e)}))}),t)}get caseSensitive(){return this._caseSensitive}set caseSensitive(e){this._caseSensitive!==e&&(this._caseSensitive=e,this.stateChanged.emit(),this.refresh())}get currentIndex(){return this.searchProvider.currentMatchIndex}get disposed(){return this._disposed}get filters(){return this._filters}get filtersDefinition(){var e,t,s;return null!==(s=null===(t=(e=this.searchProvider).getFilters)||void 0===t?void 0:t.call(e))&&void 0!==s?s:{}}get filtersDefinitionChanged(){return this.searchProvider.filtersChanged||null}get initialQuery(){return this._initialQuery}set initialQuery(e){this._initialQuery=e||this._searchExpression}get suggestedInitialQuery(){return this.searchProvider.getInitialQuery()}get selectionState(){return this.searchProvider.getSelectionState?this.searchProvider.getSelectionState():void 0}get isReadOnly(){return this.searchProvider.isReadOnly}get replaceOptionsSupport(){return this.searchProvider.replaceOptionsSupport}get parsingError(){return this._parsingError}get preserveCase(){return this._preserveCase}set preserveCase(e){this._preserveCase!==e&&(this._preserveCase=e,this.stateChanged.emit(),this.refresh())}get replaceText(){return this._replaceText}set replaceText(e){this._replaceText!==e&&(this._replaceText=e,this.stateChanged.emit())}get searchExpression(){return this._searchExpression}set searchExpression(e){this._searchExpression!==e&&(this._searchExpression=e,this.stateChanged.emit(),this.refresh())}get totalMatches(){return this.searchProvider.matchesCount}get useRegex(){return this._useRegex}set useRegex(e){this._useRegex!==e&&(this._useRegex=e,this.stateChanged.emit(),this.refresh())}get wholeWords(){return this._wholeWords}set wholeWords(e){this._wholeWords!==e&&(this._wholeWords=e,this.stateChanged.emit(),this.refresh())}dispose(){this.isDisposed||(this._searchExpression&&this.endQuery().catch((e=>{console.error(`Failed to end query '${this._searchExpression}.`,e)})),this.searchProvider.stateChanged.disconnect(this._onProviderStateChanged,this),this._searchDebouncer.dispose(),super.dispose())}async endQuery(){this._searchActive=!1,await this.searchProvider.endQuery(),this.stateChanged.emit()}async highlightNext(){await this.searchProvider.highlightNext(),this.stateChanged.emit()}async highlightPrevious(){await this.searchProvider.highlightPrevious(),this.stateChanged.emit()}refresh(){this._searchDebouncer.invoke().catch((e=>{console.error("Failed to invoke search document debouncer.",e)}))}async replaceAllMatches(){await this.searchProvider.replaceAllMatches(this._replaceText,{preserveCase:this.preserveCase,regularExpression:this.useRegex}),this.stateChanged.emit()}async replaceCurrentMatch(){await this.searchProvider.replaceCurrentMatch(this._replaceText,!0,{preserveCase:this.preserveCase,regularExpression:this.useRegex}),this.stateChanged.emit()}async setFilter(e,t){this._filters[e]!==t&&(this.searchProvider.validateFilter?(this._filters[e]=await this.searchProvider.validateFilter(e,t),this._filters[e]===t&&(this.stateChanged.emit(),this.refresh())):(this._filters[e]=t,this.stateChanged.emit(),this.refresh()))}async _updateSearch(){this._parsingError&&(this._parsingError="",this.stateChanged.emit());try{const e=this.searchExpression?r.parseQuery(this.searchExpression,this.caseSensitive,this.useRegex,this.wholeWords):null;e&&(this._searchActive=!0,await this.searchProvider.startQuery(e,this._filters),this.stateChanged.emit())}catch(e){this._parsingError=e.toString(),this.stateChanged.emit(),console.error(`Failed to parse expression ${this.searchExpression}`,e)}}_onProviderStateChanged(){this._searchActive&&this.refresh()}}!function(e){e.parseQuery=function(e,t,s,r){const i=t?"gm":"gim";let a=s?e:e.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&");r&&(a="\\b"+a+"\\b");const n=new RegExp(a,i);return n.test("")?null:n}}(r||(r={}))},44532:(e,t,s)=>{s.d(t,{W:()=>n});var r=s(18168),i=s(16781),a=s(98209);class n{constructor(e=r.Sr){this.translator=e,this._changed=new a.Signal(this),this._providerMap=new Map}add(e,t){return this._providerMap.set(e,t),this._changed.emit(),new i.DisposableDelegate((()=>{this._providerMap.delete(e),this._changed.emit()}))}getProvider(e){for(const t of this._providerMap.values())if(t.isApplicable(e))return t.createNew(e,this.translator)}hasProvider(e){for(const t of this._providerMap.values())if(t.isApplicable(e))return!0;return!1}get changed(){return this._changed}}},60936:(e,t,s)=>{s.d(t,{a:()=>T});var r=s(18168),i=s(64163),a=s(75753),n=s(55616),o=s(98209),l=s(63070),h=s(56769);const c="jp-DocumentSearch-overlay-row",p="jp-DocumentSearch-input",d="jp-DocumentSearch-input-label",u="jp-DocumentSearch-input-wrapper",g="jp-DocumentSearch-input-button-off",m="jp-DocumentSearch-input-button-on",v="jp-DocumentSearch-up-down-button",_="jp-DocumentSearch-search-filter",f="jp-DocumentSearch-replace-button",x="jp-DocumentSearch-replace-button-wrapper",C="jp-DocumentSearch-button-content",y="jp-DocumentSearch-button-wrapper";function S(e){const[t,s]=(0,h.useState)(1),r=(0,h.useCallback)((t=>{var r;const i=t?t.target:null===(r=e.inputRef)||void 0===r?void 0:r.current;if(i){const e=i.value.split(/\n/);let t=e.reduce(((e,t)=>e.length>t.length?e:t),"");i.parentNode&&i.parentNode instanceof HTMLElement&&(i.parentNode.dataset.value=t),s(e.length)}}),[]);return(0,h.useEffect)((()=>{var t,s;null===(s=null===(t=e.inputRef)||void 0===t?void 0:t.current)||void 0===s||s.select(),r()}),[e.initialValue]),h.createElement("label",{className:d},h.createElement("textarea",{onChange:t=>{e.onChange(t),r(t)},onKeyDown:t=>{e.onKeyDown(t),r(t)},rows:t,placeholder:e.placeholder,className:p,key:e.autoUpdate?e.initialValue:null,tabIndex:0,ref:e.inputRef,title:e.title,defaultValue:e.initialValue,autoFocus:e.autoFocus}))}function E(e){var t;const s=(null!==(t=e.translator)&&void 0!==t?t:r.Sr).load("jupyterlab"),n=(0,i.Sh)(e.caseSensitive?m:g,C),o=(0,i.Sh)(e.useRegex?m:g,C),l=(0,i.Sh)(e.wholeWords?m:g,C),c=u;return h.createElement("div",{className:c},h.createElement(S,{placeholder:s.__("Find"),onChange:t=>e.onChange(t),onKeyDown:t=>e.onKeydown(t),inputRef:e.inputRef,initialValue:e.initialSearchText,title:s.__("Find"),autoFocus:!0,autoUpdate:!0}),h.createElement("button",{className:y,onClick:()=>{e.onCaseSensitiveToggled()},tabIndex:0,title:s.__("Match Case")},h.createElement(a.AJ.react,{className:n,tag:"span"})),h.createElement("button",{className:y,onClick:()=>e.onWordToggled(),tabIndex:0,title:s.__("Match Whole Word")},h.createElement(a.zD.react,{className:l,tag:"span"})),h.createElement("button",{className:y,onClick:()=>e.onRegexToggled(),tabIndex:0,title:s.__("Use Regular Expression")},h.createElement(a.MU.react,{className:o,tag:"span"})))}function b(e){var t,s,n;const o=(null!==(t=e.translator)&&void 0!==t?t:r.Sr).load("jupyterlab"),l=(0,i.Sh)(e.preserveCase?m:g,C);return h.createElement("div",{className:"jp-DocumentSearch-replace-wrapper-class"},h.createElement("div",{className:u},h.createElement(S,{placeholder:o.__("Replace"),initialValue:null!==(s=e.replaceText)&&void 0!==s?s:"",onKeyDown:t=>e.onReplaceKeydown(t),onChange:t=>e.onChange(t),title:o.__("Replace"),autoFocus:!1,autoUpdate:!1}),(null===(n=e.replaceOptionsSupport)||void 0===n?void 0:n.preserveCase)?h.createElement("button",{className:y,onClick:()=>e.onPreserveCaseToggled(),tabIndex:0,title:o.__("Preserve Case")},h.createElement(a.AJ.react,{className:l,tag:"span"})):null),h.createElement("button",{className:x,onClick:()=>e.onReplaceCurrent(),tabIndex:0},h.createElement("span",{className:`${f} ${C}`,tabIndex:0},o.__("Replace"))),h.createElement("button",{className:x,tabIndex:0,onClick:()=>e.onReplaceAll()},h.createElement("span",{className:`${f} ${C}`,tabIndex:-1},o.__("Replace All"))))}function R(e){var t,s;const r=null===(t=e.keyBindings)||void 0===t?void 0:t.next,n=null===(s=e.keyBindings)||void 0===s?void 0:s.previous,o=r?l.H.formatKeystroke(r.keys):"",c=n?l.H.formatKeystroke(n.keys):"",p=c?` (${c})`:"",d=o?` (${o})`:"";return h.createElement("div",{className:"jp-DocumentSearch-up-down-wrapper"},h.createElement("button",{className:y,onClick:()=>e.onHighlightPrevious(),tabIndex:0,title:`${e.trans.__("Previous Match")}${p}`},h.createElement(a.lJ.react,{className:(0,i.Sh)(v,C),tag:"span"})),h.createElement("button",{className:y,onClick:()=>e.onHighlightNext(),tabIndex:0,title:`${e.trans.__("Next Match")}${d}`},h.createElement(a.EN.react,{className:(0,i.Sh)(v,C),tag:"span"})))}function w(e){return h.createElement("div",{className:"jp-DocumentSearch-index-counter"},0===e.totalMatches?"-/-":`${null===e.currentIndex?"-":e.currentIndex+1}/${e.totalMatches}`)}function N(e){let t=`jp-DocumentSearch-filter-button ${C}`;e.visible&&(t=`${t} jp-DocumentSearch-filter-button-enabled`);const s=e.anyEnabled?a.oT:a.QR;return h.createElement("button",{className:y,onClick:()=>e.toggleVisible(),tabIndex:0,title:e.visible?e.trans.__("Hide Search Filters"):e.trans.__("Show Search Filters")},h.createElement(s.react,{className:t,tag:"span",height:"20px",width:"20px"}))}function D(e){return h.createElement("label",{className:e.isEnabled?_:`${_} jp-DocumentSearch-search-filter-disabled`,title:e.description},h.createElement("input",{type:"checkbox",className:"jp-mod-styled",disabled:!e.isEnabled,checked:e.value,onChange:e.onToggle}),e.title)}class P extends h.Component{constructor(e){super(e),this.translator=e.translator||r.Sr}_onSearchChange(e){const t=e.target.value;this.props.onSearchChanged(t)}_onSearchKeydown(e){if(13===e.keyCode)if(e.stopPropagation(),e.preventDefault(),e.ctrlKey){const t=e.target;this._insertNewLine(t),this.props.onSearchChanged(t.value)}else e.shiftKey?this.props.onHighlightPrevious():this.props.onHighlightNext()}_onReplaceKeydown(e){13===e.keyCode&&(e.stopPropagation(),e.preventDefault(),e.ctrlKey?this._insertNewLine(e.target):this.props.onReplaceCurrent())}_insertNewLine(e){const[t,s]=[e.selectionStart,e.selectionEnd];e.setRangeText("\n",t,s,"end")}_onClose(){this.props.onClose()}_onReplaceToggled(){if(!this.props.replaceEntryVisible)for(const e in this.props.filtersDefinition){const t=this.props.filtersDefinition[e];t.supportReplace||this.props.onFilterChanged(e,!1).catch((e=>{console.error(`Fail to update filter value for ${t.title}:\n${e}`)}))}this.props.onReplaceEntryShown(!this.props.replaceEntryVisible)}_toggleFiltersVisibility(){this.props.onFiltersVisibilityChanged(!this.props.filtersVisible)}render(){var e,t;const s=this.translator.load("jupyterlab"),r=!this.props.isReadOnly&&this.props.replaceEntryVisible,i=this.props.filtersDefinition,n=Object.keys(i).length>0,o=n?h.createElement(N,{visible:this.props.filtersVisible,anyEnabled:Object.keys(i).some((e=>{var t;const s=i[e];return null!==(t=this.props.filters[e])&&void 0!==t?t:s.default})),toggleVisible:()=>this._toggleFiltersVisibility(),trans:s}):null,p=null===(e=this.props.keyBindings)||void 0===e?void 0:e.toggleSearchInSelection,d=p?l.H.formatKeystroke(p.keys):"",u=d?` (${d})`:"",g=n?h.createElement("div",{className:"jp-DocumentSearch-search-options"},Object.keys(i).map((e=>{var t;const s=i[e];return h.createElement(D,{key:e,title:s.title,description:s.description+("selection"==e?u:""),isEnabled:!r||s.supportReplace,onToggle:async()=>{await this.props.onFilterChanged(e,!this.props.filters[e])},value:null!==(t=this.props.filters[e])&&void 0!==t?t:s.default})}))):null,m=this.props.replaceEntryVisible?a.h4:a.dz;return h.createElement(h.Fragment,null,h.createElement("div",{className:c},this.props.isReadOnly?h.createElement("div",{className:"jp-DocumentSearch-toggle-placeholder"}):h.createElement("button",{className:"jp-DocumentSearch-toggle-wrapper",onClick:()=>this._onReplaceToggled(),tabIndex:0,title:s.__("Toggle Replace")},h.createElement(m.react,{className:`jp-DocumentSearch-replace-toggle ${C}`,tag:"span",elementPosition:"center",height:"20px",width:"20px"})),h.createElement(E,{inputRef:this.props.searchInputRef,useRegex:this.props.useRegex,caseSensitive:this.props.caseSensitive,wholeWords:this.props.wholeWords,onCaseSensitiveToggled:this.props.onCaseSensitiveToggled,onRegexToggled:this.props.onRegexToggled,onWordToggled:this.props.onWordToggled,onKeydown:e=>this._onSearchKeydown(e),onChange:e=>this._onSearchChange(e),initialSearchText:this.props.initialSearchText,translator:this.translator}),o,h.createElement(w,{currentIndex:this.props.currentIndex,totalMatches:null!==(t=this.props.totalMatches)&&void 0!==t?t:0}),h.createElement(R,{onHighlightPrevious:()=>{this.props.onHighlightPrevious()},onHighlightNext:()=>{this.props.onHighlightNext()},trans:s,keyBindings:this.props.keyBindings}),h.createElement("button",{className:y,onClick:()=>this._onClose(),tabIndex:0},h.createElement(a.UF.react,{className:"jp-icon-hover",elementPosition:"center",height:"16px",width:"16px"}))),h.createElement("div",{className:c},r?h.createElement(h.Fragment,null,h.createElement(b,{onPreserveCaseToggled:this.props.onPreserveCaseToggled,onReplaceKeydown:e=>this._onReplaceKeydown(e),onChange:e=>this.props.onReplaceChanged(e.target.value),onReplaceCurrent:()=>this.props.onReplaceCurrent(),onReplaceAll:()=>this.props.onReplaceAll(),replaceOptionsSupport:this.props.replaceOptionsSupport,replaceText:this.props.replaceText,preserveCase:this.props.preserveCase,translator:this.translator}),h.createElement("div",{className:"jp-DocumentSearch-spacer"})):null),this.props.filtersVisible?g:null,!!this.props.errorMessage&&h.createElement("div",{className:"jp-DocumentSearch-regex-error"},this.props.errorMessage))}}class T extends n.UB{constructor(e,t,s){super(e),this.translator=t,this._showReplace=!1,this._showFilters=!1,this._closed=new o.Signal(this),this.addClass("jp-DocumentSearch-overlay"),this._searchInput=h.createRef(),this._keyBindings=s}get closed(){return this._closed}focusSearchInput(){var e;null===(e=this._searchInput.current)||void 0===e||e.select()}setSearchText(e){this.model.initialQuery=e,e&&(this.model.searchExpression=e)}setReplaceText(e){this.model.replaceText=e}showReplace(){this.setReplaceInputVisibility(!0)}onCloseRequest(e){super.onCloseRequest(e),this._closed.emit(),this.model.endQuery()}setReplaceInputVisibility(e){this._showReplace!==e&&(this._showReplace=e,this.update())}setFiltersVisibility(e){this._showFilters!==e&&(this._showFilters=e,this.update())}render(){return this.model.filtersDefinitionChanged?h.createElement(n.lA,{signal:this.model.filtersDefinitionChanged},(()=>this._renderOverlay())):this._renderOverlay()}_renderOverlay(){return h.createElement(P,{caseSensitive:this.model.caseSensitive,currentIndex:this.model.currentIndex,isReadOnly:this.model.isReadOnly,errorMessage:this.model.parsingError,filters:this.model.filters,filtersDefinition:this.model.filtersDefinition,preserveCase:this.model.preserveCase,replaceEntryVisible:this._showReplace,filtersVisible:this._showFilters,replaceOptionsSupport:this.model.replaceOptionsSupport,replaceText:this.model.replaceText,initialSearchText:this.model.initialQuery,searchInputRef:this._searchInput,totalMatches:this.model.totalMatches,translator:this.translator,useRegex:this.model.useRegex,wholeWords:this.model.wholeWords,onCaseSensitiveToggled:()=>{this.model.caseSensitive=!this.model.caseSensitive},onRegexToggled:()=>{this.model.useRegex=!this.model.useRegex},onWordToggled:()=>{this.model.wholeWords=!this.model.wholeWords},onFilterChanged:async(e,t)=>{await this.model.setFilter(e,t)},onFiltersVisibilityChanged:e=>{this.setFiltersVisibility(e)},onHighlightNext:()=>{this.model.highlightNext()},onHighlightPrevious:()=>{this.model.highlightPrevious()},onPreserveCaseToggled:()=>{this.model.preserveCase=!this.model.preserveCase},onSearchChanged:e=>{this.model.searchExpression=e},onClose:()=>{this.close()},onReplaceEntryShown:e=>{this.setReplaceInputVisibility(e)},onReplaceChanged:e=>{this.model.replaceText=e},onReplaceCurrent:()=>{this.model.replaceCurrentMatch()},onReplaceAll:()=>{this.model.replaceAllMatches()},keyBindings:this._keyBindings})}}},45331:(e,t,s)=>{s.d(t,{x:()=>r});const r=new(s(47963).Token)("@jupyterlab/documentsearch:ISearchProviderRegistry","A service for a registry of search\n  providers for the application. Plugins can register their UI elements with this registry\n  to provide find/replace support.")}}]);