"use strict";(self.webpackChunk_datalayer_jupyter_kernels=self.webpackChunk_datalayer_jupyter_kernels||[]).push([[5142],{61295:(e,t,n)=>{n.d(t,{Z:()=>a});var s=n(66029);const r={small:16,medium:32,large:64},a=s.forwardRef((function({title:e,titleId:t,size:n,colored:a,...i},o){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",className:"icon",viewBox:"0 0 1024 1024",fill:a?"currentColor":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("currentColor")?"white":"currentColor",width:n?"string"==typeof n?r[n]:n:"16px","aria-hidden":"true",ref:o,"aria-labelledby":t},i),e?s.createElement("title",{id:t},e):null,s.createElement("path",{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}),s.createElement("path",{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}))}))},29482:(e,t,n)=>{n.d(t,{Z:()=>m});var s=n(74512),r=n(33078),a=n(66029),i=n(83627),o=n(11e3),l=n(87465),c=n(55990);const d=n.n(c)().div`
  position: fixed;
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: rgba(0, 0, 0, 0.3);
  height: 100vh;
  width: 100vw;
  right: 0;
  top: 0;
  z-index: 1000000000;
`,h=function({open:e,element:t}){return e?(0,s.jsx)(d,{children:t}):(0,s.jsx)(s.Fragment,{})},u=(0,a.createContext)({openBackdrop:e=>{},closeBackdrop:()=>{}}),p=({children:e})=>{const[t,n]=(0,a.useState)(!1),[r,i]=(0,a.useState)();return(0,s.jsxs)(u.Provider,{value:{openBackdrop:e=>{i(e),n(!0)},closeBackdrop:()=>{i(void 0),n(!1)}},children:[(0,s.jsx)(h,{open:t,element:r}),e]})},m=()=>{const[e,t]=(0,a.useState)();return(0,a.useEffect)((()=>{t((0,r.loadJupyterConfig)({}))}),[]),(0,s.jsx)(p,{children:e&&(e.insideJupyterLab?(0,s.jsx)(i.MemoryRouter,{initialEntries:["/jupyter/kernels"],children:(0,s.jsx)(l.Z,{embeddedInJupyter:!0})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.BrowserRouter,{children:(0,s.jsx)(l.Z,{})}),(0,s.jsx)(o.ToastContainer,{})]}))})}},87465:(e,t,n)=>{n.d(t,{r:()=>ct,Z:()=>dt});var s=n(74512),r=n(13899),a=n(88913),i=n(33078),o=n(62968),l=n(86497),c=n(66029),d=n(83627),h=n(20049),u=n(27955),p=n(49757),m=n(1865),g=n(66274);async function f(e="",t={}){const n=g.ServerConnection.makeSettings(),s=m.URLExt.join(n.baseUrl,"jupyter_kernels",e);let r;try{r=await g.ServerConnection.makeRequest(s,t,n)}catch(e){throw new g.ServerConnection.NetworkError(e)}let a=await r.text();if(a.length>0)try{a=JSON.parse(a)}catch(e){console.log("Not a JSON response body.",r)}if(!r.ok)throw new g.ServerConnection.ResponseError(r,a.message||a);return a}var x=n(32126),_=n(83284),y=n(20948),v=n(2947),w=n(53646),k=n(94156),b=n(19118),j=n(68148),S=n(58643),C=n(62005),D=n(97478),R=n(12221),M=n(14675),E=n(57687),I=n(20028),N=n.n(I);const T=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,P=e=>!!T.test(e),Z=(e,t)=>e.length>=t;var A=n(90573),L=n(11790),K=n(9851),O=n(28977),F=n(19893),$=n(74627);const V=()=>{const{apiRequest:e}=(0,a.useApi)({loginRoute:"/jupyter/kernels/login"});return{apiRequest:e,mountLocalFolder:e=>{f(`jump/${e}`).then((e=>{console.log("--- mountLocalFolder",e)})).catch((e=>{console.error(`Error while accessing the jupyter server jupyter_kernels extension.\n${e}`)}))},unmountLocalFolder:e=>{f(`jump/${e}`,{method:"DELETE"}).then((e=>{console.log("--- unmountLocalFolder",e)})).catch((e=>{console.error(`Error while accessing the jupyter server jupyter_kernels extension.\n${e}`)}))}}};var W=n(96129),z=n(11e3);const U=z.toast.POSITION.TOP_CENTER,{insideJupyterLab:B}=(0,i.loadJupyterConfig)({}),H=()=>({enqueueToast:(e,t)=>{switch(t.variant){case"info":B?W.Notification.info(e,{autoClose:5e3}):z.toast.info(e,{position:U});break;case"success":B?W.Notification.success(e,{autoClose:5e3}):z.toast.success(e,{position:U});break;case"warning":B?W.Notification.warning(e,{autoClose:5e3}):z.toast.warning(e,{position:U});break;case"error":B?W.Notification.error(e,{autoClose:5e3}):z.toast.error(e,{position:U})}}});var J=n(83513);const q="/jupyter/kernels/contact-us";function X(){const e=(0,c.useRef)(null),{version:t}=(0,r.useDatalayerStore)(),{iamServerURL:n,user:i,version:o}=(0,a.useStore)(),{version:l}=(0,J.ZP)(),{apiRequest:d}=V(),[h,u]=(0,c.useState)(!1),[p,m]=(0,c.useState)(!0),[g,f]=(0,c.useState)(!0),[_,y]=(0,c.useState)(!0),[v,w]=(0,c.useState)(""),[k,b]=(0,c.useState)("default"),j=(0,c.useCallback)((async s=>{if(e.current){m(!0);const r=(e.current.querySelector('input[name="email"]')?.value.length??0)>0;m(r);const a=(e.current.querySelector('input[name="subject"]')?.value.length??0)>0;f(a);const i=(e.current.querySelector('textarea[name="description"]')?.value.length??0)>0;y(i);const c=e.current.reportValidity();if(s.preventDefault(),!(c&&r&&a&&i))return;const h=new FormData(e.current);try{w(""),u(!0);const e=h.get("description")??"",s=`\nDatalayer version: ${t}\nJupyter-iam version: ${o}\nJupyter-kernels version: ${l}\nUser Agent: ${navigator.userAgent}\n          `;await d({url:`${n}/api/iam/v1/contact`,method:"POST",body:{subject:`${h.get("reason")} - ${h.get("subject")}`,body:[e,s].join("\n"),email:h.get("email")||void 0}}),w("Message successfully sent. We will reply as quickly as possible."),b("default")}catch(e){console.error("Failed to send support message.",e),w("Message not sent. Try again later or reach out through our social media channels."),b("danger")}finally{u(!1),e.current.reset()}}}),[e]);return(0,s.jsxs)(x.Z,{as:"form",ref:e,sx:{label:{marginTop:2}},onSubmit:j,children:[v&&(0,s.jsx)($.T,{variant:k,closable:!0,children:(0,s.jsx)(C.Z,{children:v})}),(0,s.jsxs)(A.Z,{required:!0,children:[(0,s.jsx)(A.Z.Label,{children:"What is the reason for your request?"}),(0,s.jsx)(L.Z,{name:"reason",children:(0,s.jsx)(L.Z.Option,{value:"login",children:"User accounts and login issues"})}),(0,s.jsx)(A.Z.Caption,{children:"This helps us route your question to the right team."})]}),(0,s.jsxs)(A.Z,{required:!0,children:[(0,s.jsx)(A.Z.Label,{children:"Your email address"}),(0,s.jsx)(D.Z,{type:"email",name:"email",defaultValue:i?.email??"",required:!0,onInvalid:()=>{m(!1)}}),!p&&(0,s.jsx)(A.Z.Validation,{variant:"error",children:"Please enter a valid email address."})]}),(0,s.jsxs)(A.Z,{required:!0,children:[(0,s.jsx)(A.Z.Label,{children:"Subject"}),(0,s.jsx)(D.Z,{type:"text",name:"subject",required:!0,onInvalid:()=>{f(!1)}}),!g&&(0,s.jsx)(A.Z.Validation,{variant:"error",children:"The subject cannot be empty."})]}),(0,s.jsxs)(A.Z,{required:!0,children:[(0,s.jsx)(A.Z.Label,{children:"Description"}),(0,s.jsx)(K.ZP,{name:"description",required:!0,onInvalid:()=>{y(!1)}}),!_&&(0,s.jsx)(A.Z.Validation,{variant:"error",children:"The description cannot be empty."}),(0,s.jsx)(A.Z.Caption,{children:"Tell us how we can help you. Include as much information as possible."})]}),(0,s.jsx)(O.r,{sx:{marginTop:2},type:"submit",variant:"primary",disabled:h,trailingVisual:h?()=>(0,s.jsx)(F.Z,{size:"small"}):null,children:"Submit"})]})}function G({onSubmit:e}){const{iamServerURL:t,user:n}=(0,a.useStore)(),{apiRequest:r}=V(),{enqueueToast:i}=H(),[o,l]=(0,c.useState)(!1),[d,h]=(0,c.useState)({email:n?.email,firstName:n?.firstName,lastName:n?.lastName}),[u,p]=(0,c.useState)({email:void 0,firstName:void 0,lastName:void 0}),m=(0,c.useCallback)((e=>{h((t=>({...t,email:e.target.value})))}),[]),g=(0,c.useCallback)((e=>{h((t=>({...t,firstName:e.target.value})))}),[]),f=(0,c.useCallback)((e=>{h((t=>({...t,lastName:e.target.value})))}),[]),_=(0,c.useCallback)((s=>{s.preventDefault(),Object.values(u).some((e=>!e))||n?.handle&&(l(!0),r({url:`${t}/api/iam/v1/user/${n.handle}`,method:"POST",body:{email:d.email,firstName:d.firstName,lastName:d.lastName}}).then((t=>{l(!1),t.success?i(t.message,{variant:"success"}):i(t.message,{variant:"error"}),e(t.success)})).catch((t=>{console.error(t),l(!1),i("Application Error.",{variant:"error"}),e(!1)})))}),[t,d,n,u]);return(0,c.useEffect)((()=>{p({...u,email:void 0===d.email?void 0:P(d.email)?"success":"error",firstName:void 0===d.firstName?void 0:Z(d.firstName,1)?"success":"error",lastName:void 0===d.lastName?void 0:Z(d.lastName,1)?"success":"error"})}),[d]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)($.T,{variant:"default",children:(0,s.jsx)(C.Z,{children:"We are missing some personal information in order to help you."})}),(0,s.jsxs)(x.Z,{as:"form",sx:{label:{marginTop:2}},children:[(0,s.jsxs)(A.Z,{children:[(0,s.jsx)(A.Z.Label,{children:"Your handle"}),(0,s.jsx)(D.Z,{disabled:!0,value:n?.handle})]}),(0,s.jsxs)(A.Z,{required:!0,children:[(0,s.jsx)(A.Z.Label,{children:"Your email"}),(0,s.jsx)(D.Z,{type:"email",value:d.email,onChange:m}),"error"===u.email&&(0,s.jsx)(A.Z.Validation,{variant:u.email,children:"Your email is not valid."})]}),(0,s.jsxs)(A.Z,{required:!0,children:[(0,s.jsx)(A.Z.Label,{children:"Your first name"}),(0,s.jsx)(D.Z,{value:d.firstName,onChange:g}),"error"===u.firstName&&(0,s.jsx)(A.Z.Validation,{variant:u.firstName,children:"Your first name must have more than 1 character."})]}),(0,s.jsxs)(A.Z,{required:!0,children:[(0,s.jsx)(A.Z.Label,{children:"Your last name"}),(0,s.jsx)(D.Z,{value:d.lastName,onChange:f}),"error"===u.lastName&&(0,s.jsx)(A.Z.Validation,{variant:u.lastName,children:"Your last name must have more than 1 character."})]}),(0,s.jsx)(O.r,{sx:{marginTop:2},type:"submit",variant:"primary",disabled:o,trailingVisual:o?()=>(0,s.jsx)(F.Z,{size:"small"}):null,onClick:_,children:"Save changes"})]})]})}function Y(){const{user:e,refreshAuth:t}=(0,a.useStore)(),n=e?.email&&e.firstName&&e.lastName,r=(0,c.useCallback)((e=>{e&&t()}),[]);return(0,s.jsxs)(R.X,{containerWidth:"medium",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsx)(R.X.Header,{children:(0,s.jsx)(E.m,{children:(0,s.jsx)(E.m.TitleArea,{variant:"large",children:(0,s.jsx)(E.m.Title,{children:"Contact Us"})})})}),(0,s.jsx)(R.X.Content,{children:n?(0,s.jsx)(X,{}):(0,s.jsx)(G,{onSubmit:r})})]})}const Q=JSON.parse('[{"question":"I\'m seeing kernels without ID","answer":"This is what we call a Zombie Kernel. It can happen if the cluster is under high pressure. You can click on the delete button to remove it."},{"question":"I don\'t have access to some features","answer":"You may need to upgrade your subscription. Don\'t hesitate to contact us directly."}]'),ee="/jupyter/kernels/support";function te(e){const{match:t}=e,n=t.value??"",r=new Array;let a=0;for(const e of t.indices)e[0]>a&&r.push(n.slice(a,e[0])),r.push((0,s.jsx)(C.Z,{sx:{backgroundColor:"var(--bgColor-attention-emphasis)",color:"var(--fgColor-onEmphasis)"},children:n.slice(e[0],e[1]+1)})),a=e[1]+1;const i=n.slice(a);return i&&r.push(i),(0,s.jsx)(s.Fragment,{children:r})}function ne(){const e=(0,y.s)(),[t,n]=(0,c.useState)(""),r=(0,c.useMemo)((()=>new(N())(Q,{includeMatches:!0,keys:["question","answer"]})),[]),a=(0,c.useMemo)((()=>r.search(t)),[t,r]),i=(0,c.useCallback)((e=>{n(e.target.value)}),[]),o=(0,c.useCallback)((()=>{e(q)}),[]);return(0,s.jsxs)(x.Z,{sx:{display:"grid",gridTemplateColumns:"1fr"},children:[(0,s.jsx)(C.Z,{as:"h3",sx:{alignSelf:"center"},children:"How can we help you?"}),(0,s.jsx)(D.Z,{sx:{alignSelf:"center"},type:"search",leadingVisual:w.W1M,placeholder:"Search the help",value:t,onChange:i}),(0,s.jsx)(x.Z,{children:a.length?(0,s.jsx)("ol",{style:{listStyle:"none",paddingInlineStart:0},children:a.map((e=>{const t=e.matches?.find((e=>"question"===e.key)),n=e.matches?.find((e=>"answer"===e.key));return(0,s.jsxs)("li",{style:{borderBottom:"var(--borderWidth-thin) solid var(--borderColor-default)"},children:[(0,s.jsx)(C.Z,{as:"h4",children:t?(0,s.jsx)(te,{match:t}):e.item.question}),(0,s.jsx)(C.Z,{as:"p",children:n?(0,s.jsx)(te,{match:n}):e.item.answer})]},e.refIndex)}))}):t?(0,s.jsx)(M.Z,{border:!0,spacious:!0,children:(0,s.jsx)(M.Z.Heading,{children:"No results for your query."})}):(0,s.jsx)("ol",{style:{listStyle:"none",paddingInlineStart:0},children:Q.map(((e,t)=>(0,s.jsxs)("li",{style:{borderBottom:"var(--borderWidth-thin) solid var(--borderColor-default)"},children:[(0,s.jsx)(C.Z,{as:"h4",children:e.question}),(0,s.jsx)(C.Z,{as:"p",children:e.answer})]},t)))})}),(0,s.jsx)(C.Z,{as:"h3",sx:{marginTop:"var(--stack-gap-spacious)"},children:"Not finding your answer?"}),(0,s.jsxs)(x.Z,{sx:{display:"grid",gridTemplateColumns:"1fr min-content",gridTemplateRows:"min-content",gridTemplateAreas:"\n            'title visual'\n            'message message'\n          ",border:"var(--borderWidth-thin) solid var(--borderColor-default)",borderRadius:"var(--borderRadius-medium)",padding:"var(--stack-padding-normal)",cursor:"pointer"},onClick:o,children:[(0,s.jsx)(C.Z,{as:"h4",sx:{gridArea:"title"},children:"Contact Us"}),(0,s.jsx)(x.Z,{sx:{gridArea:"visual",alignSelf:"center",color:"var(--fgColor-accent)"},children:(0,s.jsx)(w.UOT,{})}),(0,s.jsx)(C.Z,{sx:{gridArea:"message"},children:"Contact us directly for assistance."})]})]})}function se(){const{configuration:e}=(0,r.useDatalayerStore)();return(0,s.jsxs)(R.X,{containerWidth:"medium",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsx)(R.X.Header,{children:(0,s.jsx)(E.m,{children:(0,s.jsx)(E.m.TitleArea,{variant:"large",children:(0,s.jsx)(E.m.Title,{children:e?.whiteLabel?"Support":"Datalayer support"})})})}),(0,s.jsx)(R.X.Content,{children:(0,s.jsx)(ne,{})})]})}var re=n(94834),ae=n(3301);const ie=(0,c.forwardRef)((({to:e,children:t,...n},r)=>{const a=(0,y.s)(),i=(0,c.useCallback)((()=>{a(e)}),[e]);return(0,s.jsx)("a",{ref:r,...n,onClick:i,children:t})})),oe="/jupyter/kernels/usage";function le(){return(0,d.useOutletContext)()}const ce=()=>{if(!(0,d.useOutlet)())return(0,s.jsx)(d.Navigate,{to:`${oe}/consumptions`});const e=(0,d.useLocation)(),[t,n]=(0,c.useState)(null),[r,a]=(0,c.useState)(null);return(0,c.useEffect)((()=>{(0,ae.Ic)().then((e=>{n(e)})).catch((e=>{console.error("Failed to fetch the consumption"),n([])}))}),[]),(0,c.useEffect)((()=>{a(t?new(N())(t,{keys:["kernelGivenName"]}):null)}),[t]),(0,s.jsxs)(R.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsxs)(R.X.Pane,{position:"start",divider:"line",width:"small",children:[(0,s.jsx)(C.Z,{as:"h2",children:"Usage"}),(0,s.jsxs)(re.$,{children:[(0,s.jsx)(re.$.Item,{as:ie,to:`${oe}/consumptions`,"aria-current":e.pathname===`${oe}/consumptions`&&"page",children:"Consumption"}),(0,s.jsx)(re.$.Item,{as:ie,to:`${oe}/kernels`,"aria-current":e.pathname===`${oe}/kernels`&&"page",children:"Active Kernels"}),(0,s.jsx)(re.$.Item,{as:ie,to:`${oe}/history`,"aria-current":e.pathname===`${oe}/history`&&"page",children:"History"})]})]}),(0,s.jsx)(R.X.Content,{children:(0,s.jsx)(d.Outlet,{context:{searchUsage:r,consumptions:t}})})]})},de=()=>{const{configuration:e}=(0,r.useDatalayerStore)(),t=(0,y.s)();return(0,s.jsxs)(k.P,{children:[(0,s.jsx)(k.P.Anchor,{children:(0,s.jsx)(b.h,{icon:w.Ui8,variant:"invisible","aria-label":"jupyter-kernels-more"})}),(0,s.jsx)(k.P.Overlay,{width:"medium",children:(0,s.jsxs)(j.S,{children:[(0,s.jsxs)(j.S.Group,{title:"More...",children:[(0,s.jsxs)(j.S.Item,{onSelect:()=>t("/jupyter/kernels/settings"),children:[(0,s.jsx)(j.S.LeadingVisual,{children:(0,s.jsx)(v.SettingsIcon,{})}),"Settings",(0,s.jsx)(j.S.Description,{variant:"block",children:"Configure your personal settings."})]}),(0,s.jsxs)(j.S.Item,{onSelect:()=>t(oe),children:[(0,s.jsx)(j.S.LeadingVisual,{children:(0,s.jsx)(v.CloudIcon,{})}),"Usage",(0,s.jsx)(j.S.Description,{variant:"block",children:"Monitor CPU/GPU/Memory usage of your Kernels."})]}),!e?.whiteLabel&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(j.S.Item,{onSelect:()=>t(S.C),children:[(0,s.jsx)(j.S.LeadingVisual,{children:(0,s.jsx)(v.FullscreenIcon,{})}),"Credits",(0,s.jsx)(j.S.Description,{variant:"block",children:"Add more credits and access your credits history."})]}),(0,s.jsxs)(j.S.Item,{onSelect:()=>t("/jupyter/kernels/billing"),children:[(0,s.jsx)(j.S.LeadingVisual,{children:(0,s.jsx)(v.BankIcon,{})}),"Billing",(0,s.jsx)(j.S.Description,{variant:"block",children:"Billing history."})]})]}),(0,s.jsx)(j.S.Divider,{}),(0,s.jsxs)(j.S.Item,{onSelect:()=>t(ee),children:[(0,s.jsx)(j.S.LeadingVisual,{children:(0,s.jsx)(v.SosStencilIcon,{})}),"Support",(0,s.jsx)(j.S.Description,{variant:"block",children:"Contact us to get help on the Kernels."})]}),!e?.whiteLabel&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(j.S.Item,{onSelect:()=>t("/jupyter/kernels/docs"),children:[(0,s.jsx)(j.S.LeadingVisual,{children:(0,s.jsx)(w.vJ3,{})}),"Documentation",(0,s.jsx)(j.S.Description,{variant:"block",children:"Documentation to help you use Datalayer."})]})}),(0,s.jsxs)(j.S.Item,{onSelect:()=>t("/jupyter/kernels/about"),children:[(0,s.jsx)(j.S.LeadingVisual,{children:(0,s.jsx)(v.DatalayerIcon,{})}),"About",(0,s.jsx)(j.S.Description,{variant:"block",children:"Learn how to scale your JupyterLab with remote kernels."})]})]}),!e?.whiteLabel&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.S.Divider,{}),(0,s.jsxs)(j.S.Item,{variant:"danger",onSelect:e=>t("/jupyter/kernels/logout"),children:[(0,s.jsx)(j.S.LeadingVisual,{children:(0,s.jsx)(v.LogOutIcon,{})}),"Logout"]})]})]})})]})},he=()=>{const{configuration:e}=(0,r.useDatalayerStore)(),{user:t}=(0,a.useStore)(),n=(0,y.s)();return(0,s.jsx)(_.Z,{sx:{backgroundColor:"canvas.subtle",color:"fg.default",paddingTop:0,height:45,paddingBottom:0},children:t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(_.Z.Item,{full:!!t,children:(0,s.jsx)(_.Z.Link,{sx:{color:"fg.default",":focus":{color:"fg.subtle"},":hover":{color:"fg.subtle"}},href:"#",onClick:e=>{e.preventDefault(),n("/jupyter/kernels")},children:"Home"})}),!e?.whiteLabel&&(0,s.jsx)(_.Z.Item,{children:(0,s.jsx)(_.Z.Link,{sx:{color:"fg.default",":focus":{color:"fg.subtle"},":hover":{color:"fg.subtle"}},href:"#",onClick:e=>{e.preventDefault(),n("/jupyter/kernels/profile")},children:"Profile"})}),(0,s.jsx)(_.Z.Item,{children:(0,s.jsx)(de,{})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(_.Z.Item,{children:(0,s.jsx)(_.Z.Link,{sx:{color:"fg.default",":focus":{color:"fg.subtle"},":hover":{color:"fg.subtle"}},href:"#",onClick:e=>{e.preventDefault(),n("/jupyter/kernels/login")},children:"Login"})}),!e?.whiteLabel&&(0,s.jsx)(_.Z.Item,{children:(0,s.jsx)(_.Z.Link,{sx:{color:"fg.default",":focus":{color:"fg.subtle"},":hover":{color:"fg.subtle"}},href:"#",onClick:e=>{e.preventDefault(),n("/jupyter/kernels/join")},children:"Join"})})]})})},ue=e=>{const{children:t}=e;return(0,s.jsxs)(x.Z,{sx:{fontFamily:"normal",color:"fg.default"},children:[(0,s.jsx)(he,{}),t]})};var pe=n(56193),me=n(2998),ge=n(40158),fe=n(11048),xe=n(5917),_e=n(52746),ye=n(16419),ve=n(91075),we=n(62248),ke=n(18362),be=n(55990);const je=n.n(be)().span`
  ${({isVisible:e=!1})=>e?ke.Z:"\n        position: absolute;\n        width: 1px;\n        height: 1px;\n        padding: 0;\n        margin: -1px;\n        overflow: hidden;\n        clip: rect(0, 0, 0, 0);\n        white-space: nowrap;\n        border-width: 0;\n    "}
`;var Se=n(65693);const Ce=e=>{const{version:t}=e,{configuration:n}=(0,r.useDatalayerStore)(),{clearAuth:i,user:o}=(0,a.useStore)(),{remoteKernels:l}=(0,J.ZP)(),{enqueueToast:d}=H(),{mountLocalFolder:h,unmountLocalFolder:u}=V(),p=(0,y.s)(),{jupyterLabAdapter:m,serviceManager:g,showDisclaimer:f,setShowDisclaimer:_}=(0,J.ZP)(),[S,D]=(0,c.useState)(Array.from(g?.browser?.kernels.running()??[])??[]),[I,N]=(0,c.useState)(Array.from(g?.local.kernels.running()??[])??[]),[T,P]=(0,c.useState)(),[Z,A]=(0,c.useState)((g?.remote?.environments.get().length??0)>0),[L,K]=(0,c.useState)(!1),[z,U]=(0,c.useState)({}),B=(0,c.useCallback)((async e=>{await e.servers.refresh()}),[]),X=(0,c.useCallback)((async e=>{if(g?.remote){const t=await g.remote.servers.findById(e);if(t){const n=g.remote.servers.connectTo({model:t});try{await n.interrupt(),d(`Kernel ${e} interrupted`,{variant:"success"})}catch(t){const n=`Failed to interrupt kernel ${e}.`;console.error(n,t),d(n,{variant:"error"})}B(g.remote)}}}),[g?.remote]),G=(0,c.useCallback)((async e=>{if(g?.remote){const t=await g.remote.servers.findById(e);if(t){const n=g.remote.servers.connectTo({model:t});try{await n.restart(),d(`Kernel ${e} restarted`,{variant:"success"})}catch(t){const n=`Failed to restart kernel ${e}.`;console.error(n,t),d(n,{variant:"error"})}B(g.remote)}}}),[g?.remote]),Y=(0,c.useCallback)((async e=>{g?.remote&&(await g.remote.servers.shutdown(e),B(g.remote))}),[g?.remote]);(0,c.useEffect)((()=>{m?Promise.all([m.jupyterLab.resolveOptionalService(me.IMarkdownParser),m.jupyterLab.resolveOptionalService(W.ISanitizer)]).then((e=>{U({[me.IMarkdownParser.name]:e[0],[W.ISanitizer.name]:e[1]})})):U({})}),[m]),(0,c.useEffect)((()=>{g?.remote?.environments.ready.then((()=>{A(!!g?.remote?.environments.get().length)})),N(Array.from(g?.local.kernels.running()??[])),D(Array.from(g?.browser?.kernels.running()??[]))}),[g]),(0,ve.useInterval)((()=>{if(g){if(g.remote){const e=g.remote.environments.get();A(!!e.length)}N(Array.from(g.local.kernels.running())),g.browser&&D(Array.from(g.browser.kernels.running()))}}),5e3);const Q=(0,c.useCallback)((async()=>{await(g?.remote?.servers.refresh())}),[g]),ee=(0,c.useCallback)((()=>{K(!0)}),[]),te=(0,c.useCallback)((()=>{g?.remote&&B(g.remote),K(!1)}),[]),ne=o?.roles.includes(r.UserRoles.User),se=(0,c.useCallback)((()=>{i(),p("/jupyter/kernels/login")}),[]),re=(0,c.useCallback)((()=>{p(q)}),[]);return(0,s.jsxs)(R.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsxs)(R.X.Header,{children:[!1===n?.whiteLabel&&f&&(0,s.jsxs)(pe.CloseableFlash,{onClose:()=>_(!1),children:["Jupyter Kernels is released in ",(0,s.jsx)(fe.Z,{children:"PREVIEW"})," mode. This means that the account you have created will not stay and can be removed at any time based on Datalayer's new releases",(0,s.jsx)("br",{}),"Read the"," ",(0,s.jsx)(xe.Z,{href:"https://jupyter-kernels.datalayer.tech",target:"_blank",children:"documentation"})," ","for usage and support."]}),!ne&&(0,s.jsx)($.T,{variant:"warning",actions:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(O.r,{onClick:se,title:"If your rights have recently been updated, you need to refresh your tool permissions.",children:"Refresh permissions"}),(0,s.jsx)(O.r,{onClick:re,title:"Contact the support to request the need grant.",children:n?.whiteLabel?"Contact the support":"Datalayer support"})]}),children:(0,s.jsx)(C.Z,{children:"We appreciate your interest in joining the Jupyter Kernels feature. The platform administrator has been notified and will reach out to you to confirm the granting of your access."})}),(0,s.jsx)(E.m,{sx:{marginTop:1},children:(0,s.jsxs)(E.m.TitleArea,{variant:"large",children:[(0,s.jsxs)(E.m.Title,{children:["Jupyter Kernels ",(0,s.jsx)(fe.Z,{sx:{marginLeft:1},children:t})]}),(0,s.jsx)(E.m.Description,{children:"PREVIEW"})]})})]}),(0,s.jsxs)(R.X.Content,{children:[(0,s.jsxs)(x.Z,{mt:3,children:[l?.length?(()=>{const e=[{header:"Name",field:"kernel_given_name",sortBy:"alphanumeric",maxWidth:"200px",renderCell:e=>(0,s.jsx)(C.Z,{sx:{overflowX:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:e.kernel_given_name,children:e.kernel_given_name})},{header:"Id",field:"id",minWidth:"80px",width:"growCollapse",maxWidth:"250px",renderCell:e=>(0,s.jsx)(C.Z,{sx:{overflowX:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:e.id,children:e.id})},{header:"Type",field:"kernel_type",sortBy:"alphanumeric",width:"70px",renderCell:e=>(0,s.jsx)(C.Z,{children:"default"===e.kernel_type?"persistent":"temporary"})},{header:"Description",id:"description",width:"growCollapse",renderCell:e=>{const t=g?.remote?.environments.get().find((t=>t.name===e.environment_name));return(0,s.jsx)(C.Z,{sx:{overflowX:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:t?.description??"",children:t?.description??""})}},{header:"State",field:"execution_state",sortBy:"alphanumeric",width:"100px"},{header:()=>(0,s.jsx)(je,{children:"Actions"}),id:"actions",width:"100px",renderCell:e=>{const t=g?.remote?.environments.get().find((t=>t.name===e.environment_name)),r=t?.example;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Re,{label:`Delete the kernel ${e.name}`,icon:w.XHJ,callback:async()=>{await Y(e.id)}}),(0,s.jsxs)(k.P,{children:[(0,s.jsx)(k.P.Anchor,{children:(0,s.jsx)(b.h,{"aria-label":"Kernel actions",title:"Kernel actions",icon:w.Ui8,variant:"invisible"})}),(0,s.jsx)(k.P.Overlay,{width:"small",children:(0,s.jsxs)(j.S,{children:[(0,s.jsxs)(j.S.Item,{title:"Interrupt the kernel",onSelect:()=>{X(e.id)},children:[(0,s.jsx)(j.S.LeadingVisual,{children:(0,s.jsx)(ge.stopIcon.react,{tag:"span"})}),"Interrupt"]}),(0,s.jsxs)(j.S.Item,{title:"Restart the kernel",onSelect:()=>{G(e.id)},children:[(0,s.jsx)(j.S.LeadingVisual,{children:(0,s.jsx)(ge.refreshIcon.react,{tag:"span"})}),"Restart"]}),!n?.whiteLabel&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(j.S.Item,{title:`Pause the kernel with id ${e.id}`,onSelect:()=>d("The Start/Pause feature is not yet implemented... Checkout out the next release ðŸŽ‰, it is going to be awesome.",{variant:"warning"}),children:[(0,s.jsx)(j.S.LeadingVisual,{children:(0,s.jsx)(v.PauseIcon,{})}),"Pause"]}),(0,s.jsxs)(j.S.Item,{title:`Make your local folder accessible in the ${e.kernel_given_name} kernel.`,selected:T===e.name,onSelect:()=>{T===e.name?(u(e.id),P(void 0),d(`You local folder is not more accessible from ${e.kernel_given_name} kernel.`,{variant:"info"})):(h(e.id),P(e.name),d(`You local folder should be accessible from a Notebook connected to the ${e.kernel_given_name} kernel.`,{variant:"info"}))},disabled:void 0!==T&&T!==e.name,children:[(0,s.jsx)(j.S.LeadingVisual,{children:(0,s.jsx)(v.BooksIcon,{})}),"Mount the local folder"]})]}),(0,s.jsx)(j.S.Divider,{}),(0,s.jsxs)(j.S.Item,{disabled:!r,title:r?`Create an example notebook for kernel ${e.environment_name}`:"No example available",onSelect:()=>{(0,Se.l)({app:m.jupyterLab,name:e.environment_name,url:r,options:{kernelId:e.id}}),d(`An example notebook is created for kernel ${e.name}.`,{variant:"info"})},children:[(0,s.jsx)(j.S.LeadingVisual,{children:(0,s.jsx)(v.NotebookIcon,{})}),"Open an example notebook"]})]})})]})]})}}];return(0,s.jsxs)(_e.i.Container,{children:[(0,s.jsx)(_e.i.Title,{as:"h2",id:"remote-kernels",children:"Remote Kernels"}),(0,s.jsxs)(_e.i.Actions,{children:[(0,s.jsx)(b.h,{disabled:!Z,variant:"invisible","aria-label":"Refresh remote kernel list",title:"Refresh remote kernel list",icon:v.CounterClockWiseIcon,onClick:Q}),(0,s.jsx)(b.h,{disabled:!Z,variant:"invisible","aria-label":"Launch a Remote Kernel",title:"Launch a Remote Kernel",icon:v.PlusBaseIcon,onClick:ee})]}),(0,s.jsx)(ye.w,{"aria-labelledby":"remote-kernels",data:l,columns:e})]})})():(0,s.jsx)(x.Z,{children:(0,s.jsxs)(M.Z,{border:!0,spacious:!0,children:[!ne||l?(0,s.jsx)(M.Z.Visual,{children:(0,s.jsx)(v.JupyterIcon,{size:"medium"})}):(0,s.jsx)(x.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40px"},children:(0,s.jsx)(F.Z,{})}),(0,s.jsx)(M.Z.Heading,{children:"Remote Kernels"}),(!ne||l)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M.Z.Description,{children:(0,s.jsx)(x.Z,{sx:{textAlign:"center"},children:(0,s.jsx)(x.Z,{children:"No Remote Kernels found."})})}),(0,s.jsx)(O.r,{leadingVisual:()=>(0,s.jsx)(v.CloudUploadIcon,{color:"white"}),disabled:!ne||!Z,variant:"primary",size:"small",onClick:ee,children:"Launch a Remote Kernel"})]})]})}),g?.remote&&L&&(0,s.jsx)(we.p,{manager:g.remote,onSubmit:te,markdownParser:z["@jupyterlab/rendermime:IMarkdownParser"],sanitizer:z["@jupyterlab/apputils:ISanitizer"]})]}),!1===n?.whiteLabel&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(De,{kernels:I,location:"local"}),g?.browser&&(0,s.jsx)(De,{kernels:S,location:"browser"})]})]})]})};function De({kernels:e,location:t}){const n=`${t.charAt(0).toLocaleUpperCase()}${t.slice(1)}`;return(0,s.jsx)(x.Z,{mt:3,children:e?.length?(0,s.jsxs)(_e.i.Container,{children:[(0,s.jsx)(_e.i.Title,{as:"h2",id:`${t}-kernels`,children:`${n} Kernels`}),(0,s.jsx)(ye.w,{"aria-labelledby":`${t}-kernels`,data:e,columns:[{header:"Name",field:"name",sortBy:"alphanumeric",renderCell:e=>(0,s.jsx)(C.Z,{children:e.name}),maxWidth:"200px"},{header:"Id",field:"id",width:"growCollapse",renderCell:e=>(0,s.jsx)(C.Z,{sx:{overflowX:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.id})},{header:"State",field:"execution_state",sortBy:"alphanumeric",width:"100px",renderCell:e=>(0,s.jsx)(C.Z,{children:e.execution_state})}]})]}):(0,s.jsx)(x.Z,{children:(0,s.jsxs)(M.Z,{border:!0,spacious:!0,children:[e?(0,s.jsx)(M.Z.Visual,{children:(0,s.jsx)(v.JupyterIcon,{size:"medium"})}):(0,s.jsx)(x.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40px"},children:(0,s.jsx)(F.Z,{})}),(0,s.jsx)(M.Z.Heading,{children:`${n} Kernels`}),e&&(0,s.jsx)(M.Z.Description,{children:(0,s.jsx)(x.Z,{sx:{textAlign:"center"},children:(0,s.jsx)(x.Z,{children:`No ${n} Kernels found.`})})})]})})})}function Re({label:e,callback:t,icon:n}){const[r,a]=(0,c.useState)(!1),i=(0,c.useCallback)((async()=>{a(!0);try{await t()}finally{a(!1)}}),[t,a]);return(0,s.jsx)(b.h,{"aria-label":e,title:e,disabled:r,icon:r?()=>(0,s.jsx)(F.Z,{size:"small"}):n,size:"small",variant:"invisible",onClick:i})}const Me={small:16,medium:32,large:64},Ee=c.forwardRef((function({title:e,titleId:t,size:n,colored:s,...r},a){return c.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 243.75 243.75",fill:s?"currentColor":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("currentColor")?"white":"currentColor","aria-hidden":"true",width:n?"string"==typeof n?Me[n]:n:"16px",ref:a,"aria-labelledby":t},r),e?c.createElement("title",{id:t},e):null,c.createElement("g",{fill:s?"#fff":["#fff","#fffff","white","#FFF","#FFFFFF"].includes("#fff")?"white":"currentColor",strokeWidth:2.928,transform:"translate(0 -308.268)"},c.createElement("circle",{cx:121.875,cy:430.143,r:120.411,stroke:"#000"}),c.createElement("path",{fillRule:"evenodd",stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",d:"M119.675 477.588l.253-140.166c-73.532 5.11-86.696 84.242-28.25 114.7l.61 25.34z"}),c.createElement("path",{fillRule:"evenodd",stroke:"#000",d:"M120.07 482.652H93.813c-2.945 4.667-3.575 8.04 2.748 13.127-6.62.865-6.378 8.548-2.9 10.686-4.242 1.556-5.282 8.727 6.869 7.937l1.625 5.486c.733 2.113 1.746 2.545 2.76 2.973l10.458-.086c1.992-.72 4.299-2.105 4.39-5.015z"}),c.createElement("path",{fillRule:"evenodd",stroke:"#f75c59",strokeLinecap:"round",strokeLinejoin:"round",d:"M124.291 477.462l-.469-139.95c73.532 5.11 86.696 84.458 28.25 114.916l-.61 25.34z"}),c.createElement("path",{fillRule:"evenodd",stroke:"#f75c59",d:"M125.32 482.957l-.306 32.361c1.317 11.059 11.072 8.629 10.99-.61v-31.751zM139.957 482.957l-.305 32.361c1.317 11.059 11.072 8.629 10.99-.61v-31.751z"}),c.createElement("path",{fillRule:"evenodd",stroke:"#f8d05b",d:"M112.412 477.238l-16.948-73.934c-4.23-19.168-16.974-14.783-11.444-.557 6.267 10.896 28.39 21.763 33.582 6.106-4.523-5.743-6.628-12.59 1.333-16.65"}),c.createElement("path",{fillRule:"evenodd",stroke:"#f75c59",strokeLinejoin:"round",d:"M131.627 399.814c1.778-4.471 12.628-9.482 19.487-14.062 7.117 3.213 17.741 13.145 12.804 25.555-1.265 4.901-28.05 4.544-30.224 2.137-4.481-4.606-3.115-10.024-2.067-13.63zM128.198 428.251c-.91 7.576-.577 13.909-.763 20.76 3.425.788 7.262.337 11.082-.062-2.75-6.95-5.704-13.748-10.319-20.698z"})))})),Ie=e=>{const{version:t}=e,{configuration:n}=(0,r.useDatalayerStore)(),[a,i]=(0,c.useState)(!1);return(0,s.jsxs)(R.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsx)(R.X.Header,{children:(0,s.jsx)(E.m,{children:(0,s.jsxs)(E.m.TitleArea,{variant:"large",children:[(0,s.jsxs)(E.m.Title,{children:["ðŸª âšª Jupyter Kernels",(0,s.jsx)(fe.Z,{sx:{marginLeft:1},children:t})]}),(0,s.jsx)(E.m.Description,{children:"PREVIEW"})]})})}),(0,s.jsxs)(R.X.Content,{children:[(0,s.jsx)(x.Z,{children:(0,s.jsx)(C.Z,{children:"Jupyter Kernels scales your JupyterLab in the cloud with remote Kernels."})}),!n?.whiteLabel&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Z,{mt:3,children:a?(0,s.jsx)(Ee,{size:300,onClick:e=>i(!1)}):(0,s.jsx)("img",{src:"https://assets.datalayer.tech/releases/datalayer-0.3.0-black-snake_1024.png",onClick:e=>i(!0),style:{width:"100%"}})}),(0,s.jsx)(x.Z,{children:(0,s.jsx)(xe.Z,{href:"https://datalayer.tech/docs/releases/0.3.0-black-snake",target:"_blank",children:(0,s.jsx)(C.Z,{as:"h4",children:"Datalayer 0.3.0 Black Snake Release"})})}),(0,s.jsx)(x.Z,{children:(0,s.jsx)(xe.Z,{href:"https://github.com/datalayer/datalayer-iam",target:"_blank",children:(0,s.jsx)(C.Z,{as:"h4",children:"Source code"})})})]})]})]})};var Ne=n(46722);const Te=()=>(0,s.jsxs)(R.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsxs)(R.X.Header,{children:[(0,s.jsx)(E.m,{children:(0,s.jsxs)(E.m.TitleArea,{variant:"large",children:[(0,s.jsx)(E.m.Title,{children:"Billing"}),(0,s.jsx)(E.m.Description,{children:"PREVIEW"})]})}),(0,s.jsx)(x.Z,{children:(0,s.jsx)(Ne.Z,{children:(0,s.jsx)(x.Z,{children:"This feature is being developed."})})})]}),(0,s.jsx)(R.X.Content,{children:(0,s.jsx)(v.ConstructionIcon,{size:200})})]}),Pe=()=>(0,s.jsxs)(R.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsxs)(R.X.Header,{children:[(0,s.jsx)(E.m,{children:(0,s.jsxs)(E.m.TitleArea,{variant:"large",children:[(0,s.jsx)(E.m.Title,{children:"Content"}),(0,s.jsx)(E.m.Description,{children:"PREVIEW"})]})}),(0,s.jsx)(x.Z,{children:(0,s.jsx)(Ne.Z,{children:(0,s.jsx)(x.Z,{children:"This feature is being developed."})})})]}),(0,s.jsx)(R.X.Content,{children:(0,s.jsx)(v.ConstructionIcon,{size:200})})]});var Ze=n(21809),Ae=n(28319);const Le=e=>{const{boxPanel:t}=e;return(0,s.jsx)("div",{style:{position:"relative"},children:(0,s.jsx)(x.Z,{className:"jp-LabShell",sx:{position:"relative","& .dla-Jupyter-Notebook":{height:1e3,maxHeight:1e3,width:"100%"},"& .jp-MainAreaWidget":{width:"100%",height:"100%"},"& .jp-Toolbar":{width:"100% !important"},"& .jp-NotebookPanel-notebook":{width:"100% !important",height:"100%"},"& .lm-mod-hidden":{display:"unset !important"}},children:(0,s.jsx)(i.Lumino,{children:t})})})},Ke=e=>{const{version:t}=e,{configuration:n}=(0,r.useDatalayerStore)(),{jupyterLabAdapter:a,serviceManager:o}=(0,J.ZP)(),{enqueueToast:l}=H(),[d,h]=(0,c.useState)(),[u,p]=(0,c.useState)(),[m,g]=(0,c.useState)(),[f,_]=(0,c.useState)();(0,c.useEffect)((()=>{a&&(async()=>{const e=await a.notebook("test.ipynb");_(e)})().catch(console.error)}),[a]);const y=()=>{h(Array.from(o.local.kernels.running())),p(Array.from(o.local.sessions.running())),g(o.remote.servers.get())};return(0,ve.useInterval)((()=>{o&&o.remote&&y()}),5e3),(0,s.jsxs)(x.Z,{sx:{width:"xlarge",padding:2},children:[(0,s.jsx)(Ce,{version:t}),(0,s.jsx)(Ze.Z,{children:"Debugging Section"}),o&&o.local&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Z,{children:"Local Jupyter Server"}),(0,s.jsxs)(x.Z,{children:[o.local.serverSettings.baseUrl," -"," ",o.local.serverSettings.wsUrl]}),(0,s.jsxs)(x.Z,{mt:3,children:[(0,s.jsx)(x.Z,{children:"Local Kernels [ id | name | last_activity | execution_state | connections ]"}),d?.map((e=>(0,s.jsx)(x.Z,{children:(0,s.jsxs)(x.Z,{children:[e.id," | ",e.name," | ",e.last_activity," |"," ",e.execution_state," | ",e.connections,(0,s.jsx)(xe.Z,{sx:{marginLeft:1},href:"",onClick:t=>{var n;t.preventDefault(),n=e.id,o.local.kernels.shutdown(n).then((()=>{l(`Kernel ${n} is terminated.`,{variant:"info"}),console.log(`Kernel ${n} is terminated.`),y()}))},children:"delete"})]})},e.id)))]}),(0,s.jsxs)(x.Z,{mt:3,children:[(0,s.jsx)(x.Z,{children:"Local Sessions [ id | name | path | type | kernel_id | kernel_name ]"}),u?.map((e=>(0,s.jsx)(x.Z,{children:(0,s.jsxs)(x.Z,{children:[e.id," | ",e.name," | ",e.path," |"," ",e.type," | ",e.kernel?.id," |"," ",e.kernel?.name,(0,s.jsx)(xe.Z,{href:"",sx:{marginLeft:1},onClick:t=>{var n;t.preventDefault(),n=e.id,o.local.sessions.shutdown(n).then((()=>{l(`Session ${n} is terminated.`,{variant:"info"}),console.log(`Session ${n} is terminated.`),y()}))},children:"delete"})]})},e.id)))]})]}),o&&o.remote&&m&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Z,{mt:3,children:"Remote Jupyter Server"}),(0,s.jsxs)(x.Z,{children:[o.remote.serverSettings.baseUrl," -"," ",o.remote.serverSettings.wsUrl]}),(0,s.jsxs)(x.Z,{mt:3,children:[(0,s.jsx)(x.Z,{children:"Remote Kernels [ id | name | last_activity | execution_state | connections ]"}),m.map((e=>(0,s.jsx)(x.Z,{children:(0,s.jsxs)(x.Z,{children:[e.id," | ",e.name," | ",e.last_activity," |"," ",e.execution_state," | ",e.connections,(0,s.jsx)(xe.Z,{sx:{marginLeft:1},href:"",onClick:t=>{var n;t.preventDefault(),n=e.id,o.remote?.servers.shutdown(n).then((()=>{l(`Kernel ${n} is terminated.`,{variant:"info"}),console.log(`Kernel ${n} is terminated.`),y()}))},children:"delete"})]})},e.id)))]})]}),f&&(0,s.jsx)(i.Jupyter,{startDefaultKernel:!1,disableCssLoading:!0,collaborative:!1===n?.whiteLabel,theme:Ae.Z,lite:!1===n?.whiteLabel,children:(0,s.jsx)(Le,{boxPanel:f})})]})},Oe=()=>(0,s.jsx)(R.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:(0,s.jsx)(R.X.Content,{children:(0,s.jsx)("iframe",{src:"https://jupyter-kernels.datalayer.tech",style:{width:"100%",height:"1000px",border:0}})})}),Fe=()=>(0,s.jsxs)(R.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsxs)(R.X.Header,{children:[(0,s.jsx)(E.m,{children:(0,s.jsxs)(E.m.TitleArea,{variant:"large",children:[(0,s.jsx)(E.m.Title,{children:"Environments"}),(0,s.jsx)(E.m.Description,{children:"PREVIEW"})]})}),(0,s.jsx)(x.Z,{children:(0,s.jsx)(Ne.Z,{children:(0,s.jsx)(x.Z,{children:"This feature is being developed."})})})]}),(0,s.jsx)(R.X.Content,{children:(0,s.jsx)(v.ConstructionIcon,{size:200})})]}),$e=()=>(0,s.jsxs)(R.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsxs)(R.X.Header,{children:[(0,s.jsx)(E.m,{children:(0,s.jsxs)(E.m.TitleArea,{variant:"large",children:[(0,s.jsx)(E.m.Title,{children:"Kernels"}),(0,s.jsx)(E.m.Description,{children:"PREVIEW"})]})}),(0,s.jsx)(x.Z,{children:(0,s.jsx)(Ne.Z,{children:(0,s.jsx)(x.Z,{children:"This feature is being developed."})})})]}),(0,s.jsx)(R.X.Content,{children:(0,s.jsx)(v.ConstructionIcon,{size:200})})]}),Ve=()=>(0,s.jsxs)(R.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsxs)(R.X.Header,{children:[(0,s.jsx)(E.m,{children:(0,s.jsxs)(E.m.TitleArea,{variant:"large",children:[(0,s.jsx)(E.m.Title,{children:"Pools"}),(0,s.jsx)(E.m.Description,{children:"PREVIEW"})]})}),(0,s.jsx)(x.Z,{children:(0,s.jsx)(Ne.Z,{children:(0,s.jsx)(x.Z,{children:"This feature is being developed."})})})]}),(0,s.jsx)(R.X.Content,{children:(0,s.jsx)(v.ConstructionIcon,{size:200})})]});var We=n(4633),ze=n(54915),Ue=n(61726);const Be=[{navigation:"Overview",icon:w.vJ3,href:"#overview"},{navigation:"Details",icon:w.Rg1,counter:3,href:"#projects"},{navigation:"Cards",icon:w.H0r,counter:"12",href:"#repositories"},{navigation:"Stars",icon:w.r7p,counter:"3",href:"#stars"},{navigation:"Activity",icon:w.sOM,counter:67,href:"#activity"}],He=()=>{const{user:e}=(0,a.useStore)(),[t,n]=(0,c.useState)(0);return(0,s.jsxs)(x.Z,{sx:{display:"flex",flexDirection:"row",gap:3,alignItems:"flex-start"},children:[(0,s.jsxs)(x.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",height:"100%"},children:[(0,s.jsx)(We.Z,{size:256,src:"https://avatars.githubusercontent.com/u/5007189?s=200&v=4",alt:"avatar"}),(0,s.jsxs)(x.Z,{children:[(0,s.jsxs)(x.Z,{sx:{paddingY:3},children:[(0,s.jsx)(ze.Z,{as:"h1",sx:{fontSize:24},children:e?.displayName}),(0,s.jsx)(ze.Z,{as:"h1",sx:{fontSize:20,fontWeight:300},children:e?.handle})]}),(0,s.jsx)(x.Z,{sx:{display:"flex",flexDirection:"column",color:"fg.onEmphasis"},children:(0,s.jsx)(O.r,{block:!0,children:"Edit Profile"})})]})]}),(0,s.jsxs)(x.Z,{sx:{flexGrow:1},children:[(0,s.jsx)(Ue.J,{"aria-label":"Repository",children:Be.map(((e,r)=>(0,s.jsx)(Ue.J.Item,{icon:e.icon,"aria-current":r===t?"page":void 0,onSelect:e=>{e.preventDefault(),n(r)},counter:e.counter,href:e.href,children:e.navigation},e.navigation)))}),(0,s.jsx)(x.Z,{sx:{border:"1px solid",marginTop:2,borderColor:"border.default",borderRadius:"12px",height:"300px",width:"80%",padding:4},children:(0,s.jsx)(C.Z,{children:" "})})]})]})},Je=()=>(0,s.jsxs)(R.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsx)(R.X.Header,{children:(0,s.jsx)(E.m,{children:(0,s.jsx)(E.m.TitleArea,{variant:"large",children:(0,s.jsx)(E.m.Title,{children:"Profile"})})})}),(0,s.jsx)(R.X.Content,{children:(0,s.jsx)(He,{})})]}),qe=()=>(0,s.jsxs)(R.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsxs)(R.X.Header,{children:[(0,s.jsx)(E.m,{children:(0,s.jsxs)(E.m.TitleArea,{variant:"large",children:[(0,s.jsx)(E.m.Title,{children:"Servers"}),(0,s.jsx)(E.m.Description,{children:"PREVIEW"})]})}),(0,s.jsx)(x.Z,{children:(0,s.jsx)(Ne.Z,{children:(0,s.jsx)(x.Z,{children:"This feature is being developed."})})})]}),(0,s.jsx)(R.X.Content,{children:(0,s.jsx)(v.ConstructionIcon,{size:200})})]}),Xe=()=>(0,s.jsxs)(R.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsx)(R.X.Header,{children:(0,s.jsx)(E.m,{children:(0,s.jsx)(E.m.TitleArea,{variant:"large",children:(0,s.jsx)(E.m.Title,{children:"Settings"})})})}),(0,s.jsx)(R.X.Content,{children:(0,s.jsx)(a.DatalayerIdentity,{})})]});var Ge=n(53816),Ye=n(12829),Qe=n(85128),et=n(39509),tt=n(50425);function nt({options:e,style:t,settings:n,loading:r,theme:a}){const i=(0,c.useRef)(null),[o,l]=(0,c.useState)();return(0,c.useEffect)((()=>{const e=i.current?(0,tt.init)(i.current,a):void 0,t=()=>{e?.resize()};return e&&window.addEventListener("resize",t),l(e),()=>{e&&(e.dispose(),window.removeEventListener("resize",t))}}),[i.current,a]),(0,c.useEffect)((()=>{o?.setOption(e,n)}),[o,e,n]),(0,c.useEffect)((()=>{!0===r?o?.showLoading():o?.hideLoading()}),[o,r]),(0,s.jsx)("div",{ref:i,style:{width:"100%",height:"100px",...t}})}const st="usage-consumptions-kernels-table-title";function rt(){const e=Date.now(),{consumptions:t}=le(),[n,r]=(0,c.useState)(0),[a,i]=(0,c.useState)({month:(0,Qe.getMonth)(e)+1,year:(0,Qe.getYear)(e)}),[o,l]=(0,c.useState)(!1),d=(0,c.useMemo)((()=>function(e,t,n){const s=new Date(n.year,n.month-1),r=new Date,a=e.filter((e=>0===t?(0,Qe.isSameMonth)(e.endDate??r,s):(0,Qe.isSameYear)(e.endDate??r,s))).map((e=>{const n=e.endDate??r;return{duration:(0,Qe.differenceInSeconds)(n,e.startDate,{roundingMethod:"round"}),end:n,category:0===t?(0,Qe.getDate)(n)-1:(0,Qe.getMonth)(n)}})).reduce(((e,t)=>(e[t.category]+=t.duration,e)),new Array(0===t?(0,Qe.getDaysInMonth)(s):12).fill(0));return{x:0===t?a.map(((e,t)=>`${t+1}`)):["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],y:a}}(t??[],n,a)),[t,n,a]),h=(0,c.useCallback)((e=>{r(e)}),[]),u=(0,c.useCallback)((e=>{i(e),l(!1)}),[]),p=(0,c.useCallback)((e=>{i({month:1,year:parseInt(e.target.value,10)})}),[]),m=t?.filter((e=>!e.endDate))??[];return(0,s.jsxs)(x.Z,{sx:{padding:"var(--stack-padding-normal)",display:"grid",gridTemplateColumns:"1fr min-content",gridTemplateRows:"min-content max-content",gridTemplateAreas:"\n        'kernels credits'\n        'graph   graph'\n      ",gap:"var(--stack-gap-normal)"},children:[(0,s.jsxs)(x.Z,{sx:{gridArea:"kernels",display:"flex",flexDirection:"column","& .TableBody":{borderTop:"var(--borderWidth-thin) solid var(--borderColor-default)",borderRadius:"var(--borderRadius-medium)"},"& .TableBody .TableRow:first-of-type .TableCell:first-child":{borderTopLeftRadius:"var(--borderRadius-medium)"},"& .TableBody .TableRow:first-of-type .TableCell:last-child":{borderTopRightRadius:"var(--borderRadius-medium)"}},children:[(0,s.jsx)(_e.i.Container,{children:(0,s.jsx)(_e.i.Title,{as:"h3",id:st,children:"Running Kernels"})}),null===t?(0,s.jsx)(M.Z,{border:!0,spacious:!0,children:(0,s.jsx)(x.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40px"},children:(0,s.jsx)(F.Z,{})})}):(0,s.jsx)(_e.i,{"aria-labelledby":st,gridTemplateColumns:"1fr max-content",children:(0,s.jsx)(_e.i.Body,{children:m.length?m.map((e=>(0,s.jsxs)(_e.i.Row,{children:[(0,s.jsx)(_e.i.Cell,{children:e.kernelGivenName}),(0,s.jsxs)(_e.i.Cell,{children:[(0,s.jsx)(C.Z,{sx:{paddingRight:"var(--controlStack-medium-gap-condensed)"},children:"Started"}),(0,s.jsx)(Ge.Z,{format:"elapsed",tense:"past",date:e.startDate}),(0,s.jsx)(C.Z,{sx:{paddingLeft:"var(--controlStack-medium-gap-condensed)"},children:"ago"})]})]},e.id))):(0,s.jsx)(_e.i.Row,{children:(0,s.jsx)(_e.i.Cell,{children:(0,s.jsx)(C.Z,{sx:{color:"var(--fgColor-muted)",fontSize:"var(--text-body-size-large)"},children:"No running kernels"})})})})})]}),(0,s.jsxs)(x.Z,{sx:{gridArea:"graph",display:"flex",flexDirection:"column"},children:[(0,s.jsx)(C.Z,{as:"h3",children:"Consumption"}),(0,s.jsxs)(x.Z,{sx:{border:"solid var(--borderWidth-thin) var(--borderColor-default)",borderRadius:"var(--borderRadius-medium)",padding:"var(--stack-padding-condensed)"},children:[(0,s.jsxs)(x.Z,{sx:{display:"flex",justifyContent:"space-between"},children:[0===n?(0,s.jsxs)(x.Z,{className:"dla-consumption",children:[(0,s.jsx)(et.MonthInput,{selected:a,setShowMonthPicker:l,showMonthPicker:o,lang:navigator.language}),o?(0,s.jsx)(et.MonthPicker,{setIsOpen:l,selected:a,onChange:u,lang:navigator.language}):null]}):(0,s.jsx)(L.Z,{onChange:p,children:new Array(5).fill((0,Qe.getYear)(e)).map(((e,t)=>{const n=""+(e-t);return(0,s.jsx)(L.Z.Option,{value:n,children:n})}))}),(0,s.jsxs)(Ye.s,{"aria-label":"Consumptions interval",onChange:h,children:[(0,s.jsx)(Ye.s.Button,{selected:0===n,children:"Daily"}),(0,s.jsx)(Ye.s.Button,{selected:1===n,children:"Monthly"})]})]}),(0,s.jsx)(nt,{options:{xAxis:{type:"category",data:d.x},yAxis:{type:"value",name:"Seconds"},series:[{data:d.y,type:"bar",label:{show:!0,position:"inside",rotate:90}}],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}}},style:{height:"var(--overlay-height-medium)"}})]})]})]})}const at="usage-kernels-table-title";function it(){const{searchUsage:e,consumptions:t}=le(),[n,r]=(0,c.useState)(0),[a,i]=(0,c.useState)(""),[o,l]=(0,c.useState)([]),d=null===t,h=(0,c.useMemo)((()=>(e?.search(a)??[]).filter((e=>!e.item.endDate))),[e,a]),u=15*n,p=u+15,m=a?h.slice(u,p):(t??[]).filter((e=>!e.endDate)).map(((e,t)=>({item:e,refIndex:t}))),g=(0,c.useCallback)((e=>{i(e.target.value)}),[]),f=(0,c.useCallback)((({pageIndex:e})=>{r(e)}),[]),_=(0,c.useCallback)((e=>{const t=o.findIndex((t=>t===e));t<0?l([...o,e]):(o.splice(t,1),l([...o]))}),[o]);return(0,s.jsxs)(_e.i.Container,{children:[(0,s.jsx)(_e.i.Title,{as:"h3",id:at,children:"Active Kernels"}),(0,s.jsx)(x.Z,{sx:{padding:"var(--stack-padding-condensed) 0",gridArea:"filter"},children:(0,s.jsx)(D.Z,{disabled:d,type:"search",placeholder:"Search or filter",value:a,onChange:g,leadingVisual:w.W1M,sx:{width:"100%"}})}),d?(0,s.jsx)(M.Z,{border:!0,spacious:!0,children:(0,s.jsx)(x.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40px"},children:(0,s.jsx)(F.Z,{})})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(_e.i,{"aria-labelledby":at,gridTemplateColumns:"min-content 1fr max-content max-content max-content",children:[(0,s.jsx)(_e.i.Head,{children:(0,s.jsxs)(_e.i.Row,{children:[(0,s.jsx)(_e.i.Header,{}),(0,s.jsx)(_e.i.Header,{children:"Kernel name"}),(0,s.jsx)(_e.i.Header,{children:"Status"}),(0,s.jsx)(_e.i.Header,{children:"Total Running time"}),(0,s.jsx)(_e.i.Header,{children:"Create datetime"})]})}),(0,s.jsx)(_e.i.Body,{children:m.flatMap((e=>{const t=o.includes(e.item.id),n=[(0,s.jsxs)(_e.i.Row,{children:[(0,s.jsx)(_e.i.Cell,{children:(0,s.jsx)(b.h,{variant:"invisible","aria-label":t?"Hide kernel details":"Show kernel details",title:t?"Hide kernel details":"Show kernel details",icon:t?w.g8U:w.v4q,onClick:()=>{_(e.item.id)}})}),(0,s.jsx)(_e.i.Cell,{children:e.item.kernelGivenName}),(0,s.jsx)(_e.i.Cell,{children:(0,s.jsx)(fe.Z,{variant:"success",children:"Running"})}),(0,s.jsx)(_e.i.Cell,{children:(0,s.jsx)(Ge.Z,{format:"duration",date:e.item.startDate})}),(0,s.jsx)(_e.i.Cell,{children:(0,s.jsx)(Ge.Z,{date:e.item.startDate})})]},e.item.id)];return t&&n.push((0,s.jsx)(_e.i.Row,{children:(0,s.jsxs)(_e.i.Cell,{className:"kernels-usage-details",children:[(0,s.jsx)(C.Z,{children:"Resources: "}),(0,s.jsx)(C.Z,{children:JSON.stringify(e.item.podResources.requests??e.item.podResources.limits??"{}").slice(1,-1)})]})},`${e.item.id}-details`)),n}))})]}),(0,s.jsx)(_e.i.Pagination,{"aria-label":"Kernels usage pagination",pageSize:15,totalCount:h.length,onChange:f})]})]})}const ot="usage-history-table-title";function lt(){const{searchUsage:e,consumptions:t}=le(),[n,r]=(0,c.useState)(0),[a,i]=(0,c.useState)(""),o=null===t,l=(0,c.useMemo)((()=>(e?.search(a)??[]).filter((e=>e.item.endDate instanceof Date)).map((e=>Object.assign(e,{id:e.item.id,kernelGivenName:e.item.kernelGivenName,endDate:e.item.endDate})))),[e,a]),d=15*n,h=d+15,u=a?l.slice(d,h):(t??[]).filter((e=>e.endDate instanceof Date)).map(((e,t)=>({...e,item:e,refIndex:t}))),p=(0,c.useCallback)((e=>{i(e.target.value)}),[]),m=(0,c.useCallback)((({pageIndex:e})=>{r(e)}),[]);return(0,s.jsxs)(_e.i.Container,{children:[(0,s.jsx)(_e.i.Title,{as:"h3",id:ot,children:"Kernels"}),(0,s.jsx)(x.Z,{sx:{padding:"var(--stack-padding-condensed) 0",gridArea:"filter"},children:(0,s.jsx)(D.Z,{disabled:o,type:"search",placeholder:"Search or filter",value:a,onChange:p,leadingVisual:w.W1M,sx:{width:"100%"}})}),o?(0,s.jsx)(M.Z,{border:!0,spacious:!0,children:(0,s.jsx)(x.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40px"},children:(0,s.jsx)(F.Z,{})})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ye.w,{"aria-labelledby":ot,data:u,columns:[{header:"Kernel name",rowHeader:!0,field:"kernelGivenName",sortBy:"alphanumeric"},{header:"Date",field:"endDate",sortBy:"datetime",renderCell:e=>(0,s.jsx)(Ge.Z,{format:"datetime",precision:"day",date:e.item.endDate})},{header:"Duration",id:"duration",renderCell:e=>(0,s.jsx)(s.Fragment,{children:(0,Qe.formatDuration)((0,Qe.intervalToDuration)({start:e.item.startDate,end:e.item.endDate??Date.now()}))})}]}),(0,s.jsx)(_e.i.Pagination,{"aria-label":"Kernels usage pagination",pageSize:15,totalCount:l.length,onChange:m})]})]})}const ct=e=>{const{embeddedInJupyter:t=!1}=e,{jupyterLabAdapter:m,serviceManager:g,version:x,setJupyterLabAdapter:_,setServiceManager:y,setVersion:v}=(0,J.ZP)(),{user:w,logUser:k,token:b}=(0,a.useStore)(),{configuration:j}=(0,r.useDatalayerStore)(),[C,D]=(0,c.useState)(null);return(0,c.useEffect)((()=>{t||k()}),[]),(0,c.useEffect)((()=>{t||f("config").then((e=>{v(e.version)})).catch((e=>{console.error(`Error while accessing the jupyter server jupyter_kernels extension.\n${e}`)}))}),[t]),(0,c.useEffect)((()=>{if(!t)if(!m&&b){const e=e=>{_(e)},t=(0,s.jsx)(i.JupyterLabApp,{extensionPromises:(!1,{extensionPromises:[n.e(2800).then(n.t.bind(n,12800,23)),n.e(6640).then(n.t.bind(n,6640,23)).then((e=>e.default.filter((({id:e})=>!e.endsWith(":sessionDialogs"))))),n.e(5635).then(n.t.bind(n,15635,23)),n.e(1587).then(n.t.bind(n,61587,23)),n.e(7625).then(n.t.bind(n,27625,23)),n.e(6427).then(n.t.bind(n,26427,23)),n.e(3599).then(n.t.bind(n,13599,23)).then((e=>e.default.filter((({id:e})=>!e.endsWith(":manager"))))),n.e(1019).then(n.t.bind(n,91019,23)),n.e(7806).then(n.t.bind(n,17806,23)).then((e=>e.default)),n.e(7737).then(n.t.bind(n,57737,23)),n.e(1254).then(n.t.bind(n,51254,23)),n.e(8802).then(n.t.bind(n,58802,23)),n.e(7176).then(n.t.bind(n,77176,23)).then((e=>e.default.filter((({id:e})=>!e.includes(":language-server"))))),n.e(9845).then(n.t.bind(n,59845,23)),n.e(9448).then(n.t.bind(n,79448,23)).then((e=>e.default.filter((({id:e})=>!(e.includes(":language-server")||e.endsWith(":update-raw-mimetype")))))),n.e(5547).then(n.t.bind(n,5547,23)),n.e(3619).then(n.t.bind(n,33619,23)),n.e(1841).then(n.t.bind(n,31841,23)),n.e(2040).then(n.t.bind(n,52040,23)),n.e(6521).then(n.t.bind(n,46521,23)),n.e(4721).then(n.t.bind(n,44721,23))]}).extensionPromises,extensions:[l,o,u],headless:!0,disabledExtensions:[],onJupyterLab:e});D(t)}else D(null)}),[t,g,b,m]),(0,c.useEffect)((()=>{t||m&&!g&&y(m.jupyterLab.serviceManager)}),[t,m]),(0,c.useEffect)((()=>{t||g&&(0,p.Ad)(g,j,b,w)}),[g,j,b,w]),(0,s.jsx)(h.f,{embeddedInJupyter:t,children:w?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(d.Routes,{children:[(0,s.jsx)(d.Route,{path:"/",element:(0,s.jsx)(ue,{children:(0,s.jsx)(Ce,{version:x})})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels",element:(0,s.jsx)(ue,{children:(0,s.jsx)(Ce,{version:x})})}),(0,s.jsxs)(d.Route,{path:oe,element:(0,s.jsx)(ue,{children:(0,s.jsx)(ce,{})}),children:[(0,s.jsx)(d.Route,{path:"consumptions",element:(0,s.jsx)(rt,{})}),(0,s.jsx)(d.Route,{path:"kernels",element:(0,s.jsx)(it,{})}),(0,s.jsx)(d.Route,{path:"history",element:(0,s.jsx)(lt,{})})]}),(0,s.jsx)(d.Route,{path:S.C,element:(0,s.jsx)(ue,{children:(0,s.jsx)(S.Z,{})})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels/settings",element:(0,s.jsx)(ue,{children:(0,s.jsx)(Xe,{})})}),(0,s.jsx)(d.Route,{path:q,element:(0,s.jsx)(ue,{children:(0,s.jsx)(Y,{})})}),(0,s.jsx)(d.Route,{path:ee,element:(0,s.jsx)(ue,{children:(0,s.jsx)(se,{})})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels/login",element:(0,s.jsx)(ht,{whiteLabel:j?.whiteLabel})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels/about",element:(0,s.jsx)(ue,{children:(0,s.jsx)(Ie,{version:x})})}),!j?.whiteLabel&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.Route,{path:"/jupyter/kernels/debug",element:(0,s.jsx)(ue,{children:(0,s.jsx)(Ke,{version:x})})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels/kernels",element:(0,s.jsx)(ue,{children:(0,s.jsx)($e,{})})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels/pools",element:(0,s.jsx)(ue,{children:(0,s.jsx)(Ve,{})})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels/environments",element:(0,s.jsx)(ue,{children:(0,s.jsx)(Fe,{})})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels/content",element:(0,s.jsx)(ue,{children:(0,s.jsx)(Pe,{})})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels/servers",element:(0,s.jsx)(ue,{children:(0,s.jsx)(qe,{})})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels/billing",element:(0,s.jsx)(ue,{children:(0,s.jsx)(Te,{})})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels/profile",element:(0,s.jsx)(ue,{children:(0,s.jsx)(Je,{})})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels/docs",element:(0,s.jsx)(ue,{children:(0,s.jsx)(Oe,{})})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels/logout",element:(0,s.jsx)(ue,{children:(0,s.jsx)(a.Logout,{homeRoute:"/jupyter/kernels"})})})]})]}),C]}):(0,s.jsxs)(d.Routes,{children:[(0,s.jsx)(d.Route,{path:"/",element:(0,s.jsx)(ht,{whiteLabel:j?.whiteLabel})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels",element:(0,s.jsx)(ht,{whiteLabel:j?.whiteLabel})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels/login",element:(0,s.jsx)(ht,{whiteLabel:j?.whiteLabel})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels/password",element:(0,s.jsx)(ue,{children:(0,s.jsx)(a.NewPasswordForm,{passwordConfirmRoute:"/jupyter/kernels/password/confirm"})})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels/password/confirm",element:(0,s.jsx)(ue,{children:(0,s.jsx)(a.NewPasswordConfirm,{loginRoute:"/jupyter/kernels/login",passwordWelcomeRoute:"/jupyter/kernels/password/welcome"})})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels/password/welcome",element:(0,s.jsx)(ue,{children:(0,s.jsx)(a.NewPasswordWelcome,{loginRoute:"/jupyter/kernels/login"})})}),!1===j?.whiteLabel&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.Route,{path:"/jupyter/kernels/join",element:(0,s.jsx)(ue,{children:(0,s.jsx)(a.JoinForm,{joinConfirmRoute:"/jupyter/kernels/join/confirm"})})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels/join/confirm",element:(0,s.jsx)(ue,{children:(0,s.jsx)(a.JoinConfirm,{loginRoute:"/jupyter/kernels/login",joinWelcomeRoute:"/jupyter/kernels/join/welcome"})})}),(0,s.jsx)(d.Route,{path:"/jupyter/kernels/join/welcome",element:(0,s.jsx)(ue,{children:(0,s.jsx)(a.JoinWelcome,{loginRoute:"/jupyter/kernels/login"})})})]})]})})},dt=ct;function ht({whiteLabel:e=!1}){return(0,s.jsx)(ue,{children:(0,s.jsx)(a.LoginForm,{heading:e?"Login":"Login to Datalayer",homeRoute:"/jupyter/kernels",passwordRoute:"/jupyter/kernels/password",joinRoute:e?void 0:"/jupyter/kernels/join",joinConfirmRoute:e?void 0:"/jupyter/kernels/join/confirm",showEmailLogin:!e,showGitHubLogin:!e,showTokenLogin:!0})})}},3301:(e,t,n)=>{n.d(t,{Ic:()=>l,Kc:()=>o,Sj:()=>i,cR:()=>a,hF:()=>r});var s=n(50086);async function r({serverSettings:e}={}){const t=await(0,s.rN)("api/jupyter/v1/environments",{},e);return t.success?t.environments??[]:(console.error("Failed to fetch available environments.",t),[])}async function a(e){const t=await(0,s.rN)(`api/jupyter/v1/environment/${e.name}`,{method:"POST",body:JSON.stringify({kernel_type:e.kernelType??"default",kernel_given_name:e.givenName})},e.serverSettings);if(!t.success||!t.kernel){const n=`Failed to create a kernel for the environment ${e.name}.`;throw console.error(n,t),new Error(n)}return t.kernel}async function i({serverSettings:e}={}){const t=await(0,s.rN)("api/jupyter/v1/kernels",{},e);if(!t.success){const e="Failed to list the running kernel servers.";throw console.error(e,t),new Error(e)}return t.kernels??[]}async function o(e){await(0,s.rN)(`api/jupyter/v1/kernel/${e.id}`,{method:"DELETE"},e.serverSettings)}async function l({serverSettings:e}={}){const t=await(0,s.rN)("api/jupyter/v1/usage",{},e);return t.success?(t.consumptions??[]).map((e=>({id:e.session_id,endDate:e.end_date?new Date(e.end_date):void 0,environmentName:e.environment_name,kernelGivenName:e.kernel_given_name,podResources:e.pod_resources,startDate:new Date(e.start_date)}))):(console.error("Failed to fetch user resources consumptions.",t),[])}},50086:(e,t,n)=>{n.d(t,{lV:()=>o,rN:()=>l});var s=n(13899),r=n(88913),a=n(1865),i=n(66274);function o(e,t,n){return i.ServerConnection.makeSettings({baseUrl:e,wsUrl:n||e.replace(/^http/,"ws"),token:t,appendToken:!0,init:{mode:"cors",credentials:"include",cache:"no-store"}})}async function l(e,t,n){const l=n??function(){const e=s.datalayerStore.getState().configuration?.apiServerUrl;if(!e)throw new Error("Undefined remote service server.");const t=r.jpIAMStore.getState().token;if(!t)throw new Error("No authentication token found for the remote service server.");return o(e,t)}();let c=e;0!==e.indexOf(l.baseUrl)&&(c=a.URLExt.join(l.baseUrl,e));const d=await async function(e,t,n){if(0!==e.indexOf(n.baseUrl))throw new Error("Can only be used for jupyter server requests");"no-store"===(t.cache??n.init.cache)&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());const s=new n.Request(e,{...n.init,...t});let r=!1;if(n.token&&(r=!0,s.headers.append("Authorization",`Bearer ${n.token}`)),"undefined"!=typeof document){const e=function(e){let t="";try{t=document.cookie}catch(e){return}const n=t.match("\\b"+e+"=([^;]*)\\b");return n?.[1]}("_xsrf");void 0!==e&&(r=!0,s.headers.append("X-XSRFToken",e))}const a=new Headers(t.headers);!a.has("Content-Type")&&r&&s.headers.set("Content-Type","application/json"),!a.has("Accept")&&r&&s.headers.set("Accept","application/json");try{return await n.fetch.call(null,s)}catch(e){throw new i.ServerConnection.NetworkError(e)}}(c,t??{},l);if(!d.ok)throw await i.ServerConnection.ResponseError.create(d);return"application/json"===d.headers.get("Content-Type")?await d.json():await d.text()}},74627:(e,t,n)=>{n.d(t,{T:()=>c});var s=n(74512),r=n(53646),a=n(46722),i=n(32126),o=n(19118),l=n(66029);function c(e){const{actions:t,children:n,closable:c,variant:d,sx:h,...u}=e,[p,m]=(0,l.useState)(!0),g="warning"===d?(0,s.jsx)(r.zMQ,{}):"success"===d?(0,s.jsx)(r.nQG,{}):"danger"===d?(0,s.jsx)(r.wNq,{}):(0,s.jsx)(r.szr,{}),f=(0,l.useCallback)((()=>{c&&m(!1)}),[c]);return p?(0,s.jsxs)(a.Z,{...u,variant:d,sx:{...h,margin:"var(--stack-gap-condensed) 0",display:"grid",gridTemplateColumns:"min-content 1fr minmax(0, auto)",gridTemplateRows:"min-content",gridTemplateAreas:"'visual message actions close'","@media screen and (max-width: 544px)":{gridTemplateColumns:"min-content 1fr",gridTemplateRows:"min-content min-content",gridTemplateAreas:"\n                'visual message close'\n                '.      actions actions'\n              "}},children:[(0,s.jsx)(i.Z,{sx:{display:"grid",paddingBlock:"var(--base-size-8)",alignSelf:"center",gridArea:"visual"},children:g}),(0,s.jsx)(i.Z,{sx:{alignSelf:"center",display:"grid",gridArea:"message"},children:n}),(0,s.jsx)(i.Z,{sx:{display:"grid",gap:"var(--stack-gap-condensed)",marginLeft:"actions","@media screen and (max-width: 544px)":{alignSelf:"start",margin:"var(--base-size-8) 0 0 var(--base-size-8)"}},children:t}),c&&(0,s.jsx)(i.Z,{sx:{alignSelf:"start",marginLeft:"close"},children:(0,s.jsx)(o.h,{"aria-label":"Dismiss flash message",title:"Dismiss",onClick:f,variant:"invisible",icon:r.b0D,sx:{"& > svg":{marginRight:0,color:"var(--fgColor-default)"}}})})]}):null}},27117:(e,t,n)=>{n.d(t,{U:()=>a});var s=n(74512),r=n(66029);function a(e){const{markdownParser:t,sanitizer:n,text:a}=e,[i,o]=(0,r.useState)("");return(0,r.useEffect)((()=>{t.render(a).then((e=>{o(n?n.sanitize(e):e)}))}),[t,n,a]),(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:i}})}},62248:(e,t,n)=>{n.d(t,{p:()=>w});var s=n(74512),r=n(88913),a=n(19893),i=n(32126),o=n(90573),l=n(11790),c=n(97478),d=n(18310),h=n(28977),u=n(62005),p=n(86642),m=n(66029),g=n(20948),f=n(83513),x=n(65693),_=n(58643),y=n(74627),v=n(27117);function w(e){const{manager:t,onSubmit:n,openDocument:w,startKernel:k,markdownParser:b,sanitizer:j}=e,S=t.environments.get(),{user:C}=(0,r.useStore)();let D;try{D=(0,g.s)()}catch(e){}const{jupyterLabAdapter:R}=(0,f.ZP)(),[M,E]=(0,m.useState)(S[0]?.name??""),[I,N]=(0,m.useState)(S[0]?.kernel?.givenNameTemplate||S[0]?.title||""),[T,P]=(0,m.useState)(!1),[Z,A]=(0,m.useState)(!1),[L,K]=(0,m.useState)(!1),[O,F]=(0,m.useState)(""),[$,V]=(0,m.useState)("danger"),W=(0,m.useCallback)((e=>{const t=e.target.value;if(E(t),!T){const e=S.find((e=>e.name===t));N(e?.kernel?.givenNameTemplate||e?.title||"")}}),[E,T]),z=(0,m.useCallback)((async()=>{if(M){F(""),K(!0);const e=S.find((e=>e.name===M)),s={name:M,language:e?.language??"",location:"remote",displayName:I??e?.title};if(k??1)try{const e=await t.servers.startNew({name:M,givenName:I},{username:C?.handle,handleComms:!0});if(R?.jupyterLab){const t={kernelId:e.id,kernelName:e.name};if(w)"notebook"===w&&(0,x.l)({app:R.jupyterLab,options:t});else if(Z){const e=S.find((e=>e.name===M))?.example;e&&(0,x.l)({app:R.jupyterLab,name:M,url:e,options:t})}}}catch(e){let t="Failed to create the remote kernel";return"MaxKernelsError"===e.name?(t="You reached your persistent remote kernel limits. Stop existing kernel before starting new ones.",V("warning")):V("danger"),console.error(t,e),void F(t)}finally{K(!1)}n(s)}}),[t,M,I,n,Z,R]),U=(0,m.useCallback)((e=>{e.preventDefault(),A(!Z)}),[Z]),B=(0,m.useCallback)((()=>{D?.(_.C)}),[D]),H=(0,m.useCallback)((e=>{"string"==typeof e.target.value&&(N(e.target.value),P(!0))}),[]),J=S.find((e=>e.name===M))?.description??"";return(0,s.jsx)(p.V,{title:"Launch a Kernel",onClose:()=>{n(null)},footerButtons:[{buttonType:"default",onClick:()=>{n(null)},content:"Cancel",disabled:L},{buttonType:"primary",onClick:z,content:L?(0,s.jsx)(a.Z,{size:"small"}):k??1?"Launch a Kernel":"Assign from the Environment",disabled:L,autoFocus:!0}],children:(0,s.jsxs)(i.Z,{as:"form",children:[(0,s.jsxs)(o.Z,{required:!0,children:[(0,s.jsx)(o.Z.Label,{children:"Environment"}),(0,s.jsx)(l.Z,{name:"environment",disabled:0===S.length,value:M,onChange:W,block:!0,children:S.map((e=>(0,s.jsxs)(l.Z.Option,{value:e.name,children:[e.name,e.title&&(0,s.jsxs)(s.Fragment,{children:[" - ",(0,s.jsx)("span",{children:e.title})]})]},e.name)))}),(0,s.jsx)(o.Z.Caption,{children:b?(0,s.jsx)(v.U,{text:J,markdownParser:b,sanitizer:j}):J})]}),(0,s.jsxs)(o.Z,{children:[(0,s.jsx)(o.Z.Label,{children:"Kernel name"}),(0,s.jsx)(c.Z,{name:"name",value:I,onChange:H,block:!0})]}),!w&&R?.jupyterLab&&(0,s.jsxs)(o.Z,{sx:{paddingTop:"10px"},children:[(0,s.jsx)(o.Z.Label,{children:"Open example notebook"}),(0,s.jsx)(d.Z,{disabled:!S.find((e=>e.name===M))?.example,checked:Z,onClick:U})]}),O&&(0,s.jsx)(y.T,{variant:$,actions:D&&"warning"===$?(0,s.jsx)(h.r,{onClick:B,title:"Upgrade your subscription.",children:"Upgrade"}):void 0,children:(0,s.jsx)(u.Z,{children:O})})]})})}},20049:(e,t,n)=>{n.d(t,{f:()=>l});var s=n(74512),r=n(59689),a=n(59606),i=n(66029),o=n(83513);function l(e){const{children:t,colorMode:n,embeddedInJupyter:l,...c}=e,{jupyterLabAdapter:d}=(0,o.ZP)(),[h,u]=(0,i.useState)(n??"light");return(0,i.useEffect)((()=>{if(!l)return e({matches:window.matchMedia("(prefers-color-scheme: dark)").matches}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e),()=>{window.matchMedia("(prefers-color-scheme: dark)").removeEventListener("change",e)};{const e=d?.service("@jupyterlab/apputils-extension:themes");if(e)return t(e),e.themeChanged.connect(t),()=>{e.themeChanged.disconnect(t)}}function e({matches:e}){u(e?"dark":"light")}function t(e){u(e.theme&&!e.isLight(e.theme)?"dark":"light")}}),[l,d]),(0,s.jsx)(r.f6,{...c,colorMode:h,children:(0,s.jsx)(a.Z,{children:t})})}},20948:(e,t,n)=>{n.d(t,{s:()=>r});var s=n(83627);const r=()=>{const e=(0,s.useNavigate)();return(t,n=null,s=!0)=>{n&&n.preventDefault(),window.scrollTo(0,0),document.body.scrollTop=0,e(t)}}},27955:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Wt});var s={};n.r(s),n.d(s,{changeCurrentWorkingDirectory:()=>W,getOutputCandidates:()=>z,listVariables:()=>F,loadVariables:()=>V,saveVariables:()=>$});var r=n(74512),a=n(13899),i=n(1339);const o=new i.zZ({name:"@datalayer/icons:cloud",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 896 896" fill="currentColor" aria-hidden="true">\n  <path d="M747.4 354.7C701.6 233.9 584.9 148 448.2 148S194.8 233.8 149 354.6C63.3 377.1 0 455.1 0 548c0 110.5 89.5 200 199.9 200h496.2C806.5 748 896 658.5 896 548c0-92.7-63.1-170.7-148.6-193.3zm36.3 281a123.07 123.07 0 01-87.6 36.3H199.9c-33.1 0-64.2-12.9-87.6-36.3A123.3 123.3 0 0176 548c0-28 9.1-54.3 26.2-76.3a125.7 125.7 0 0166.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10c54.3 14.5 92.1 63.8 92.1 120 0 33.1-12.9 64.3-36.3 87.7z"/>\n</svg>\n'}),l=new i.zZ({name:"@datalayer/icons:cloud-upload",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 1024 1024" fill="currentColor" aria-hidden="true">\n  <path d="M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"/>\n  <path d="M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"/>\n</svg>\n'}),c=new i.zZ({name:"@datalayer/icons:circle-white",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72" fill="currentColor" aria-hidden="true">\n  <circle cx="36" cy="36" r="28" fill="#fff"/>\n  <circle cx="36" cy="36" r="28" fill="none" stroke="#000" stroke-linejoin="round" stroke-width="2"/>\n</svg>\n'});var d=n(88913),h=n(33078),u=n(56653),p=n(96129),m=n(1865),g=n(91295),f=n(8826),x=n(2998),_=n(66274),y=n(67370),v=n(62086),w=n(40158),k=n(34882),b=n(29482),j=n(62248),S=n(83513),C=n(2947),D=n(74901),R=n(53646),M=n(19118),E=n(66029),I=n(97930),N=n(68148),T=n(32126),P=n(90573),Z=n(11790),A=n(62005),L=n(34500),K=n(70818),O=n(86642);function F(){return"\ndef _list_variables():\n    import json\n    from types import BuiltinFunctionType, BuiltinMethodType, FunctionType, MethodType, MethodWrapperType, ModuleType, TracebackType\n\n    _FORBIDDEN_TYPES = [type, BuiltinFunctionType, BuiltinMethodType, FunctionType, MethodType, MethodWrapperType, ModuleType, TracebackType]\n    try:\n        from IPython.core.autocall import ExitAutocall\n        _FORBIDDEN_TYPES.append(ExitAutocall)\n    except ImportError:\n        pass\n    _exclude = tuple(_FORBIDDEN_TYPES)\n\n    _all = frozenset(globals())\n    _vars = {}\n    for _n in _all:\n        _v = globals()[_n]\n        \n        if not (\n            _n.startswith('_') or\n            isinstance(_v, _exclude) or\n            # Special IPython variables\n            (_n == 'In' and isinstance(_v, list)) or\n            (_n == 'Out' and isinstance(_v, dict))\n        ):\n            _vars[_n] = type(_v).__qualname__\n\n    return json.dumps(_vars)\n\n_list_variables()"}function $(e){return`\ndef _pickle_variables():\n    from base64 import encodebytes\n    import json\n    import pickle\n    _names = {${e.map((e=>`"${e}"`)).join(",")}}\n    _data = {}\n    for _n in _names:\n        try:\n            _v = globals()[_n]\n            dump = pickle.dumps(_v)\n            _data[_n] = encodebytes(dump).decode("ascii")\n        except:\n            ...\n\n    return json.dumps(_data)\n\n_pickle_variables()\n`}function V(e){return`\ndef _load_variables():\n    from base64 import decodebytes\n    import json\n    import pickle\n    _data = json.loads(${e})\n    _loaded = []\n    for _n, _v in _data.items():\n        try:\n            dump = decodebytes(_v.encode("ascii"))\n            globals()[_n] = pickle.loads(dump)\n            _loaded.append(_n)\n        except:\n            ...\n    return json.dumps(_loaded)\n\n_load_variables()\n`}function W(e){return`\ndef _change_current_directory():\n    import os\n    from pathlib import Path\n    _local_content_mount_point = Path(Path.home() / ${e.split("/").map((e=>`"${e}"`)).join(" / ")})\n    _local_content_mount_point.mkdir(parents=True, exist_ok=True)\n    os.chdir(_local_content_mount_point)\n\n    assert Path.cwd() == _local_content_mount_point\n\n_change_current_directory()\n`}function z(e){return Array.from(e.matchAll(/^((?<output>[A-z][\w]*)\s*=[^=]|\((?<walrus>[A-z][\w]*)\s*:=[^=)]+\))/gm)).map((e=>e.groups?.output??e.groups?.walrus??"")).filter((e=>!!e))}class U{static $language=new Map;static register(e,t){this.$language.set(e,t)}static supports(e){return this.$language.has(e)}_language;constructor(e){if(!U.$language.has(e))throw new Error(`${e} is not supported.`);this._language=e}get language(){return this._language}changeCurrentWorkingDirectory(e){return U.$language.get(this.language).changeCurrentWorkingDirectory(e)}listVariables(){return U.$language.get(this.language).listVariables()}loadVariables(e){return U.$language.get(this.language).loadVariables(e)}saveVariables(e){return U.$language.get(this.language).saveVariables(e)}getOutputCandidates(e){return U.$language.get(this.language).getOutputCandidates(e)}}U.register("python",s);var B=n(61295),H=n(94156);const J=["browser","local"];function q(e){return!J.includes(e)}const X=30;function G(e){const{preActions:t,postActions:n,disabled:s,filterKernel:a,preference:i,serviceManager:o,selection:l,setSelection:c,translator:d,variant:h}=e,[u,p]=(0,E.useState)(Y(o,i?.id,d,a,h)),m=(0,E.useMemo)((()=>(d??v.nullTranslator).load("jupyterlab")),[d]),g={maxHeight:"large",width:"cell"===h?"small":"auto"};return(0,E.useEffect)((()=>{const e=()=>{p(Y(o,i?.id,d,a,h))};return o.browser?.kernels.runningChanged.connect(e),o.browser?.kernelspecs.specsChanged.connect(e),o.browser?.sessions.runningChanged.connect(e),o.local.kernels.runningChanged.connect(e),o.local.kernelspecs.specsChanged.connect(e),o.local.sessions.runningChanged.connect(e),o.remote?.servers.changed.connect(e),o.remote?.environments.changed.connect(e),()=>{o.browser?.kernels.runningChanged.disconnect(e),o.browser?.kernelspecs.specsChanged.disconnect(e),o.browser?.sessions.runningChanged.disconnect(e),o.local.kernels.runningChanged.disconnect(e),o.local.kernelspecs.specsChanged.disconnect(e),o.local.sessions.runningChanged.disconnect(e),o.remote?.servers.changed.disconnect(e),o.remote?.environments.changed.disconnect(e)}}),[o,i,d,a,h]),(0,r.jsxs)(H.P,{children:["cell"===h?(0,r.jsx)(H.P.Anchor,{children:(0,r.jsx)(M.h,{disabled:s||null===u,icon:()=>(0,r.jsx)(w.kernelIcon.react,{className:"dla-cell-kernel-icon",tag:"span"}),"aria-label":m.__("Assign a specific kernel to the cell."),title:m.__("Assign specific kernel to the cell."),size:"small",variant:"invisible"})}):(0,r.jsxs)(H.P.Button,{variant:"default",disabled:s||null===u,children:[(0,r.jsx)(A.Z,{fontWeight:"bold",children:m.__("Kernel:")})," "+(l?.displayName??m.__("No Kernel"))]}),(0,r.jsx)(H.P.Overlay,{...g,width:"medium",sx:{overflowY:"auto"},side:"cell"===h?"outside-left":"outside-right",children:(0,r.jsxs)(N.S,{selectionVariant:"single",children:["cell"===h&&(0,r.jsxs)(N.S.Item,{selected:null===l,onSelect:()=>{c(null)},children:[i?.location&&(0,r.jsx)(N.S.LeadingVisual,{children:"local"===i.location?(0,r.jsx)(C.LaptopSimpleIcon,{}):"browser"===i.location?(0,r.jsx)(C.BrowserIcon,{}):(0,r.jsx)(B.Z,{})}),m.__("Assign the Notebook Kernel")]},"null"),!!t&&t,Object.entries(u??{}).map((([e,t])=>(0,r.jsx)(N.S.Group,{title:e,children:t.map((e=>{const t=e.id?`${e.displayName??""} - ${e.id.slice(0,7)}`:e.displayName??"",n=(e.displayName?.length??0)>X?e.displayName.slice(0,X)+"â€¦":e.displayName??"";return(0,r.jsxs)(N.S.Item,{title:t,selected:(e.location===l?.location||q(e.location)&&q(l?.location??"local"))&&(e.id??e.name)===(l?.id??l?.name),onSelect:()=>{c(e)},children:[(0,r.jsx)(N.S.LeadingVisual,{children:"local"===e.location?(0,r.jsx)(C.LaptopSimpleIcon,{}):"browser"===e.location?(0,r.jsx)(C.BrowserIcon,{}):(0,r.jsx)(B.Z,{})}),e.id?`${n} - ${e.id.slice(0,7)}`:n]},e.name)}))},e))),!!n&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(N.S.Divider,{}),n]})]})})]})}function Y(e,t,n,s=(()=>!0),r){const a=(n=n??v.nullTranslator).load("jupyterlab"),i=e.local.kernelspecs.specs,o=e.local.sessions.running(),l={},c=Array.from(o).filter((e=>e.kernel&&e.kernel.id!==t&&i.kernelspecs[e.kernel.name])).map((e=>{const t=i.kernelspecs[e.kernel.name];return{id:e.kernel.id,name:t.name,language:t.language,displayName:e.name||m.PathExt.basename(e.path),location:"local"}})).concat(Array.from(e.browser?.sessions.running()??[]).filter((e=>e.kernel&&e.kernel.id!==t)).map((t=>{const n=e.browser.kernelspecs.specs.kernelspecs[t.kernel.name];return{id:t.kernel.id,name:n.name,language:n.language,displayName:t.name||m.PathExt.basename(t.path),location:"browser"}}))).filter(s),d=c.map((e=>e.id)),h=Array.from(e.local.kernels.running()).filter((e=>!d.includes(e.id))).map((e=>{const t=i.kernelspecs[e.name];return{id:e.id,name:t.name,language:t.language,displayName:t.display_name,location:"local"}})).concat((e.remote?.servers.get()??[]).filter((e=>e.id&&!d.includes(e.id))).map((t=>{const n=e.remote.environments.get().find((e=>e.name===t.environment_name));return{id:t.id,name:n.name,language:n.language,displayName:t.kernel_given_name??n.title,location:"remote"}}))).concat(Array.from(e.browser?.kernels.running()??[]).filter((e=>!d.includes(e.id))).map((t=>{const n=e.browser.kernelspecs.specs.kernelspecs[t.name];return{id:t.id,name:n.name,language:n.language,displayName:n.display_name,location:"browser"}}))).filter(s);c.push(...h),c.length&&(l["cell"===r?"Assign a running remote Kernel":"Assign a running Kernel"]=c);const u=Object.values(i.kernelspecs).filter((e=>!!e)).map((e=>({name:e.name,language:e.language,displayName:e.display_name,location:"local"}))).filter(s);return u.push(...e.remote?.environments.get().map((e=>({name:e.name,language:e.language,displayName:e.title,location:"remote"}))).filter(s)??[]),u.push(...Object.values(e.browser?.kernelspecs.specs?.kernelspecs??{}).filter((e=>!!e)).map((e=>({name:e.name,language:e.language,displayName:e.display_name,location:"browser"}))).filter(s)),u.length&&(l[a.__("Assign a new Kernel")]=u),l}var Q=n(27117);function ee(e){const{markdownParser:t,model:n,preference:s,sanitizer:a,serviceManager:i,sessionContext:o,translator:l}=e,[c,d]=(0,E.useState)(!1),[h,u]=(0,E.useState)(!1),[p,m]=(0,E.useState)(!1),[g,f]=(0,E.useState)(!1),[x,_]=(0,E.useState)(""),[y,w]=(0,E.useState)([]),[k,b]=(0,E.useState)(!1),S=(0,E.useMemo)((()=>(l??v.nullTranslator).load("jupyterlab")),[l]);(0,E.useEffect)((()=>{const e=e=>{const t=(e.getMetadata("datalayer")??{}).kernel;d(!!t),u(!1===t?.params?.persistent);const n=[];if(t){const e=i.remote?.environments.get().find((e=>e.name===t.name));_(e?.language??""),e?.snippets&&n.push(...e.snippets)}w(n)};return e(n),n.metadataChanged.connect(e),()=>{n.metadataChanged.disconnect(e)}}),[n]);const D=(0,E.useCallback)((e=>!!e.id&&q(e.location)&&(!s?.language||e.language===s?.language)),[s]),R=(0,E.useCallback)((e=>{const t=n.getMetadata("datalayer")??{kernel:null};null===e?(delete t.kernel,n.setMetadata("datalayer",t)):n.setMetadata("datalayer",Object.assign(t,{kernel:e}))}),[n]),M=(0,E.useCallback)((()=>{f(!1)}),[]),I=(0,E.useCallback)((()=>{f(!0)}),[]),T=(0,E.useCallback)((()=>{b(!1)}),[]),P=(0,E.useCallback)((()=>{b(!0)}),[]),Z=(0,E.useCallback)((()=>{m(!0)}),[]),A=(0,E.useCallback)((e=>{e&&(e.params={...e.params,persistent:!1},R(e)),m(!1)}),[R]),L=n.getMetadata("datalayer")??{};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(G,{filterKernel:D,preference:s,serviceManager:i,selection:L.kernel?L.kernel:null,setSelection:R,variant:"cell",preActions:(0,r.jsxs)(N.S.Item,{disabled:!i.remote,onSelect:Z,selected:h,title:i.remote?"Assign a new temporary kernel on each cell run.":"You are not connected with Datalayer.",children:[(0,r.jsx)(N.S.LeadingVisual,{children:(0,r.jsx)(C.CloudUploadIcon,{})}),S.__("Assign a Temporary Kernel")]}),postActions:(0,r.jsxs)(r.Fragment,{children:[U.supports(s?.language??"")&&(0,r.jsx)(N.S.Item,{onSelect:I,disabled:!c,title:S.__("Define variables to transfer between the document kernel and the cell kernel."),children:S.__("Define Cell Variables Transfer")}),(0,r.jsx)(N.S.Item,{onSelect:P,disabled:0===y.length,title:S.__("Inject a code snippet at the end of the cell."),children:S.__("Inject code snippet")})]}),translator:l}),g&&(0,r.jsx)(te,{model:n,onClose:M,preference:s,sessionContext:o,translator:l}),k&&(0,r.jsx)(ne,{language:x,model:n,snippets:y,onClose:T,markdownParser:t,sanitizer:a}),p&&(0,r.jsx)(j.p,{manager:i.remote,onSubmit:A,openDocument:"cell",startKernel:!1,markdownParser:t,sanitizer:a})]})}function te(e){const{onClose:t,model:n,preference:s,sessionContext:a,translator:i}=e,[o,l]=(0,E.useState)([]),[c,d]=(0,E.useState)(),u=(0,E.useMemo)((()=>(i??v.nullTranslator).load("jupyterlab")),[i]);(0,E.useEffect)((()=>{const e=e=>{const t=e.getMetadata("datalayer")??{};t.in&&!I.JSONExt.deepEqual(o,t.in)&&l(t.in),t.out&&t.out!==c&&d(t.out)};return e(n),n.metadataChanged.connect(e),()=>{n.metadataChanged.disconnect(e)}}),[n]);const p=(0,E.useCallback)((()=>{const e=n.getMetadata("datalayer")??{};o.length?e.in=o:delete e.in,c?e.out=c:delete e.out,n.setMetadata("datalayer",{...e}),t()}),[o,c]),m=(0,E.useCallback)((async()=>{if(!a)return[];const e=a.session.kernel,t=a.specsManager.specs.kernelspecs[e.model.name],n=new U(t.language),s=(await new h.KernelExecutor({connection:e}).execute(n.listVariables())).get(0).data["text/plain"];if(s){const e=JSON.parse(s.slice(1,s.length-1));return Object.keys(e??{})}return[]}),[s,a]),g=(0,E.useCallback)((async()=>new U("python").getOutputCandidates(n.sharedModel.source)),[n]);let f="Define cell variables to transfer";const x=(n.getMetadata("datalayer")??{}).kernel??{},_=(x.displayName||x.name)??"";return _&&(!1!==x.params?.persistent&&x.id?f+=` with running ${_} (${x.id.slice(0,7)})`:f+=` with ${_}`),(0,r.jsx)(O.V,{title:f,onClose:t,footerButtons:[{buttonType:"default",content:u.__("Cancel"),onClick:t},{buttonType:"primary",content:u.__("Set variables"),onClick:p,autoFocus:!0}],children:(0,r.jsx)(se,{inputs:o,getInputOptions:a?m:void 0,setInputs:l,output:c??void 0,getOutputOptions:g,setOutput:d,translator:i})})}function ne(e){const{model:t,onClose:n,language:s,snippets:a,markdownParser:i,sanitizer:o,translator:l}=e,[c,d]=(0,E.useState)(a[0]),h=(0,E.useMemo)((()=>(l??v.nullTranslator).load("jupyterlab")),[l]),u=(0,E.useCallback)((e=>{const t=e.target.value;d(a[parseInt(t,10)])}),[d,a]),p=(0,E.useCallback)((()=>{const e=t.sharedModel.getSource().length;t.sharedModel.updateSource(e,e,"\n".repeat(e?2:0)+c.code),n()}),[t,c,n]);return(0,r.jsx)(O.V,{title:"Pick a snippet to inject",onClose:n,footerButtons:[{buttonType:"default",content:h.__("Cancel"),onClick:n},{buttonType:"primary",content:h.__("Inject snippet"),onClick:p,autoFocus:!0}],children:(0,r.jsx)(T.Z,{as:"form",children:(0,r.jsxs)(P.Z,{children:[(0,r.jsx)(P.Z.Label,{}),(0,r.jsx)(Z.Z,{block:!0,onChange:u,children:a.map(((e,t)=>(0,r.jsx)(Z.Z.Option,{value:`${t}`,children:e.title})))}),(0,r.jsxs)(P.Z.Caption,{children:[c.description&&(0,r.jsx)(A.Z,{as:"p",children:c.description}),i?(0,r.jsx)(Q.U,{markdownParser:i,sanitizer:o,text:`\`\`\`${s}\n${c.code}\`\`\``}):(0,r.jsx)("code",{children:c.code})]})]})})})}function se(e){const{getInputOptions:t,inputs:n,setInputs:s,getOutputOptions:a,output:i,setOutput:o,translator:l}=e,c=(0,E.useMemo)((()=>(l??v.nullTranslator).load("jupyterlab")),[l]),d=(0,E.useRef)(null),[h,u]=(0,E.useState)(!1),[p,m]=(0,E.useState)(!!t),[g,f]=(0,E.useState)(null),[x,_]=(0,E.useState)(n.map((e=>({id:e,text:e,selected:!0})))),[y,w]=(0,E.useState)("");(0,E.useEffect)((()=>{const e=n.filter((e=>!x.find((t=>t.text===e))));e.length&&_([...x,...e.map((e=>({id:e,text:e,selected:!0})))])}),[n]),(0,E.useEffect)((()=>{const e=x.filter((e=>e.selected)).map((e=>e.text));I.JSONExt.deepEqual(n,e)||s(e)}),[x]),(0,E.useEffect)((()=>{p&&(t?t().then((e=>{const t=x.map((e=>e.text));_([...x,...e.sort().filter((e=>!t.includes(e))).map((e=>({id:e,text:e,selected:!1})))]),m(!1)})):m(!1))}),[x,t]),(0,E.useEffect)((()=>{a&&Promise.all([a(),t?.()]).then((([e,t])=>{f(e.sort().concat((t??[]).sort()).reduce(((e,t)=>(e.includes(t)||e.push(t),e)),[]).map((e=>({id:e,text:e,selected:!1}))))})).catch((e=>{console.error("Failed to get the cell output candidates",e),f([])}))}),[a,t]);const k=(0,E.useCallback)((e=>{const t=x.findIndex((t=>t.id===e));t>=0&&(x.splice(t,1),_([...x]))}),[x]),b=(0,E.useCallback)((e=>{Array.isArray(e)||(e=[e]);const t=e.map((e=>e.id));_([...x.map((e=>t.includes(e.id)?Object.assign(e,{selected:!0}):Object.assign(e,{selected:!1})))])}),[x]),j=(0,E.useCallback)((e=>{const t=x.find((t=>t.id===e.id));t?(t.selected=!0,_([...x])):_([...x,e])}),[x]),S=(0,E.useCallback)((e=>{e.currentTarget&&w(e.currentTarget.value)}),[]),C=(0,E.useCallback)((e=>{e.currentTarget&&o(e.currentTarget.value)}),[]),D=(0,E.useCallback)((e=>{h?d.current&&!e&&(o(d.current.value),u(!1)):e&&u(!0)}),[h]);return(0,r.jsxs)(T.Z,{as:"form",sx:{p:3},children:[(0,r.jsxs)(P.Z,{children:[(0,r.jsx)(P.Z.Label,{id:"cell-input-variables",children:c.__("Inputs")}),(0,r.jsxs)(L.Z,{children:[(0,r.jsx)(L.Z.Input,{as:K.Z,tokens:x.filter((e=>e.selected)),onTokenRemove:k,onChange:S}),(0,r.jsx)(L.Z.Overlay,{children:(0,r.jsx)(L.Z.Menu,{addNewItem:y&&!x.find((e=>e.text===y))?{id:y,text:c.__("Add '%1'",y),handleAddItem:e=>{j({...e,text:y,selected:!0}),w("")}}:void 0,items:x,selectedItemIds:x.filter((e=>e.selected)).map((e=>e.id)),onSelectedChange:b,"aria-labelledby":"cell-input-variables",selectionVariant:"multiple",emptyStateText:c.__("No available variables."),loading:p})})]})]}),(0,r.jsxs)(P.Z,{children:[(0,r.jsx)(P.Z.Label,{id:"cell-output-variables",children:c.__("Output")}),(0,r.jsxs)(L.Z,{children:[(0,r.jsx)(L.Z.Input,{ref:d,value:i,onChange:C}),(0,r.jsx)(L.Z.Overlay,{children:(0,r.jsx)(L.Z.Menu,{items:g??[],selectedItemIds:i?[i]:[],"aria-labelledby":"cell-output-variables",loading:a&&!g,emptyStateText:c.__("Not among the available variables."),onOpenChange:D})})]})]})]})}var re=n(20049);function ae(e){const{model:t}=e,[n,s]=(0,E.useState)(!1),[a,i]=(0,E.useState)(!1),o=(0,E.useCallback)((()=>{s(!1)}),[]);return(0,E.useEffect)((()=>{const e=e=>{const t=e.getMetadata("datalayer")??{};i(!!t.kernel)};return e(t),t.metadataChanged.connect(e),()=>{t.metadataChanged.disconnect(e)}}),[t]),a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(M.h,{style:{color:"var(--jp-brand-color1)"},icon:R.Coy,"aria-label":"Set variables to transfer between kernels",variant:"invisible",size:"small",title:"Set variables to transfer between kernels",onClick:e=>{e.preventDefault(),s(!0)}}),n&&(0,r.jsx)(re.f,{embeddedInJupyter:!0,children:(0,r.jsx)(te,{...e,onClose:o})})]}):null}class ie{commands;constructor(e,t){this.commands=t,this._panel=e,this._panel.content.model?.cells.changed.connect(this.updateConnectedCell,this),this._panel.content.modelChanged.connect((()=>{this._panel.content.model?.cells.changed.connect(this.updateConnectedCell,this)}))}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,D.Signal.clearData(this))}updateConnectedCell(e,t){t.oldValues.forEach((e=>{this._removeAction(e)})),Promise.all(t.newValues.map((e=>this._addAction(e))))}async _addAction(e){const t=this._panel.content.widgets.find((t=>t.model===e));if("code"===t?.model.type){await t.ready;const n=w.ReactWidget.create((0,r.jsx)(ae,{model:t.model,preference:this._panel.sessionContext?{id:this._panel.sessionContext.session?.kernel?.id,language:this._panel.sessionContext.specsManager.specs?.kernelspecs[this._panel.sessionContext.session?.kernel?.name??""]?.language}:void 0,sessionContext:this._panel.sessionContext,translator:this._panel.translator}));n.addClass("dla-cell-action"),this._cellActions.has(e)&&this._cellActions.get(e)?.dispose(),this._cellActions.set(e,t),this._panel.disposed.connect((()=>{this._cellActions.delete(e),n.dispose()})),t.layout.addWidget(n)}}_removeAction(e){this._cellActions.get(e)?.dispose()}_isDisposed=!1;_cellActions=new WeakMap;_panel}class oe{commands;constructor(e){this.commands=e}createNew(e,t){const n=new ie(e,this.commands);return this._extensions.set(e,n),e.disposed.connect((()=>{this._extensions.delete(e)})),n}_extensions=new WeakMap}const le={id:"@datalayer/jupyter-kernels:cell-action",description:"Cell action item",optional:[v.ITranslator],autoStart:!0,activate:(e,t)=>{e.docRegistry.addWidgetExtension("Notebook",new oe(e.commands))}};var ce=n(32850),de=n(63879),he=n(96697);const ue=new WeakMap;class pe{static serviceManager=null;static getForeignCell(e){return ue.get(e)}static run(e,t,n,s){if(!e.model||!e.activeCell)return Promise.resolve(!1);const r=ge.getState(e),a=ge.runSelected(e,t,n,s);return ge.handleRunState(e,r,!1),a}static runCells(e,t,n,s,r){if(!e.model)return Promise.resolve(!1);const a=ge.getState(e),i=ge.runCells(e,t,n,s,r);return ge.handleRunState(e,a,!1),i}static runAll(e,t,n,s){if(!e.model||!e.activeCell)return Promise.resolve(!1);const r=ge.getState(e),a=e.widgets.length,i=ge.runCells(e,e.widgets,t,n,s);return e.activeCellIndex=a,e.deselectAll(),ge.handleRunState(e,r,!0),i}static runAllAbove(e,t,n,s){const{activeCell:r,activeCellIndex:a,model:i}=e;if(!i||!r||a<1)return Promise.resolve(!1);const o=ge.getState(e),l=ge.runCells(e,e.widgets.slice(0,e.activeCellIndex),t,n,s);return e.deselectAll(),ge.handleRunState(e,o,!0),l}static runAllBelow(e,t,n,s){if(!e.model||!e.activeCell)return Promise.resolve(!1);const r=ge.getState(e),a=e.widgets.length,i=ge.runCells(e,e.widgets.slice(e.activeCellIndex),t,n,s);return e.activeCellIndex=a,e.deselectAll(),ge.handleRunState(e,r,!0),i}static async runAndAdvance(e,t,n,s){if(!e.model||!e.activeCell)return Promise.resolve(!1);const r=ge.getState(e),a=ge.runSelected(e,t,n,s),i=e.model;return e.activeCellIndex===e.widgets.length-1?(i.sharedModel.insertCell(e.widgets.length,{cell_type:e.notebookConfig.defaultCell,metadata:"code"===e.notebookConfig.defaultCell?{trusted:!0}:{}}),e.activeCellIndex++,!1===e.activeCell?.inViewport&&await(0,m.signalToPromise)(e.activeCell.inViewportChanged,200).catch((()=>{})),e.mode="edit"):e.activeCellIndex++,ge.handleRunState(e,r,!0),a}static async runAndInsert(e,t,n,s){if(!e.model||!e.activeCell)return Promise.resolve(!1);const r=ge.getState(e),a=ge.runSelected(e,t,n,s);return e.model.sharedModel.insertCell(e.activeCellIndex+1,{cell_type:e.notebookConfig.defaultCell,metadata:"code"===e.notebookConfig.defaultCell?{trusted:!0}:{}}),e.activeCellIndex++,!1===e.activeCell?.inViewport&&await(0,m.signalToPromise)(e.activeCell.inViewportChanged,200).catch((()=>{})),e.mode="edit",ge.handleRunState(e,r,!0),a}}var me,ge;!function(e){e[e.QUEUED=0]="QUEUED",e[e.STARTING_KERNEL=1]="STARTING_KERNEL",e[e.IMPORTING=2]="IMPORTING",e[e.EXECUTING=3]="EXECUTING",e[e.EXPORTING=4]="EXPORTING",e[e.UNKNOWN=5]="UNKNOWN",e[e.DONE=6]="DONE",e[e.ERROR=7]="ERROR"}(me||(me={}));class fe{cell;sessionContext;metadata;constructor({cell:e,sessionContext:t,metadata:n}){this.cell=e,this.sessionContext=t,this.metadata=n}get connection(){return this.sessionContext?.session?.kernel??void 0}cancelExecution(){this.cell.setPrompt("")}scheduleExecution(){this.cell.model.sharedModel.transact((()=>{this.cell.model.clearExecution()}),!1),this.cell.setPrompt("*")}processCell(){return Promise.resolve(!1)}}class xe extends fe{_connection;_reason=null;_isDisposed=!1;_kernelSpec;_processed=null;_state=me.QUEUED;_stateChanged=new D.Signal(this);_variablesIn;_variableOut;constructor(e){super(e);const t=this.cell.model.getMetadata("datalayer")??{};this._kernelSpec=t.kernel,this._variablesIn=Array.isArray(t.in)?t.in:[],this._variableOut="string"==typeof t.out?t.out:""}get connection(){return this._connection}get isDisposed(){return this._isDisposed}get reason(){return this._reason}get state(){return this._state}setState(e,t){this._state===e&&this._reason===t||(this._reason=t??null,this._state=e,this._stateChanged.emit(this._state))}get stateChanged(){return this._stateChanged}cancelExecution(){super.cancelExecution(),this.setState(me.ERROR)}scheduleExecution(){super.scheduleExecution(),this.setState(me.QUEUED)}dispose(){this._isDisposed||(this._isDisposed=!0,this._connection?.dispose(),D.Signal.clearData(this))}async processCell(){let e;await this.setupKernel();try{this._processed=new I.PromiseDelegate,this._processCell().then((e=>{this._processed?.resolve(e)})).catch((e=>{this._processed?.reject(e)})),e=await this._processed.promise}finally{await this.teardownKernel()}return e}async _processCell(){if(!this._connection){const e=`Failed to process a foreign cell '${this.cell.model.id}'.`;throw this.setState(me.ERROR,e),new Error(e)}if(this._variablesIn.length){if(!this.sessionContext){const e="Unable to import variables; no document kernel available.";throw this.setState(me.ERROR,e),new Error(e)}this.setState(me.IMPORTING);const e=this.sessionContext.specsManager.specs.kernelspecs[this.sessionContext.session.kernel.model.name];if(!await _e(e.language,this.sessionContext.session.kernel,this._variablesIn,this._connection)){const e=`Failed to transfer ${this._variablesIn.join(", ")} to ${this._connection.location} - ${this._connection.name} (${this._connection.id})`;throw this.setState(me.ERROR,e),new Error(e)}}this.setState(me.EXECUTING);const e=await de.CodeCell.execute(this.cell,{session:{kernel:this._connection}},this.metadata);if(console.debug(`@datalayer/jupyter-kernels: Capture cell ${this.cell.model.id} execution`,e),this.metadata.deletedCells&&(this.metadata.deletedCells.length=0),!e)return!1;if("ok"===e.content.status){if(this._variableOut){if(!this.sessionContext){const e="Unable to export variables; no document kernel available.";throw this.setState(me.ERROR,e),new Error(e)}this.setState(me.EXPORTING);const e=this.sessionContext.specsManager.specs.kernelspecs[this.sessionContext.session.kernel.model.name];if(!await _e(e.language,this._connection,[this._variableOut],this.sessionContext.session.kernel)){const e=`Failed to transfer ${this._variableOut} from ${this._connection.location} - ${this._connection.name} (${this._connection.id})`;throw this.setState(me.ERROR,e),new Error(e)}}return this.setState(me.DONE),!0}throw this.setState(me.ERROR),new ce.KernelError(e.content)}async setupKernel(){if(!pe.serviceManager){const e="No service manager available";throw this.setState(me.ERROR,e),new Error(e)}this.setState(me.STARTING_KERNEL),this._connection&&(this._connection.id===this._kernelSpec.id&&this._connection.name===this._kernelSpec.name&&(this._connection.location??"local")===kernelDescription.location||this._connection.dispose(),this._connection.isDisposed&&(this._connection?.connectionStatusChanged.disconnect(this.onConnectionChanged,this),this._connection?.statusChanged.disconnect(this.onKernelStatusChanged,this),this._connection=void 0));const e=!1!==this._kernelSpec.params?.persistent;switch(this._connection?.status){case"idle":case"busy":case"autorestarting":case"restarting":case"starting":break;default:{this._connection?.dispose(),this._connection?.connectionStatusChanged.disconnect(this.onConnectionChanged,this),this._connection?.statusChanged.disconnect(this.onKernelStatusChanged,this),this._connection=void 0;const t=q(this._kernelSpec.location)?pe.serviceManager.remote?.servers:pe.serviceManager[this._kernelSpec.location]?.kernels;if(e&&this._kernelSpec.id)try{this._connection=t?.connectTo({model:{id:this._kernelSpec.id,name:this._kernelSpec.name},handleComms:!0})}catch(e){if(!e||"Unable to find the kernel."!==e.message)throw e;console.log(`Persistent kernel ${this._kernelSpec.id} does not exist. Starting a new one...`)}if(!this._connection)try{this._connection=await(t?.startNew({name:this._kernelSpec.name,kernelType:e?"default":"snippet"},{handleComms:!0}))}catch(t){if("MaxKernelsError"===t.name){if(!e){const e=new I.PromiseDelegate,t=window.setTimeout((()=>{e.reject("Timeout")}),3e5),n=S.SE.subscribe((t=>{t.remoteKernels.filter((e=>"snippet"===e.kernel_type)).length<t.configuration.maxTemporaryKernels&&e.resolve()}));try{return this.setState(me.STARTING_KERNEL,"Waiting for a temporary kernel to stopâ€¦"),await e.promise,clearTimeout(t),this.setupKernel()}catch(e){console.log("Waiting for free kernel slot expired.")}finally{n()}}(0,p.showErrorMessage)("Unable to create a new remote kernel",`${t.message} Cell '${this.cell.model.id}' of notebook '${this.sessionContext?.path??"unknown"}' cannot be executed.`)}else 404===t.response?.status&&(0,p.showErrorMessage)("Unable to create a new remote kernel",`Unknown environment '${this._kernelSpec.name}' sets for cell '${this.cell.model.id}' of notebook '${this.sessionContext?.path??"unknown"}'. Please select an existing environment.`);throw this.setState(me.ERROR,"string"==typeof t?t:t.message??"Unable to start a kernel"),t}this._connection&&(this._connection?.connectionStatusChanged.connect(this.onConnectionChanged,this),this._connection?.statusChanged.connect(this.onKernelStatusChanged,this),this._connection.location=this._kernelSpec.location,e&&(this._kernelSpec.id=this._connection.id,this.cell.model.setMetadata("datalayer",Object.assign(this.cell.model.getMetadata("datalayer")??{},{kernel:this._kernelSpec}))))}}if(!this._connection){const e=`Unable to start a kernel for cell ${this.cell.model.id} with ${JSON.stringify(this._kernelSpec)}`;throw this.setState(me.ERROR,e),new Error(e)}}async teardownKernel(){!1===this._kernelSpec.params?.persistent&&(this._connection&&!this._connection.isDisposed&&(q(this._kernelSpec.location)?pe.serviceManager.remote.servers.shutdown(this._connection.id):this._connection.shutdown(),this._connection.dispose()),this._connection?.connectionStatusChanged.disconnect(this.onConnectionChanged,this),this._connection?.statusChanged.disconnect(this.onKernelStatusChanged,this),this._connection=void 0)}onConnectionChanged(){"disconnected"===this._connection?.connectionStatus&&this._processed?.reject("Kernel has been disconnected")}onKernelStatusChanged(){["dead","terminating"].includes(this._connection?.status??"")&&this._processed?.reject(`Kernel status '${this._connection?.status}' is not appropriate`)}}async function _e(e,t,n,s){const r=new U(e),a=await new h.KernelExecutor({connection:t}).execute(r.saveVariables(n)),i=a.get(0)?.data["text/plain"]??"";if(!i)return!1;{const e=await new h.KernelExecutor({connection:s}).execute(r.loadVariables(i)),t=e.get(0)?.data["text/plain"]||"[]",a=JSON.parse(t.slice(1,t.length-1));if(!n.every((e=>a.includes(e))))return!1;console.debug(`@datalayer/jupyter-kernels: Successfully transfer ${n.join(", ")}`)}return!0}!function(e){const t=ce.NotebookActions.executed,n=ce.NotebookActions.executionScheduled,s=ce.NotebookActions.selectionExecuted;async function r(e,r,o,l,c){const d=r[-1];e.mode="command";try{const h=await Promise.all(r.map((s=>async function(e,s,r,o,l){const c=await async function({notebook:e,cell:s,sessionContext:r}){if("code"!==s.model.type)return!1;const o={deletedCells:e.model?.deletedCells??[],recordTiming:e.notebookConfig.recordTiming},l=!!(s.model.getMetadata("datalayer")??{}).kernel,c=new(l?xe:fe)({cell:s,sessionContext:r,metadata:o});if(l){ue.set(s.model,c);const e=()=>{ue.delete(s.model),c.dispose()};s.disposed.connect(e),r?.disposed.connect(e)}return async function(e,s){const r=new I.PromiseDelegate;a.has(e)||a.set(e,[]);const o=a.get(e),l=0===o.length;return n.emit({notebook:e,cell:s.cell}),s.scheduleExecution(),o.push({cell:s,done:r}),l&&i(o).catch((e=>{console.error("Fail to start processing the cell queue",e)})),r.promise.then((()=>{t.emit({notebook:e,cell:s.cell,success:!0})})).catch((()=>{t.emit({notebook:e,cell:s.cell,success:!1})})),r.promise}(e,c)}({notebook:e,cell:s,sessionContext:r});if(c)return!0;const d=(l=l||v.nullTranslator).load("jupyterlab");switch(s.model.type){case"markdown":s.rendered=!0,s.inputHidden=!1,t.emit({notebook:e,cell:s,success:!0});break;case"code":if(r){if(r.isTerminating){await(0,p.showDialog)({title:d.__("Kernel Terminating"),body:d.__("The kernel for %1 appears to be terminating. You can not run any cell for now.",r.session?.path),buttons:[p.Dialog.okButton()]});break}if(r.pendingInput)return await(0,p.showDialog)({title:d.__("Cell not executed due to pending input"),body:d.__("The cell has not been executed to avoid kernel deadlock as there is another pending input! Submit your pending input and try again."),buttons:[p.Dialog.okButton()]}),!1;if(r.hasNoKernel&&await r.startKernel()&&o&&await o.selectKernel(r),r.hasNoKernel)return s.model.sharedModel.transact((()=>{s.model.clearExecution()})),!0;const a=e.model?.deletedCells??[];n.emit({notebook:e,cell:s});let i=!1;try{const t={deletedCells:a,recordTiming:e.notebookConfig.recordTiming};console.debug(`@datalayer/jupyter-kernels: Process normally cell ${s.model.id}`);const n=await de.CodeCell.execute(s,r,t)??void 0;a.splice(0,a.length),i=(()=>{if(s.isDisposed)return!1;if(!n)return!0;if("ok"===n.content.status){const t=n.content;return t.payload&&t.payload.length&&function(e,t,n){const s=e.payload?.filter((e=>"set_next_input"===e.source))[0];if(!s)return;const r=s.text;if(s.replace)return void n.model.sharedModel.setSource(r);const a=t.model.sharedModel,i=t.model.cells,o=(0,he.findIndex)(i,(e=>e===n.model));-1===o?a.insertCell(a.cells.length,{cell_type:"code",source:r,metadata:{trusted:!1}}):a.insertCell(o+1,{cell_type:"code",source:r,metadata:{trusted:!1}})}(t,e,s),!0}throw new ce.KernelError(n.content)})()}catch(n){if(!s.isDisposed&&!n.message.startsWith("Canceled"))throw t.emit({notebook:e,cell:s,success:!1,error:n}),n;i=!1}return i&&t.emit({notebook:e,cell:s,success:!0}),i}s.model.sharedModel.transact((()=>{s.model.clearExecution()}),!1)}return Promise.resolve(!0)}(e,s,o,l,c))));return!e.isDisposed&&(s.emit({notebook:e,lastCell:d}),e.update(),h.every((e=>e)))}catch(t){if(!t.message||!t.message.startsWith("KernelReplyNotOK"))throw t;return r.map((e=>{"code"===e.model.type&&null===e.model.executionCount&&e.setPrompt("")})),s.emit({notebook:e,lastCell:d}),e.update(),!1}}e.getState=function(e){return{wasFocused:e.node.contains(document.activeElement),activeCellId:e.activeCell?.model.id??null}},e.handleRunState=async function(e,t,n=!1){const{activeCell:s,activeCellIndex:r}=e;n&&s&&await e.scrollToItem(r,"smart",0).catch((e=>{})),(t.wasFocused||"edit"===e.mode)&&e.activate()},e.runCells=r,e.runSelected=function(e,t,n,s){e.mode="command";let a=e.activeCellIndex;const i=e.widgets.filter(((t,n)=>{const s=e.isSelectedOrActive(t);return s&&(a=n),s}));return e.activeCellIndex=a,e.deselectAll(),r(e,i,t,n,s)};const a=new WeakMap;async function i(e){const t=e[0];if(!t)return Promise.resolve();const{done:n,cell:s}=t;try{const t=await s.processCell();n.resolve(t),e.shift(),i(e).catch((e=>{console.error("Error processing cell queue")}))}catch(t){for(s.cell.setPrompt(""),n.reject(t),s===e[0]?.cell&&e.shift();e.length;){const{done:t,cell:n}=e.shift()??{};n?.cancelExecution(),t?.reject("Canceled")}}}}(ge||(ge={}));const ye="@datalayer/jupyter-kernels:plugin",ve=new I.Token("@datalayer/jupyter-kernels:multi-service-manager"),we=new I.Token("@datalayer/jupyter-kernels:browser-router"),ke=new I.Token("@datalayer/jupyter-kernels:plugin");var be=n(67095),je=n(85128);function Se(e){const{model:t}=e,[n,s]=(0,E.useState)(""),[a,i]=(0,E.useState)(""),[o,l]=(0,E.useState)(null),[c,d]=(0,E.useState)(""),[h,u]=(0,E.useState)(""),[p,m]=(0,E.useState)(""),[g,f]=(0,E.useState)(pe.getForeignCell(t)??null),[x,_]=(0,E.useState)(me.UNKNOWN),[y,v]=(0,E.useState)("");(0,E.useEffect)((()=>{const e=()=>{const n=t.getMetadata("datalayer")?.kernel;let r="",a="";if(n){let e=C.LaptopSimpleIcon;switch(r=n.displayName??"Unknown kernel",a=`${r} running `,n.location){case"local":a+="locally.";break;case"browser":e=C.BrowserIcon,a+="in your browser.";break;default:!1===n.params?.persistent?(e=C.TreeDeciduousIcon,a+="remotely."):(e=C.CircleWhiteIcon,a+="in a persistent remote kernel.")}l(e?(0,E.createElement)(e,{title:n.location}):null),s(r),i(a)}else l(null),s(""),i("");const o=t.getMetadata("execution");if(!o||!I.JSONExt.isObject(o))return c&&d(""),h&&u(""),void(p&&m(""));const g=o["iopub.status.busy"],f=g?new Date(g):null,x=o["shell.execute_reply.started"]||o["iopub.execute_input"],_=x?new Date(x):null,y=o.execution_failed,v=o["shell.execute_reply"]??y,w=v?new Date(v):null,k=v&&!o["iopub.execute_input"],b=setInterval((()=>{if(c.startsWith("Execution started at")){if(t.getMetadata("execution").execution_failed)return clearInterval(b),void e();if(_){const e=Re(new Date,_);u(`${e} ${p?`(${p})`:""}`)}}else clearInterval(b)}),100);let j="";if(k)j="";else if(w&&_){const e=Re(w,_);m(e),j=y?"Failed":"Last executed",j&&(j+=` at ${De(w,"yyy-MM-dd HH:mm:ss")}`),j+=` in ${e}`}else _?j=`Execution started at ${De(_,"yyy-MM-dd HH:mm:ss")}`:f&&(p&&u(`N/A (${p})`),j=`Execution queued at ${De(f,"yyy-MM-dd HH:mm:ss")}`);c!==j&&d(j)},n=(e,{notebook:n,cell:s})=>{if(s.model===t){const e=pe.getForeignCell(t)??null;_(e?.state??me.QUEUED),v(e?.state?"":"Queued"),f(e)}},r=(e,{cell:n,success:s,error:r})=>{g||n.model!==t||(_(s?me.DONE:me.ERROR),v(""))};return e(),t.metadataChanged.connect(e),"code"===t.type&&(ce.NotebookActions.executionScheduled.connect(n),ce.NotebookActions.executed.connect(r)),()=>{t.metadataChanged.disconnect(e),"code"===t.type&&(ce.NotebookActions.executionScheduled.disconnect(n),ce.NotebookActions.executed.disconnect(r))}}),[t,g]),(0,E.useEffect)((()=>{const e=(e,t)=>{switch(_(t),t){case me.QUEUED:v("Queued");break;case me.ERROR:v(e.reason??"");break;case me.EXECUTING:v("Runningâ€¦");break;case me.EXPORTING:v("Exporting dataâ€¦");break;case me.IMPORTING:v("Importing dataâ€¦");break;case me.STARTING_KERNEL:v(e.reason??"Starting the kernelâ€¦");break;default:v("")}};return g?.stateChanged.connect(e),()=>{g?.stateChanged.disconnect(e)}}),[g]);const w=!!o;let k=!1,b=100,j=w?"var(--jp-brand-color1)":"var(--jp-brand-color3)",S="var(--jp-brand-color1)",D="";switch(x){case me.QUEUED:D="ðŸ’¤ï¸Ž",b=0;break;case me.UNKNOWN:b=0;break;case me.DONE:D="âœ”ï¸Ž",j=w?"var(--jp-success-color1)":"var(--jp-success-color3)",S="var(--jp-success-color1)";break;case me.ERROR:D="âŒï¸Ž",j=w?"var(--jp-error-color1)":"var(--jp-error-color3)",S="var(--jp-error-color1)";break;case me.EXECUTING:D="âš¡ï¸Ž",k=!0,b=40;break;case me.EXPORTING:D="ðŸ“¤ï¸Ž",k=!0,b=90;break;case me.IMPORTING:D="ðŸ“¥ï¸Ž",k=!0,b=30;break;case me.STARTING_KERNEL:D="ðŸ”¥ï¸Ž",k=!0,b=20}const R=["dla-cell-footer"];return w&&R.push("jp-mod-foreign"),(0,r.jsxs)("div",{className:R.join(" "),children:[(0,r.jsx)("div",{style:{minHeight:"3px"},children:x!==me.UNKNOWN&&(0,r.jsx)(be.k,{sx:{maxHeight:"3px"},progress:b,bg:j,animated:k,barSize:"small"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{style:{color:S},title:y||void 0,children:`${D} ${y}`.trimEnd()}),(0,r.jsx)("span",{children:t.getMetadata("execution")&&(0,r.jsx)(r.Fragment,{children:c})}),(0,r.jsxs)("span",{className:"dla-cell-footer-kernel",title:a,children:[o,n]})]})]})}class Ce{constructor(e){this._panel=e,this._panel.content.model?.cells.changed.connect(this.updateConnectedCell,this),this._panel.content.modelChanged.connect((()=>{this._panel.content.model?.cells.changed.connect(this.updateConnectedCell,this)}))}get settings(){return this._settings}set settings(e){I.JSONExt.deepEqual(this._settings,e)||(this._settings=e,this.updateConnectedCell(this._panel.context.model.cells,{type:"set",newIndex:0,newValues:Array.from(this._panel.context.model.cells),oldIndex:0,oldValues:Array.from(this._panel.context.model.cells)}))}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,D.Signal.clearData(this))}updateConnectedCell(e,t){t.oldValues.forEach((e=>{this._removeFooter(e)})),Promise.all(t.newValues.map((e=>this._addFooter(e))))}async _addFooter(e){if("code"===e.type){const t=this._panel.content.widgets.find((t=>t.model===e));if(t){await t.ready;const n=w.ReactWidget.create((0,r.jsx)(re.f,{theme:h.jupyterTheme,embeddedInJupyter:!0,children:(0,r.jsx)(Se,{model:e})}));this._cellFooters.has(e)&&this._cellFooters.get(e)?.dispose(),this._cellFooters.set(e,t);const s=()=>{this._cellFooters.delete(e),n.dispose()};t.disposed.connect(s),this._panel.disposed.disconnect(s),k.Widget.attach(n,t.inputArea.editorWidget.node)}}}_removeFooter(e){this._cellFooters.get(e)?.dispose()}_isDisposed=!1;_cellFooters=new WeakMap;_panel;_settings={dateFormat:"yyy-MM-dd HH:mm:ss",showDate:!0,showLiveExecutionTime:!0}}const De=(e,t="yyy-MM-dd HH:mm:ss")=>(0,je.format)(e,t),Re=(e,t)=>{const n=36e5,s=864e5;let r=(0,je.differenceInMilliseconds)(e,t);if(r<1e3)return`${r}ms`;const a=Math.floor(r/s);r%=s;const i=Math.floor(r/n);r%=n;const o=Math.floor(r/6e4);r%=6e4;let l="";return a&&(l+=`${a}d `),(a||i)&&(l+=`${i}h `),(a||i||o)&&(l+=`${o}m `),a||(l+=`${(r/1e3).toFixed(i?0:2)}s`),l.trim()};class Me{constructor(e,t){this._tracker=e,t.load("@datalayer/jupyter-kernels:plugin").then((e=>{this._updateSettings(e),e.changed.connect(this._updateSettings.bind(this)),t.load("@jupyterlab/notebook-extension:tracker").then((e=>e.set("recordTiming",!0)),(e=>{console.error("@datalayer/jupyter-kernels: Could not force metadata recording.",e)}))})).catch((e=>{console.error("@datalayer/jupyter-kernels: Could not load settings",e)}))}createNew(e,t){const n=new Ce(e);return this._extensions.set(e,n),e.disposed.connect((()=>{this._extensions.delete(e)})),n}_updateSettings(e){const t={showLiveExecutionTime:e.get("showLiveExecutionTime").composite,showDate:e.get("showDate").composite},n=e.get("dateFormat").composite,s=(e=>{const t=new Date;try{return(0,je.format)(t,e),{isValid:!0}}catch(e){return{isValid:!1,message:e.message}}})(n);s.isValid?t.dateFormat=n:(t.dateFormat="yyy-MM-dd HH:mm:ss",(0,p.showErrorMessage)("Invalid date format in Execute Time extension setting",s.message??"")),this._settings={...this._settings,...t},this._tracker.forEach((e=>{const t=this._extensions.get(e);t&&(t.settings={...this._settings})}))}_tracker;_extensions=new WeakMap;_settings={showLiveExecutionTime:!0,showDate:!0,dateFormat:"yyy-MM-dd HH:mm:ss"}}const Ee={id:"@datalayer/jupyter-kernels:cell-executor",description:"Handle kernel per cells.",requires:[ve,ce.INotebookTracker],optional:[p.IToolbarWidgetRegistry,v.ITranslator,x.IMarkdownParser,p.ISanitizer],autoStart:!0,activate:(e,t,n,s,a,i,o)=>{pe.serviceManager=t,ce.NotebookActions.run=pe.run,ce.NotebookActions.runAll=pe.runAll,ce.NotebookActions.runAllAbove=pe.runAllAbove,ce.NotebookActions.runAllBelow=pe.runAllBelow,ce.NotebookActions.runAndAdvance=pe.runAndAdvance,ce.NotebookActions.runAndInsert=pe.runAndInsert,ce.NotebookActions.runCells=pe.runCells,s?.addFactory("Cell","dla-kernel-picker",(e=>{const s=n.find((t=>!(!t.model||!Array.from(t.model.cells).find((t=>t===e.model)))));return"code"!==e.model.type?new k.Widget:w.ReactWidget.create((0,r.jsx)(re.f,{embeddedInJupyter:!0,children:(0,r.jsx)(ee,{markdownParser:i??void 0,sanitizer:o??void 0,model:e.model,preference:s?.sessionContext?{id:s.sessionContext.session?.kernel?.id,language:s.sessionContext.specsManager.specs?.kernelspecs[s.sessionContext.session?.kernel?.name??""]?.language,location:s.sessionContext.location}:void 0,serviceManager:t,sessionContext:s?.sessionContext,translator:a??void 0})}))}))}},Ie={id:"@datalayer/jupyter-kernels:cell-footer",description:"Cell footer with Datalayer kernel information",requires:[ce.INotebookTracker,y.ISettingRegistry],optional:[v.ITranslator],autoStart:!0,activate:(e,t,n,s)=>{e.docRegistry.addWidgetExtension("Notebook",new Me(t,n))}};var Ne=n(53004),Te=n(87717),Pe=n(53857),Ze=n(89620),Ae=n(43250);function Le({checkbox:e,footerButtons:t,setChecked:n}){const[s,a]=(0,E.useState)(),{containerRef:i}=(0,Ze.v)({bindKeys:Pe.Qw.ArrowHorizontal|Pe.Qw.Tab,focusInStrategy:"closest"});return(0,r.jsxs)(O.V.Footer,{className:"dla-dialog-footer",ref:i,children:[e&&(0,r.jsxs)(P.Z,{layout:"horizontal",children:[(0,r.jsx)(Ae.Z,{className:e.className??"",checked:s,defaultChecked:e.checked,onChange:e=>{a(e.target.checked),n(e.target.checked)},title:e.caption??""}),(0,r.jsx)(P.Z.Label,{children:e.label??""})]}),(0,r.jsx)("div",{className:"dla-dialog-footer-spacer"}),t&&(0,r.jsx)(O.V.Buttons,{buttons:t})]})}class Ke extends w.ReactWidget{body;checkbox;buttons;host;dialogTitle;_closing=new I.PromiseDelegate;_result={button:null,isChecked:null,value:null};constructor(e={}){super(),this.host=e.host??document.body,this.body=e.body??(()=>null),this.checkbox=e.checkbox??null,this.buttons=e.buttons??[p.Dialog.cancelButton(),p.Dialog.okButton()],this.dialogTitle=e.title}close=()=>{k.Widget.detach(this),this._closing.resolve()};async launch(){return k.Widget.attach(this,this.host),await this._closing.promise,this._result}render(){return(0,r.jsx)(re.f,{embeddedInJupyter:!0,children:(0,r.jsx)(O.V,{sx:{fontFamily:"var(--fontStack-system)",fontSize:"var(--text-body-size-medium)",lineHeight:"var(--text-body-lineHeight-medium)",color:"var(--fgColor-default)"},onClose:this.close,footerButtons:this.buttons.map(((e,t)=>({buttonType:"default"===e.displayType?e.accept?"primary":"default":"danger",onClick:()=>{this.handleButton(t)},content:e.label,"aria-label":e.ariaLabel,autoFocus:e.accept}))),renderBody:this._renderBody,renderFooter:this._renderFooter,title:this.dialogTitle})})}handleButton=e=>{this.setButton(this.buttons[e]),this.close()};setButton=e=>{this._result.button=e};setChecked=e=>{this._result.isChecked=e};setValue=e=>{e instanceof Error?this._closing.reject(e):this._result.value=e};_renderBody=e=>(0,r.jsx)(O.V.Body,{children:(0,E.createElement)(this.body,{...e,setValue:this.setValue})});_renderFooter=e=>(0,r.jsx)(Le,{...e,checkbox:this.checkbox,setChecked:this.setChecked})}var Oe,Fe,$e=n(18310),Ve=n(52746),We=n(16419),ze=n(14675);function Ue(e){const{className:t,translator:n,selectedVariables:s,setSelectVariable:a,transferVariables:i,setTransferVariable:o,kernelVariables:l}=e,c=(0,E.useMemo)((()=>(n??v.nullTranslator).load("jupyterlab")),[n]),d=Object.keys(l??{}).length,h=[{header:c.__("Name"),field:"name",rowHeader:!0},{header:c.__("Type"),field:"type"},{id:"select",maxWidth:"70px",header:()=>(0,r.jsx)(M.h,{"aria-label":s.length===d?c.__("Deselect all"):c.__("Select all"),title:s.length===d?c.__("Deselect all"):c.__("Select all"),icon:s.length===d?w.checkIcon.react:()=>(0,r.jsx)("span",{}),variant:"default",size:"small",onClick:e=>{e.preventDefault(),s.length===d?a([]):a(Object.keys(l??{}))}}),renderCell:e=>{const t=s.includes(e.name);return(0,r.jsx)(M.h,{"aria-label":t?c.__("Deselect: %1",e.name):c.__("Select: %1",e.name),title:t?c.__("Deselect: %1",e.name):c.__("Select: %1",e.name),icon:t?w.checkIcon.react:()=>(0,r.jsx)("span",{}),variant:"default",size:"small",onClick:t=>{t.preventDefault();const n=s.findIndex((t=>t===e.name));if(n>=0){const e=[...s];e.splice(n,1),a(e)}else a([...s,e.name])}})}}];return(0,r.jsxs)(T.Z,{className:t,sx:{paddingTop:"10px"},children:[(0,r.jsx)(A.Z,{id:"kernel-toggle-variables",fontWeight:"bold",children:c.__("Transfer variables")}),(0,r.jsx)($e.Z,{checked:i,onClick:()=>{o(!i)},"aria-labelledby":"kernel-toggle-variables"}),i&&(0,r.jsxs)(Ve.i.Container,{sx:{flex:"1 1 auto"},children:[(0,r.jsx)(Ve.i.Title,{as:"h2",id:"dla-kernel-variables",children:c.__("Kernel variables")}),(0,r.jsx)(Ve.i.Subtitle,{as:"p",id:"dla-kernel-variables-subtitle",children:c.__("The list of transferable kernel variables.")}),l?Object.keys(l??{}).length?(0,r.jsx)(We.w,{"aria-labelledby":"dla-kernel-variables","aria-describedby":"dla-kernel-variables-subtitle",data:Object.entries(l??{}).map((([e,t],n)=>({id:n,name:e,type:t}))).sort(((e,t)=>e.name>t.name?1:-1)),columns:h,cellPadding:"condensed"}):(0,r.jsx)(T.Z,{sx:{gridArea:"table"},children:(0,r.jsx)(ze.Z,{border:!0,children:(0,r.jsx)(ze.Z.Heading,{children:c.__("No eligible variables.")})})}):(0,r.jsx)(Ve.i.Skeleton,{"aria-labelledby":"dla-kernel-variables","aria-describedby":"dla-kernel-variables-subtitle",columns:h,rows:5})]})]})}function Be(e){const[t,n]=(0,E.useState)(null),[s,a]=(0,E.useState)(!1),[i,o]=(0,E.useState)(!1),[l,c]=(0,E.useState)(!1),[d,u]=(0,E.useState)(!1),[p,m]=(0,E.useState)(),[g,f]=(0,E.useState)([]),{multiServiceManager:x,sessionContext:_,setValue:y,translator:v}=e;(0,E.useEffect)((()=>{const e=_.specsManager.specs?.kernelspecs;if(_.session?.kernel?.name&&e){const t=Object.values(e).find((e=>e?.name===_.session.kernel.name));t&&(n({name:t.name,id:_.session.kernel.id,location:_.location,language:t.language,displayName:_.kernelDisplayName}),a(U.supports(t.language)))}}),[_]);const w=(0,E.useCallback)((async()=>{if(d)return Promise.resolve();u(!0);const e=_.session.kernel,t=_.specsManager.specs.kernelspecs[e.model.name],n=new U(t.language),s=(await new h.KernelExecutor({connection:e}).execute(n.listVariables())).get(0).data["text/plain"];if(s)if(m(JSON.parse(s.slice(1,s.length-1))),g.length){const e=Object.keys(p??{});f(g.filter((t=>e.includes(t))))}else f(Object.keys(p??{}));else m({})}),[d,p,g]),k=(0,E.useCallback)((e=>{I.JSONExt.deepEqual(g,e)||f(e)}),[g]),b=(0,E.useCallback)((e=>{l!==e&&(e&&w().catch((e=>{console.error("Failed to list the kernel variable",e),u(!1)})),c(e))}),[l]),j=(0,E.useCallback)((e=>{null!==e?t?.displayName===e.displayName&&t?.id===e.id||(n({...e}),o(U.supports(e.language))):null!==t&&(n(null),o(!1))}),[t]);(0,E.useEffect)((()=>{y({kernel:t?{name:["browser","remote"].includes(t.location)?`${t.location}-${t.name}`:t.name,id:t.id}:null,selectedVariables:g})}),[t,g]);const{kernelPreference:{canStart:S}}=_;return(0,r.jsxs)(T.Z,{className:"dla-kernel-picker",children:[(0,r.jsx)(G,{disabled:!1===S,preference:{id:_.session?.id,kernelDisplayName:_.kernelPreference.shouldStart?_.kernelDisplayName:void 0},serviceManager:x,translator:v,selection:t,setSelection:j}),s&&i&&(0,r.jsx)(Ue,{translator:v,selectedVariables:g,setSelectVariable:k,transferVariables:l,setTransferVariable:b,kernelVariables:p})]})}function He(e){const{specs:t,preference:n}=e,{name:s,language:r,canStart:a,autoStartDefault:i}=n;if(!t||!1===a)return null;const o=i?t.default:null;if(!s&&!r)return o;for(const e in t.kernelspecs)if(e===s)return s;if(!r)return o;const l=[];for(const e in t.kernelspecs){const n=t.kernelspecs[e]?.language;r===n&&l.push(e)}if(1===l.length){const e=l[0];return console.warn("No exact match found for "+e+", using kernel "+e+" that matches language="+r),e}return o}class Je{constructor(e,t){this.translator=e.translator||v.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._path=e.path??I.UUID.uuid4(),this._type=e.type??"",this._name=e.name??"",this._setBusy=e.setBusy,this._kernelPreference=e.kernelPreference??{},this._serviceManager=t}get session(){return this._session??null}get path(){return this._path}get type(){return this._type}get name(){return this._name}get location(){return this._location}get kernelChanged(){return this._kernelChanged}get sessionChanged(){return this._sessionChanged}get statusChanged(){return this._statusChanged}get pendingInput(){return this._pendingInput}get connectionStatusChanged(){return this._connectionStatusChanged}get iopubMessage(){return this._iopubMessage}get unhandledMessage(){return this._unhandledMessage}get propertyChanged(){return this._propertyChanged}get kernelPreference(){return this._kernelPreference}set kernelPreference(e){if(!I.JSONExt.deepEqual(e,this._kernelPreference)){const t=this._kernelPreference;this._kernelPreference=e,this._preferenceChanged.emit({name:"kernelPreference",oldValue:t,newValue:I.JSONExt.deepCopy(e)})}}get kernelPreferenceChanged(){return this._preferenceChanged}get isReady(){return this._isReady}get ready(){return this._ready.promise}get isTerminating(){return this._isTerminating}get isRestarting(){return this._isRestarting}get kernelManager(){switch(this._location){case"browser":return this._serviceManager.browser.kernels;case"local":return this._serviceManager.local.kernels;default:return this._serviceManager.remote.servers.getServices(this._location).kernels}}get serviceManager(){return this._serviceManager}get sessionManager(){switch(this._location){case"browser":return this._serviceManager.browser.sessions;case"local":return this._serviceManager.local.sessions;default:return this._serviceManager.remote.servers.getServices(this._location).sessions}}get specsManager(){switch(this._location){case"browser":return this._serviceManager.browser.kernelspecs;case"local":return this._serviceManager.local.kernelspecs;default:return this._serviceManager.remote.servers.getServices(this._location).kernelspecs}}get hasNoKernel(){return this.kernelDisplayName===this.noKernelName}get kernelDisplayName(){const e=this.session?.kernel;if(this._pendingKernelName===this.noKernelName)return this.noKernelName;let t="";if(t=q(this.location)?"â˜ï¸Ž ":"browser"===this.location?"ðŸŒï¸Ž ":"ðŸ’»ï¸Ž ",e){if(q(this.location)){const n=this.serviceManager.remote.servers.get().find((t=>t.id===e.id));return t+n?.kernel_given_name??n?.environment_display_name??e.name}return t+(this.specsManager.specs?.kernelspecs[e.name]?.display_name??e.name)}return this._pendingKernelName?t+(this.specsManager.specs?.kernelspecs[this._pendingKernelName]?.display_name??this._pendingKernelName):this.noKernelName}get kernelDisplayStatus(){const e=this.session?.kernel;return this._isTerminating?"terminating":this._isRestarting?"restarting":this._pendingKernelName===this.noKernelName?"unknown":!e&&this._pendingKernelName?"initializing":e||this.isReady||!1===this.kernelPreference.canStart||!1===this.kernelPreference.shouldStart?("connected"===e?.connectionStatus?e?.status:e?.connectionStatus)??"unknown":"initializing"}get prevKernelName(){return this._prevKernelName}get isDisposed(){return this._isDisposed}get disposed(){return this._disposed}get noKernelName(){return this._trans.__("No Kernel")}dispose(){this._isDisposed||(this._isDisposed=!0,this._disposed.emit(),this._session&&(this.kernelPreference.shutdownOnDispose&&this.sessionManager.shutdown(this._session.id).catch((e=>{console.error(`Kernel not shut down ${e}`)})),this._session.dispose(),this._session=null),this._dialog&&this._dialog.dispose(),this._busyDisposable&&(this._busyDisposable.dispose(),this._busyDisposable=null),D.Signal.clearData(this))}async startKernel(){const e=this.kernelPreference;if(!e.autoStartDefault&&!1===e.shouldStart)return!0;let t;if(e.id)t={id:e.id};else{const n=He({specs:this.specsManager.specs,sessions:this.sessionManager.running(),preference:e});n&&(t={name:n})}if(t)try{return await this._changeKernel(t),!1}catch(e){}return!0}async restartKernel(){const e=this.session?.kernel||null;if(!this._isRestarting){this._isRestarting=!0,this._isReady=!1,this._statusChanged.emit("restarting");try{await(this.session?.kernel?.restart()),this._isReady=!0}catch(e){console.error(e)}this._isRestarting=!1,this._statusChanged.emit(this.session?.kernel?.status||"unknown"),this._kernelChanged.emit({name:"kernel",oldValue:e,newValue:this.session?.kernel||null})}}async changeKernel(e={}){if(this.isDisposed)throw new Error("Disposed");return await this._initStarted.promise,this._changeKernel(e)}async shutdown(){if(!this.isDisposed&&this._initializing)return await this._initStarted.promise,this._pendingSessionRequest="",this._pendingKernelName=this.noKernelName,this._shutdownSession()}async initialize(){if(this._initializing)return this._initPromise.promise;this._initializing=!0;const e=await this._initialize();return e||(this._isReady=!0,this._ready.resolve(void 0)),this._pendingSessionRequest||this._initStarted.resolve(void 0),this._initPromise.resolve(e),e}async _initialize(){const e=this.sessionManager;await e.ready,await e.refreshRunning();const t=(0,he.find)(e.running(),(e=>e.path===this._path));if(t)try{const n=e.connectTo({model:t});this._handleNewSession(n)}catch(e){return this._handleSessionError(e),Promise.reject(e)}return await this._startIfNecessary()}async _shutdownSession(){const e=this._session,t=this._isTerminating,n=this._isReady;this._isTerminating=!0,this._isReady=!1,this._statusChanged.emit("terminating");try{await(e?.shutdown()),this._isTerminating=!1,e?.dispose(),this._session=null;const t=e?.kernel||null;this._statusChanged.emit("unknown"),this._kernelChanged.emit({name:"kernel",oldValue:t,newValue:null}),this._sessionChanged.emit({name:"session",oldValue:e,newValue:null})}catch(s){this._isTerminating=t,this._isReady=n;const r=e?.kernel?.status;throw void 0===r?this._statusChanged.emit("unknown"):this._statusChanged.emit(r),s}}async _startIfNecessary(){const e=this.kernelPreference;return!this.isDisposed&&!this.session?.kernel&&!1!==e.shouldStart&&!1!==e.canStart&&this.startKernel()}async _changeKernel(e={}){let t;if(e.id){if(await this.serviceManager.local.kernels.refreshRunning(),(0,he.find)(this.serviceManager.local.kernels.running(),(t=>t.id===e.id))&&(t="local"),!t&&this.serviceManager.remote){await this.serviceManager.remote.servers.refresh();const n=this.serviceManager.remote.servers.get().find((t=>t.id===e.id));n&&(t=n.jupyter_pod_name)}!t&&this.serviceManager.browser&&(await this.serviceManager.browser.kernels.refreshRunning(),(0,he.find)(this.serviceManager.browser.kernels.running(),(t=>t.id===e.id))&&(t="browser"))}if(!t)switch(e.name?.split("-",1)[0]){case"browser":t="browser";break;case"remote":t="remote";break;default:t="local"}const n=this._location===t;if(!n&&q(this._location)&&(console.debug("Shutting down the current remote session as the kernel location is changing."),await this._shutdownSession()),this._location=t,e.name&&("local"!==this._location&&(e.name=e.name.replace(/^(remote-|browser-)/,"")),this._pendingKernelName=e.name),this._session||this._kernelChanged.emit({name:"kernel",oldValue:null,newValue:null}),this._pendingSessionRequest||this._initStarted.resolve(void 0),n&&this._session&&!this._isTerminating)try{return console.log("--- Reusing session and changing the kernel with a model",this._session,e),await this._session.changeKernel(e),this._session.kernel}catch(e){throw this._handleSessionError(e),e}const s=m.PathExt.dirname(this._path),r=this._pendingSessionRequest=m.PathExt.join(s,I.UUID.uuid4());try{if(this._statusChanged.emit("starting"),"remote"===this._location){const t=await(this.serviceManager.remote?.servers.startNew({name:e.name},{handleComms:!0}));if(t){e.id=t.model.id;const n=await(this.serviceManager.remote?.servers.findById(t.model.id));n&&(this._location=n.jupyter_pod_name),t.dispose()}}const t=await this.sessionManager.startNew({path:r,type:this._type,name:this._name,kernel:e});return this._pendingSessionRequest!==t.path?(await t.shutdown(),t.dispose(),null):(await t.setPath(this._path),await t.setName(this._name),this._session&&!this._isTerminating&&await this._shutdownSession(),this._handleNewSession(t))}catch(e){throw"MaxKernelsError"===e.name?(0,p.showErrorMessage)("Unable to create a new remote kernel","You have reached your persistent remote kernels limit. Stop some kernels to start new ones."):this._handleSessionError(e),e}}_handleNewSession(e){if(this.isDisposed)throw Error("Disposed");return this._isReady||(this._isReady=!0,this._ready.resolve(void 0)),this._session&&this._session.dispose(),this._session=e,this._pendingKernelName="",e&&(this._prevKernelName=e.kernel?.name??"",e.disposed.connect(this._onSessionDisposed,this),e.propertyChanged.connect(this._onPropertyChanged,this),e.kernelChanged.connect(this._onKernelChanged,this),e.statusChanged.connect(this._onStatusChanged,this),e.connectionStatusChanged.connect(this._onConnectionStatusChanged,this),e.pendingInput.connect(this._onPendingInput,this),e.iopubMessage.connect(this._onIopubMessage,this),e.unhandledMessage.connect(this._onUnhandledMessage,this),e.path!==this._path&&this._onPropertyChanged(e,"path"),e.name!==this._name&&this._onPropertyChanged(e,"name"),e.type!==this._type&&this._onPropertyChanged(e,"type")),this._sessionChanged.emit({name:"session",oldValue:null,newValue:e}),this._kernelChanged.emit({oldValue:null,newValue:e?.kernel||null,name:"kernel"}),this._statusChanged.emit(e?.kernel?.status||"unknown"),e?.kernel||null}async _handleSessionError(e){this._handleNewSession(null);let t="",n="";try{t=e.traceback,n=e.message}catch(e){}await this._displayKernelError(n,t)}async _displayKernelError(e,t){const n=(0,r.jsxs)("div",{children:[e&&(0,r.jsx)("pre",{children:e}),t&&(0,r.jsx)("details",{className:"jp-mod-wide",children:(0,r.jsx)("pre",{children:t})})]}),s=this._dialog=new p.Dialog({title:this._trans.__("Error Starting Kernel"),body:n,buttons:[p.Dialog.okButton()]});await s.launch(),this._dialog=null}_onSessionDisposed(){if(this._session){const e=this._session;this._session=null;const t=this._session;this._sessionChanged.emit({name:"session",oldValue:e,newValue:t})}}_onPropertyChanged(e,t){switch(t){case"path":this._path=e.path;break;case"name":this._name=e.name;break;case"type":this._type=e.type;break;default:throw new Error(`unrecognized property ${t}`)}this._propertyChanged.emit(t)}_onKernelChanged(e,t){this._kernelChanged.emit(t)}_onStatusChanged(e,t){if("dead"===t){const t=e.kernel?.model;if(t?.reason){const e=t.traceback||"";this._displayKernelError(t.reason,e)}}this._setBusy&&("busy"===t?this._busyDisposable||(this._busyDisposable=this._setBusy()):this._busyDisposable&&(this._busyDisposable.dispose(),this._busyDisposable=null)),this._statusChanged.emit(t)}_onConnectionStatusChanged(e,t){this._connectionStatusChanged.emit(t)}_onPendingInput(e,t){this._pendingInput=t}_onIopubMessage(e,t){"shutdown_reply"===t.header.msg_type&&this.session.kernel.removeInputGuard(),this._iopubMessage.emit(t)}_onUnhandledMessage(e,t){this._unhandledMessage.emit(t)}_path="";_name="";_type="";_prevKernelName="";_kernelPreference;_isDisposed=!1;_location="local";_disposed=new D.Signal(this);_session=null;_ready=new I.PromiseDelegate;_initializing=!1;_initStarted=new I.PromiseDelegate;_initPromise=new I.PromiseDelegate;_isReady=!1;_isTerminating=!1;_isRestarting=!1;_kernelChanged=new D.Signal(this);_preferenceChanged=new D.Signal(this);_sessionChanged=new D.Signal(this);_statusChanged=new D.Signal(this);_connectionStatusChanged=new D.Signal(this);translator;_trans;_pendingInput=!1;_iopubMessage=new D.Signal(this);_unhandledMessage=new D.Signal(this);_propertyChanged=new D.Signal(this);_dialog=null;_setBusy;_busyDisposable=null;_serviceManager;_pendingKernelName="";_pendingSessionRequest=""}!function(e){e.getDefaultKernel=function(e){const{preference:t}=e,{shouldStart:n}=t;return!1===n?null:He(e)}}(Je||(Je={}));class qe{constructor(e={},t){this._translator=e.translator??v.nullTranslator,this._multiServiceManager=t}async selectKernel(e){if(e.isDisposed)return Promise.resolve();const t=this._translator.load("jupyterlab");let n=t.__("Cancel");e.hasNoKernel&&(n=e.kernelDisplayName);const s=e.kernelPreference.autoStartDefault,a="boolean"==typeof s,i=new Ke({title:t.__("Assign a Kernel for %1",e.name),body:t=>(0,r.jsx)(Be,{sessionContext:e,multiServiceManager:this._multiServiceManager,setValue:t.setValue,translator:this._translator}),buttons:[p.Dialog.cancelButton({label:n}),p.Dialog.okButton({label:t.__("Assign"),ariaLabel:t.__("Assign Kernel")})],checkbox:a?{label:t.__("Always start the preferred kernel"),caption:t.__("Remember my choice and always start the preferred kernel"),checked:s}:null}),o=await i.launch();if(e.isDisposed||!o.button.accept)return;a&&null!==o.isChecked&&(e.kernelPreference={...e.kernelPreference,autoStartDefault:o.isChecked});const{kernel:l,selectedVariables:c}=await(o.value??Promise.resolve({kernel:null,selectedVariables:[]}));if(null!==l||e.hasNoKernel||(await e.shutdown(),p.Notification.success("Kernel stopped.")),l){let n,s="";if(c.length){n=p.Notification.emit("Saving the variablesâ€¦","in-progress",{autoClose:!1});try{s=await async function(e,t){if(t.length){const n=e.session.kernel,s=e.specsManager.specs.kernelspecs[n.model.name],r=new U(s.language);return(await new h.KernelExecutor({connection:n}).execute(r.saveVariables(t))).get(0).data["text/plain"]}return""}(e,c)}catch(e){return n&&p.Notification.update({id:n,message:"Failed to save the variables",type:"error",autoClose:!1}),void console.error(e)}}n&&p.Notification.update({id:n,message:"Starting the new kernelâ€¦"});const r=await e.changeKernel(l);if(r){let a;try{const t=e.specsManager.specs.kernelspecs[r.model.name];a=new U(t.language)}catch(e){return console.warn("Kernel snippets not supported.",e),void(n&&p.Notification.update({id:n,message:"Kernel is ready",type:"success",autoClose:3e3}))}"remote"===e.location&&await new h.KernelExecutor({connection:r}).execute(a.changeCurrentWorkingDirectory("content/local"));try{const r=[];if(s){n&&p.Notification.update({id:n,message:"Importing the variablesâ€¦"});const t=(await new h.KernelExecutor({connection:e.session.kernel}).execute(a.loadVariables(s))).get(0).data["text/plain"]||"[]",i=JSON.parse(t.slice(1,t.length-1));r.push(...c.filter((e=>!i.includes(e))))}n&&p.Notification.update({id:n,message:"Kernel is ready",type:r.length?"warning":"success",autoClose:3e3,actions:r.length?[{label:t.__("Warnings"),callback:()=>{(0,p.showDialog)({title:t.__("Warning"),body:`The following variables were not transferred: ${r.join(", ")}`,buttons:[p.Dialog.warnButton({label:t.__("Dismiss")})]})},displayType:"warn"}]:void 0})}catch(e){console.error(e),n&&p.Notification.update({id:n,message:"Fail to import the variables",type:"error"})}}}}async restart(e){const t=this._translator.load("jupyterlab");if(await e.initialize(),e.isDisposed)throw new Error("session already disposed");const n=e.session?.kernel;if(!n&&e.prevKernelName)return await e.changeKernel({name:e.prevKernelName}),!0;if(!n)throw new Error("No kernel to restart");const s=p.Dialog.warnButton({label:t.__("Restart"),ariaLabel:t.__("Confirm Kernel Restart")}),r=await(0,p.showDialog)({title:t.__("Restart Kernel?"),body:t.__("Do you want to restart the kernel of %1? All variables will be lost.",e.name),buttons:[p.Dialog.cancelButton({ariaLabel:t.__("Cancel Kernel Restart")}),s]});return!n.isDisposed&&!!r.button.accept&&(await e.restartKernel(),!0)}_translator;_multiServiceManager}class Xe{constructor(e){const t=this._manager=e.manager;this.translator=e.translator||v.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._factory=e.factory,this._dialogs=e.sessionDialogs??new p.SessionContextDialogs({translator:e.translator}),this._opener=e.opener||Oe.noOp,this._path=this._manager.contents.normalize(e.path),this._lastModifiedCheckMargin=e.lastModifiedCheckMargin||500;const n=this._manager.contents.localPath(this._path),s=this._factory.preferredLanguage(m.PathExt.basename(n)),r=this._manager.contents.getSharedModelFactory(this._path),a=r?.createNew({path:n,format:this._factory.fileFormat,contentType:this._factory.contentType,collaborative:this._factory.collaborative});this._model=this._factory.createNew({languagePreference:s,sharedModel:a,collaborationEnabled:r?.collaborative??!1}),this._readyPromise=t.ready.then((()=>this._populatedPromise.promise));const i=m.PathExt.extname(this._path);this.sessionContext=new Je({sessionManager:t.sessions,specsManager:t.kernelspecs,path:n,type:".ipynb"===i?"notebook":"file",name:m.PathExt.basename(n),kernelPreference:e.kernelPreference||{shouldStart:!1},setBusy:e.setBusy},t),this.sessionContext.propertyChanged.connect(this._onSessionChanged,this),t.contents.fileChanged.connect(this._onFileChanged,this),this.urlResolver=new x.RenderMimeRegistry.UrlResolver({path:this._path,contents:t.contents})}get pathChanged(){return this._pathChanged}get fileChanged(){return this._fileChanged}get saveState(){return this._saveState}get disposed(){return this._disposed}get lastModifiedCheckMargin(){return this._lastModifiedCheckMargin}set lastModifiedCheckMargin(e){this._lastModifiedCheckMargin=e}get model(){return this._model}sessionContext;get path(){return this._path}get localPath(){return this._manager.contents.localPath(this._path)}get contentsModel(){return this._contentsModel?{...this._contentsModel}:null}get factoryName(){return this.isDisposed?"":this._factory.name}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,this.sessionContext.dispose(),this._model.dispose(),this._model.sharedModel.dispose(),this._disposed.emit(void 0),D.Signal.clearData(this))}get isReady(){return this._isReady}get ready(){return this._readyPromise}get canSave(){return!(!this._contentsModel?.writable||this._model.collaborative)}urlResolver;async initialize(e){e?await this._save():await this._revert(),this.model.sharedModel.clearUndoHistory()}rename(e){return this.ready.then((()=>this._manager.ready.then((()=>this._rename(e)))))}async save(){await this.ready,await this._save()}async saveAs(){await this.ready;const e=this._manager.contents.localPath(this.path),t=await Oe.getSavePath(e);if(this.isDisposed||!t)return;const n=this._manager.contents.driveName(this.path),s=""===n?t:`${n}:${t}`;if(s===this._path)return this.save();try{await this._manager.ready,await this._manager.contents.get(s),await this._maybeOverWrite(s)}catch(e){if(!e.response||404!==e.response.status)throw e;await this._finishSaveAs(s)}}async download(){const e=await this._manager.contents.getDownloadUrl(this._path),t=document.createElement("a");t.href=e,t.download="",document.body.appendChild(t),t.click(),document.body.removeChild(t)}async revert(){await this.ready,await this._revert()}createCheckpoint(){const e=this._manager.contents;return this._manager.ready.then((()=>e.createCheckpoint(this._path)))}deleteCheckpoint(e){const t=this._manager.contents;return this._manager.ready.then((()=>t.deleteCheckpoint(this._path,e)))}restoreCheckpoint(e){const t=this._manager.contents,n=this._path;return this._manager.ready.then((()=>e?t.restoreCheckpoint(n,e):this.listCheckpoints().then((s=>{if(!this.isDisposed&&s.length)return e=s[s.length-1].id,t.restoreCheckpoint(n,e)}))))}listCheckpoints(){const e=this._manager.contents;return this._manager.ready.then((()=>e.listCheckpoints(this._path)))}addSibling(e,t={}){const n=this._opener;return n&&n(e,t),new Te.DisposableDelegate((()=>{e.close()}))}_onFileChanged(e,t){if("rename"!==t.type)return;let n=t.oldValue&&t.oldValue.path,s=t.newValue&&t.newValue.path;if(s&&0===this._path.indexOf(n||"")){let e=t.newValue;n!==this._path&&(s=this._path.replace(new RegExp(`^${n}/`),`${s}/`),n=this._path,e={last_modified:t.newValue?.created,path:s}),this._updateContentsModel({...this._contentsModel,...e}),this._updatePath(s)}}_onSessionChanged(e,t){if("path"!==t)return;const n=this._manager.contents.driveName(this.path);let s=this.sessionContext.session.path;n&&(s=`${n}:${s}`),this._updatePath(s)}_updateContentsModel(e){const t=e.writable&&!this._model.collaborative,n={path:e.path,name:e.name,type:e.type,writable:t,created:e.created,last_modified:e.last_modified,mimetype:e.mimetype,format:e.format},s=this._contentsModel?.last_modified??null;this._contentsModel=n,s&&n.last_modified===s||this._fileChanged.emit(n)}_updatePath(e){if(this._path===e)return;this._path=e;const t=this._manager.contents.localPath(e),n=m.PathExt.basename(t);if(this.sessionContext.session?.path!==t&&this.sessionContext.session?.setPath(t),this.sessionContext.session?.name!==n&&this.sessionContext.session?.setName(n),this.urlResolver.path!==e&&(this.urlResolver.path=e),this._contentsModel&&(this._contentsModel.path!==e||this._contentsModel.name!==n)){const t={...this._contentsModel,name:n,path:e};this._updateContentsModel(t)}this._pathChanged.emit(e)}async _populate(){if(this._isPopulated=!0,this._isReady=!0,this._populatedPromise.resolve(void 0),await this._maybeCheckpoint(!1),this.isDisposed)return;const e=this._model.defaultKernelName||this.sessionContext.kernelPreference.name;this.sessionContext.kernelPreference={...this.sessionContext.kernelPreference,name:e,language:this._model.defaultKernelLanguage},this.sessionContext.initialize().then((e=>{e&&this._dialogs.selectKernel(this.sessionContext)}))}async _rename(e){const t=this.localPath.split("/");t[t.length-1]=e;let n=m.PathExt.join(...t);const s=this._manager.contents.driveName(this.path);s&&(n=`${s}:${n}`),await this._manager.contents.rename(this.path,n)}async _save(){this._saveState.emit("started");const e=this._createSaveOptions();try{await this._manager.ready;const t=await this._maybeSave(e);if(this.isDisposed)return;this._model.dirty=!1,this._updateContentsModel(t),this._isPopulated||await this._populate(),this._saveState.emit("completed")}catch(e){const{name:t}=e;if("ModalCancelError"===t||"ModalDuplicateError"===t)throw e;const n=this._manager.contents.localPath(this._path),s=m.PathExt.basename(n);throw this._handleError(e,this._trans.__("File Save Error for %1",s)),this._saveState.emit("failed"),e}}_revert(e=!1){const t={type:this._factory.contentType,content:null!==this._factory.fileFormat,...null!==this._factory.fileFormat?{format:this._factory.fileFormat}:{}},n=this._path,s=this._model;return this._manager.ready.then((()=>this._manager.contents.get(n,t))).then((e=>{if(!this.isDisposed){if(e.content)if("json"===e.format)s.fromJSON(e.content);else{let t=e.content;-1!==t.indexOf("\r\n")?(this._lineEnding="\r\n",t=t.replace(/\r\n/g,"\n")):-1!==t.indexOf("\r")?(this._lineEnding="\r",t=t.replace(/\r/g,"\n")):this._lineEnding=null,s.fromString(t)}return this._updateContentsModel(e),s.dirty=!1,this._isPopulated?void 0:this._populate()}})).catch((async e=>{const t=this._manager.contents.localPath(this._path),n=m.PathExt.basename(t);throw this._handleError(e,this._trans.__("File Load Error for %1",n)),e}))}_maybeSave(e){const t=this._path;return this._manager.contents.get(t,{content:!1}).then((n=>{if(this.isDisposed)return Promise.reject(new Error("Disposed"));const s=this._lastModifiedCheckMargin,r=this.contentsModel?.last_modified,a=r?new Date(r):new Date,i=new Date(n.last_modified);return r&&i.getTime()-a.getTime()>s?this._timeConflict(a,n,e):this._manager.contents.save(t,e)}),(n=>{if(n.response&&404===n.response.status)return this._manager.contents.save(t,e);throw n}))}async _handleError(e,t){await(0,p.showErrorMessage)(t,e)}_maybeCheckpoint(e){let t=Promise.resolve(void 0);return this.canSave?(t=e?this.createCheckpoint().then():this.listCheckpoints().then((e=>{if(!this.isDisposed&&!e.length&&this.canSave)return this.createCheckpoint().then()})),t.catch((e=>{if(!e.response||403!==e.response.status)throw e}))):t}_timeConflict(e,t,n){const s=new Date(t.last_modified);if(console.warn(`Last saving performed ${e} while the current file seems to have been saved ${s}`),this._timeConflictModalIsOpen){const e=new Error("Modal is already displayed");return e.name="ModalDuplicateError",Promise.reject(e)}const r=this._trans.__('"%1" has changed on disk since the last time it was opened or saved.\nDo you want to overwrite the file on disk with the version open here,\nor load the version on disk (revert)?',this.path),a=p.Dialog.okButton({label:this._trans.__("Revert"),actions:["revert"]}),i=p.Dialog.warnButton({label:this._trans.__("Overwrite"),actions:["overwrite"]});return this._timeConflictModalIsOpen=!0,(0,p.showDialog)({title:this._trans.__("File Changed"),body:r,buttons:[p.Dialog.cancelButton(),a,i]}).then((e=>{if(this._timeConflictModalIsOpen=!1,this.isDisposed)return Promise.reject(new Error("Disposed"));if(e.button.actions.includes("overwrite"))return this._manager.contents.save(this._path,n);if(e.button.actions.includes("revert"))return this.revert().then((()=>t));const s=new Error("Cancel");return s.name="ModalCancelError",Promise.reject(s)}))}_maybeOverWrite(e){const t=this._trans.__('"%1" already exists. Do you want to replace it?',e),n=p.Dialog.warnButton({label:this._trans.__("Overwrite"),accept:!0});return(0,p.showDialog)({title:this._trans.__("File Overwrite?"),body:t,buttons:[p.Dialog.cancelButton(),n]}).then((t=>this.isDisposed?Promise.reject(new Error("Disposed")):t.button.accept?this._manager.contents.delete(e).then((()=>this._finishSaveAs(e))):void 0))}async _finishSaveAs(e){this._saveState.emit("started");try{await this._manager.ready;const t=this._createSaveOptions();await this._manager.contents.save(e,t),await this._maybeCheckpoint(!0),this._saveState.emit("completed")}catch(e){if("Cancel"===e.message||"Modal is already displayed"===e.message)throw e;const t=this._manager.contents.localPath(this._path),n=m.PathExt.basename(t);return this._handleError(e,this._trans.__("File Save Error for %1",n)),void this._saveState.emit("failed")}}_createSaveOptions(){let e=null;return"json"===this._factory.fileFormat?e=this._model.toJSON():(e=this._model.toString(),this._lineEnding&&(e=e.replace(/\n/g,this._lineEnding))),{type:this._factory.contentType,format:this._factory.fileFormat,content:e}}translator;_isReady=!1;_isDisposed=!1;_isPopulated=!1;_trans;_manager;_opener;_model;_path="";_lineEnding=null;_factory;_contentsModel=null;_readyPromise;_populatedPromise=new I.PromiseDelegate;_pathChanged=new D.Signal(this);_fileChanged=new D.Signal(this);_saveState=new D.Signal(this);_disposed=new D.Signal(this);_dialogs;_lastModifiedCheckMargin=500;_timeConflictModalIsOpen=!1}!function(e){e.getSavePath=function(e,n){const s=(n=n||v.nullTranslator).load("jupyterlab"),r=p.Dialog.okButton({label:s.__("Save"),accept:!0});return(0,p.showDialog)({title:s.__("Save File Asâ€¦"),body:new t(e),buttons:[p.Dialog.cancelButton(),r]}).then((e=>{if(e.button.accept)return e.value??void 0}))},e.noOp=function(){};class t extends k.Widget{constructor(e){super({node:n(e)})}getValue(){return this.node.value}}function n(e){const t=document.createElement("input");return t.value=e,t}}(Oe||(Oe={}));class Ge{constructor(e){this.translator=e.translator||v.nullTranslator,this.registry=e.registry,this.services=e.manager,this._dialogs=e.sessionDialogs??new p.SessionContextDialogs({translator:e.translator}),this._isConnectedCallback=e.isConnectedCallback||(()=>!0),this._opener=e.opener,this._when=e.when||e.manager.ready;const t=new g.DocumentWidgetManager({registry:this.registry,translator:this.translator});t.activateRequested.connect(this._onActivateRequested,this),t.stateChanged.connect(this._onWidgetStateChanged,this),this._widgetManager=t,this._setBusy=e.setBusy}registry;services;get activateRequested(){return this._activateRequested}get autosave(){return this._autosave}set autosave(e){if(this._autosave!==e){const t=this._autosave;this._autosave=e,this._contexts.forEach((t=>{const n=Fe.saveHandlerProperty.get(t);n&&(!0!==e||n.isActive?!1===e&&n.isActive&&n.stop():n.start())})),this._stateChanged.emit({name:"autosave",oldValue:t,newValue:e})}}get autosaveInterval(){return this._autosaveInterval}set autosaveInterval(e){if(this._autosaveInterval!==e){const t=this._autosaveInterval;this._autosaveInterval=e,this._contexts.forEach((t=>{const n=Fe.saveHandlerProperty.get(t);n&&(n.saveInterval=e||120)})),this._stateChanged.emit({name:"autosaveInterval",oldValue:t,newValue:e})}}get confirmClosingDocument(){return this._widgetManager.confirmClosingDocument}set confirmClosingDocument(e){if(this._widgetManager.confirmClosingDocument!==e){const t=this._widgetManager.confirmClosingDocument;this._widgetManager.confirmClosingDocument=e,this._stateChanged.emit({name:"confirmClosingDocument",oldValue:t,newValue:e})}}get lastModifiedCheckMargin(){return this._lastModifiedCheckMargin}set lastModifiedCheckMargin(e){if(this._lastModifiedCheckMargin!==e){const t=this._lastModifiedCheckMargin;this._lastModifiedCheckMargin=e,this._contexts.forEach((t=>{t.lastModifiedCheckMargin=e})),this._stateChanged.emit({name:"lastModifiedCheckMargin",oldValue:t,newValue:e})}}get renameUntitledFileOnSave(){return this._renameUntitledFileOnSave}set renameUntitledFileOnSave(e){if(this._renameUntitledFileOnSave!==e){const t=this._renameUntitledFileOnSave;this._renameUntitledFileOnSave=e,this._stateChanged.emit({name:"renameUntitledFileOnSave",oldValue:t,newValue:e})}}get stateChanged(){return this._stateChanged}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,D.Signal.clearData(this),this._contexts.forEach((e=>this._widgetManager.closeWidgets(e))),this._widgetManager.dispose(),this._contexts.length=0)}cloneWidget(e){return this._widgetManager.cloneWidget(e)}closeAll(){return Promise.all(this._contexts.map((e=>this._widgetManager.closeWidgets(e)))).then((()=>{}))}closeFile(e){const t=this._contextsForPath(e).map((e=>this._widgetManager.closeWidgets(e)));return Promise.all(t).then((e=>{}))}contextForWidget(e){return this._widgetManager.contextForWidget(e)}copy(e,t){return this.services.contents.copy(e,t)}createNew(e,t="default",n){return this._createOrOpenDocument("create",e,t,n)}deleteFile(e){return this.services.sessions.stopIfNeeded(e).then((()=>this.services.contents.delete(e))).then((()=>(this._contextsForPath(e).forEach((e=>this._widgetManager.deleteWidgets(e))),Promise.resolve(void 0))))}duplicate(e){const t=m.PathExt.dirname(e);return this.services.contents.copy(e,t)}findWidget(e,t="default"){const n=m.PathExt.normalize(e);let s=[t];if("default"===t){const e=this.registry.defaultWidgetFactory(n);if(!e)return;s=[e.name]}else null===t&&(s=this.registry.preferredWidgetFactories(n).map((e=>e.name)));for(const e of this._contextsForPath(n))for(const t of s)if(null!==t){const n=this._widgetManager.findWidget(e,t);if(n)return n}}newUntitled(e){return"file"===e.type&&(e.ext=e.ext||".txt"),this.services.contents.newUntitled(e)}open(e,t="default",n,s){return this._createOrOpenDocument("open",e,t,n,s)}openOrReveal(e,t="default",n,s){const r=this.findWidget(e,t);return r?(this._opener.open(r,{type:t,...s}),r):this.open(e,t,n,s??{})}overwrite(e,t){const n=`${t}.${I.UUID.uuid4()}`,s=()=>this.rename(n,t);return this.rename(e,n).then((()=>this.deleteFile(t))).then(s,s)}rename(e,t){return this.services.contents.rename(e,t)}_findContext(e,t){const n=this.services.contents.normalize(e);return(0,he.find)(this._contexts,(e=>e.path===n&&e.factoryName===t))}_contextsForPath(e){const t=this.services.contents.normalize(e);return this._contexts.filter((e=>e.path===t))}_createContext(e,t,n){const s=new Xe({opener:(e,t)=>{this._widgetManager.adoptWidget(s,e),this._opener.open(e,t)},manager:this.services,factory:t,path:e,kernelPreference:n,setBusy:this._setBusy,sessionDialogs:this._dialogs,lastModifiedCheckMargin:this._lastModifiedCheckMargin,translator:this.translator}),r=new g.SaveHandler({context:s,isConnectedCallback:this._isConnectedCallback,saveInterval:this.autosaveInterval});return Fe.saveHandlerProperty.set(s,r),s.ready.then((()=>{this.autosave&&r.start()})),s.disposed.connect(this._onContextDisposed,this),this._contexts.push(s),s}_onContextDisposed(e){he.ArrayExt.removeFirstOf(this._contexts,e)}_widgetFactoryFor(e,t){const{registry:n}=this;if("default"===t){const s=n.defaultWidgetFactory(e);if(!s)return;t=s.name}return n.getWidgetFactory(t)}_createOrOpenDocument(e,t,n="default",s,r){const a=this._widgetFactoryFor(t,n);if(!a)return;const i=a.modelName||"text",o=this.registry.getModelFactory(i);if(!o)return;const l=this.registry.getKernelPreference(t,a.name,s);let c,d=Promise.resolve(void 0);if("open"===e)c=this._findContext(t,o.name)||null,c||(c=this._createContext(t,o,l),d=this._when.then((()=>c.initialize(!1))));else{if("create"!==e)throw new Error(`Invalid argument 'which': ${e}`);c=this._createContext(t,o,l),d=this._when.then((()=>c.initialize(!0)))}const h=this._widgetManager.createWidget(a,c);return this._opener.open(h,{type:a.name,...r}),d.catch((e=>{console.error(`Failed to initialize the context with '${o.name}' for ${t}`,e),h.close()})),h}_onActivateRequested(e,t){this._activateRequested.emit(t)}_onWidgetStateChanged(e,t){"confirmClosingDocument"===t.name&&this._stateChanged.emit(t)}translator;_activateRequested=new D.Signal(this);_contexts=[];_opener;_widgetManager;_isDisposed=!1;_autosave=!0;_autosaveInterval=120;_lastModifiedCheckMargin=500;_renameUntitledFileOnSave=!0;_when;_setBusy;_dialogs;_isConnectedCallback;_stateChanged=new D.Signal(this)}!function(e){e.saveHandlerProperty=new Ne.AttachedProperty({name:"saveHandler",create:()=>{}})}(Fe||(Fe={}));var Ye=n(49757);const Qe="autoRestartCellKernels",et={id:"@datalayer/jupyter-kernels:lifecycle",description:"Handle foreign cell kernel lifecycle when the document one changes",requires:[ve,ce.INotebookTracker],optional:[y.ISettingRegistry],autoStart:!0,activate:(e,t,n,s)=>{const r=new WeakMap,a=new WeakMap,i=async e=>{const n=e.kernelDisplayStatus;if(["autorestarting","restarting"].includes(n)&&n!==r.get(e)){r.set(e,e.kernelDisplayStatus);let t=null;const n=new Array,o=(await(s?.get(ye,Qe)))?.composite??"ask";for(const s of a.get(e)?.model?.cells??[])s.getMetadata("datalayer")?.kernel&&!1!==s.getMetadata("datalayer").kernel.params?.persistent&&s.getMetadata("datalayer").kernel.id&&(n.push(s.getMetadata("datalayer").kernel),"ask"===o&&null===t&&(t=(0,p.showDialog)({title:"Restart cell kernels",body:"Do you want to restart the cell kernels too?",buttons:[p.Dialog.cancelButton({label:"No"}),p.Dialog.okButton({label:"Yes"})],checkbox:{label:"Don't ask me again",caption:"Store your answer and apply it next time a restart is performed."}})));const l=await(t??Promise.resolve(null));"yes"===o?i(n):l&&(l.button.accept&&i(n),l.isChecked&&await(s?.set(ye,Qe,l.button.accept?"yes":"no")))}else r.set(e,n);function i(e){e.forEach((async e=>{const n=q(e.location),s=n?t.remote?.servers:t[e.location]?.kernels;try{const t=s?.connectTo({model:{id:e.id,name:e.name}});await(t?.restart())}catch(t){console.error(`Failed to restart ${n?"remote":e.location} kernel (${e.id})`)}}))}},o=(e,t)=>{e.isDisposed||(r.set(e,e.kernelDisplayStatus),e.statusChanged.connect(i),e.connectionStatusChanged.connect(i),a.set(e,t),e.disposed.connect((()=>{a.delete(e),e.statusChanged.disconnect(i),e.connectionStatusChanged.disconnect(i)})))};n.forEach((e=>{o(e.context.sessionContext,e.content)})),n.widgetAdded.connect(((e,t)=>{o(t.context.sessionContext,t.content)}))}};var tt,nt=n(2429),st=n(25071),rt=n(24842),at=n(29754),it=n(56558),ot=n(76797),lt=n(96096),ct=n.n(lt),dt=n(17149);!function(e){e.createConsole="@datalayer/jupyter-kernels:new-browser-console",e.createNotebook="@datalayer/jupyter-kernels:new-browser-notebook"}(tt||(tt={}));const ht={id:"@datalayer/jupyter-kernels:browser-localforage",autoStart:!1,requires:[a.IDatalayer],provides:rt.ILocalForage,activate:async(e,t)=>(await Ct(t,"@datalayer/jupyter-kernels:browser-localforage"),{localforage:ct()})},ut={id:"@datalayer/jupyter-kernels:browser-localforage-memory-storage",autoStart:!0,requires:[rt.ILocalForage],activate:async(e,t)=>{JSON.parse(m.PageConfig.getOption("enableMemoryStorage")||"false")&&(console.warn("Memory storage fallback enabled: contents and settings may not be saved"),await(0,rt.ensureMemoryStorage)(t.localforage))}},pt={id:"@datalayer/jupyter-kernels:browser-contents",requires:[rt.ILocalForage],autoStart:!1,provides:nt.IContents,activate:(e,t)=>{const n=m.PageConfig.getOption("contentsStorageName"),s=JSON.parse(m.PageConfig.getOption("contentsStorageDrivers")||"null"),{localforage:r}=t,a=new nt.Contents({storageName:n,storageDrivers:s,localforage:r});return e.started.then((()=>a.initialize().catch(console.warn))),a}},mt={id:"@datalayer/jupyter-kernels:browser-contents-routes",autoStart:!0,requires:[we,nt.IContents],activate:(e,t,n)=>{t.get("/api/contents/(.+)/checkpoints",(async(e,t)=>{const s=await n.listCheckpoints(t);return new Response(JSON.stringify(s))})),t.post("/api/contents/(.+)/checkpoints/(.*)",(async(e,t,s)=>{const r=await n.restoreCheckpoint(t,s);return new Response(JSON.stringify(r),{status:204})})),t.post("/api/contents/(.+)/checkpoints",(async(e,t)=>{const s=await n.createCheckpoint(t);return new Response(JSON.stringify(s),{status:201})})),t.delete("/api/contents/(.+)/checkpoints/(.*)",(async(e,t,s)=>{const r=await n.deleteCheckpoint(t,s);return new Response(JSON.stringify(r),{status:204})})),t.get("/api/contents(.*)",(async(e,t)=>{const s={content:"1"===e.query?.content},r=await n.get(t,s);return r?new Response(JSON.stringify(r)):new Response(null,{status:404})})),t.post("/api/contents(.*)",(async(e,t)=>{const s=e.body,r=s?.copy_from;let a;return a=r?await n.copy(r,t):await n.newUntitled(s),a?new Response(JSON.stringify(a),{status:201}):new Response(null,{status:400})})),t.patch("/api/contents(.*)",(async(e,t)=>{const s=e.body?.path??"";t="/"===t[0]?t.slice(1):t;const r=await n.rename(t,s);return new Response(JSON.stringify(r))})),t.put("/api/contents/(.+)",(async(e,t)=>{const s=e.body,r=await n.save(t,s);return new Response(JSON.stringify(r))})),t.delete("/api/contents/(.+)",(async(e,t)=>(await n.delete(t),new Response(null,{status:204}))))}};class gt{constructor(e){const t=e?.workerUrl??m.URLExt.join(m.PageConfig.getBaseUrl(),at.WORKER_NAME);this.initialize(t).catch(console.warn)}get registrationChanged(){return this._registrationChanged}get enabled(){return null!==this._registration}get ready(){return this._ready.promise}async initialize(e){const{serviceWorker:t}=navigator;let n=null;if(t?t.controller&&(n=await t.getRegistration(t.controller.scriptURL)||null,console.info("JupyterLite ServiceWorker was already registered")):console.warn("ServiceWorkers not supported in this browser"),!n&&t)try{const s=await t.getRegistrations();await Promise.all(s.map((e=>e.unregister()))),console.info("Existing JupyterLite ServiceWorkers unregistered"),console.info("Registering new JupyterLite ServiceWorker",e),n=await t.register(e,{scope:m.PageConfig.getBaseUrl()}),console.info("JupyterLite ServiceWorker was successfully registered")}catch(e){console.warn(e),console.warn(`JupyterLite ServiceWorker registration unexpectedly failed: ${e}`)}this.setRegistration(n),n?this._ready.resolve(void 0):this._ready.reject(void 0)}setRegistration(e){this._registration=e,this._registrationChanged.emit(this._registration)}_registration=null;_registrationChanged=new D.Signal(this);_ready=new I.PromiseDelegate}const ft={id:"@datalayer/jupyter-kernels:browser-service-worker",autoStart:!1,provides:at.IServiceWorkerManager,requires:[a.IDatalayer],activate:async(e,t)=>(await Ct(t,"@datalayer/jupyter-kernels:browser-service-worker"),new gt({workerUrl:m.URLExt.join(m.PageConfig.getBaseUrl(),"jupyter_kernels/service-worker",at.WORKER_NAME)}))},xt={id:"@datalayer/jupyter-kernels:emscripten-filesystem",autoStart:!1,requires:[ve,we],optional:[at.IServiceWorkerManager],provides:nt.IBroadcastChannelWrapper,activate:(e,t,n,s)=>{const{contents:r}=t.browser??{};if(!r)throw new Error("Unable to activate emscripten-filesystem plugin without the browser service manager.");const a=new nt.BroadcastChannelWrapper({contents:r}),i="Kernel filesystem and JupyterLite contents";function o(e,t){t&&console.warn(t),e&&console.warn(e),t||e?console.warn(`${i} will NOT be synced`):console.info(`${i} will be synced`)}return s?s.ready.then((()=>{a.enable(),o()})).catch((e=>{o("JupyterLite ServiceWorker failed to become available",e)})):o("JupyterLite ServiceWorker not available"),a}},_t={id:"@datalayer/jupyter-kernels:browser-kernels",autoStart:!1,provides:st.IKernels,requires:[st.IKernelSpecs],activate:(e,t)=>new st.Kernels({kernelspecs:t})},yt={id:"@datalayer/jupyter-kernels:browser-kernels-routes",autoStart:!0,requires:[we,st.IKernels],activate:(e,t,n)=>{t.get("/api/kernels",(async e=>{const t=await n.list();return new Response(JSON.stringify(t))})),t.post("/api/kernels/(.*)/restart",(async(e,t)=>{const s=await n.restart(t);return new Response(JSON.stringify(s))})),t.delete("/api/kernels/(.*)",(async(e,t)=>{const s=await n.shutdown(t);return new Response(JSON.stringify(s),{status:204})}))}},vt={id:"@datalayer/jupyter-kernels:browser-kernelspec",autoStart:!1,provides:st.IKernelSpecs,requires:[a.IDatalayer],optional:[v.ITranslator,f.ILauncher],activate:async(e,t,n,s)=>{await Ct(t,"@datalayer/jupyter-kernels:browser-kernelspec");const r=new st.KernelSpecs,a=(n??v.nullTranslator).load("datalayer");if(s){let e=null,t=new Te.DisposableSet;new ot.Poll({factory:async()=>{const n=r.specs;I.JSONExt.deepEqual(e,n)||(t.dispose(),e=n,t=new Te.DisposableSet,Object.values(e?.kernelspecs??{}).map((e=>{if(e){const n=e.resources["logo-svg"]||e.resources["logo-64x64"];t.add(s.add({command:tt.createConsole,args:{isLauncher:!0,kernelName:`browser-${e.name}`},category:a.__("Console"),kernelIconUrl:n,metadata:{kernel:I.JSONExt.deepCopy(e.metadata||{})}})),t.add(s.add({command:tt.createNotebook,args:{isLauncher:!0,kernelName:`browser-${e.name}`},category:a.__("Notebook"),kernelIconUrl:n,metadata:{kernel:I.JSONExt.deepCopy(e.metadata||{})}}))}})))}})}return r}},wt={id:"@datalayer/jupyter-kernels:browser-kernelspec-routes",autoStart:!0,requires:[we,st.IKernelSpecs],activate:(e,t,n)=>{t.get("/api/kernelspecs",(async e=>{const{specs:t}=n;if(!t)return new Response(null);const s={},r=t.kernelspecs;Object.keys(r).forEach((e=>{const t=r[e],{resources:n}=t??{};s[e]={name:e,spec:t,resources:n}}));const a={default:t.default,kernelspecs:s};return new Response(JSON.stringify(a))}))}},kt={id:"@datalayer/jupyter-kernels:browser-sessions",autoStart:!1,provides:it.ISessions,requires:[st.IKernels],activate:(e,t)=>new it.Sessions({kernels:t})},bt={id:"@datalayer/jupyter-kernels:browser-sessions-routes",autoStart:!0,requires:[we,it.ISessions],activate:(e,t,n)=>{t.get("/api/sessions/(.+)",(async(e,t)=>{const s=await n.get(t);return new Response(JSON.stringify(s),{status:200})})),t.get("/api/sessions",(async e=>{const t=await n.list();return new Response(JSON.stringify(t),{status:200})})),t.patch("/api/sessions(.*)",(async(e,t)=>{const s=e.body,r=await n.patch(s);return new Response(JSON.stringify(r),{status:200})})),t.delete("/api/sessions/(.+)",(async(e,t)=>(await n.shutdown(t),new Response(null,{status:204})))),t.post("/api/sessions",(async e=>{const t=e.body,s=await n.startNew(t);return new Response(JSON.stringify(s),{status:201})}))}};class jt{constructor(e){this._stream=new D.Stream(this),this._serverSettings=e.serverSettings}async emit(e){}dispose(){}get isDisposed(){return!0}get stream(){return this._stream}get serverSettings(){return this._serverSettings}_stream;_serverSettings}const St=[pt,mt,{id:"@datalayer/jupyter-kernels:browser-manager",requires:[ve,a.IDatalayer],optional:[v.ITranslator,u.ILabStatus],provides:we,autoStart:!1,activate:async(e,t,n,s,r)=>{await Ct(n,"@datalayer/jupyter-kernels:browser-manager");const a=(s??v.nullTranslator).load("jupyterlab"),i=new at.Router,o={..._.ServerConnection.makeSettings(),WebSocket:dt.WebSocket,fetch:async(e,t)=>{if(!(e instanceof Request))throw Error("Request info is not a Request");try{return i.route(e)}catch(n){if(n.message.startsWith("Cannot route"))return console.log(`No browser route for ${e.method} ${e.url}`),fetch(e,t);throw n}}},l=t.browser=new _.ServiceManager({standby:"never",serverSettings:o,events:new jt({serverSettings:o})});let c=0;return e.commands.addCommand(tt.createConsole,{label:e=>{const t=e.kernelName||"";if(e.isLauncher&&t&&l.kernelspecs){const e=t.startsWith("browser-")?t.slice(8):t;return l.kernelspecs.specs?.kernelspecs[e]?.display_name??e}return e.isPalette||e.isContextMenu?a.__("New Console"):a.__("Console")},caption:a.__("Create a new console"),icon:e=>e.isPalette?void 0:w.consoleIcon,execute:n=>{const s=c++;let i=n.path;return i||(i=m.PathExt.join(n.basePath||"",`console-browser-${s}-${I.UUID.uuid4()}`)),n.sessionContext=new Je({sessionManager:t.sessions,specsManager:t.kernelspecs,path:t.contents.localPath(i),name:n.name||a.__("Console %1",s),type:"console",kernelPreference:n.kernelPreference,setBusy:r?()=>r.setBusy():void 0},t),e.commands.execute("console:create",n)}}),e.commands.addCommand(tt.createNotebook,{label:e=>{const t=e.kernelName||"";if(e.isLauncher&&t&&l.kernelspecs){const e=t.startsWith("browser-")?t.slice(8):t;return l.kernelspecs.specs?.kernelspecs[e]?.display_name??e}return e.isPalette||e.isContextMenu?a.__("New Notebook"):a.__("Notebook")},caption:a.__("Create a new notebook"),icon:e=>e.isPalette?void 0:w.notebookIcon,execute:t=>e.commands.execute("notebook:create-new",t)}),i}},xt,_t,yt,vt,wt,ut,ht,ft,kt,bt];async function Ct(e,t){if(await e.ready,!1!==e.configuration.configuration?.whiteLabel)throw new Error(`Plugin ${t} is not included in Datalayer white labelled distribution.`)}const Dt=new i.zZ({name:"@datalayer/icons:browser",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor" aria-hidden="true">\n  <path d="M256 0C114.62 0 0 114.62 0 256s114.62 256 256 256 256-114.62 256-256S397.38 0 256 0zm-83.789 41.609c-24.934 27.119-44.68 66.125-56.755 111.992H49.749c25.43-50.86 69.12-91.077 122.462-111.992zM25.6 256c0-26.999 5.077-52.727 13.662-76.8h70.494c-4.608 24.294-7.356 49.963-7.356 76.8s2.748 52.506 7.347 76.8H39.262C30.677 308.727 25.6 283 25.6 256zm24.149 102.4h65.707c12.083 45.867 31.821 84.872 56.755 111.991-53.342-20.915-97.032-61.132-122.462-111.991zM243.2 485.188c-43.81-8.252-81.877-58.24-101.359-126.788H243.2v126.788zm0-152.388H135.74c-4.924-24.166-7.74-49.997-7.74-76.8s2.816-52.634 7.74-76.8H243.2v153.6zm0-179.2H141.841C161.323 85.052 199.39 35.063 243.2 26.812V153.6zm219.051 0h-65.707c-12.083-45.867-31.821-84.873-56.755-111.992 53.342 20.916 97.032 61.133 122.462 111.992zM268.8 26.812c43.81 8.252 81.877 58.24 101.359 126.788H268.8V26.812zm0 152.388h107.46c4.924 24.166 7.74 49.997 7.74 76.8s-2.816 52.634-7.74 76.8H268.8V179.2zm0 305.988V358.4h101.359C350.677 426.948 312.61 476.937 268.8 485.188zm70.989-14.797c24.934-27.127 44.672-66.125 56.755-111.991h65.707c-25.43 50.859-69.12 91.076-122.462 111.991zM402.244 332.8c4.608-24.294 7.356-49.963 7.356-76.8s-2.748-52.506-7.347-76.8h70.494c8.576 24.073 13.653 49.801 13.653 76.8 0 27-5.077 52.727-13.662 76.8h-70.494z"/>\n</svg>\n'}),Rt=new i.zZ({name:"@datalayer/icons:laptop-simple",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" class="icon" viewBox="0 0 1024 1024" fill="currentColor" aria-hidden="true">\n  <path d="M956.9 845.1L896.4 632V168c0-17.7-14.3-32-32-32h-704c-17.7 0-32 14.3-32 32v464L67.9 845.1C60.4 866 75.8 888 98 888h828.8c22.2 0 37.6-22 30.1-42.9zM200.4 208h624v395h-624V208zm228.3 608l8.1-37h150.3l8.1 37H428.7zm224 0l-19.1-86.7c-.8-3.7-4.1-6.3-7.8-6.3H398.2c-3.8 0-7 2.6-7.8 6.3L371.3 816H151l42.3-149h638.2l42.3 149H652.7z"/>\n</svg>\n'});var Mt=n(9859),Et=n(12828);const It="jp-mod-kernel";var Nt;!function(e){e.kernelNewConsole="running:kernel-new-console",e.kernelNewNotebook="running:kernel-new-notebook",e.kernelOpenSession="running:kernel-open-session",e.kernelShutDown="running:kernel-shut-down",e.showPanel="running:show-panel"}(Nt||(Nt={}));const Tt={activate:function(e,t,n,s,r,a){const i=t.load("jupyterlab"),o=new Mt.RunningSessionManagers,c=new Mt.RunningSessions(o,t);return c.id="jp-running-sessions",c.title.caption=i.__("Running Terminals and Kernels"),c.title.icon=w.runningIcon,c.node.setAttribute("role","region"),c.node.setAttribute("aria-label",i.__("Running Sessions section")),r&&r.add(c,"running-sessions"),a&&(0,Et.w)(o,t,a),function(e,t,n,s){n.ready.then((()=>async function(e,t,n,s){const{commands:r,contextMenu:a}=e,i=new D.Signal({}),o=new ot.Throttler((()=>i.emit()),100),c=s.load("jupyterlab"),d=()=>o.invoke().catch((e=>{console.error("Failed to refresh the running kernels.",e)}));n.local.kernels.runningChanged.connect(d),n.local.sessions.runningChanged.connect(d);const h=()=>{d(),n.remote?.servers.changed.connect(d)};h(),n.remoteChanged.connect(h);const u=()=>{d(),n.browser?.kernels.runningChanged.connect(d),n.browser?.sessions.runningChanged.connect(d)};u(),n.browserChanged.connect(u),t.add({name:c.__("Kernels"),running:()=>{const e=[new Zt({commands:r,location:"local",kernelspecs:n.local.kernelspecs,kernels:n.local.kernels,sessions:n.local.sessions,trans:c})];return n.remote?e.push(new At({commands:r,trans:c,servers:n.remote.servers})):e.push(Object.freeze({label:()=>"remote",labelTitle:()=>"Click to connect",detail:()=>"Disconnected",icon:()=>l,open:()=>{r.execute("@datalayer/jupyter-kernels:create-widget")}})),n.browser&&e.push(new Zt({commands:r,location:"browser",kernelspecs:n.browser?.kernelspecs,kernels:n.browser?.kernels,sessions:n.browser?.sessions,trans:c})),e},shutdownAll:()=>Promise.all([n.local.kernels.shutdownAll(),n.remote?.servers.shutdownAll(),n.browser?.kernels.shutdownAll()]),refreshRunning:()=>Promise.all([n.local.kernels.refreshRunning(),n.local.sessions.refreshRunning(),n.remote?.servers.refresh(),n.browser?.kernels.refreshRunning(),n.browser?.sessions.refreshRunning()]),runningChanged:i,shutdownLabel:c.__("Shut Down Kernel"),shutdownAllLabel:c.__("Shut Down All"),shutdownAllConfirmationText:c.__("Are you sure you want to permanently shut down all running kernels?")});const p=e=>e.classList.contains(It);r.addCommand(Nt.kernelNewConsole,{icon:w.consoleIcon,label:c.__("New Console for Kernel"),execute:t=>{const n=e.contextMenuHitTest(p),s=t.id??n?.dataset.context;if(s)return r.execute("console:create",{kernelPreference:{id:s}})}}),r.addCommand(Nt.kernelNewNotebook,{icon:w.notebookIcon,label:c.__("New Notebook for Kernel"),execute:t=>{const n=e.contextMenuHitTest(p),s=t.id??n?.dataset.context;if(s)return r.execute("notebook:create-new",{kernelId:s})}}),r.addCommand(Nt.kernelOpenSession,{icon:e=>"console"===e.type?w.consoleIcon:"notebook"===e.type?w.notebookIcon:void 0,isEnabled:({path:e,type:t})=>!!t||void 0!==e,label:({name:e,path:t})=>e||m.PathExt.basename(t||c.__("Unknown Session")),execute:({path:e,type:t})=>{if(!t||void 0===e)return;const n="console"===t?"console:open":"docmanager:open";return r.execute(n,{path:e})}}),r.addCommand(Nt.kernelShutDown,{icon:w.closeIcon,label:c.__("Shut Down Kernel"),execute:t=>{const s=e.contextMenuHitTest(p),r=t.id??s?.dataset.context;if(r)return Promise.all([n.local.kernels.findById(r).then((()=>n.local.kernels.shutdown(r))),n.remote?.servers.findById(r).then((()=>n.remote?.servers.shutdown(r))),n.browser?.kernels.findById(r).then((()=>n.browser?.kernels.shutdown(r)))])}});const g=[];a.opened.connect((async()=>{const t=a.menu.items.find((e=>"submenu"===e.type&&"jp-contextmenu-connected-sessions"===e.submenu?.id))?.submenu??null;if(!t)return;g.forEach((e=>e.dispose())),g.length=0,t.clearItems();const s=e.contextMenuHitTest(p),r=s?.dataset.context;if(!r)return;const i=Nt.kernelOpenSession;for(const e of Array.from(n.local.sessions.running()).concat(Array.from(n.browser?.sessions.running()??[])))if(r===e.kernel?.id){const{name:n,path:s,type:r}=e;g.push(t.addItem({command:i,args:{name:n,path:s,type:r}}))}}))}(e,t,n,s))).catch((e=>{console.error("The services manager failed to initialize.",e)}))}(e,o,n,t),e.shell.add(c,"left",{rank:200,type:"Sessions and Tabs"}),e.commands.addCommand(Nt.showPanel,{label:i.__("Sessions and Tabs"),execute:()=>{e.shell.activateById(c.id)}}),o},id:"@datalayer/jupyter-kernels:running",description:"Provides the running session managers.",provides:Mt.IRunningSessionManagers,requires:[v.ITranslator,ve,a.IDatalayer],optional:[u.ILayoutRestorer,u.ILabShell],autoStart:!0};const Pt={browser:Dt,local:Rt,remote:l};class Zt{commands;kernelspecs;kernels;sessions;trans;constructor({commands:e,location:t,kernelspecs:n,kernels:s,sessions:r,trans:a}){this.commands=e,this.context=t,this.kernelspecs=n,this.kernels=s,this.sessions=r,this.trans=a}get children(){return Array.from(this.kernels.running()).map((e=>new Lt({commands:this.commands,kernel:e,kernels:this.kernels,sessions:this.sessions,spec:this.kernelspecs.specs?.kernelspecs[e.name],trans:this.trans})))}get className(){return this.kernels.running().next().done?"dla-kernels-empty-group":"dla-kernels-group"}context;open(){"remote"===this.context&&this.commands.execute("@datalayer/jupyter-kernels:create-widget")}shutdown(){this.kernels.shutdownAll().catch((e=>{console.error(`Failed to shutdown all kernels on ${this.context} location.`,e)}))}icon(){return Pt[this.context]}label(){return this.context}detail(){switch(this.context){case"browser":return function(){const e=e=>e.test(navigator.userAgent);return e(/opr\//i)?"Opera":e(/edg/i)?"Microsoft Edge":e(/chrome|chromium|crios/i)?"Google Chrome":e(/firefox|fxios/i)?"Mozilla Firefox":e(/safari/i)?"Apple Safari":e(/trident/i)?"Microsoft Internet Explorer":e(/ucbrowser/i)?"UC Browser":e(/samsungbrowser/i)?"Samsung Browser":"Unknown browser"}();case"local":case"remote":try{return new URL(this.kernels.serverSettings.baseUrl).hostname}catch(e){return""}}return""}}class At{commands;trans;servers;constructor({commands:e,servers:t,trans:n}){this.commands=e,this.context="remote",this.trans=n,this.servers=t}get children(){return this.servers.get().map((e=>{const t=this.servers.getServices(e.jupyter_pod_name);return t?new Lt({commands:this.commands,kernel:e,kernels:this.servers,sessions:t.sessions,spec:t.kernelspecs.specs?.kernelspecs[e.name]?{...t.kernelspecs.specs.kernelspecs[e.name],name:e.environment_name,display_name:e.environment_display_name}:void 0,trans:this.trans}):null})).filter((e=>!!e))}get className(){return 0===this.servers.get().length?"dla-kernels-empty-group":"dla-kernels-group"}context;detail(){return new URL(this.servers.serverSettings.baseUrl).hostname}icon(){return Pt[this.context]}label(){return this.context}open(){this.commands.execute("@datalayer/jupyter-kernels:create-widget")}shutdown(){this.servers.shutdownAll().catch((e=>{console.error(`Failed to shutdown all kernels on ${this.context} location.`,e)}))}}class Lt{constructor(e){this.className=It,this.commands=e.commands,this.kernel=e.kernel,this.context=this.kernel.id,this.kernels=e.kernels,this.sessions=e.sessions,this.spec=e.spec||null,this.trans=e.trans}className;context;commands;kernel;kernels;sessions;spec;trans;get children(){const e=[],t=Nt.kernelOpenSession,{commands:n}=this;for(const s of this.sessions.running())if(this.kernel.id===s.kernel?.id){const{name:r,id:a,path:i,type:o}=s;e.push({className:"ITEM_CLASS",context:this.kernel.id,open:()=>{n.execute(t,{name:r,path:i,type:o})},icon:()=>"console"===o?w.consoleIcon:"notebook"===o?w.notebookIcon:w.jupyterIcon,label:()=>r,labelTitle:()=>i,detail:()=>a})}return e}shutdown(){return this.kernels.shutdown(this.kernel.id)}icon(){const{spec:e}=this;return e&&e.resources?e.resources["logo-svg"]||e.resources["logo-64x64"]||e.resources["logo-32x32"]:w.jupyterIcon}label(){const{kernel:e,spec:t}=this;return t?.display_name||e.name}labelTitle(){const{trans:e}=this,{id:t}=this.kernel,n=[`${this.label()}: ${t}`];for(const t of this.sessions.running())if(this.kernel.id===t.kernel?.id){const{path:s,type:r}=t;n.push(e.__("%1\nPath: %2",r,s))}return n.join("\n\n")}detail(){return this.kernel.id}}var Kt;!function(e){e.createWidget="@datalayer/jupyter-kernels:create-widget",e.launchRemoteKernel="@datalayer/jupyter-kernels:launch-remote"}(Kt||(Kt={}));const Ot={id:"@datalayer/jupyter-kernels:manager",description:"Provides the document manager.",provides:g.IDocumentManager,requires:[g.IDocumentWidgetOpener,p.ISessionContextDialogs],optional:[v.ITranslator,u.ILabStatus,u.JupyterLab.IInfo],activate:(e,t,n,s,r,a)=>{const{docRegistry:i}=e,o=s??v.nullTranslator,l=e.restored.then((()=>{}));return new Ge({registry:i,manager:e.serviceManager,opener:t,when:l,setBusy:(r&&(()=>r.setBusy()))??void 0,sessionDialogs:n,translator:o??v.nullTranslator,isConnectedCallback:()=>!a||a.isConnected})}},Ft={id:"@datalayer/jupyter-kernels:service-manager",description:"Overrides the Jupyter service manager.",provides:ve,autoStart:!0,activate:e=>{console.log("Activating @datalayer/jupyter-kernels:service-manager plugin with app",e);const t=new Ye.iq(e.serviceManager);return e.serviceManager=t,t}},$t={id:"@datalayer/jupyter-kernels:sessionDialogs",description:"Provides the session context dialogs.",provides:p.ISessionContextDialogs,optional:[v.ITranslator],requires:[ve],autoStart:!0,activate:async(e,t,n)=>(document.body.dataset.portalRoot="true",new qe({translator:n??v.nullTranslator},t))},Vt={id:ye,autoStart:!0,requires:[a.IDatalayer,ve],optional:[y.ISettingRegistry,p.ICommandPalette,f.ILauncher,u.ILayoutRestorer,x.IMarkdownParser,p.ISanitizer],provides:ke,activate:async(e,t,n,s,a,i,u,g,f)=>{const x=_.ServerConnection.makeSettings(),y=m.URLExt.join(x.baseUrl,"jupyter_kernels","config");try{const e=await _.ServerConnection.makeRequest(y,{},x);if(e.ok){const t=await e.json(),{setConfiguration:n,setVersion:s}=S.SE.getState();n(t.configuration),s(t.version)}else console.error("Failed to load @datalayer/jupyter-kernels configuration.")}catch(e){console.error("Failed to load @datalayer/jupyter-kernels configuration.",e)}const{configuration:v,jupyterLabAdapter:C,serviceManager:D,setJupyterLabAdapter:R,setServiceManager:M}=S.SE.getState(),E={configuration:v};C||R(h.JupyterLabAppAdapter.create(e)),D||M(n);let I=!1;const N={label:"Jupyter Kernels",caption:"Show Jupyter Kernels",icon:c},T=e=>{if(!e)return;if(!I){I=!0;const{category:t,icon:n,name:r,rank:o}=e.launcher,l=Kt.createWidget;(async()=>{if(r&&(N.label=r,N.caption=`Show ${r}`),n)try{const e=await fetch(n),t=await e.text();N.icon=new w.LabIcon({name:"@datalayer/core:launcher-icon",svgstr:t})}catch(e){console.warn(`Failed to fetch the custom icon SVG from ${n}.`)}P.notifyCommandChanged(l)})(),a?.addItem({command:l,category:t});const c=e=>{const n=e.get("showInLauncher").composite;i&&n&&i.add({command:l,category:t,rank:o})};s&&s.load(Vt.id).then((e=>{console.log(`${Vt.id} settings loaded:`,e.composite),c(e),e.changed.connect(c)})).catch((e=>{console.error(`Failed to load settings for ${Vt.id}.`,e)}));const{token:h,logUser:u}=d.jpIAMStore.getState();h||u()}const{user:t,token:r}=d.jpIAMStore.getState();(0,Ye.Ad)(n,e,r,t),d.jpIAMStore.subscribe(((t,s)=>{t.token&&t.token!==s.token&&(0,Ye.Ad)(n,e,t.token,t.user)}))};T(t.configuration.configuration),t.configuration.configurationChanged.connect(((e,t)=>{T(t)}));const{commands:P}=e,Z=new p.WidgetTracker({namespace:"jupyter-kernels"}),A=Kt.createWidget;return P.addCommand(A,{caption:()=>N.caption,label:()=>N.label,icon:()=>N.icon,execute:()=>{const t=w.ReactWidget.create((0,r.jsx)(b.Z,{}));t.addClass("dla-Container");const n=new p.MainAreaWidget({content:t});n.title.label=N.label,n.title.icon=N.icon,e.shell.add(n,"main"),Z.add(n)}}),u&&u.restore(Z,{command:A,name:()=>"@datalayer/jupyter-kernels"}),P.addCommand(Kt.launchRemoteKernel,{label:"Launch a Remote Kernel",caption:"Launch a Notebook with a Remote Kernel",icon:e=>e.isLauncher?w.notebookIcon:o,execute:async()=>{if(n.remote){const e=w.ReactWidget.create((0,r.jsx)(h.Jupyter,{startDefaultKernel:!1,disableCssLoading:!0,children:(0,r.jsx)(j.p,{manager:n.remote,onSubmit:async()=>{e.dispose(),await n.kernels.refreshRunning()},openDocument:"notebook",markdownParser:g??void 0,sanitizer:f??void 0})}));k.Widget.attach(e,document.body),await(0,m.signalToPromise)(e.disposed)}else await P.execute(Kt.createWidget)}}),i&&i.add({command:Kt.launchRemoteKernel,category:"Notebook",kernelIconUrl:`data:image/svg+xml,${l.svgstr}`,rank:-1,args:{isLauncher:!0}}),console.log(`JupyterLab plugin ${Vt.id} is activated.`),E}},Wt=[Vt,Ot,Ft,$t,Tt,le,Ee,Ie,...St,et]},49757:(e,t,n)=>{n.d(t,{iq:()=>f,Ad:()=>x});var s=n(13899),r=n(74901),a=n(50086),i=n(66274),o=n(97930),l=n(76797),c=n(3301);class d extends Error{constructor(e,t){super(e,t),this.name="MaxKernelsError"}}var h=n(83513);class u extends i.BaseManager{_changed=new r.Signal(this);_connectionFailure=new r.Signal(this);_environments=new Array;_isReady=!1;_poll;_ready=new o.PromiseDelegate;constructor({serverSettings:e,standby:t}){super({serverSettings:e}),this._poll=new l.Poll({auto:!1,factory:()=>this.requestEnvironments(),frequency:{interval:61e3,backoff:!0,max:3e5},name:"@datalayer/jupyter-kernels:EnvironmentsManager#environments",standby:t??"when-hidden"}),this._ready.promise.then((async()=>{await this._poll.start(),await this._poll.tick,this._isReady=!0})),this.requestEnvironments().then((()=>{this._ready.resolve()})).catch((e=>{console.error("Failed to fetch the remote environments.",e),this._ready.reject(e)}))}get changed(){return this._changed}get connectionFailure(){return this._connectionFailure}get isReady(){return this._isReady}get ready(){return this._ready.promise}dispose(){this.isDisposed||(this._poll.dispose(),super.dispose())}get(){return[...this._environments]}async refresh(){await this._poll.refresh(),await this._poll.tick}async requestEnvironments(){try{const e=await(0,c.hF)({serverSettings:this.serverSettings});o.JSONExt.deepEqual(this._environments,e)||(this._environments=e,this._changed.emit([...this._environments]))}catch(e){if(e instanceof i.ServerConnection.ResponseError)throw e;this._connectionFailure.emit(e)}}}class p{_isDisposed=!1;_ready;constructor({serverSettings:e,standby:t}){this.serverSettings=e;const n=this.kernels=new i.KernelManager({serverSettings:e,standby:t});this.kernelspecs=new i.KernelSpecManager({serverSettings:e,standby:t}),this.sessions=new i.SessionManager({kernelManager:n,serverSettings:e,standby:t}),this._ready=Promise.all([this.kernels.ready,this.kernelspecs.ready,this.sessions.ready]).then((()=>{}))}get isDisposed(){return this._isDisposed}kernels;kernelspecs;get ready(){return this._ready}serverSettings;sessions;dispose(){this.isDisposed||(this._isDisposed=!0,this.sessions.dispose(),this.kernels.dispose(),this.kernelspecs.dispose())}}class m extends i.BaseManager{_connectionFailure=new r.Signal(this);_disposeStateSubscription=()=>{};_isReady=!1;_poll;_ready=new o.PromiseDelegate;_changed=new r.Signal(this);_kernelServers=new Map;_refreshLock=new Set;constructor({serverSettings:e,standby:t}){super({serverSettings:e}),this._poll=new l.Poll({auto:!1,factory:()=>this.requestKernels(),frequency:{interval:61e3,backoff:!0,max:3e5},name:"@datalayer/jupyter-kernels:KernelManager#kernels",standby:t??"when-hidden"}),this._ready.promise.then((async()=>{this._disposeStateSubscription=h.SE.subscribe((e=>{this._changed.emit([...e.remoteKernels])})),await this._poll.start(),await this._poll.tick,this._isReady=!0})),this.requestKernels().then((()=>{this._ready.resolve()})).catch((e=>{console.error("Failed to fetch the remote kernel servers.",e),this._ready.reject(e)}))}get connectionFailure(){return this._connectionFailure}get isReady(){return this._isReady}get ready(){return this._ready.promise}get changed(){return this._changed}dispose(){this.isDisposed||(this._disposeStateSubscription(),this._poll.dispose(),super.dispose())}get(){return[...h.SE.getState().remoteKernels]}getServices(e){return this._kernelServers.get(e)}async refresh(){await this._poll.refresh(),await this._poll.tick}async startNew(e,t){if(this.isDisposed)throw new Error("Manager is disposed.");const{configuration:n,remoteKernels:s}=h.SE.getState();if("snippet"!==e.kernelType&&s.filter((e=>"snippet"!==e.kernel_type)).length>=n.maxKernels||"snippet"===e.kernelType&&s.filter((e=>"snippet"===e.kernel_type)).length>=n.maxTemporaryKernels)throw new d(`You have reached your ${"snippet"===e.kernelType?"temporary":"persistent"} remote kernels limit.`);const r=new o.PromiseDelegate;let i,l;this._refreshLock.add(r.promise);try{i=await(0,c.cR)({...e,serverSettings:this.serverSettings});const t=i.jupyter_pod_name;l=new p({serverSettings:a.lV(i.ingress,i.token),standby:this._poll.standby}),this._kernelServers.set(t,l)}finally{r.resolve(),this._refreshLock.delete(r.promise)}await l.ready;const u=l.kernels,m=Date.now();for(;u.running().next().done&&Date.now()-m<1e4;)await u.refreshRunning();const g=u.running().next();if(!g.done){const e=g.value,n={...e,...i,name:i.environment_name};return h.SE.getState().addRemoteKernel(n),u.connectTo({...t,model:e})}throw new Error(`No kernel running on server '${i.jupyter_pod_name}'.`)}async findById(e){for(const t of this.get())if(t.id===e)return t;await this.refresh();for(const t of this.get())if(t.id===e)return t}connectTo(e){const{model:{id:t}}=e;let n;for(const e of this.get())if(e.id===t){n=e;break}if(n){const t=this._kernelServers.get(n.jupyter_pod_name);if(t)return t.kernels.connectTo(e)}throw new Error("Unable to find the kernel.")}async shutdown(e){const t=await this.findById(e);if(t){const n=new o.PromiseDelegate;this._refreshLock.add(n.promise);try{const n=this._kernelServers.get(t.jupyter_pod_name);e&&await(n?.kernels.shutdown(e)),await(0,c.Kc)({id:t.jupyter_pod_name,serverSettings:this.serverSettings}),n?.dispose(),this._kernelServers.delete(t.jupyter_pod_name),h.SE.getState().removeRemoteKernel(e)}finally{n.resolve(),this._refreshLock.delete(n.promise)}}}async shutdownAll(){const e=new o.PromiseDelegate;this._refreshLock.add(e.promise);try{await Promise.all(Array.from(this._kernelServers.entries()).map((async([e,t])=>{await t.kernels.shutdownAll(),await(0,c.Kc)({id:e,serverSettings:this.serverSettings}),t.dispose()}))),this._kernelServers.clear(),h.SE.getState().setRemoteKernels([])}finally{e.resolve(),this._refreshLock.delete(e.promise)}}async requestKernels(){for(;this._refreshLock.size;)await Promise.all(this._refreshLock);try{const e=await(0,c.Sj)({serverSettings:this.serverSettings}),t=e.map((e=>e.jupyter_pod_name)),n=Array.from(this._kernelServers.keys());for(const t of e)if(!n.includes(t.jupyter_pod_name)){const e=new p({serverSettings:a.lV(t.ingress,t.token),standby:this._poll.standby});this._kernelServers.set(t.jupyter_pod_name,e),await e.ready}const s=await Promise.all(Array.from(this._kernelServers.entries()).map((async([n,s])=>{if(t.includes(n)){const t=s.kernels.running().next(),r=e.find((e=>e.jupyter_pod_name===n));return t.done?(console.warn(`No kernel in pod ${n}.`),{...r,id:"",name:r?.environment_name,execution_state:"unknown"}):{...r,...t.value,name:r?.environment_name}}await s.kernels.shutdownAll(),s.dispose(),this._kernelServers.delete(n),console.info(`Removing zombie server ${n}`)})));h.SE.getState().setRemoteKernels(s.filter((e=>!!e)))}catch(e){if(e instanceof i.ServerConnection.ResponseError)throw e;this._connectionFailure.emit(e)}}}class g{_isDisposed=!1;_isReady=!1;_ready;constructor({serverSettings:e,standby:t}){this.serverSettings=e,this.environments=new u({serverSettings:e,standby:t}),this.servers=new m({serverSettings:e,standby:t}),this._ready=Promise.all([this.environments.ready,this.servers.ready]).then((()=>{})),this._ready.then((()=>{this._isReady=!0}))}environments;servers;serverSettings;get isDisposed(){return this._isDisposed}get isReady(){return this._isReady}get ready(){return this._ready}dispose(){this.isDisposed||(this._isDisposed=!0,this.environments.dispose(),this.servers.dispose())}}class f{_browserServices;_localServices;_remoteServices;_browserChanged=new r.Signal(this);_remoteChanged=new r.Signal(this);constructor(e){this._localServices=e}get browser(){return this._browserServices}set browser(e){this._browserServices=e,this._browserChanged.emit(this._browserServices)}get browserChanged(){return this._browserChanged}get local(){return this._localServices}get remote(){return this._remoteServices}set remote(e){this._remoteServices=e,this._remoteChanged.emit(this._remoteServices)}get remoteChanged(){return this._remoteChanged}get isReady(){return this._localServices.isReady}get ready(){return this._localServices.ready}get connectionFailure(){return this._localServices.connectionFailure}get isDisposed(){return this._localServices.isDisposed}get builder(){return this._localServices.builder}get contents(){return this._localServices.contents}get events(){return this._localServices.events}get serverSettings(){return this._localServices.serverSettings}get sessions(){return this._localServices.sessions}get kernels(){return this._localServices.kernels}get kernelspecs(){return this._localServices.kernelspecs}get settings(){return this._localServices.settings}get terminals(){return this._localServices.terminals}get user(){return this._localServices.user}get workspaces(){return this._localServices.workspaces}get nbconvert(){return this._localServices.nbconvert}dispose(){this._localServices.dispose()}}async function x(e,t,n,r){e.remote?.serverSettings.baseUrl===t?.apiServerUrl&&n||e.remote&&(e.remote.dispose(),e.remote=void 0),r?.roles.includes(s.UserRoles.User)&&n&&t?.apiServerUrl&&!e.remote&&(e.remote=new g({serverSettings:a.lV(t.apiServerUrl,n)}))}},83513:(e,t,n)=>{n.d(t,{SE:()=>a,ZP:()=>i});var s=n(97930),r=n(4231);const a=(0,n(19992).M)(((e,t)=>({configuration:{maxKernels:5,maxTemporaryKernels:3},setConfiguration:t=>{e((e=>s.JSONExt.deepEqual(e.configuration,t)?{}:{configuration:{...t}}))},setJupyterLabAdapter:t=>{e((e=>({jupyterLabAdapter:t})))},tab:0,getIntTab:()=>Math.floor(t().tab),setTab:t=>e((e=>({tab:t}))),remoteKernels:[],addRemoteKernel:n=>{const s=t().remoteKernels;(s.findIndex((e=>n.id===e.id))??-1)<0&&e({remoteKernels:[...s,n]})},removeRemoteKernel:n=>{const s=[...t().remoteKernels],r=s?.findIndex((e=>n===e.id))??-1;r>=0&&(s.splice(r,1),e({remoteKernels:s}))},setRemoteKernels:n=>{s.JSONExt.deepEqual(t().remoteKernels,n)||e({remoteKernels:[...n]})},serviceManager:void 0,setServiceManager:t=>{e((e=>({serviceManager:t})))},showDisclaimer:!0,setShowDisclaimer:t=>{e((e=>({showDisclaimer:t})))},version:"",setVersion:n=>{n&&!t().version&&e((e=>({version:n})))}}))),i=function(e){return(0,r.useStore)(a,e)}},65693:(e,t,n)=>{n.d(t,{l:()=>s});const s=async({app:e,name:t,url:n,options:s})=>{const r=await e.commands.execute("notebook:create-new",s);if(n){const e=await fetch(n),t=(await e.text()).replaceAll("\n","\n");r.context.model.fromJSON({...JSON.parse(t)})}}},58643:(e,t,n)=>{n.d(t,{C:()=>c,Z:()=>d});var s=n(74512),r=n(12221),a=n(32126),i=n(46722),o=n(57687),l=n(2947);const c="/jupyter/kernels/credits",d=()=>(0,s.jsxs)(r.X,{containerWidth:"xlarge",padding:"normal",sx:{overflow:"visible",minHeight:"calc(100vh - 45px)"},children:[(0,s.jsxs)(r.X.Header,{children:[(0,s.jsx)(o.m,{children:(0,s.jsxs)(o.m.TitleArea,{variant:"large",children:[(0,s.jsx)(o.m.Title,{children:"Credits"}),(0,s.jsx)(o.m.Description,{children:"PREVIEW"})]})}),(0,s.jsx)(a.Z,{children:(0,s.jsx)(i.Z,{children:(0,s.jsx)(a.Z,{children:"This feature is being developed."})})})]}),(0,s.jsx)(r.X.Content,{children:(0,s.jsx)(l.ConstructionIcon,{size:200})})]})}}]);