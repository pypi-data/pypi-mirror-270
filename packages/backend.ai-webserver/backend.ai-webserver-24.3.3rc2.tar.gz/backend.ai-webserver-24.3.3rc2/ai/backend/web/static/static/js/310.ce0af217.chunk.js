"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[310],{23623:(e,s,n)=>{n.d(s,{A:()=>r});var t=n(76998);const l=(e,s,n)=>{const[l,r]=(0,t.useState)(e());return(0,t.useEffect)((()=>{n&&r(e())}),[n]),function(e,s){const n=(0,t.useRef)();(0,t.useEffect)((()=>{n.current=e})),(0,t.useEffect)((()=>{if(null!==s){let e=setInterval((function(){var e;null===(e=n.current)||void 0===e||e.call(n)}),s);return()=>clearInterval(e)}}),[s])}((()=>{const s=e();s!==l&&r(s)}),s),l},r=e=>{let{callback:s,delay:n,triggerKey:t}=e;return l(s,n,t)}},42989:(e,s,n)=>{n.d(s,{A:()=>d});var t=n(66464),l=n(60708),r=n(14455),o=n.n(r),a=n(45901),i=n.n(a),c=(n(76998),n(23446));const d=e=>{let{value:s,onChange:n,localFormat:r,...a}=e;const[,d]=(0,t.A)({value:s,onChange:n});return(0,c.jsx)(l.A,{value:s?o()(s):void 0,onChange:e=>{var s,n,t;i().isArray(e)&&(e=e[0]);const l=r?null===(s=e)||void 0===s?void 0:s.format():null===(n=e)||void 0===n||null===(t=n.tz())||void 0===t?void 0:t.toISOString();d(l)},...a})}},55256:(e,s,n)=>{n.d(s,{Ay:()=>A,Kk:()=>p,p3:()=>x,sT:()=>h,vB:()=>m});var t=n(83468),l=n(5621),r=n(29871),o=n(48713),a=n(45901),i=n.n(a),c=n(76998),d=n(23446);const u=e=>{let{image:s,...n}=e;s=s||"";const[,{getImageAliasName:r,getBaseVersion:o,tagAlias:a}]=(0,t.Gj)();return(0,d.jsx)(l.A,{values:[{label:a(r(s)),color:"blue"},{label:o(s),color:"green"}],...n})},m=e=>{let{image:s,...n}=e;s=s||"";const[,{getBaseVersion:l,tagAlias:r}]=(0,t.Gj)();return(0,d.jsx)(o.A,{color:"green",...n,children:r(l(s))})},h=e=>{let{image:s,...n}=e;s=s||"";const[,{getBaseImage:l,tagAlias:r}]=(0,t.Gj)();return(0,d.jsx)(o.A,{color:"green",...n,children:r(l(s))})},g=e=>{let{image:s,...n}=e;s=s||"";const[,{getArchitecture:l,tagAlias:r}]=(0,t.Gj)();return(0,d.jsx)(o.A,{color:"green",...n,children:r(l(s))})},p=e=>{let{image:s,...n}=e;s=s||"";const[,{getImageLang:l,tagAlias:r}]=(0,t.Gj)();return(0,d.jsx)(o.A,{color:"green",...n,children:r(l(s))})},x=e=>{let{image:s,labels:n,...a}=e;s=s||"",n=n||[];const[,{getFilteredRequirementsTags:c,getCustomTag:u,tagAlias:m}]=(0,t.Gj)();return(0,d.jsxs)(r.A,{children:[i().map(c(s),((e,s)=>(0,d.jsx)(o.A,{color:"blue",...a,children:m(e||"")},s))),(0,d.jsx)(l.A,{color:"cyan",values:[{label:"Customized",color:"cyan"},{label:u(n),color:"cyan"}],...a})]})},v=(e,s)=>{let{image:n,style:t={}}=e;return n=n||"",(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(u,{image:n}),(0,d.jsx)(h,{image:n}),(0,d.jsx)(g,{image:n})]})},A=c.memo(v)},26165:(e,s,n)=>{n.r(s),n.d(s,{default:()=>l});const t={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VFolderPermissionTag_VFolder",selections:[{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null}],type:"VirtualFolder",abstractKey:null,hash:"d3b0f85629ac8c6f45ef363938f66067"},l=t},83310:(e,s,n)=>{n.r(s),n.d(s,{default:()=>Ee});var t=n(25344),l=n(82156),r=n(50840),o=n(6932),a=n(29475),i=n(45901),c=n.n(i),d=n(76998),u=n(23446);const m=e=>{let{status:s="default",extraButtonTitle:n,onClickExtraButton:i,extra:d,style:m,...h}=e;const{token:g}=r.A.useToken(),p=d||n&&(0,u.jsx)(o.Ay,{type:"link",icon:"error"===s?(0,u.jsx)(t.A,{twoToneColor:g.colorError}):"warning"===s?(0,u.jsx)(l.A,{twoToneColor:g.colorWarning}):void 0,onClick:i,children:n})||void 0;return(0,u.jsx)(a.A,{style:c().extend(m,{borderColor:"error"===s?g.colorError:"warning"===s?g.colorWarning:"success"===s?g.colorSuccess:null===m||void 0===m?void 0:m.borderColor}),extra:p,...h})};var h=n(23623),g=n(42989),p=n(5621),x=n(29871),v=n(94080),A=n(5336),j=n(65080),y=n(82028),f=n(77678);const b=e=>{let{formItemProps:s,...n}=e;const t=(0,d.useRef)(null),{t:l}=(0,f.Bd)(),r=j.A.useFormInstance();return(0,u.jsx)(j.A.List,{...n,children:(e,a)=>{let{add:i,remove:d}=a;return(0,u.jsxs)(x.A,{direction:"column",gap:"xs",align:"stretch",children:[e.map(((o,a)=>{let{key:i,name:m,...h}=o;return(0,u.jsxs)(x.A,{direction:"row",align:"baseline",gap:"xs",children:[(0,u.jsx)(j.A.Item,{...h,style:{marginBottom:0,flex:1},name:[m,"variable"],rules:[{required:!0,message:l("session.launcher.EnterEnvironmentVariable")},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,message:l("session.launcher.EnvironmentVariableNamePatternError")},e=>{let{getFieldValue:s}=e;return{validator(e,t){const r=c().map(s(n.name),(e=>null===e||void 0===e?void 0:e.variable));return!c().isEmpty(t)&&r.length>0&&c().filter(r,(e=>e===t)).length>1?Promise.reject(l("session.launcher.EnvironmentVariableDuplicateName")):Promise.resolve()}}}],...s,children:(0,u.jsx)(y.A,{ref:a===e.length-1?t:null,placeholder:"Variable",onChange:()=>{const s=e.map(((e,s)=>[n.name,s,"variable"]));r.validateFields(s)}})}),(0,u.jsx)(j.A.Item,{...h,name:[m,"value"],style:{marginBottom:0,flex:1},rules:[{required:!0,message:l("session.launcher.EnvironmentVariableValueRequired")}],validateTrigger:["onChange","onBlur"],children:(0,u.jsx)(y.A,{placeholder:"Value"})}),(0,u.jsx)(v.A,{onClick:()=>d(m)})]},i)})),(0,u.jsx)(j.A.Item,{noStyle:!0,children:(0,u.jsx)(o.Ay,{type:"dashed",onClick:()=>{i(),setTimeout((()=>{t.current&&t.current.focus()}),0)},icon:(0,u.jsx)(A.A,{}),block:!0,children:l("session.launcher.AddEnvironmentVariable")})})]})}})};var F=n(85676),w=n(35051),C=n(55256),V=n(16788),k=n(83468),S=n(30217),T=n(48713);const I=e=>{let{value:s,...n}=e;const t=parseInt(s),l=t>=1024&&t<=65535;return(0,u.jsx)(T.A,{color:l?void 0:"red",...n})},E=e=>{let{...s}=e;const{t:n}=(0,f.Bd)(),t=(0,k.CX)();return(0,u.jsx)(j.A.Item,{label:n("session.launcher.PreOpenPortTitle"),name:"ports",tooltip:(0,u.jsx)(f.x6,{i18nKey:"session.launcher.DescSetPreOpenPort"}),extra:n("session.launcher.PreOpenPortRangeGuide"),rules:[{max:t._config.maxCountForPreopenPorts,type:"array",message:n("session.launcher.PreOpenPortMaxCountLimit",{count:t._config.maxCountForPreopenPorts})},e=>{let{getFieldValue:s}=e;return{validator:(e,s)=>c().every(s,(e=>{const s=parseInt(e);return s>=1024&&s<=65535}))?Promise.resolve():Promise.reject(new Error(n("session.launcher.PreOpenPortRange")))}}],...s,children:(0,u.jsx)(S.A,{mode:"tags",tagRender:e=>(0,u.jsx)(I,{closable:e.closable,onClose:e.onClose,onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},value:e.value,children:e.label}),style:{width:"100%"},suffixIcon:null,open:!1,tokenSeparators:[","," "]})})};var P=n(97443),N=n(8469);const M=e=>{let{...s}=e;const{t:n}=(0,f.Bd)();return(0,u.jsx)(j.A.Item,{label:n("session.launcher.SessionName"),name:"sessionName",rules:[{min:4,message:n("session.Validation.SessionNameTooShort")},{max:64,message:n("session.Validation.SessionNameTooLong64")},{validator:(e,s)=>c().isEmpty(s)?Promise.resolve():/^\w/.test(s)?/^[\w.-]*$/.test(s)?!/\w$/.test(s)&&s.length>=4?Promise.reject(n("session.Validation.SessionNameShouldEndWith")):Promise.resolve():Promise.reject(n("session.Validation.SessionNameInvalidCharacter")):Promise.reject(n("session.Validation.SessionNameShouldStartWith"))}],...s,children:(0,u.jsx)(y.A,{allowClear:!0,autoComplete:"off"})})};var _,D=n(30032),z=n(57857),O=n(73987),B=n(91412),R=n(81638),L=n(3606);const K=e=>{let{vFolderFrgmt:s=null,permission:t}=e;const l=(0,L.useFragment)(void 0!==_?_:_=n(26165),s),r=c().chain({r:"green",w:"blue",d:"red"}).map(((e,s)=>{if(((e,s)=>!(null===e||void 0===e||!e.includes(s))||!(null===e||void 0===e||!e.includes("w")||"r"!==s))((null===l||void 0===l?void 0:l.permission)||t,s))return{label:s.toUpperCase(),color:e}})).compact().value();return(0,u.jsx)(p.A,{values:r})};var W=n(71155),q=n(8925),G=n(93792),U=n(66464),H=n(13279),J=n(20307),Z=n(14862),Q=n(22307),$=n(14455),X=n.n($);const Y=/^[a-zA-Z0-9_/-]*$/,ee=e=>{let{filter:s,showAliasInput:n=!1,selectedRowKeys:t=[],onChangeSelectedRowKeys:l,aliasBasePath:r="/home/work/",aliasMap:a,onChangeAliasMap:i,rowKey:m="name",onChangeAutoMountedFolders:h,showAutoMountedFoldersSection:g,...p}=e;const v=d.useMemo((()=>e=>e&&e[m]),[m]),[A,b]=(0,U.A)({value:t,onChange:l},{defaultValue:[]}),[F,w]=(0,U.A)({value:a,onChange:i},{defaultValue:{}}),[C]=j.A.useForm();(0,d.useEffect)((()=>{F&&(C.setFieldsValue(c().mapValues(F,(e=>e.startsWith(r)?e.slice(r.length):e))),C.validateFields())}),[F,C,r]);const{t:V}=(0,f.Bd)(),S=(0,D.QE)(),I=(0,k.hd)(),[E,P]=(0,k.Tw)("first"),[N,M]=(0,d.useTransition)(),{data:_}=(0,z.n)({queryKey:["VFolderSelectQuery",E,I.id],queryFn:()=>S({method:"GET",url:"/folders?group_id=".concat(I.id)}),staleTime:0}),L=(0,d.useMemo)((()=>c().chain(_).filter((e=>{var s;return"ready"===e.status&&(null===(s=e.name)||void 0===s?void 0:s.startsWith("."))})).map((e=>e.name)).value()),[_]);(0,d.useEffect)((()=>{c().isFunction(h)&&h(L)}),[L]);const[$,ee]=(0,d.useState)(""),se=c().chain(_).filter((e=>!s||s(e))).filter((e=>!!A.includes(v(e))||(!$||e.name.includes($)))).value(),ne=(0,O.E)(((e,s)=>c().isEmpty(s)?"".concat(r).concat(e):null!==s&&void 0!==s&&s.startsWith("/")?s:"".concat(r).concat(s))),te=(0,O.E)((()=>{w(c().mapValues(c().pickBy(C.getFieldsValue(),(e=>!!e)),((e,s)=>ne(s,e)))),C.validateFields().catch((()=>{}))}));(0,d.useEffect)((()=>{te()}),[JSON.stringify(A),te]);const le=(0,B.useShadowRoot)(),re=[{title:(0,u.jsxs)(x.A,{direction:"row",gap:"xxs",children:[(0,u.jsx)(H.A.Text,{children:V("data.folders.Name")}),n&&(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(H.A.Text,{type:"secondary",style:{fontWeight:"normal"},children:["(",V("session.launcher.FolderAlias")," ",(0,u.jsx)(J.A,{title:(0,u.jsx)(f.x6,{i18nKey:"session.launcher.DescFolderAlias"}),getPopupContainer:()=>le,children:(0,u.jsx)(W.A,{})}),")"]})})]}),dataIndex:"name",sorter:(e,s)=>e.name.localeCompare(s.name),render:(e,s)=>{const t=A.includes(v(s));return(0,u.jsxs)(x.A,{direction:"column",align:"stretch",gap:"xxs",style:n&&t?{display:"inline-flex",height:70,width:"100%"}:{maxWidth:200},children:[(0,u.jsx)(R.A,{keyword:$,children:e}),n&&t&&(0,u.jsx)(j.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>e[v(s)]!==n[v(s)],children:()=>{const e=c()(A).reduce(((e,s)=>(e[s]=(null===F||void 0===F?void 0:F[s])||ne(s,void 0),e)),{});return(0,u.jsx)(j.A.Item,{name:v(s),rules:[{type:"string",pattern:Y,message:V("session.launcher.FolderAliasInvalid")},{type:"string",validator:async(n,t)=>t&&c().some(e,((e,n)=>n!==v(s)&&e===ne(v(s),t)))?Promise.reject(V("session.launcher.FolderAliasOverlapping")):Promise.resolve()}],extra:ne(s.name,C.getFieldValue(v(s))),children:(0,u.jsx)(y.A,{onClick:e=>{e.stopPropagation()},placeholder:V("session.launcher.FolderAlias"),allowClear:!0,onChange:()=>{te()}})})}})]})}},{title:V("data.UsageMode"),dataIndex:"usage_mode",sorter:(e,s)=>e.usage_mode.localeCompare(s.usage_mode)},{title:V("data.Host"),dataIndex:"host"},{title:V("data.Type"),dataIndex:"type",sorter:(e,s)=>e.type.localeCompare(s.type),render:(e,s)=>(0,u.jsxs)(x.A,{direction:"column",children:["user"===s.type?(0,u.jsx)(q.A,{title:"User"}):(0,u.jsx)("div",{children:"Group"}),"group"===s.type&&"(".concat(s.group_name,")")]})},{title:V("data.Permission"),dataIndex:"permission",sorter:(e,s)=>e.permission.localeCompare(s.permission),render:(e,s)=>(0,u.jsx)(K,{permission:s.permission})},{title:V("data.Created"),dataIndex:"created_at",sorter:(e,s)=>e.created_at.localeCompare(s.created_at),render:(e,s)=>X()(e).format("L")}];return(0,u.jsxs)(x.A,{direction:"column",align:"stretch",gap:"xs",children:[(0,u.jsxs)(x.A,{direction:"row",gap:"xs",justify:"between",children:[(0,u.jsx)(y.A,{value:$,onChange:e=>ee(e.target.value),allowClear:!0,placeholder:V("data.SearchByName")}),(0,u.jsx)(o.Ay,{loading:N,icon:(0,u.jsx)(G.A,{}),onClick:()=>{M((()=>{P()}))}})]}),(0,u.jsx)(j.A,{form:C,component:!1,children:(0,u.jsx)(Z.A,{scroll:{x:"max-content"},rowKey:v,rowSelection:{selectedRowKeys:A,onChange:e=>{b(e)}},showSorterTooltip:!1,columns:re,dataSource:se,onRow:(e,s)=>({onClick:s=>{var n;const t=s.target;null!==t&&void 0!==t&&null!==(n=t.classList)&&void 0!==n&&n.contains("ant-table-selection-column")&&(s.stopPropagation(),A.includes(v(e))?b(A.filter((s=>s!==v(e)))):b([...A,v(e)]))}}),...p})}),g&&L.length>0?(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(Q.A,{size:"small",children:(0,u.jsx)(Q.A.Item,{label:V("data.AutomountFolders"),children:c().map(L,(e=>(0,u.jsx)(T.A,{children:e})))})})}):null]})},se=e=>{let{filter:s,...n}=e;const t=j.A.useFormInstance(),{t:l}=(0,f.Bd)();return j.A.useWatch("vfoldersAliasMap",t),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(j.A.Item,{hidden:!0,name:"vfoldersAliasMap",rules:[{validator(e,s){const n=c().chain(t.getFieldValue("mounts")).reduce(((e,n)=>(e[n]=s[n]||"/home/work/"+n,e)),{}).values().value();return c().uniq(n).length!==n.length?Promise.reject(l("session.launcher.FolderAliasOverlapping")):c().some(n,(e=>!Y.test(e)))?Promise.reject(l("session.launcher.FolderAliasInvalid")):Promise.resolve()}}],children:(0,u.jsx)(y.A,{})}),(0,u.jsx)(j.A.Item,{hidden:!0,name:"autoMountedFolderNames"}),(0,u.jsx)(j.A.Item,{name:"mounts",...n,valuePropName:"selectedRowKeys",trigger:"onChangeSelectedRowKeys",children:(0,u.jsx)(ee,{rowKey:"name",showAliasInput:!0,aliasMap:t.getFieldValue("vfoldersAliasMap"),onChangeAliasMap:e=>{t.setFieldValue("vfoldersAliasMap",e),t.validateFields(["vfoldersAliasMap"])},pagination:!1,filter:s,showAutoMountedFoldersSection:!0,onChangeAutoMountedFolders:e=>{t.setFieldValue("autoMountedFolderNames",e)}})})]})};var ne=n(21454),te=n(90660);var le=n(21186),re=n(15618),oe=n(78474),ae=n(42290),ie=n(40718),ce=n(76108),de=n(12620),ue=n(33554),me=n(41814),he=n(17480),ge=n(87627),pe=n(82745),xe=n(7518),ve=n(9788),Ae=n(91409),je=n(41856),ye=n(59065),fe=n(67970),be=n(34515),Fe=n(81365),we=n(6592),Ce=n(52276),Ve=n(44442),ke=n(58346);const Se=e=>{let{form:s,containerCount:n=1}=e;return(0,u.jsxs)(u.Fragment,{children:[c().map(c().omit(s.getFieldsValue().resource,"shmem","accelerator","acceleratorType"),((e,t)=>{var l,r;return(0,u.jsx)(N.Ay,{type:t,value:"mem"===t?((null===(l=(0,D.Js)(e,"b"))||void 0===l?void 0:l.number)||0)*n+"":c().toNumber(e)*n+"",opts:{shmem:s.getFieldValue("resource").shmem?((null===(r=(0,D.Js)(s.getFieldValue("resource").shmem,"b"))||void 0===r?void 0:r.number)||0)*n:void 0}},t)})),c().isNumber(s.getFieldValue(["resource","accelerator"]))&&s.getFieldValue(["resource","acceleratorType"])&&(0,u.jsx)(N.Ay,{type:s.getFieldValue(["resource","acceleratorType"]),value:c().toString(s.getFieldValue(["resource","accelerator"])*n)})]})},Te=()=>{let e="";const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<8;n++)e+=s.charAt(Math.floor(62*Math.random()));return e+"-session"},Ie=()=>{let e=Math.floor(52*Math.random()*52*52);let s="";for(let t=0;t<3;t++)s+=(n=e%52)<26?String.fromCharCode(65+n):String.fromCharCode(97+n-26),e=Math.floor(e/52);var n;return s},Ee=()=>{var e,s,n,t,l,i,v,A,N,_,z,O,B,R,L,K,q;const G=de.A.useApp();let U="normal";const $=(0,Ve.vc)(V.i7),Y=(0,k.CX)(),[ee,Ee]=(0,d.useState)(!1),Pe={sessionType:"interactive",allocationPreset:"auto-preset",hpcOptimization:{autoEnabled:!0,OMP_NUM_THREADS:"1",OPENBLAS_NUM_THREADS:"1"},batch:{enabled:!1,command:void 0,scheduleDate:void 0},envvars:[],...(null===(e=Y._config)||void 0===e?void 0:e.default_session_environment)&&{environments:{environment:null===(s=Y._config)||void 0===s?void 0:s.default_session_environment}},...P.jh},Ne=(0,ke.withDefault)(ke.NumberParam,0),Me=(0,ke.withDefault)(ke.JsonParam,Pe),[{step:_e,formValues:De,redirectTo:ze},Oe]=(0,ke.useQueryParams)({step:Ne,formValues:Me,redirectTo:ke.StringParam}),{isDarkMode:Be}=(0,te.e)(),Re=(0,Fe.Zp)(),Le=(0,k.f0)(),Ke=(0,k.hd)(),{upsertNotification:We}=(0,ne.js)(),{run:qe}=(0,ce.A)((()=>{Oe({formValues:c().omit(Ze.getFieldsValue(),["environments.image"],["environments.customizedTag"],["autoMountedFolderNames"])},"replaceIn")}),{leading:!1,wait:500,trailing:!0}),Ge=e=>{Oe({step:e},"pushIn")},{token:Ue}=r.A.useToken(),{t:He}=(0,f.Bd)(),Je=ue.Ay.useBreakpoint(),[Ze]=j.A.useForm();(0,d.useEffect)((()=>{JSON.stringify(Pe)!==JSON.stringify(De)&&(Ze.setFieldsValue(De),Ze.validateFields().catch((e=>{})))}),[]),(0,d.useEffect)((()=>{var e;null===(e=$.current)||void 0===e||e.scrollTo(0,0)}),[_e]);const Qe=j.A.useWatch("sessionType",{form:Ze,preserve:!0})||Ze.getFieldValue("sessionType")||De.sessionType,$e=c().filter([{title:He("session.launcher.SessionType"),key:"sessionType"},{title:"".concat(He("session.launcher.Environments")," & ").concat(He("session.launcher.ResourceAllocation")," "),key:"environment"},"inference"!==Qe&&{title:He("webui.menu.Data&Storage"),key:"storage"},{title:He("session.launcher.Network"),key:"network"},{title:He("session.launcher.ConfirmAndLaunch"),icon:(0,u.jsx)(le.A,{}),key:"review"}],(e=>!!e)),Xe=null===(n=$e[_e])||void 0===n?void 0:n.key,Ye=c().some(Ze.getFieldsError(),(e=>e.errors.length>0)),[,es]=(0,k.Tw)("first");(0,d.useEffect)((()=>{_e===$e.length-1&&Ze.validateFields().catch((()=>{})).finally((()=>es()))}),[_e,Ze,es,$e.length]);return(0,u.jsxs)(x.A,{direction:"column",align:"stretch",style:{justifyContent:"revert"},gap:"md",children:[(0,u.jsx)("style",{children:".session-type-radio-group .ant-radio {\n  align-self: flex-start;\n  margin-top: 2px;\n}\n"}),ze&&(0,u.jsx)(me.A,{items:[{title:He("webui.menu.Sessions"),onClick:e=>{e.preventDefault(),Le(ze)},href:ze},{title:He("session.launcher.StartNewSession")}]}),(0,u.jsxs)(x.A,{direction:"row",gap:"md",align:"start",children:[(0,u.jsx)(x.A,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:(0,u.jsx)(j.A.Provider,{onFormChange:(e,s)=>{qe()},children:(0,u.jsx)(j.A,{form:Ze,layout:"vertical",requiredMark:"optional",initialValues:Pe,children:(0,u.jsxs)(x.A,{direction:"column",align:"stretch",gap:"md",children:[(0,u.jsxs)(a.A,{title:He("session.launcher.SessionType"),style:{display:"sessionType"===Xe?"block":"none"},children:[(0,u.jsx)(j.A.Item,{name:"sessionType",children:(0,u.jsx)(he.Ay.Group,{className:"session-type-radio-group",options:[{label:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(H.A.Text,{code:!0,children:He("session.launcher.InteractiveMode")})," ",(0,u.jsx)(H.A.Text,{type:"secondary",children:He("session.launcher.InteractiveModeDesc")})]}),value:"interactive"},{label:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(H.A.Text,{code:!0,children:He("session.launcher.BatchMode")})," ",(0,u.jsx)(H.A.Text,{type:"secondary",children:He("session.launcher.BatchModeDesc")})]}),value:"batch"}]})}),(0,u.jsx)(M,{})]}),"batch"===Qe&&(0,u.jsxs)(a.A,{title:He("session.launcher.BatchModeConfig"),style:{display:"sessionType"===Xe?"block":"none"},children:[(0,u.jsx)(j.A.Item,{label:He("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0,type:"string"}],children:(0,u.jsx)(y.A.TextArea,{autoSize:!0})}),(0,u.jsx)(j.A.Item,{label:He("session.launcher.SessionStartTime"),extra:(0,u.jsx)(j.A.Item,{noStyle:!0,shouldUpdate:(e,s)=>e.batch.scheduleDate!==s.batch.scheduleDate,children:()=>{const e=Ze.getFieldValue(["batch","scheduleDate"]);return(0,u.jsx)(h.A,{delay:1e3,callback:()=>{const e=Ze.getFieldValue(["batch","scheduleDate"]);return e?X()(e).isBefore(X()())?void(0===Ze.getFieldError(["batch","scheduleDate"]).length&&Ze.validateFields([["batch","scheduleDate"]])):X()(e).fromNow():void 0},triggerKey:e||"none"})}}),children:(0,u.jsxs)(x.A,{direction:"row",gap:"xs",children:[(0,u.jsx)(j.A.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,u.jsx)(ge.A,{onChange:e=>{e.target.checked&&c().isEmpty(Ze.getFieldValue(["batch","scheduleDate"]))?Ze.setFieldValue(["batch","scheduleDate"],X()().add(2,"minutes").toISOString()):!1===e.target.checked&&Ze.setFieldValue(["batch","scheduleDate"],void 0),Ze.validateFields([["batch","scheduleDate"]])},children:He("session.launcher.Enable")})}),(0,u.jsx)(j.A.Item,{noStyle:!0,shouldUpdate:(e,s)=>{var n,t;return(null===(n=e.batch)||void 0===n?void 0:n.enabled)!==(null===(t=s.batch)||void 0===t?void 0:t.enabled)},children:()=>{var e;const s=!0!==(null===(e=Ze.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(j.A.Item,{name:["batch","scheduleDate"],noStyle:!0,rules:[{validator:async(e,s)=>s&&X()(s).isBefore(X()())?Promise.reject(He("session.launcher.StartTimeMustBeInTheFuture")):Promise.resolve()}],children:(0,u.jsx)(g.A,{disabled:s,showTime:!0,localFormat:!0,disabledDate:e=>e.isBefore(X()().startOf("day"))})})})}})]})})]}),"inference"===Qe&&(0,u.jsx)(a.A,{title:"Inference Mode Configuration",children:(0,u.jsx)(j.A.Item,{name:["inference","vFolderName"],label:He("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,u.jsx)(S.A,{})})}),(0,u.jsxs)(a.A,{title:He("session.launcher.Environments"),style:{display:"environment"===Xe?"block":"none"},children:[(0,u.jsx)(be.tH,{fallbackRender:e=>(console.log(e),null),children:(0,u.jsx)(F.A,{})}),(0,u.jsx)(j.A.Item,{label:He("session.launcher.EnvironmentVariable"),children:(0,u.jsx)(b,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,u.jsx)(a.A,{title:He("session.launcher.ResourceAllocation"),style:{display:"environment"===Xe?"block":"none"},children:(0,u.jsx)(P.Ay,{enableNumOfSessions:!0,enableResourcePresets:!0})}),(0,u.jsxs)(a.A,{title:He("session.launcher.HPCOptimization"),style:{display:"environment"===Xe?"block":"none"},children:[(0,u.jsx)(j.A.Item,{noStyle:!0,children:(0,u.jsxs)(x.A,{direction:"row",gap:"sm",children:[(0,u.jsx)(H.A.Text,{children:He("session.launcher.SwitchOpenMPoptimization")}),(0,u.jsx)(j.A.Item,{label:He("session.launcher.SwitchOpenMPoptimization"),name:["hpcOptimization","autoEnabled"],valuePropName:"checked",required:!0,noStyle:!0,children:(0,u.jsx)(pe.A,{checkedChildren:"ON",unCheckedChildren:"OFF",onChange:e=>{e&&Ze.setFieldsValue(c().pick(Pe,["hpcOptimization"]))}})})]})}),(0,u.jsx)(j.A.Item,{noStyle:!0,shouldUpdate:(e,s)=>{var n,t;return(null===(n=e.hpcOptimization)||void 0===n?void 0:n.autoEnabled)!==(null===(t=s.hpcOptimization)||void 0===t?void 0:t.autoEnabled)},children:()=>{const e=Ze.getFieldValue(["hpcOptimization","autoEnabled"]);return(0,u.jsxs)(xe.A,{gutter:Ue.marginMD,style:{display:e?"none":void 0,marginTop:Ue.marginMD},children:[(0,u.jsx)(ve.A,{xs:24,sm:12,children:(0,u.jsx)(j.A.Item,{style:{flex:1},label:He("session.launcher.NumOpenMPthreads"),name:["hpcOptimization","OMP_NUM_THREADS"],tooltip:(0,u.jsxs)(u.Fragment,{children:[He("session.launcher.OpenMPOptimization"),(0,u.jsx)(f.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,u.jsx)(Ae.A,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})}),(0,u.jsx)(ve.A,{xs:24,sm:12,children:(0,u.jsx)(j.A.Item,{style:{flex:1},label:He("session.launcher.NumOpenBLASthreads"),name:["hpcOptimization","OPENBLAS_NUM_THREADS"],tooltip:(0,u.jsxs)(u.Fragment,{children:[He("session.launcher.OpenMPOptimization"),(0,u.jsx)(f.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,u.jsx)(Ae.A,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})})]})}})]}),(0,u.jsx)(a.A,{title:He("webui.menu.Data&Storage"),style:{display:"storage"===Xe?"block":"none"},children:(0,u.jsx)(se,{filter:e=>{var s;return"ready"===e.status&&!(null!==(s=e.name)&&void 0!==s&&s.startsWith("."))}})}),(0,u.jsx)(a.A,{title:He("session.launcher.Network"),style:{display:"network"===Xe?"block":"none"},children:(0,u.jsx)(E,{})}),"review"===Xe&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(m,{title:He("session.launcher.SessionType"),size:"small",status:Ze.getFieldError("sessionName").length>0||Ze.getFieldError(["batch","command"]).length>0||Ze.getFieldError(["batch","scheduleDate"]).length>0?"error":void 0,extraButtonTitle:He("button.Edit"),onClickExtraButton:()=>{Ge($e.findIndex((e=>"sessionType"===e.key)))},children:(0,u.jsxs)(Q.A,{size:"small",column:1,children:[(0,u.jsx)(Q.A.Item,{label:He("session.SessionType"),children:Ze.getFieldValue("sessionType")}),!c().isEmpty(Ze.getFieldValue("sessionName"))&&(0,u.jsx)(Q.A.Item,{label:He("session.launcher.SessionName"),children:Ze.getFieldValue("sessionName")}),"batch"===Qe&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(Q.A.Item,{label:He("session.launcher.StartUpCommand"),children:Ze.getFieldValue(["batch","command"])?(0,u.jsx)(we.A,{style:Be?Ce.A:void 0,language:"shell",customStyle:{margin:0,width:"100%"},children:Ze.getFieldValue(["batch","command"])}):(0,u.jsx)(H.A.Text,{type:"secondary",children:He("general.None")})}),(0,u.jsx)(Q.A.Item,{label:He("session.launcher.ScheduleTimeSimple"),children:Ze.getFieldValue(["batch","scheduleDate"])?X()(Ze.getFieldValue(["batch","scheduleDate"])).format("LLL (Z)"):(0,u.jsx)(H.A.Text,{type:"secondary",children:He("general.None")})})]})]})}),(0,u.jsx)(m,{title:He("session.launcher.Environments"),size:"small",status:c().some(Ze.getFieldValue("envvars"),((e,s)=>Ze.getFieldError(["envvars",s,"variable"]).length>0||Ze.getFieldError(["envvars",s,"value"]).length>0))?"error":void 0,extraButtonTitle:He("button.Edit"),onClickExtraButton:()=>{Ge($e.findIndex((e=>"environment"===e.key)))},children:(0,u.jsxs)(Q.A,{size:"small",column:1,children:[(0,u.jsx)(Q.A.Item,{label:He("session.launcher.Project"),children:Ke.name}),(0,u.jsx)(Q.A.Item,{label:He("general.Image"),children:(0,u.jsxs)(x.A,{direction:"row",gap:"xs",style:{flex:1},children:[(0,u.jsx)(w.A,{image:(null===(t=Ze.getFieldValue("environments"))||void 0===t?void 0:t.version)||(null===(l=Ze.getFieldValue("environments"))||void 0===l?void 0:l.manual)}),(0,u.jsx)(x.A,{direction:"row",children:null!==(i=Ze.getFieldValue("environments"))&&void 0!==i&&i.manual?(0,u.jsx)(H.A.Text,{copyable:!0,code:!0,children:null===(v=Ze.getFieldValue("environments"))||void 0===v?void 0:v.manual}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(C.Ay,{image:null===(A=Ze.getFieldValue("environments"))||void 0===A?void 0:A.version}),null!==(N=Ze.getFieldValue("environments"))&&void 0!==N&&N.customizedTag?(0,u.jsx)(p.A,{values:[{label:"Customized",color:"cyan"},{label:null===(_=Ze.getFieldValue("environments"))||void 0===_?void 0:_.customizedTag,color:"cyan"}]}):null,(0,u.jsx)(H.A.Text,{copyable:{text:null===(z=Ze.getFieldValue("environments"))||void 0===z?void 0:z.version}})]})})]})}),(null===(O=Ze.getFieldValue("envvars"))||void 0===O?void 0:O.length)>0&&(0,u.jsx)(Q.A.Item,{label:He("session.launcher.EnvironmentVariable"),children:null!==(B=Ze.getFieldValue("envvars"))&&void 0!==B&&B.length?(0,u.jsx)(we.A,{style:Be?Ce.A:void 0,codeTagProps:{style:{}},customStyle:{margin:0,width:"100%"},children:c().map(Ze.getFieldValue("envvars"),(e=>"".concat((null===e||void 0===e?void 0:e.variable)||"",'="').concat((null===e||void 0===e?void 0:e.value)||"",'"'))).join("\n")}):(0,u.jsx)(H.A.Text,{type:"secondary",children:"-"})})]})}),(0,u.jsx)(m,{title:He("session.launcher.ResourceAllocation"),status:c().some(Ze.getFieldValue("resource"),((e,s)=>Ze.getFieldError(["resource",s]).length>0))||Ze.getFieldError(["num_of_sessions"]).length>0||Ze.getFieldError("resourceGroup").length>0?"error":void 0,size:"small",extraButtonTitle:He("button.Edit"),onClickExtraButton:()=>{Ge($e.findIndex((e=>"environment"===e.key)))},children:(0,u.jsxs)(x.A,{direction:"column",align:"stretch",children:[c().some(null===(R=Ze.getFieldValue("resource"))||void 0===R?void 0:R.resource,((e,s)=>Ze.getFieldWarning(["resource",s]).length>0))&&(0,u.jsx)(je.A,{type:"warning",showIcon:!0,message:He("session.launcher.EnqueueComputeSessionWarning")}),(0,u.jsxs)(Q.A,{column:2,children:[(0,u.jsx)(Q.A.Item,{label:He("general.ResourceGroup"),span:2,children:Ze.getFieldValue("resourceGroup")||(0,u.jsx)(H.A.Text,{type:"secondary",children:He("general.None")})}),(0,u.jsx)(Q.A.Item,{label:He("session.launcher.ResourceAllocationPerContainer"),span:2,children:(0,u.jsxs)(x.A,{direction:"row",align:"start",gap:"sm",wrap:"wrap",style:{flex:1},children:["custom"===Ze.getFieldValue("allocationPreset")?"":(0,u.jsx)(T.A,{children:Ze.getFieldValue("allocationPreset")}),(0,u.jsx)(Se,{form:Ze})]})}),(0,u.jsx)(Q.A.Item,{label:He("session.launcher.NumberOfContainer"),children:1===Ze.getFieldValue("cluster_size")?Ze.getFieldValue("num_of_sessions"):Ze.getFieldValue("cluster_size")}),(0,u.jsx)(Q.A.Item,{label:He("session.launcher.ClusterMode"),children:"single-node"===Ze.getFieldValue("cluster_mode")?He("session.launcher.SingleNode"):He("session.launcher.MultiNode")})]}),(0,u.jsx)(a.A,{size:"small",type:"inner",title:He("session.launcher.TotalAllocation"),children:(0,u.jsx)(x.A,{direction:"row",gap:"xxs",children:(0,u.jsx)(Se,{form:Ze,containerCount:1===Ze.getFieldValue("cluster_size")?Ze.getFieldValue("num_of_sessions"):Ze.getFieldValue("cluster_size")})})})]})}),(0,u.jsx)(m,{title:He("webui.menu.Data&Storage"),size:"small",status:Ze.getFieldError("vfoldersAliasMap").length>0?"error":void 0,extraButtonTitle:He("button.Edit"),onClickExtraButton:()=>{Ge($e.findIndex((e=>"storage"===e.key)))},children:(0,u.jsxs)(x.A,{direction:"column",align:"stretch",gap:"xs",children:[(null===(L=Ze.getFieldValue("mounts"))||void 0===L?void 0:L.length)>0?(0,u.jsx)(Z.A,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:He("data.folders.Name")},{dataIndex:"alias",title:He("session.launcher.FolderAlias"),render:(e,s)=>c().isEmpty(e)?(0,u.jsx)(H.A.Text,{type:"secondary",style:{opacity:.7},children:"/home/work/".concat(s.name)}):e}],dataSource:c().map(Ze.getFieldValue("mounts"),(e=>{var s;return{name:e,alias:null===(s=Ze.getFieldValue("vfoldersAliasMap"))||void 0===s?void 0:s[e]}}))}):(0,u.jsx)(je.A,{type:"warning",showIcon:!0,message:He("session.launcher.NoFolderMounted")}),(null===(K=Ze.getFieldValue("autoMountedFolderNames"))||void 0===K?void 0:K.length)>0?(0,u.jsx)(Q.A,{size:"small",children:(0,u.jsx)(Q.A.Item,{label:He("data.AutomountFolders"),children:c().map(Ze.getFieldValue("autoMountedFolderNames"),(e=>(0,u.jsx)(T.A,{children:e})))})}):null]})}),(0,u.jsx)(m,{title:"Network",size:"small",status:Ze.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:He("button.Edit"),onClickExtraButton:()=>{Ge($e.findIndex((e=>"network"===e.key)))},children:(0,u.jsx)(Q.A,{size:"small",children:(0,u.jsx)(Q.A.Item,{label:He("session.launcher.PreOpenPortTitle"),children:(0,u.jsxs)(x.A,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[c().sortBy(Ze.getFieldValue("ports"),(e=>parseInt(e))).map((e=>(0,u.jsx)(I,{value:e,style:{margin:0},children:e}))),c().isArray(Ze.getFieldValue("ports"))&&0!==(null===(q=Ze.getFieldValue("ports"))||void 0===q?void 0:q.length)?null:(0,u.jsx)(H.A.Text,{type:"secondary",children:He("general.None")})]})})})})]}),(0,u.jsxs)(x.A,{direction:"row",justify:"between",children:[(0,u.jsx)(x.A,{gap:"sm",children:(0,u.jsx)(ye.A,{title:He("button.Reset"),description:He("session.launcher.ResetFormConfirm"),onConfirm:()=>{Ze.resetFields(),Re("/session/start")},icon:(0,u.jsx)(W.A,{style:{color:Ue.colorError}}),okText:He("button.Reset"),okButtonProps:{danger:!0},children:(0,u.jsx)(o.Ay,{danger:!0,type:"link",style:{paddingRight:0,paddingLeft:0},children:He("button.Reset")})})}),(0,u.jsxs)(x.A,{direction:"row",gap:"sm",children:[_e>0&&(0,u.jsx)(o.Ay,{onClick:()=>{Ge(_e-1)},icon:(0,u.jsx)(re.A,{}),disabled:ee,children:He("button.Previous")}),_e===$e.length-1?(0,u.jsx)(J.A,{title:Ye?He("session.launcher.PleaseCompleteForm"):void 0,children:(0,u.jsx)(o.Ay,{type:"primary",icon:(0,u.jsx)(oe.A,{}),disabled:Ye,onClick:()=>{Ee(!0),Ze.validateFields().then((async e=>{if(c().isEmpty(e.mounts)||0===e.mounts.length){if(!await new Promise((e=>{G.modal.confirm({title:He("session.launcher.NoFolderMounted"),content:(0,u.jsxs)(u.Fragment,{children:[He("session.launcher.HomeDirectoryDeletionDialog"),(0,u.jsx)("br",{}),(0,u.jsx)("br",{}),He("session.launcher.LaunchConfirmationDialog"),(0,u.jsx)("br",{}),(0,u.jsx)("br",{}),He("dialog.ask.DoYouWantToProceed")]}),onOk:()=>{e(!0)},okText:He("session.launcher.Start"),onCancel:()=>{e(!1)},closable:!0})})))return}const s=e.environments.manual||e.environments.version;let[n,t]=s?s.split("@"):["",""];const l=c().isEmpty(e.sessionName)?Te():e.sessionName,r={kernelName:n,architecture:t,sessionName:l,config:{type:e.sessionType,..."batch"===e.sessionType?{startsAt:e.batch.enabled?e.batch.scheduleDate:void 0,startupCommand:e.batch.command}:{},group_name:Ke.name,domain:Y._config.domainName,scaling_group:e.resourceGroup,cluster_mode:e.cluster_mode,cluster_size:e.cluster_size,maxWaitSeconds:15,cpu:e.resource.cpu,mem:e.resource.mem,shmem:(0,D.Mh)(e.resource.mem,"4g")>0&&(0,D.Mh)(e.resource.shmem,"1g")<0?"1g":e.resource.shmem,...e.resource.accelerator>0?{[e.resource.acceleratorType]:e.resource.accelerator}:void 0,mounts:e.mounts,mount_map:e.vfoldersAliasMap,env:{...c().fromPairs(e.envvars.map((e=>[e.variable,e.value]))),...c().omit(e.hpcOptimization,"autoEnabled")},preopen_ports:c().map(e.ports,(e=>parseInt(e)))}},o=c().map(c().range(e.num_of_sessions||1),(s=>{const n=(e.num_of_sessions||1)>1?"".concat(r.sessionName,"-").concat(Ie(),"-").concat(s):r.sessionName;return Y.createIfNotExists(r.kernelName,n,r.config,2e4,r.architecture).then((e=>{if(null===e||void 0===e||!e.created)throw new Error(He("session.launcher.SessionAlreadyExists"));if("CANCELLED"===(null===e||void 0===e?void 0:e.status))throw new Error(He("session.launcher.FailedToStartNewSession"));return e})).catch((e=>{throw e}))}));Le(ze||"/job"),We({key:"session-launcher:"+l,backgroundTask:{promise:Promise.all(o),status:"pending",statusDescriptions:{pending:He("session.PreparingSession"),resolved:He("eduapi.ComputeSessionPrepared")}},duration:0,message:He("general.Session")+": "+l,open:!0}),await Promise.all(o).then((s=>{let[n]=s;if(1===e.num_of_sessions&&"batch"!==e.sessionType){const e=n;let s;s="kernelId"in e?{"session-name":e.kernelId,"access-key":"",mode:U}:{"session-uuid":e.sessionId,"session-name":e.sessionName,"access-key":"",mode:U};const t=e.servicePorts;!0===Array.isArray(t)?s["app-services"]=t.map((e=>e.name)):s["app-services"]=[],t.length>0&&globalThis.appLauncher.showLauncher(s)}})).catch((()=>{}))})).catch((e=>{console.log("validation errors",e)})).finally((()=>{Ee(!1)}))},loading:ee,children:He("session.launcher.Launch")})}):(0,u.jsxs)(o.Ay,{type:"primary",ghost:!0,onClick:()=>{Ge(_e+1)},children:[He("button.Next")," ",(0,u.jsx)(ae.A,{})]}),_e!==$e.length-1&&(0,u.jsxs)(o.Ay,{onClick:()=>{Ge($e.length-1)},children:[He("session.launcher.SkipToConfirmAndLaunch"),(0,u.jsx)(ie.A,{})]})]})]})]})})})}),Je.lg&&(0,u.jsx)(x.A,{style:{position:"sticky",top:80},children:(0,u.jsx)(fe.A,{size:"small",direction:"vertical",current:_e,onChange:e=>{Ge(e)},items:c().map($e,((e,s)=>({...e,status:s===_e?"process":"wait"})))})})]})]})}}}]);
//# sourceMappingURL=310.ce0af217.chunk.js.map