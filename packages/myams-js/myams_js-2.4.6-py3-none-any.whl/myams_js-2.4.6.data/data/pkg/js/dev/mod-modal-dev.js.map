{"version":3,"file":"mod-modal-dev.js","names":["$","MyAMS","_initialized","modalToggleEventHandler","evt","Promise","resolve","reject","source","currentTarget","handlers","data","attr","hasClass","stopPropagation","preventDefault","tooltip","modal","open","then","modalShownEventHandler","zIndexModal","dialog","target","visibleModalsCount","length","zIndex","css","setTimeout","not","first","addClass","off","on","handler","modalDismissEventHandler","core","executeFunctionByName","document","dynamicModalShowEventHandler","config","initContent","dynamicModalShownEventHandler","require","form","setFocus","parents","confirmChangedForm","status","modalHiddenEventHandler","fn","Constructor","prototype","_checkScrollbar","_setScrollbar","dynamicModalHiddenEventHandler","clearContent","remove","last","_exports","init","ajaxNav","options","sourceData","url","amsUrl","urlGetter","getFunctionByName","startsWith","ajax","type","cache","amsAllowCache","undefined","request","response","getResponse","dataType","contentType","result","content","dialogData","dialogOptions","settings","handleJSON","wrap","parent","backdrop","keyboard","extend","amsOptions","amsInit","append","stats","amsLogEvent","logPageview","fitWidthToImage","image","exists","padding","width","Math","min","window","get","naturalWidth","close","element","objectOrParentWithClass","env","bundle","modules","push","console","debug"],"sources":["mod-modal.js"],"sourcesContent":["/* global MyAMS */\n/**\n * MyAMS modal dialogs support\n */\n\nconst $ = MyAMS.$;\n\n\nlet _initialized = false;\n\n\n/*\n * Standard data-toggle=\"modal\" handler\n */\nexport function modalToggleEventHandler(evt) {\n\treturn new Promise((resolve, reject) => {\n\t\tconst\n\t\t\tsource = $(evt.currentTarget),\n\t\t\thandlers = source.data('ams-disabled-handlers');\n\t\tif (source.attr('disabled') ||\n\t\t\tsource.hasClass('disabled') ||\n\t\t\t(handlers === true) ||\n\t\t\t(handlers === 'click') ||\n\t\t\t(handlers === 'all')) {\n\t\t\tresolve(false);\n\t\t\treturn;\n\t\t}\n\t\tif (source.data('ams-context-menu') === true) {\n\t\t\tresolve(false);\n\t\t\treturn;\n\t\t}\n\t\tif (source.data('ams-stop-propagation') === true) {\n\t\t\tevt.stopPropagation();\n\t\t}\n\t\tevt.preventDefault();\n\t\tsource.tooltip('hide');\n\t\tMyAMS.modal.open(source).then(() => {\n\t\t\tresolve(true);\n\t\t}, reject);\n\t});\n}\n\n/**\n * Standard modal shown event handler\n * This handler is used to allow modals stacking\n */\nexport function modalShownEventHandler(evt) {\n\n\tconst zIndexModal = 1100;\n\n\t// Enable modals stacking\n\tconst\n\t\tdialog = $(evt.target),\n\t\tvisibleModalsCount = $('.modal:visible').length,\n\t\tzIndex = zIndexModal + (100 * visibleModalsCount);\n\tdialog.css('z-index', zIndex);\n\tsetTimeout(() => {\n\t\t$('.modal-backdrop').not('.modal-stack')\n\t\t\t.first()\n\t\t\t.css('z-index', zIndex - 10)\n\t\t\t.addClass('modal-stack');\n\t}, 0);\n\t// Check form contents before closing modals\n\t$(dialog).off('click', '[data-dismiss=\"modal\"]')\n\t\t.on('click', '[data-dismiss=\"modal\"]', (evt) => {\n\t\t\tconst handler = $(evt.currentTarget).data('ams-dismiss-handler') || modalDismissEventHandler;\n\t\t\treturn MyAMS.core.executeFunctionByName(handler, document, evt);\n\t\t});\n}\n\n\n/**\n * Dynamic modal 'show' callback\n * This callback is used to initialize modal's viewport size\n *\n * @param evt: source event\n */\nexport function dynamicModalShowEventHandler(evt) {\n\tconst dialog = $(evt.target);\n\treturn MyAMS.core.executeFunctionByName(dialog.data('ams-init-content') ||\n\t\tMyAMS.config.initContent, document, dialog);\n}\n\n\n/**\n * Dynamic modal 'shown' callback\n * This callback is used to set focus on first modal input\n *\n * @param evt: source event\n */\nexport function dynamicModalShownEventHandler(evt) {\n\treturn new Promise((resolve, reject) => {\n\t\tMyAMS.require('form').then(() => {\n\t\t\tconst modal = $(evt.target);\n\t\t\tMyAMS.form.setFocus(modal);\n\t\t\tresolve(modal);\n\t\t}, reject);\n\t});\n}\n\n\n/**\n * Modal dismiss handler\n */\nexport function modalDismissEventHandler(evt) {\n\treturn new Promise((resolve, reject) => {\n\t\tconst\n\t\t\tsource = $(evt.currentTarget),\n\t\t\tdialog = source.parents('.modal').first();\n\t\tdialog.data('modal-result', $(evt.currentTarget).data('modal-dismiss-value'));\n\t\tif (MyAMS.form) {\n\t\t\tMyAMS.form.confirmChangedForm(dialog).then((status) => {\n\t\t\t\tif (status === 'success') {\n\t\t\t\t\tdialog.modal('hide');\n\t\t\t\t}\n\t\t\t}).then(resolve, reject);\n\t\t} else {\n\t\t\tdialog.modal('hide');\n\t\t\tresolve();\n\t\t}\n\t});\n}\n\n\n/**\n * Standard modal hidden event handler\n *\n * If several visible modals are still, a \"modal-open\" class is added to body to ensure\n * modals are still visible.\n */\nexport function modalHiddenEventHandler() {\n\tif ($('.modal:visible').length > 0) {\n\t\t$.fn.modal.Constructor.prototype._checkScrollbar();\n\t\t$.fn.modal.Constructor.prototype._setScrollbar();\n\t\t$('body').addClass('modal-open');\n\t}\n}\n\n\n/**\n * Dynamic modal 'hidden' callback\n * This callback is used to clear and remove dynamic modals\n *\n * @param evt: source event\n */\nexport function dynamicModalHiddenEventHandler(evt) {\n\tconst dialog = $(evt.target);\n\tMyAMS.core.executeFunctionByName(dialog.data('ams-clear-content') ||\n\t\tMyAMS.config.clearContent, document, dialog).then(() => {\n\t\tif (dialog.data('dynamic') === true) {\n\t\t\tdialog.remove();\n\t\t\tif (MyAMS.form) {\n\t\t\t\tMyAMS.form.setFocus($('.modal-dialog').last());\n\t\t\t}\n\t\t}\n\t});\n}\n\n\n/**\n * Main modal module definition\n */\nexport const modal = {\n\n\tinit: () => {\n\n\t\tif (_initialized) {\n\t\t\treturn;\n\t\t}\n\t\t_initialized = true;\n\n\t\tif (MyAMS.config.ajaxNav) {\n\t\t\t// Initialize modal dialogs links\n\t\t\t// Standard Bootstrap handlers are removed!!\n\t\t\t$(document).off('click', '[data-toggle=\"modal\"]')\n\t\t\t\t.on('click', '[data-toggle=\"modal\"]', (evt) => {\n\t\t\t\t\t// disable click on dragging element\n\t\t\t\t\tif ($(evt.currentTarget).data('is-dragging')) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\tconst handler = $(evt.currentTarget).data('ams-modal-handler') || modalToggleEventHandler;\n\t\t\t\t\tMyAMS.core.executeFunctionByName(handler, document, evt);\n\t\t\t\t});\n\t\t}\n\n\t\t// Handle modal shown event to allow modals stacking\n\t\t$(document).on('shown.bs.modal', '.modal', (evt) => {\n\t\t\tconst handler = $(evt.currentTarget).data('ams-shown-handler') || modalShownEventHandler;\n\t\t\tMyAMS.core.executeFunctionByName(handler, document, evt);\n\t\t});\n\n\t\t// Handle modal hidden event to check remaining modals\n\t\t$(document).on('hidden.bs.modal', '.modal', (evt) => {\n\t\t\tconst handler = $(evt.currentTarget).data('ams-hidden-handler') || modalHiddenEventHandler;\n\t\t\tMyAMS.core.executeFunctionByName(handler, document, evt);\n\t\t});\n\t},\n\n\topen: (source, options) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet sourceData = {},\n\t\t\t\turl = source;\n\t\t\tif (typeof source !== 'string') {\n\t\t\t\tsourceData = source.data();\n\t\t\t\turl = source.attr('href') || sourceData.amsUrl;\n\t\t\t}\n\t\t\tconst urlGetter = MyAMS.core.getFunctionByName(url);\n\t\t\tif (typeof urlGetter === 'function') {\n\t\t\t\turl = urlGetter(source);\n\t\t\t}\n\t\t\tif (!url) {\n\t\t\t\treject(\"No provided URL!\");\n\t\t\t}\n\t\t\tif (url.startsWith('#')) {  // Open inner modal\n\t\t\t\t$(url).modal('show');\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\t$.ajax({\n\t\t\t\t\ttype: 'get',\n\t\t\t\t\turl: url,\n\t\t\t\t\tcache: sourceData.amsAllowCache === undefined ? false : sourceData.amsAllowCache,\n\t\t\t\t\tdata: options\n\t\t\t\t}).then((data, status, request) => {\n\t\t\t\t\tlet modal = null;\n\t\t\t\t\tMyAMS.require('ajax').then(() => {\n\t\t\t\t\t\tconst\n\t\t\t\t\t\t\tresponse = MyAMS.ajax.getResponse(request),\n\t\t\t\t\t\t\tdataType = response.contentType,\n\t\t\t\t\t\t\tresult = response.data;\n\t\t\t\t\t\tlet content,\n\t\t\t\t\t\t\tdialog,\n\t\t\t\t\t\t\tdialogData,\n\t\t\t\t\t\t\tdialogOptions,\n\t\t\t\t\t\t\tsettings;\n\t\t\t\t\t\tswitch (dataType) {\n\t\t\t\t\t\t\tcase 'json':\n\t\t\t\t\t\t\t\tMyAMS.ajax.handleJSON(result,\n\t\t\t\t\t\t\t\t\t$($(source).data('ams-json-target') || '#content'));\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'script':\n\t\t\t\t\t\t\tcase 'xml':\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'html':\n\t\t\t\t\t\t\tcase 'text':\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tcontent = $(result),\n\t\t\t\t\t\t\t\tdialog = $('.modal-dialog', content.wrap('<div></div>').parent()),\n\t\t\t\t\t\t\t\tdialogData = dialog.data() || {},\n\t\t\t\t\t\t\t\tdialogOptions = {\n\t\t\t\t\t\t\t\t\tbackdrop: dialogData.backdrop === undefined ? 'static' : dialogData.backdrop,\n\t\t\t\t\t\t\t\t\tkeyboard: dialogData.keyboard === undefined ? true : dialogData.keyboard\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tsettings = $.extend({}, dialogOptions, dialogData.amsOptions);\n\t\t\t\t\t\t\t\tsettings = MyAMS.core.executeFunctionByName(dialogData.amsInit, dialog, settings) || settings;\n\t\t\t\t\t\t\t\tmodal = $('<div>').addClass('modal fade')\n\t\t\t\t\t\t\t\t\t.attr('tabIndex', '-1')\n\t\t\t\t\t\t\t\t\t.data('dynamic', true)\n\t\t\t\t\t\t\t\t\t.append(content)\n\t\t\t\t\t\t\t\t\t.on('show.bs.modal', dynamicModalShowEventHandler)\n\t\t\t\t\t\t\t\t\t.on('shown.bs.modal', dynamicModalShownEventHandler)\n\t\t\t\t\t\t\t\t\t.on('hidden.bs.modal', dynamicModalHiddenEventHandler)\n\t\t\t\t\t\t\t\t\t.modal(settings);\n\t\t\t\t\t\t\t\tif (MyAMS.stats &&\n\t\t\t\t\t\t\t\t\t!((sourceData.amsLogEvent === false) ||\n\t\t\t\t\t\t\t\t\t\t(dialogData.amsLogEvent === false))) {\n\t\t\t\t\t\t\t\t\tMyAMS.stats.logPageview(url);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tresolve(modal);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tfitWidthToImage: (evt, options) => {\n\t\tsetTimeout(() => {\n\t\t\tconst\n\t\t\t\tsource = evt.currentTarget,\n\t\t\t\timage = options ? $(options['resize-target']) : source;\n\t\t\tif (image.exists()) {\n\t\t\t\tconst\n\t\t\t\t\tdialog = image.parents('.modal-dialog'),\n\t\t\t\t\tpadding = dialog.width() - image.width();\n\t\t\t\tdialog.css('max-width',\n\t\t\t\t\tMath.min($(window).width(), image.get(0).naturalWidth + padding));\n\t\t\t}\n\t\t}, 150);\n\t},\n\n\t/**\n\t * Close modal associated with given element\n\t *\n\t * @param element: the element contained into closed modal\n\t */\n\tclose: (element) => {\n\t\tif (typeof element === 'string') {\n\t\t\telement = $(element);\n\t\t} else if (typeof element === 'undefined') {\n\t\t\telement = $('.modal-dialog:last');\n\t\t}\n\t\tconst dialog = element.objectOrParentWithClass('modal');\n\t\tif (dialog.length > 0) {\n\t\t\tdialog.modal('hide');\n\t\t}\n\t}\n};\n\n\n/**\n * Global module initialization\n */\nif (MyAMS.env.bundle) {\n\tMyAMS.config.modules.push('modal');\n} else {\n\tMyAMS.modal = modal;\n\tconsole.debug(\"MyAMS: modal module loaded...\");\n}\n"],"mappings":"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"}