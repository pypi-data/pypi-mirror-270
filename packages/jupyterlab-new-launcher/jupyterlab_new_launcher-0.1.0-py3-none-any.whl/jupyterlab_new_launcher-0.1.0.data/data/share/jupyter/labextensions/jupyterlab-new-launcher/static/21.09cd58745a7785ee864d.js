"use strict";(self.webpackChunkjupyterlab_new_launcher=self.webpackChunkjupyterlab_new_launcher||[]).push([[21],{21:(e,t,a)=>{a.r(t),a.d(t,{default:()=>R});var s=a(465),n=a(638),r=a(221),o=a(595),l=a(618),i=a(714),c=a(664),d=a(53),m=a(345);const u=new c.LabIcon({name:"jupyterlab-new-launcher:star",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n  <path class="jp-icon3 jp-star-filled" fill="rgb(97,97,97)" d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />\n  <path class="jp-icon3 jp-star-border" fill="rgb(97,97,97)" d="M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z" />\n</svg>\n'}),h=new c.LabIcon({name:"jupyterlab-new-launcher:file",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n  <path class="jp-icon3" fill="rgb(97,97,97)" d="M13.81 22H6C4.89 22 4 21.11 4 20V4C4 2.9 4.89 2 6 2H14L20 8V13.09C19.67 13.04 19.34 13 19 13S18.33 13.04 18 13.09V9H13V4H6V20H13.09C13.21 20.72 13.46 21.39 13.81 22M23 18H20V15H18V18H15V20H18V23H20V20H23V18Z" />\n</svg>'});var p=a(602);class g{constructor(e){var t;this._options=e,this._refreshLastUsed=new p.Signal(this),this._refreshClock=null,this._lastUsed=null;const{item:a,commands:s,lastUsedDatabase:n,favoritesDatabase:r,cwd:o}=e,l={...a.args,cwd:o};this.command=a.command,this.args=l,this.category=a.category,this.rank=a.rank,this.kernelIconUrl=a.kernelIconUrl,this.metadata=a.metadata,this.iconClass=s.iconClass(a.command,l),this.icon=s.icon(a.command,l),this.caption=s.caption(a.command,l),this.label=s.label(a.command,l),this.lastUsed=n.get(a),this.starred=null!==(t=r.get(a))&&void 0!==t&&t}get lastUsed(){return this._lastUsed}set lastUsed(e){this._lastUsed=e,this._setRefreshClock()}get refreshLastUsed(){return this._refreshLastUsed}async execute(){const{item:e,commands:t,lastUsedDatabase:a}=this._options;await t.execute(e.command,this.args),await a.recordAsUsedNow(e),this.lastUsed=a.get(e),this._refreshLastUsed.emit()}async markAsUsed(){const{item:e,lastUsedDatabase:t}=this._options;await t.recordAsUsedNow(e),this.lastUsed=t.get(e),this._refreshLastUsed.emit()}toggleStar(){const{item:e,favoritesDatabase:t}=this._options,a=!t.get(e);return this.starred=a,t.set(e,a)}_setRefreshClock(){const e=this._lastUsed;if(null!==this._refreshClock&&(window.clearTimeout(this._refreshClock),this._refreshClock=null),!e)return;const t=Date.now()-e.getTime(),a=t<6e4?1e4:t<36e5?6e4:36e5;this._refreshClock=window.setTimeout((()=>{this._refreshLastUsed.emit(),this._setRefreshClock()}),a)}}var v=a(597),_=a(262);const f="jupyterlab-new-launcher:plugin";var b;!function(e){e.create="launcher:create",e.moveColumn="new-launcher:table-move-column",e.toggleColumn="new-launcher:table-toggle-column"}(b||(b={}));const w=new _.Token("jupyterlab-new-launcher:ILauncherDatabase","Databases for new launcher."),C="jp-starIconButton",y="jp-TableKernelItem";function k(e){if(0===e.length)return"(empty)";switch(e){case"conda_env_name":return"Environment";case"conda_env_path":return"Environment path";case"conda_language":return"Language";case"conda_raw_kernel_name":return"Kernel";case"conda_is_base_environment":return"Base?";case"conda_is_currently_running":return"Running?"}return e[0].toUpperCase()+e.substring(1)}function D(e){var t,a,s,n;const{trans:r}=e;let o,l;if(e.showSearchBox){const[e,t]=m.useState("");o=e,l=t}else o=e.query;const[,i]=m.useReducer((e=>e+1),0),d=new Set;for(const a of e.items){const e=null===(t=a.metadata)||void 0===t?void 0:t.kernel;if(e)for(const t of Object.keys(e))d.add(t)}const h=[...d].map((e=>({id:e,label:k(e),renderCell:t=>{var a;const s=null===(a=t.metadata)||void 0===a?void 0:a.kernel;if(!s)return"-";const n=s[e];return"string"==typeof n?n:JSON.stringify(n)},sort:(t,a)=>{var s,n;const r=null===(s=t.metadata)||void 0===s?void 0:s.kernel,o=null===(n=a.metadata)||void 0===n?void 0:n.kernel,l=r?r[e]:void 0,i=o?o[e]:void 0;return l===i?0:l?i?"string"==typeof l&&"string"==typeof i?l.localeCompare(i):l>i?1:-1:-1:1}}))),p=[{id:"icon",label:r.__("Icon"),renderCell:t=>m.createElement("div",{className:"jp-LauncherCard-icon",onClick:()=>e.onClick(t)},t.kernelIconUrl?m.createElement("img",{src:t.kernelIconUrl,className:"jp-Launcher-kernelIcon",alt:t.label}):m.createElement("div",{className:"jp-LauncherCard-noKernelIcon"},t.label[0].toUpperCase())),sort:(e,t)=>e.command.localeCompare(t.command)},{id:"kernel",label:r.__("Kernel"),renderCell:t=>m.createElement("span",{className:y,onClick:a=>{e.onClick(t),a.stopPropagation()},onKeyDown:e=>{"Enter"===e.key&&t.execute()},tabIndex:0},t.label),sort:(e,t)=>e.label.localeCompare(t.label)},...h,{id:"last-used",label:r.__("Last Used"),renderCell:e=>m.createElement(c.UseSignal,{signal:e.refreshLastUsed},(()=>e.lastUsed?m.createElement("span",{title:v.Time.format(e.lastUsed)},v.Time.formatHuman(e.lastUsed)):r.__("Never"))),sort:(e,t)=>e.lastUsed===t.lastUsed?0:e.lastUsed?t.lastUsed&&e.lastUsed>t.lastUsed?1:-1:1},{id:"star",label:"",renderCell:e=>{const t=e.starred,a=t?r.__("Click to add this kernel to favourites"):r.__("Click to remove the kernel from favourites");return m.createElement("button",{className:t?`${C} jp-mod-starred`:C,title:a,onClick:t=>{e.toggleStar(),i(),t.stopPropagation()}},m.createElement(u.react,{className:"jp-starIcon"}))},sort:(e,t)=>Number(e.starred)-Number(t.starred)}],g=null!==(a=e.hideColumns)&&void 0!==a?a:[],_=p.filter((e=>!g.includes(e.id))),[f,w]=m.useState(null!==(s=e.settings.composite.hiddenColumns)&&void 0!==s?s:{}),D=_.map((e=>e.id)),[L,I]=m.useState(null!==(n=e.settings.composite.columnOrder)&&void 0!==n?n:D),U=c.Table,E=()=>{var t,a;const s=null!==(t=e.settings.composite.hiddenColumns)&&void 0!==t?t:{};f!==s&&w(s);const n=null!==(a=e.settings.composite.columnOrder)&&void 0!==a?a:D;L!==n&&I(n)};return m.useEffect((()=>(e.settings.changed.connect(E),()=>{e.settings.changed.disconnect(E)}))),m.createElement("div",{className:"jp-NewLauncher-table"},e.showSearchBox?m.createElement("div",{className:"jp-Launcher-searchBox"},m.createElement(c.FilterBox,{placeholder:r.__("Filter"),updateFilter:(e,t)=>{l(null!=t?t:"")},initialQuery:"",useFuzzyFilter:!1})):null,m.createElement("div",{className:"jp-NewLauncher-table-scroller",onContextMenu:t=>{var a;t.preventDefault();const s=new c.MenuSvg({commands:e.commands}),n=new c.MenuSvg({commands:e.commands});for(const e of _)n.addItem({command:b.toggleColumn,args:{id:e.id,label:e.label}});n.title.label=r.__("Visible Columns"),s.addItem({type:"submenu",submenu:n});const o=null===(a=t.target.closest("th[data-id]"))||void 0===a?void 0:a.dataset.id;o&&(s.addItem({command:b.moveColumn,args:{direction:"left",order:L,id:o}}),s.addItem({command:b.moveColumn,args:{direction:"right",order:L,id:o}})),s.open(t.clientX,t.clientY)}},m.createElement(U,{rows:e.items.filter((e=>-1!==e.label.toLowerCase().indexOf(o.toLowerCase()))).map((e=>({data:e,key:e.command+JSON.stringify(e.args)}))),blankIndicator:()=>m.createElement("div",null,r.__("No entries")),sortKey:"kernel",onRowClick:e=>{const t=e.target,a=t.closest("tr");if(!a)return;const s=t.closest("td"),n=null==s?void 0:s.querySelector(`.${C}`);if(n)return n.click();a.querySelector(`.${y}`).click()},columns:_.filter((e=>!f[e.id])).map((e=>{var t;return{...e,rank:null!==(t=L.indexOf(e.id))&&void 0!==t?t:10}})).sort(((e,t)=>e.rank-t.rank))})))}function L(e){const[t,a]=m.useState(e.open);return m.createElement("details",{onToggle:e=>a(e.currentTarget.open),className:(0,c.classes)(e.className,"jp-CollapsibleSection"),open:t},m.createElement("summary",null,m.createElement("div",{className:"jp-CollapsibleSection-CollapserIconWrapper","aria-hidden":"true"},m.createElement(c.caretRightIcon.react,{className:"jp-CollapsibleSection-CollapserIcon"})),m.createElement(e.icon.react,{tag:"span",className:"jp-CollapsibleSection-CategoryIcon"}),m.createElement("h3",{className:"jp-CollapsibleSection-Title"},e.title)),m.createElement("div",{className:"jp-Launcher-CardGroup jp-Launcher-cardContainer"},e.children))}function I(e){const{item:t}=e;return m.createElement("div",{onClick:()=>t.execute(),className:"jp-Launcher-TypeCard jp-LauncherCard",title:t.caption,tabIndex:0},m.createElement("div",{className:"jp-LauncherCard-icon"},m.createElement(c.LabIcon.resolveReact,{icon:t.icon,iconClass:(0,c.classes)(t.iconClass,"jp-Icon-cover")})),m.createElement("div",{className:"jp-LauncherCard-label"},m.createElement("p",null,t.label)))}function U(e){var t;const{trans:a,cwd:s,typeItems:n,otherItems:r}=e,[o,l]=m.useState(""),i=new Set;for(const a of e.notebookItems){const e=null===(t=a.metadata)||void 0===t?void 0:t.kernel;if(e)for(const t of Object.keys(e))i.add(t)}return m.createElement("div",{className:"jp-LauncherBody"},m.createElement("div",{className:"jp-NewLauncher-TopBar"},m.createElement("div",{className:"jp-Launcher-cwd"},m.createElement("h3",null,a.__("Current folder:")," ",m.createElement("code",null,s||"/"))),m.createElement("div",{className:"jp-NewLauncher-OtherItems"},r.map((e=>m.createElement(I,{item:e,trans:a}))))),m.createElement("div",{className:"jp-Launcher-searchBox"},m.createElement(c.FilterBox,{placeholder:a.__("Filter"),updateFilter:(e,t)=>{l(null!=t?t:"")},initialQuery:"",useFuzzyFilter:!1})),m.createElement(L,{className:"jp-Launcher-openByType",title:a.__("Create Empty"),icon:h,open:!0},n.filter((e=>!o||-1!==e.label.toLowerCase().indexOf(o.toLowerCase()))).map((e=>m.createElement(I,{item:e,trans:a})))),m.createElement(L,{className:"jp-Launcher-openByKernel",title:a.__("Launch Notebook"),icon:c.notebookIcon,open:!0},m.createElement(D,{items:e.notebookItems,commands:e.commands,showSearchBox:!1,query:o,settings:e.settings,trans:a,onClick:e=>e.execute()})),m.createElement(L,{className:"jp-Launcher-openByKernel",title:a.__("Launch Console"),icon:c.consoleIcon,open:!1},m.createElement(D,{items:e.consoleItems,commands:e.commands,showSearchBox:!1,query:o,settings:e.settings,trans:a,onClick:e=>e.execute()})))}class E extends o.Launcher{constructor(e){super(e),this.renderCommand=e=>new g({item:e,cwd:this.cwd,commands:this.commands,lastUsedDatabase:this._lastUsedDatabase,favoritesDatabase:this._favoritesDatabase}),this.renderKernelCommand=e=>this.renderCommand(e),this.commands=e.commands,this.trans=this.translator.load("jupyterlab-new-launcher"),this._lastUsedDatabase=e.lastUsedDatabase,this._favoritesDatabase=e.favoritesDatabase,this._settings=e.settings}render(){if(!this.model)return null;const e=this.trans,t=[...this.model.items()],a=e.__("Notebook"),s=e.__("Console"),n=[a,s],r=["inspector:open"],o=t.filter((e=>r.includes(e.command))).map(this.renderCommand),l=t.filter((e=>!(e.category&&n.includes(e.category)||r.includes(e.command)))),i={"terminal:create-new":3,"fileeditor:create-new":6,"fileeditor:create-new-markdown-file":5};for(const e of l)e.command in i&&(e.rank=i[e.command]);const c=[{command:"notebook:create-new",rank:1},{command:"console:create",rank:4},...l].sort(((e,t)=>{var a,s;return(null!==(a=null==e?void 0:e.rank)&&void 0!==a?a:0)-(null!==(s=null==t?void 0:t.rank)&&void 0!==s?s:0)})),d=t.filter((e=>e.category&&e.category===a)).map(this.renderKernelCommand),u=t.filter((e=>e.category&&e.category===s)).map(this.renderKernelCommand),h=c.map(this.renderCommand);return m.createElement(U,{trans:this.trans,cwd:this.cwd,commands:this.commands,typeItems:h,notebookItems:d,consoleItems:u,otherItems:o,settings:this._settings})}}class S extends n.SessionContextDialogs{constructor(e){var t;super(e),this.options=e;const a=null!==(t=e.translator)&&void 0!==t?t:i.nullTranslator;this.trans=a.load("jupyterlab")}async selectKernel(e){const t=this.trans;if(e.isDisposed)return Promise.resolve();let a=t.__("Cancel");e.hasNoKernel&&(a=e.kernelDisplayName);const s=[n.Dialog.cancelButton({label:a}),n.Dialog.okButton({label:t.__("Select"),ariaLabel:t.__("Select Kernel"),className:"jp-KernelSelector-SelectButton"})],r=e.kernelPreference.autoStartDefault,o="boolean"==typeof r,l=await this.options.settingRegistry.load(f),i=new n.Dialog({title:t.__("Select Kernel"),body:new j({data:{specs:e.specsManager.specs,sessions:e.sessionManager.running(),preference:e.kernelPreference},commands:this.options.commands,favoritesDatabase:this.options.database.favorites,lastUsedDatabase:this.options.database.lastUsed,settings:l,trans:t,acceptDialog:()=>{i.resolve(1)}}),buttons:s,checkbox:o?{label:t.__("Always start the preferred kernel"),caption:t.__("Remember my choice and always start the preferred kernel"),checked:r}:null});i.node.classList.add("jp-KernelSelector-Dialog");const c=await i.launch();if(e.isDisposed||!c.button.accept)return;o&&null!==c.isChecked&&(e.kernelPreference={...e.kernelPreference,autoStartDefault:c.isChecked});const d=c.value;if(null===d&&!e.hasNoKernel)return e.shutdown();d&&await e.changeKernel(d)}}const N={id:"jupyterlab-new-launcher:dialogs",description:"Session dialogs for redesigned JupyterLab launcher",provides:n.ISessionContextDialogs,autoStart:!0,requires:[i.ITranslator,w,l.ISettingRegistry],activate:(e,t,a,s)=>new S({translator:t,database:a,commands:e.commands,settingRegistry:s})};class j extends n.ReactWidget{constructor(e){super(),this.options=e,this.renderKernelCommand=e=>new g({item:e,cwd:"",commands:this.commands,lastUsedDatabase:this._lastUsedDatabase,favoritesDatabase:this._favoritesDatabase}),this._selection=null,this.commands=e.commands,this._lastUsedDatabase=e.lastUsedDatabase,this._favoritesDatabase=e.favoritesDatabase,this._settings=e.settings,this.trans=e.trans}render(){var e;const t=[],a=this.options.data.specs.kernelspecs;for(const e of Object.values(a)){if(!e)continue;const a=e.resources["logo-svg"]||e.resources["logo-64x64"];t.push({command:"notebook:create-new",args:{isLauncher:!0,kernelName:e.name},kernelIconUrl:a,metadata:{kernel:_.JSONExt.deepCopy(e.metadata||{})}})}const s=[];for(const t of this.options.data.sessions){const n=t.kernel;if(!n)continue;const r=a[n.name],o=r.resources["logo-svg"]||r.resources["logo-64x64"];s.push({command:"notebook:create-new",args:{isLauncher:!0,kernelName:r.name},kernelIconUrl:o,metadata:{kernel:{..._.JSONExt.deepCopy(r.metadata||{}),state:null!==(e=n.execution_state)&&void 0!==e?e:"running","used by":t.name},model:n}})}const n=t.map(this.renderKernelCommand),r=s.map(this.renderKernelCommand);return m.createElement(m.Fragment,null,m.createElement("h3",{className:"jp-KernelSelector-Section"},this.trans.__("Start a new kernel")),m.createElement(D,{trans:this.trans,commands:this.commands,items:n,settings:this._settings,query:"",showSearchBox:!0,onClick:e=>{this._selection=e,this.options.acceptDialog()}}),r.length>0?m.createElement(m.Fragment,null,m.createElement("h3",{className:"jp-KernelSelector-Section"},this.trans.__("Connect to a running kernel")),m.createElement(D,{trans:this.trans,commands:this.commands,items:r,settings:this._settings,query:"",showSearchBox:!1,onClick:e=>{this._selection=e,this.options.acceptDialog()},hideColumns:["last-used","star"]})):null)}getValue(){var e;return this._selection?(null===(e=this._selection.metadata)||void 0===e?void 0:e.model)?this._selection.metadata.model:{name:this._selection.args.kernelName}:null}}var x=a(750);class B{constructor(e){this._updateDB=async()=>{const e=await this._fetch();this._db=e},this._db=null,this._stateDB=e.stateDB;const t=new _.PromiseDelegate;this.ready=t.promise,this._updateDB().then((()=>t.resolve())),window.setInterval(this._updateDB,e.fetchInterval)}_get(e){return this._db?this._db[this._itemKey(e)]:(console.error("Database is not ready!"),null)}async _set(e,t){const a=await this._fetch();this._db=a,a[this._itemKey(e)]=t,await this._stateDB.save(this._stateDBKey,a)}async _fetch(){let e=await this._stateDB.fetch(this._stateDBKey);return void 0===e&&(e=await this._stateDB.fetch(this._stateDBKey)),void 0===e?{}:e}}class K extends B{_itemKey(e){return e.command+"_"+JSON.stringify(e.args)}}class T extends K{constructor(){super(...arguments),this._stateDBKey="new-launcher:last-used"}get(e){const t=super._get(e);return t?new Date(t):null}async recordAsUsedNow(e){this._set(e,(new Date).toUTCString())}}class M extends K{constructor(){super(...arguments),this._stateDBKey="new-launcher:favorites"}get(e){var t;return null!==(t=super._get(e))&&void 0!==t?t:null}async set(e,t){this._set(e,t)}}const O={id:"jupyterlab-new-launcher:database",description:"A redesigned JupyterLab launcher databases",provides:w,autoStart:!0,requires:[x.IStateDB],activate:(e,t)=>{const a={stateDB:t,fetchInterval:1e4};return{lastUsed:new T(a),favorites:new M(a)}}},R=[{id:f,description:"A redesigned JupyterLab launcher",provides:o.ILauncher,autoStart:!0,requires:[i.ITranslator,l.ISettingRegistry,w],optional:[s.ILabShell,n.ICommandPalette,r.IDefaultFileBrowser],activate:function(e,t,a,s,r,l,i){const{commands:m,shell:u}=e,h=t.load("jupyterlab-new-launcher"),p=new o.LauncherModel;return a.load(f).then((t=>{!function(e,t,a){e.commands.addCommand(b.toggleColumn,{label:e=>{if(e.label)return e.label;if(e.id){const t=e.id;return t[0].toLocaleUpperCase()+t.substring(1)}return t.__("Toggle given column")},execute:async e=>{var t;const s=e.id;if(!s)return console.error("Column ID missing");const n=null!==(t=a.user.hiddenColumns)&&void 0!==t?t:{};n[s]?n[s]=!1:n[s]=!0,await a.set("hiddenColumns",n)},isToggleable:!0,isToggled:e=>{var t;const s=e.id;return s?!(null!==(t=a.user.hiddenColumns)&&void 0!==t?t:{})[s]:(console.error("Column ID missing for checking if toggled"),!1)}}),e.commands.addCommand(b.moveColumn,{label:e=>"left"===e.direction?t.__("Move Column Left"):"right"===e.direction?t.__("Move Column Right"):t.__("Move column left or right"),execute:async e=>{const t=e.order,s=e.id,n=t.indexOf(s),r=n+("left"===e.direction?-1:1);if(r<0||r>=t.length)return void console.log("Cannot move the column any further");const o=t[r];t[r]=s,t[n]=o,await a.set("columnOrder",t)}})}(e,h,t)})),m.addCommand(b.create,{label:h.__("New Launcher"),icon:e=>e.toolbar?c.addIcon:void 0,execute:async e=>{var o,l;const g=null!==(l=null!==(o=e.cwd)&&void 0!==o?o:null==i?void 0:i.model.path)&&void 0!==l?l:"",v="launcher-"+F.id++,_=await a.load(f);await Promise.all([s.lastUsed.ready,s.favorites.ready]);const b=new E({model:p,cwd:g,callback:e=>{(0,d.find)(u.widgets("main"),(t=>t===e))&&(u.add(e,"main",{ref:v}),b.dispose())},commands:m,translator:t,lastUsedDatabase:s.lastUsed,favoritesDatabase:s.favorites,settings:_});b.model=p,b.title.icon=c.launcherIcon,b.title.label=h.__("Launcher");const w=new n.MainAreaWidget({content:b});if(w.title.closable=!!Array.from(u.widgets("main")).length,w.id=v,u.add(w,"main",{activate:e.activate,ref:e.ref}),r&&r.layoutModified.connect((()=>{w.title.closable=Array.from(r.widgets("main")).length>1}),w),i){const e=e=>{b.cwd=e.path};i.model.pathChanged.connect(e),b.disposed.connect((()=>{i.model.pathChanged.disconnect(e)}))}return w}}),r&&Promise.all([e.restored,null==i?void 0:i.model.restored]).then((()=>{r.layoutModified.connect((()=>{r.isEmpty("main")&&m.execute(b.create)}))})),l&&l.addItem({command:b.create,category:h.__("Launcher")}),r&&(r.addButtonEnabled=!0,r.addRequested.connect(((e,t)=>{var a;const s=(null===(a=t.currentTitle)||void 0===a?void 0:a.owner.id)||t.titles[t.titles.length-1].owner.id;return m.execute(b.create,{ref:s})}))),p}},N,O];var F;!function(e){e.id=0}(F||(F={}))}}]);