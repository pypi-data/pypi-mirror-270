{"version":3,"file":"async-DashWebsocketComponent.js","mappings":"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","sources":["webpack:///./src/lib/fragments/DashWebsocketComponent.react.js"],"sourcesContent":["import {Component} from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nexport default class DashWebsocketComponent extends Component {\r\n    _init_client() {\r\n        let {url} = this.props;\r\n        const {protocols} = this.props;\r\n        url = url ? url : 'ws://' + location.host + location.pathname + 'ws';\r\n        this.client = new WebSocket(url, protocols);\r\n\r\n        this.client.onopen = (e) => {\r\n            this.props.setProps({\r\n                state: {\r\n                    readyState: WebSocket.OPEN,\r\n                    isTrusted: e.isTrusted,\r\n                    timeStamp: e.timeStamp,\r\n                    origin: e.origin,\r\n                    lastConnected: Number(new Date()),\r\n                },\r\n            });\r\n        };\r\n        this.client.onmessage = (e) => {\r\n            this.props.setProps({\r\n                state: {\r\n                    ...this.props.state,\r\n                    lastConnected: Number(new Date()),\r\n                },\r\n                message: {\r\n                    data: e.data,\r\n                    isTrusted: e.isTrusted,\r\n                    origin: e.origin,\r\n                    timeStamp: e.timeStamp,\r\n                },\r\n            });\r\n        };\r\n        this.client.onerror = (e) => {\r\n            console.log(`ON ERROR ${location.host}`);\r\n            this.props.setProps({error: JSON.stringify(e)});\r\n        };\r\n        this.client.onclose = (e) => {\r\n            console.log(`ON CLOSE ${location.host}`);\r\n            this.props.setProps({\r\n                error: JSON.stringify(e),\r\n                state: {\r\n                    readyState: WebSocket.CLOSED,\r\n                    isTrusted: e.isTrusted,\r\n                    timeStamp: e.timeStamp,\r\n                    code: e.code,\r\n                    reason: e.reason,\r\n                    wasClean: e.wasClean,\r\n                    lastConnected: Number(new Date()),\r\n                },\r\n            });\r\n            setTimeout(_init_client, 1000);\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        console.log('Try to load web socket component');\r\n        this.props.setProps({\r\n            state: {\r\n                ...this.props.state,\r\n                lastConnected: 0,\r\n            },\r\n        });\r\n        this._init_client();\r\n    }\r\n\r\n    componentDidUpdate(prevProps) {\r\n        const {send} = this.props;\r\n        if (send && send !== prevProps.send) {\r\n            if (this.props.state.readyState === WebSocket.OPEN) {\r\n                this.client.send(send);\r\n            }\r\n            // TODO handle this\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.client.onopen = null;\r\n        this.client.onclose = null;\r\n        this.client.onerror = null;\r\n        this.client.onmessage = null;\r\n        this.client.close();\r\n    }\r\n\r\n    render() {\r\n        return null;\r\n    }\r\n}\r\n\r\nDashWebsocketComponent.defaultProps = {\r\n    state: {readyState: WebSocket.CONNECTING},\r\n};\r\n\r\nDashWebsocketComponent.propTypes = {\r\n    /**\r\n     * This websocket state (in the readyState prop) and associated information.\r\n     */\r\n    state: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\r\n\r\n    /**\r\n     * When messages are received, this property is updated with the message content.\r\n     */\r\n    message: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\r\n\r\n    /**\r\n     * This property is set with the content of the onerror event.\r\n     */\r\n    error: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\r\n\r\n    /**\r\n     * When this property is set, a message is sent with its content.\r\n     */\r\n    send: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\r\n\r\n    /**\r\n     * The websocket endpoint (e.g. wss://echo.websocket.org).\r\n     */\r\n    url: PropTypes.string,\r\n\r\n    /**\r\n     * Supported websocket protocols (optional).\r\n     */\r\n    protocols: PropTypes.arrayOf(PropTypes.string),\r\n\r\n    /**\r\n     * The ID used to identify this component in Dash callbacks.\r\n     */\r\n    id: PropTypes.string,\r\n\r\n    /**\r\n     * Dash-assigned callback that should be called to report property changes\r\n     * to Dash, to make them available for callbacks.\r\n     */\r\n    setProps: PropTypes.func,\r\n};\r\n"],"names":["DashWebsocketComponent","_Component","_classCallCheck","_callSuper","arguments","_inherits","key","value","_init_client2","_init_client","apply","toString","_this","url","this","props","protocols","location","host","pathname","client","WebSocket","onopen","e","setProps","state","readyState","OPEN","isTrusted","timeStamp","origin","lastConnected","Number","Date","onmessage","_objectSpread","message","data","onerror","console","log","concat","error","JSON","stringify","onclose","CLOSED","code","reason","wasClean","setTimeout","prevProps","send","close","Component","defaultProps","CONNECTING","propTypes","PropTypes","id"],"sourceRoot":""}