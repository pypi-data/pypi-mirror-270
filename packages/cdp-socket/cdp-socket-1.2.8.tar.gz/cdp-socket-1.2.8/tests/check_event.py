from cdp_socket.utils.utils import launch_chrome, random_port
from cdp_socket.socket import CDPSocket
import os
import asyncio
import aiodebug.log_slow_callbacks
aiodebug.log_slow_callbacks.enable(0.025)

global sock1
data_dir = os.getcwd() + "/data_dir"


async def on_resumed(params):
    url = params["request"]["url"]
    if url == "https://httpbin.org/post":
        print(params)
    global sock1
    await sock1.exec("Fetch.continueRequest", {"requestId": params['requestId']})


PORT = random_port()
process = launch_chrome(data_dir, PORT)


async def main():
    global sock1

    async with CDPSocket(PORT) as base_socket:
        targets = await base_socket.targets
        target = targets[0]
        sock1 = await base_socket.get_socket(target)
        await sock1.exec("Network.clearBrowserCookies")
        await sock1.exec("Fetch.enable")
        sock1.add_listener("Fetch.requestPaused", on_resumed)
        await sock1.exec("Page.navigate", {"url": "https://httpbin.org"})
        script = r"""
        fetch("https://httpbin.org/post", {
          method: "POST",
          body: "x%+2\u000f+z\u0017z\n\u00049Y<aVD_\b\n/\u041f?~4:-\u045fpb\u0014\u000e?t_1?~I\u0018FP\u001c\u001f?-\u0016\u0012UC\u000b#\u03f5W\f\u0011us\u001d\b[Q\u000fP]e\u0327i:8W\u05a6i\u000fa\u000em{;\u0415+]P(N,}rmMs\u000foLD{\u0015?u_nM\u0011c~\u001f\r}_@i\u0000\u04f9\u0005O\u0240y\u0016\u0014F :8?l/NBc[0Bc\u0018_\u01dflP1\u0012\u001d\u0003\u001f\u0004\u76c39X\u0776x5:c\u0010A\u0010\u0010\u000f@(\bA\u0010\f2\u0154-o1\u0018\u5fb6Wn[;\no\u055f\\\u0015c\"\u0018\r!\b+mN (_\u0015I1ei&\u001fZ;rT\u0018M\u01efu]k>\r\b\u001cO\ubfebI\u0004E~W{\f\u0fef-\u072f[lu;Z%\u0019\u0007C\u0000C&\b\u001b4|'o\u0017\u0003]\u043f\u001a\u0003\u0018\u001fMC\u04f83\u001c\u05e9-?\u0336oq\u000ew\u031b?~\u02bf\u000eY;\u0016t\u06c3\\\"Mo7cQ\u0016?@ \u001f\u001b%w\u0014w<\u000b\fS\fm}\u0003\u059f\u04f1v/i\u001ev\r% '/\u000b&#7\u0439\u0019e\u0005^Lv\u00050u~a\u57da,;\u001d\u000fu-\u0010#Hc.)SOAVl~S\u0011\fMt[\u0014\u01dco[9\u026fy/dvf\u0012A(\r+\b=CS~\u0014CO\u0c01>\u000bo]D1\u0001D\u0013\u000b\u0004\u0002IFUi\u079e`K5o\u000bF\u0007\u0011vBH\u0002F$\u0004\t5 \u0006y>4oqaqJ;vI<\u0017\t\u0012j\u0505\t\u0012eH`\ua651VO)NN\u001fkF/.rmV+\tZz\u000f^%f$\u01833D,yK\u0007v\u05d6a\n\u001dc\\&\"\u000b6\u0018OSMG`,-\b\b\u0678tF=S\u001ak]gxx\u0017Sl;\u0012Fc\u0003\u0000\u0002roF\ue50e\u00038YI\u05c30\r\u001e,r\u0349\u04ba\f1\u000f\u0013y\u04f7LT&:J'\u001c\u0013\u060d$\u03e3D\u0012t\u0011#[j\u000e\u00dd\u022chKe\u0000%:o\u0018n)\u001dC/WZf\u88c8\u0015\u1ecaj\u001ck3|(6\u07d4\u0015\"Zc\"\u9a6b\u0017gJg-\u0013%k{$\u001a&s_<\u001dB\u0012\u001cDY\u0016=\u000f/\u0018\u03179}VDxyVv\u0004\u0018U\u0013\u00054>Bl$x4\u0002\u000fF{\u0011\u000f\bYfYC>\u0011\u0007\u0005\u000f\u0565f\u0006\n\u0106\u0000/t\u0011CtGS-^\u000bHQX8K2~\nPwZ\u001b\u00cfcW> 7\u056d9|FJt:\u06a4#@D\"`KbB\r\u0011m{ie_Pk+Vgy\u001dc\u07d0p16;7l\u0003\te:K\u000eP7e\uc41c%c\u0010Ro\u0010\u0011D<\u0017n2O3p\u000b}2\u001e+LmA \u001e\u0015^9)\u0018\u0018sYUwi1u~\fd<H~\u075b&\"_#69\u0018\u000feS\u0002\u00ddyGMw$\u0018\u0445@;IpK\u03f31T8K3\u0017=XH7o\u012c_P\u0249ZW<\u0012\u000fIJvCEV/\u0265\u001ec`Y\u0019\f\u001e,\u06d8K!~BHe\u000fp'\b\u0013~\u0011y\tm\n\u07c3'\\\u0175r\u0004nWN\u0016&o\u0014BN&\u0010w3kuL\u024f|\u0007<\tv_\u0018^A\u0563$4/nL}/\u013b+\u001dW\u001ezJff\u001b\u0014\u07cc[ta|L\\u\u001f\u0004i\u0007MZ96]U\t\u0012\u0199|r\u0017Muo^;\u000b(\\\u04df\u000771\u0419\u001eLn\u0006x&:e-\u001f4\u0013;Irh)\n#$%\u0015MX\r_C#y\u0001\u0015\u04f8X\u001co\u000e\\4\r#\u0001B\u001cXT\u054aYU,,_\u0012\u0018gRA8m=%\u0003?a-\u001cT4lxR\u0011\u031fZ\u035fDTo#3tJ-\u00151\ud958\ude1a\u0015\u001fN]T>IU\u001bls2CW\\>J/'\u001e\u0016^\u0000'7#\u001bp8z\u0015e\u0169J\u00f5\\RCI%[RWkje6X_\f1\u060eP|8]\u0006PNp>0svI7F$IS\u0011:\u001fwI|Y*Q8\\\tdFT+>*\u0002~\\4\u0007[\u0003rRx?}l\n]l\bfTb\u001f\u0016A\u0794\u001a\u0003S;JFT,U\u001d\u0016tC\u072c}a@[4v5kyxtm\u041ce\u001c\u001f\u0011\u0011\\.9|\u001f\u000e\u0000\u0011C\u0004/\u0004$\u0001Z\nP\u0596#\b.>^:-*h9Gr\u0007\u0011\\\u1a34\u0015ai\u0473A\u0013\u0001E@!B\u0004sbqo3I<O\u0003R\u0011G_Zsy.lAlFl5\u0018W\u0007A\"$\u0004\u02ab7\u0002\u0001o9zVAl7\r\f\u0003\u001aF\u2784h\u00015uj\u000fq3DdH\u000f\bt\u0122j)u\u0005H.7\u0000\u0002q}-\u0019\fBMh\u0013\\Y\u0006f8_I8>\u0012g\rE+C\n\u001f\u00113\"\u001fB\f+]\rBuOFB\u000b3i\u00147At{\u001a\u0460}|Op7F\u0234\u0647\u001en\u0002H}1o\u001bX\t4JxtV3\u001dv\u00076F\u0018'0~OG9-\u0003QY'5\u0015D`'\u0011g\u0016QwGL`\bTu}G\u5035\u03ab:Es\u0006g\\\u019e8et_d[\u03982onoh\"\r{H>\u0011KL\u00066\u0017\rimPjri\u001c*4\u001e>&&\\\"Z1Q@\u0007=Ee#\u00161\u0016MJO\u001bx\u0016aPWMcX\u046b\u0013.W0}\u0002wy\u0445'ZyV&\u0011\u001f*%\u0007?\u0002>\f16M\u0015\u001eH!sg\u0001\u0018f1?k5JP/W\t\u058a\u0011\r\u0005hk.omrXe`x?a\u0017\u0013D9l\u0004v`Y\u02f0\u001b8)\u0011d\u000f&\u0013\u05d0na\u000e\u0019t\u011b5`\u000e\u0006`\u001eyt\u000e\u0007|gI\u0707aqNh[\t;\n\u0002\u0210u\u0015xEw)\u0002g\u0013L\u02cfIA\u001dmJa?]~\u0013Ua\tGh\bTY\u0012M\u5d69)a@6\fC'\u0015za\u0383pL1\u0015\u00166IzFNPsQ\u02dcf\u0017,\u0003\u0013yG\u0000\tQ\">\u0010iM\u00055O~s\\c\u0005q\u062e8hFvs\u000fW |1Z\u000fww1iv\"\"{B]/j\u0011\u0014J9\u001f\t\u0010)e\u0013\u0011^m\u0001Kd@H!3]O|j;\u00189Phk\u0727=t\u001eGlteq[6E\u0002\u0000Z\t]}_*2sL\u0001\u0007:8S/[u\u0012=\u0010SXU#`\u0007k\u0018Y%,-Xa~c\u001c/\u001dITjJR\u001a\u0001,0tT\u03e5\u0011'M\u0006zD\u000e[f|K\u0003t\\4\u0005\u000ez}\u0013\t/!~\u001b8\u0001$/\u000b\u0016D\u00fe\u001e_\u0019\u0014:D\u02fd0V7/\u0017\u0007*\u0017\r0\u0000e0O'\"y\f\u001d<W\rN\u000f\bjJ!4'\u02ccT,M5[x *\u0328,\u001dr\u0014RQ\u0012SJm_9\u000eh\u0001r1(\u000e&\u0002wFX?E=\u0016~[Dm7C\r1h\u001fal m\fU+#X1g\\z\\ur=`YD\u0005}\u0105xs'\u0011\u0d27eN\n1H\uf2e0Zj3y:\fk?-z^J@#G+b\u0015i\u027e\u0004\u00024\u0005d\n}\u0004 ;d\u01f5$6Vu5~gdx\\g\r\u0007Ce\u00194;p\u0003z&}r\u0001\ue82adqj\u0016@r\u05ca3\u001a0\u074asfU/G\u06d6~o\u0019\u000fJ\tVF!\\Cn0b4\t\b#`\u0006D/v+\u0004\u0000|zV\u0013\r\\`c\u001c+li\u0013g\u0017}ZBB8}mQ4UhW#'j+]\u0002\u06cd\u0002\u0007\tmoj\u0006\u0007\u01072OA\u05e9\u04730@\u0010vnu\u057a\u001dh\u1355\u02c3]}\u0000Z4c5/?\f{\u00140\fo<\u000exOs\u02b0?n!\":]\b\u0000\\v' >\u0016t-X$\u0001an8N*\\\u001a\u0010l>0A.\u0019\tiQ74vs$pb\u00178Z#zuD9[\u0018\u04f1\u0015cLs(\fT\u0000felNu\u0470p\"Sc|\u0004'OtO()\"\u001c\u0011Y\u04db\u001et y\u001f;N\u001ecs\tj\r:2uE<%&#\u001a\u001aA\u000f#0m\u03249H@7s '2\u0014]\u0015>c|8/NQ\u0005/\u0016\u0407-\u5cab\bd_\u043a[d\u0002_#XN\\\u0004Zt.8#l:vA$z680_\u000b;'V$M\u0013fkqoT \u001alcD7\u000bP\u0012i\u0011 \u0016\u02ddgo\u001c\u0012%HO\u07b9\u0140ifw8\u060b\u0010\u001f<'#\u069ad\t[R\u001314\u0001uTdSm7\u0011\u0018E~+\u0007cp[9+)PD.SLCJIqG\u0011?p\bu\u0019!8R40\u000bk~'\u0010S\u001eq\u0010/gCXa\\:):q4^\u0003x2\b8\u0017MB*N?\u0018\u0006u\u056d<0c\u0011z<\u001a\u001fo~\u001c\ub68d\u52290>\bN;\u0012~7'|<(NQT>\u0004F\u021f[\u000eRsb&D/\u0000BQx\u001c{\u0004Z\u049c\u001b\u0019Ad\u0001NX.\u001b!\u0014\b\rX\u001fjTwre\n3u\u0019\u0014E7xk\u075ai8Un82$\u001c@\u0004N%|\u0516\u06be\u0012\u0010<\u066daz!f^|\u0666#0\"b\u0783\u001bb\u001a\u06db~75|Up30 \u0011>C\u0015/w'\u001b/fq\u0004p=i\"P=\u01d2\u0004Gy Y*`($\u0018U6\u0348-}M%\u001b-4[FQoz4~qTv89)uG/w\u0004AwWk\"?\ti|XN+\u01ffN9\u0005\u0004,__Rw\u06dd:^\u00041_uPEIb&6HO3\\v[^\u0011\"s|*XZ'yo$\u000e\u00166`lJ`\u000b\u0004YmX\b\u0440\\\u0012b\u00016\u0001K\u0631s@\u00055i\\\u000ef;?e\u001c\u0006uG\r\u0015RFzAn\b`HF\u0730DJIlE\u001a\u0013\u0015\\\u001aOa8\ua67e\u0010\u001e_;^7@F4jozS,\u0005\u00fb%1V\bN>D;h\u0012@CLn0&u\u0002O\u0005D\b*4]_6B:'o[VF1\u0012~Md\u0004\u05d2\u0409\u079cut|[\u000brn6,mZxYX:.L\u0780?\u0015Kkbl\u02b7/Pcf\u0016xzxwje?$\\9B.\u0013-\u0000qj3N\u0007\rWz'\u0017\u02289]3Go\u0415{W(%\n1\u000f7S}P\u00e0svQ8%\u04c1d_lC\u001f9\u0013>\u0011\u0004\u0015jT_\u06c2EG\u000e4\r\u001d?\u0004[V\u0014=5ZD\u000f{v]c\u0011YoT\u001d@ct<\u06b3*\u0013+o[.\u01fd\u078d\u000br\u042e\u001d\u0019-;\ua431#\u07fa1\f\u0017B-\u0010D\u001e<\u0014z\u001d\u001a\u0003\u06c3&ZNLX9\u000b@.*\u018c\bne\u0012p\u843aQ\u0013d(\"\u0014|~\u0019^\u0003[\u0011|\u0010a>%,-J(0v\u001e\u0016j|\u0016kZ1\\FV'\u0014tu+)Su1TJ#\u0019HwdUj\u0656P\u0017/+2w\u000b&5:xGd~.U;X_NO\u000f#]\u001dqaC\u0016\u000bBZj^7cy\u03b7\u000e=0BzT<V\u019c?BV1Pf\u0010\u000b*i/ro\u001ciZ/2\f\u0005\u001e}&\u0671EJ85+l5a3\t\u001bf!*4){5-\u0010e\\\n\u000fu^\ude1dqNAX}>\u00172\u001b2rHo~\u0003A\u0017ZJ\u000f\u0016\u001bWb\u0003^'\u001c]!\u05c9p\u0002(|8Fz\u000e\rjZ\u000eTNbjg\u0002\"m*nR@e[hF\u0018#y\u0411 VA\f\u001ba\\]O\u0005c {6jj\u0015,?V\fYS\u00029\u07056C(\u001fUR\u0010v\u0002ur=\u0011\u0011ddx\u0549s1-o\u001b\u057b\u001d,B\u01b1h\u0007Rs/w,\u0006x<\u0019_U=<s:\u0016\u001e0x\u23704<\u03d4l\u034cS\u0170\u0122MxAs\u001b\u001e~(W\u00137!xK(e{\u0017>&\u0007\u0012\u001c~Wc*\u0013~E^UPLOJHR*>=7&u\u0013f!7\u001dt1R\u0012\u037c:8\u0000\u001dO]e`\u0014\u001e=5E.:\\-\u001e?zz*\u0001\u0376n\u0006C'\u00115\u001f\u001el\u0003\u000b\u0005\u07f8\u045d\b2\u0019\tV1M@:=\u0019tCfC6<xzKE2\u0016\u001c]/\u001co:TN5z\u0014N[-,k\u0013|c\n\u0006&4\u0014$}C-bf~|~#L\u000b\u0015Q$B\u0011\u03f5\u000e\u001f\u0005\u001c\u001a\u0601T\u001f4]^\u000b\u02e7#\u0015\u067ac/\u02ddG\u0672)(pz\bDqG:E5`\u001e\u001ch\u001eQS9\u001aW4}j'\u0016T73$MB\u0001_\u000b\u0019-\u0001\u0015\u0018\u001f}\u0015h[\r=dGY`Si^n9!O\u0004<c>\u001fAI\u0006\u9920\u00106,\u000b\u0012i\u0005\u001c+3\u0003i\u0255\u0003/Q\u6cdfif\u00018os^I\u0017HRxvQCFS\u0003(-\u00004jI\u000b\u0000I\u00034Y`a\u00b7ZQ\u0002\u069enl\u059aI\udee64?D@#ph\u043ee@\u0261\u001eG>E1FjGF\u0018\u05d8?q\u000bWt\u001fFW\u0012n= \u001aG\t7q}\u01b4\u0601AH-y k=\u0019wVze.h0\u0013f$S\u001fQE\u0013m\u0015<[Z5m5mZJ%(,s\u05afI_<#A*l-.zK_\u0017]CU\u0697-$\u000bZWz>\u001103,/\u05dc-s2,F=\u001c\b\u0011\u001f#\u001fXBRJ\"\u00176n+\u001a&X.H#7#\u0013S>\u0005Qk+}U\u02476T\u0001uQY\fl\u0216a\t,\u0002\u02a2f[\u000f\t%W\u001c)\u0013g4`\u001f?G'4$\u03a4NOsP/c\u0010\u00124w{f\u016c\u00195$7\udbf6\ude05i\u0011G]-1MfP\u010c_MxXy#s(07}=g7rju=\\i\ufdf1HZ{cDJ\u0001&K\u01e6s3yL.yWt(l`3_+\u01d7/,n\u0014\u00016\u0014\u0006\u063a:vzn3-<7\u001e\u0004pP@o\n31o\uf5ebQE>A\u0005^?m4]\u001bU\u07be\u000fr-\r>\u000f\\\u01ab6q&!xc'N .\u0018f\\\u0000\n\u000btiY9!J+69H&\u0007\t[VeXNeh\\\u03dd\u0017 \u001e\u0001Aecx\u0389\u03bb0S(s-\u001c\\::\u0000}O2pUKz`\fUC\u0015\u0002*~\u0011~E<}>\u05adh\u0017;;Ek\u05f9\u0004\u02c2K\u001c\u001f?#]),\u0006UuHXbYSOE/9\u027bn\u06f7>1\u00185\u001e5'hpK\n\u0002\u0005`icX\u001d\u03c0\u0794e\u001dx4\u0011/\f3Q\u0002\u077dr\rf<d.W\u0007b!l>\u001fy.8}P\u071dr%\u000fCe\u0004y1hV>Jan\f\u001c\u0013So5tTm#\u0015\u000ffl)!P+xn$\u0004Su)Y6*a\u0019DT\u001e;4x9wtD\u0014'|\u001c\u0010B'}CYV3VV\u0010h\rAY\bR\u0014N(\u062c\u00154\\\nmu7o-kN\u000f\u00ebe<5\u000eH8Nj\u0013\u001duFkyq`\u001a\\EZ+~UG\"7MC\u02c7Z\u000b5\u0006s$)\u0016\u001e|5T\t\u07b58DZ)NIe\u0016\u001aC}\u023a\u02ee\u001cBv\u0016\u0005iaz(\u000e|ea2j\"\u0016^Ke$y=7'S b3G\u0149\rQV\tiE\u045cC\u97cdi\u0095\u0017l\u0000\u03bd+b=\u000f\u07bc\r^l_L~Hu.\nl9^&P$G0\u001d5\u05fds\u0017\\GWf\u0019gy4&?Z\u0006\u001e@6c<*78;\u06f1qwPHXm\u000b|T\u0400=\u0000N +\u0014\u001d\u010d\u001fD<h*.#\t\u01aa\u001bmA_\u000698F \u001d\u04f1;\bf>N\u001d!bU}t\u0007Eykx68H\u001f\u0014\u0019\u0007\u0014@r\u001ew~o\u001a'\u0565\u000b3B\u0014\u000f\u0345(_n\u16e3}ij\u0010H\u000ecv1\u001fO:\u0004pzPR%Q\u0005)> \u0010#gp\u0018!Kf\u0019\f\u0004J\t\u000b\u0001v\u0310t\u06f6\u001b|j\u0003QB\u0006g\u0744\u00132g\u035b\nW~K2dGs\u0002B}Q\bamF0\r:O}w\u0003N6k\n\n\u0017\u001ddOtUE\b\u0004i\u0004J>0IO\f\u0018i8\u021f\bK,i6S4M=;>M\u0002Q!\"\u0004\u02b2n&u7V\rUn~|\r\u001eA\u0014+\u0015\u0010(a\nd\u0002@Z\u000b[n}\u001c1R\u0011g(d@+zusiU\u00134wt9\u0019I\u001cn|.2-\u0003\u000b\u00f0,\t\u0017X\u001ejdmg!~s\u05e8%\u0676\r{\u0013\b}\u001c\u047b\u0019>b6-}5\u0002I\u0005Tl\u001c\u0000%\u0018[q.;\u0007X@\u000f_)0WGf+;W^+6.\u000e1\b%\ud990bOg,\u0148k]q\u001f\u0007\u000e\u000e\u0019\u001a~@:;>!J7-J+_o&\u001b\u051c\u0017=u:`\u0011D:r)n#*W0AgUi3\bm:EYB]F\u070923t}\nA_\u001d3\u00180\u0001~b\u0001/<.]+-\u0017ha\u0004sz6F#\u0001U%:\u001f\u001e\b=IcNTT>n\u0002Olu\u001bec{\u06b7\u001b\u07eeh\u000ew\u000fy\u0012\u0006Gp31PrC3ld\bM\u0010%4|:\u0005_l{\u001dczDh\u0005\u3e9dd\u000b1]XH5!k\u0017;\u000b\u0017ZzRE\u0543AP6l'O\"\u0003:B\u042e\u001bJgHz{z\u02eb\u001f5\u00194 \u0011-*7({z|\u07ba\u0004\u0014>\u0007%\u07a5\u01d1\u0002l\f~\u00022i7KW$Qucv<)X~u7\u001ePwM0;\u0017\u001dPj@%\u0004u>*q;\u064a)BH\u001dD\u0015\u0014'\u011c\u0018\u01b7\u90f6mk3o\u001cn\u0010Ji!6u\u001f-C\u0011A\u0003c\u001f\u03fb\f\t!k:\u0000$\u001e\u00e6\u07e0Pc 1\u000f$\u039bx\u001eF\u001a`+\rD\t\u000b/.\r\u0016~\u0017N{L{5OV`\u054cA`yN\u051cW+k$\u0263~2E\uef12ZL\u00e2\u001d\u0016\u0010U\u0007\u0234\u0013>wT\u001c\u6d45P&=Db\u000exm\u0015(>8@Tf(\u0007\u011cTXm3:q\r\rGin=5\nD)r\u0015hV\b[]&\"\"~lvv\u0002\t\u05f1{UdES)R2\r\\\u0003\f\u0018fW}d\u05751m4i\u0004FF~E?/\u0769HA*Z,bs\t@XW\u0012Pp-\u02abgj\u000f+\u0018#xHAo\t\u0327Jb\u001c%Onh\u001b3\u0013!e&x#9j(\u0410En\u001f\u0006)h-T170\u0000l\u0017\" \b.\u000b$DP\u001c\u0006n79DnmeIuqD\u001bgaG\u01a90_\u001d)x(2 e|8]\u0018+PghYje(\u000e,2786\f \u0006\u0001\u001bmUS^\u0007$\u0006Ecgx3\u6237,|\u0002\u000e\u00079<\r~EQAO\u000eJ\u0019Ok\b \u0012/\u0012*[4_Y&5+\t>2\u012d\u0015h]t\u001aYT@j\u0013&RM7$Th]-G\"Y6+=\u012dQB.R<kP/G<-\u0013{,\t\u0734z\u6d79KeQqkV\u0776TLvkMlC\u001dc\u029aT ;6k1l<?B{9e\u0000w<v-[{;\u0018\u001d\b\u0000~Rw\u001e!@\u0002h\u02d3\u0013]5!N~oN\b\u001a&O\"|@?=\u0018<\u0003\t#(A\u001f\u000b;W"
        });
        """
        await sock1.exec("Runtime.evaluate", {"expression": script})
        a = True
        while a:
            await asyncio.sleep(4)

    os.kill(process.pid, 15)


asyncio.run(main())
